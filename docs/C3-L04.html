<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oren Bochman">
<meta name="keywords" content="Mixture Models, Kernel Density Estimation, Mixture Density Estimation, Clustering, Classification, notes">

<title>Applications of Mixture Models – Bayesian Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-923206e44a13b4518db4dede9f4ebdc9.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-37379e3bbb48fc9e4c504b22bdb22879.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-e12ace95bce8268b44b48d9ebb190a16.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-37379e3bbb48fc9e4c504b22bdb22879.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C3-L01.html">3. Mixture Models</a></li><li class="breadcrumb-item"><a href="./C3-L04.html">Applications of Mixture Models</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian Statistics</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">1. From Concept to Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on paradigms of probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes’ Theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability and Bayes’ Law</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability and Bayes’ Law</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Random Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frequentist Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework - Frequentist MLE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Likelihoods and MLEs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Posterior Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bernoulli/binomial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Poisson Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Honors Quiz - Beta Bernoulli</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exponential Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework exponential data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normal/Gaussian Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Normal data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-Informative Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Alternative Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Brief Review of Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">—</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Honnors Homework On Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">2. Techniques and Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Modeling and Monte Carlo estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monte Carlo estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Metropolis-Hastings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on the Metropolis-Hastings algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Gibbs sampling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW - Gibbs-Sampling algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Assessing Convergence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on the Gibbs-Sampling algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Honnors Homework on M-H algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Linear regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW on Linear Regression Model Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW - Deviance information criterion (DIC)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">C2-L08 ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW on ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW+ - Multiple Factor ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Logistic regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Poisson regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Poisson regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Hierarchical modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Hierarchical Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Non-Normal Hierarchical Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Capstone Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Predictive distributions and mixture models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">3. Mixture Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex1-Basic-Definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex2-Gaussian-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixtures of Gaussians</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex3-Zero-Inflated-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Definition of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex4-Def-mixture-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zero inflated distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The EM algorithm for zero-inflated mixtures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The EM algorithm for Zero-Inflated Mixtures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The EM algorithm for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MCMC for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The MCMC algorithm for Zero-Inflated Mixtures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov chain Monte Carlo algorithms for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Applications of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Old Faithful eruptions density estimation with the EM algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Old Faithful eruptions density estimation with the MCMC algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Mixture Models for Classification of Banknotes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Practical Considerations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computational considerations for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Information Criteria (BIC)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Estimating the number of components in Bayesian settings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Estimating the partition structure in Bayesian models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The MCMC algorithm for Zero-Inflated Mixtures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Time series Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 0: Introductions to time series analysis and the AR(1) process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductions to Time Series analysis &amp; the AR(1) process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The AR(p) process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normal Dynamic Linear Models, Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normal Dynamic Linear Models, Part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 0: Feyman Notebook on Bayesian Time Series Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">5. Capstone Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">C5-L01.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">6. Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Discrete Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Discrete Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Indicator Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exponents &amp; Logarithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The ArgMax function</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Law of large numbers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Central Limit Theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conjugate prior - Wikipedia</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Link function</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes by backprop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Books in R &amp; Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#applications-of-mixture-models" id="toc-applications-of-mixture-models" class="nav-link active" data-scroll-target="#applications-of-mixture-models"><span class="header-section-number">1</span> Applications of Mixture Models</a>
  <ul class="collapse">
  <li><a href="#density-estimation" id="toc-density-estimation" class="nav-link" data-scroll-target="#density-estimation"><span class="header-section-number">1.1</span> Density Estimation</a>
  <ul class="collapse">
  <li><a href="#density-estimation-using-mixture-models" id="toc-density-estimation-using-mixture-models" class="nav-link" data-scroll-target="#density-estimation-using-mixture-models"><span class="header-section-number">1.1.1</span> Density Estimation using Mixture Models</a></li>
  <li><a href="#density-estimation-example" id="toc-density-estimation-example" class="nav-link" data-scroll-target="#density-estimation-example"><span class="header-section-number">1.1.2</span> Density Estimation Example</a></li>
  <li><a href="#sample-code-for-density-estimation-problem" id="toc-sample-code-for-density-estimation-problem" class="nav-link" data-scroll-target="#sample-code-for-density-estimation-problem"><span class="header-section-number">1.1.3</span> Sample code for Density Estimation Problem</a></li>
  </ul></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering"><span class="header-section-number">1.2</span> Clustering</a>
  <ul class="collapse">
  <li><a href="#mixture-models-for-clustering" id="toc-mixture-models-for-clustering" class="nav-link" data-scroll-target="#mixture-models-for-clustering"><span class="header-section-number">1.2.1</span> Mixture Models for Clustering</a></li>
  <li><a href="#clustering-example" id="toc-clustering-example" class="nav-link" data-scroll-target="#clustering-example"><span class="header-section-number">1.2.2</span> Clustering example</a></li>
  </ul></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">1.3</span> Classification</a>
  <ul class="collapse">
  <li><a href="#mixture-models-and-naive-bayes-classifiers" id="toc-mixture-models-and-naive-bayes-classifiers" class="nav-link" data-scroll-target="#mixture-models-and-naive-bayes-classifiers"><span class="header-section-number">1.3.1</span> Mixture Models and naive Bayes classifiers</a></li>
  <li><a href="#lda-and-the-em-algorithm" id="toc-lda-and-the-em-algorithm" class="nav-link" data-scroll-target="#lda-and-the-em-algorithm"><span class="header-section-number">1.3.2</span> LDA and the EM algorithm</a></li>
  <li><a href="#linear-and-quadratic-discriminant-analysis-in-the-context-of-mixture-models" id="toc-linear-and-quadratic-discriminant-analysis-in-the-context-of-mixture-models" class="nav-link" data-scroll-target="#linear-and-quadratic-discriminant-analysis-in-the-context-of-mixture-models"><span class="header-section-number">1.3.3</span> Linear and quadratic discriminant analysis in the context of Mixture Models</a></li>
  <li><a href="#classification-example" id="toc-classification-example" class="nav-link" data-scroll-target="#classification-example"><span class="header-section-number">1.3.4</span> Classification example</a></li>
  <li><a href="#sample-em-algorithm-for-classification-problems" id="toc-sample-em-algorithm-for-classification-problems" class="nav-link" data-scroll-target="#sample-em-algorithm-for-classification-problems"><span class="header-section-number">1.3.5</span> Sample EM algorithm for classification problems</a></li>
  </ul></li>
  <li><a href="#advanced-density-estimation-and-classification" id="toc-advanced-density-estimation-and-classification" class="nav-link" data-scroll-target="#advanced-density-estimation-and-classification"><span class="header-section-number">1.4</span> Advanced Density Estimation and Classification</a>
  <ul class="collapse">
  <li><a href="#practice-graded-assignment-the-em-algorithm-and-density-estimation" id="toc-practice-graded-assignment-the-em-algorithm-and-density-estimation" class="nav-link" data-scroll-target="#practice-graded-assignment-the-em-algorithm-and-density-estimation"><span class="header-section-number">1.4.1</span> Practice Graded Assignment: The EM algorithm and density estimation</a></li>
  <li><a href="#honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation" id="toc-honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation" class="nav-link" data-scroll-target="#honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation"><span class="header-section-number">1.4.2</span> Honors Peer-graded Assignment: MCMC algorithms and density estimation</a></li>
  <li><a href="#honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation-1" id="toc-honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation-1" class="nav-link" data-scroll-target="#honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation-1"><span class="header-section-number">1.4.3</span> Honors Peer-graded Assignment: MCMC algorithms and density estimation</a></li>
  <li><a href="#honors-peer-graded-assignment-classification" id="toc-honors-peer-graded-assignment-classification" class="nav-link" data-scroll-target="#honors-peer-graded-assignment-classification"><span class="header-section-number">1.4.4</span> Honors Peer-graded Assignment: Classification</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C3-L01.html">3. Mixture Models</a></li><li class="breadcrumb-item"><a href="./C3-L04.html">Applications of Mixture Models</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Applications of Mixture Models</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Bayesian Statistics: Mixture Models</p>
  <div class="quarto-categories">
    <div class="quarto-category">Bayesian Statistics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Oren Bochman </p>
          </div>
  </div>
    
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Mixture Models, Kernel Density Estimation, Mixture Density Estimation, Clustering, Classification, notes</p>
  </div>
</div>

</header>


<section id="applications-of-mixture-models" class="level1 page-columns page-full" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Applications of Mixture Models</h1>
<section id="density-estimation" class="level2 page-columns page-full" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="density-estimation"><span class="header-section-number">1.1</span> Density Estimation</h2>
<section id="density-estimation-using-mixture-models" class="level3 page-columns page-full" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="density-estimation-using-mixture-models"><span class="header-section-number">1.1.1</span> Density Estimation using Mixture Models</h3>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c3l04-ss-01-density-estimation-using-mixture-models.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Density Estimation using Mixture Models"><img src="images/c3l04-ss-01-density-estimation-using-mixture-models.png" class="img-fluid figure-img" alt="Density Estimation using Mixture Models"></a></p>
<figcaption>Density Estimation using Mixture Models</figcaption>
</figure>
</div></div><section id="kde" class="level4" data-number="1.1.1.1">
<h4 data-number="1.1.1.1" class="anchored" data-anchor-id="kde"><span class="header-section-number">1.1.1.1</span> KDE</h4>
<ul>
<li>the typical method for estimating the density of a random variable is to use a kernel density estimator (KDE)</li>
<li>the KDE is a non-parametric method that estimates the density of a random variable by averaging the contributions of a set of kernel functions centered at each data point</li>
</ul>
<p><span class="math display">
X_1, \ldots, X_n \sim f(x)
</span></p>
<p><span class="math display">
\tilde{f}(x) = \frac{1}{n} \sum_{i=1}^n \frac{1}{h}  g(\frac{|X - X_i|}{h})
</span></p>
<p>where <span class="math inline">h</span> is the bandwidth of the kernel and <span class="math inline">g</span> is a kernel function. The kernel function is a non-negative function that integrates to 1 and is symmetric around 0.</p>
<p>For example, the Gaussian kernel is given by: <span class="math display">
g(x) = \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}}
</span></p>
<p>giving us:</p>
<p><span id="eq-kde"><span class="math display">
\tilde{f}(x) = \frac{1}{n} \sum_{i=1}^n \frac{1}{h}  \frac{1}{\sqrt{2\pi}} e^{-\frac{|X - X_i|^2}{2h^2}}
\tag{1}</span></span></p>
</section>
<section id="mixture-of-k-components" class="level4" data-number="1.1.1.2">
<h4 data-number="1.1.1.2" class="anchored" data-anchor-id="mixture-of-k-components"><span class="header-section-number">1.1.1.2</span> Mixture of K components</h4>
<ul>
<li>a mixture of K components is a parametric method that estimates the density of a random variable by averaging the contributions of K kernel functions, each centered at a different location and with a different scale</li>
<li>the mixture model is given by:</li>
</ul>
<p><span id="eq-mixture-density-estimation"><span class="math display">
X_1, \ldots, X_n \sim f(x) = \sum_{k=1}^K w_k g(x \mid \hat{\theta}_k)
\tag{2}</span></span></p>
<p>where <span class="math inline">w_k</span> is the weight of the <span class="math inline">k</span>-th component, <span class="math inline">\hat{\theta}_k</span> is the location and scale of the <span class="math inline">k</span>-th component, and <span class="math inline">g(x \mid \hat{\theta}_k)</span> is the kernel function centered at <span class="math inline">\hat{\theta}_k</span>. The weights are non-negative and sum to 1.</p>
<p>Example: a location mixture of K Gaussian distributions is given by:</p>
<p><span id="eq-mixture-density-estimation-gaussian-location"><span class="math display">
X_1, \ldots, X_n \sim \hat{f}(x) = \sum_{k=1}^K \hat{w}_k \frac{1}{\sqrt{2\pi}\hat{\sigma}} \exp^{-\frac{(x - \hat{\mu}_k)^2}{2\hat{\sigma}^2}}
\tag{3}</span></span></p>
<p>where <span class="math inline">\hat{w}_k</span> is the weight of the <span class="math inline">k</span>-th component, <span class="math inline">\hat{\mu}_k</span> is the mean of the <span class="math inline">k</span>-th component, and <span class="math inline">\hat{\sigma}</span> is the standard deviation of the <span class="math inline">k</span>-th component.</p>
<p>we can see the the two methods are quite similar, but the mixture model is more flexible and can capture more complex shapes in the data.</p>
<ul>
<li>The KDE is a special case of the mixture model where all the components have the same scale and location.</li>
<li>KDE needs as many components as the number of data points, while the mixture model can have fewer components.</li>
<li>KDE uses a fixed bandwidth,</li>
<li>MDE can adaptively choose the bandwidth for each component. In fact we have a weight for each component and a scale parameter that controls the width of the kernel function.</li>
<li>MDE tends to use less components and the weights tend to be 1/K</li>
</ul>
<p>The above model can be improved by:</p>
<ol type="1">
<li>using a scale-location mixture model, where the scale and location of each component are estimated from the data.</li>
</ol>
</section>
</section>
<section id="density-estimation-example" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="density-estimation-example"><span class="header-section-number">1.1.2</span> Density Estimation Example</h3>
<p>We use the galaxies dataset to illustrate the differences between the two methods.</p>
<p>The galaxies dataset contains the velocities of 82 galaxies in the Virgo cluster. The data is available in the MASS package.</p>
</section>
<section id="sample-code-for-density-estimation-problem" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="sample-code-for-density-estimation-problem"><span class="header-section-number">1.1.3</span> Sample code for Density Estimation Problem</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mixture models for density estimation in the galaxies dataset</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare kernel density estimation, and estimates from mixtures of KK=6</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## components obtained using both frequentist and Bayesian procedures</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading data and setting up global variables</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCpack)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: coda</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>##
## Markov Chain Monte Carlo Package (MCMCpack)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## Copyright (C) 2003-2025 Andrew D. Martin, Kevin M. Quinn, and Jong Hee Park</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>##
## Support provided by the U.S. National Science Foundation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## (Grants SES-0350646 and SES-0350613)
##</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(galaxies)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>KK <span class="ot">=</span> <span class="dv">6</span>          <span class="co"># Based on the description of the dataset</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>x  <span class="ot">=</span> galaxies</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">=</span> <span class="fu">length</span>(x)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">781209</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">### First, compute the "Maximum Likelihood" density estimate associated with a location mixture of 6 Gaussian distributions using the EM algorithm</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Initialize the parameters</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>w     <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>mu    <span class="ot">=</span> <span class="fu">rnorm</span>(KK, <span class="fu">mean</span>(x), <span class="fu">sd</span>(x))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">sd</span>(x)<span class="sc">/</span>KK</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">=</span> <span class="fl">0.000001</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>s       <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>sw      <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>KL      <span class="ot">=</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>KL.out  <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="sc">!</span>sw){</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## E step</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(n,KK))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    v[,k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> <span class="fu">dnorm</span>(x, mu[k], sigma,<span class="at">log=</span><span class="cn">TRUE</span>)  </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    v[i,] <span class="ot">=</span> <span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,])))</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## M step</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weights</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">=</span> <span class="fu">apply</span>(v,<span class="dv">2</span>,mean)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, KK)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>      mu[k]    <span class="ot">=</span> mu[k] <span class="sc">+</span> v[i,k]<span class="sc">*</span>x[i]</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    mu[k] <span class="ot">=</span> mu[k]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standard deviations</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>      sigma <span class="ot">=</span> sigma <span class="sc">+</span> v[i,k]<span class="sc">*</span>(x[i] <span class="sc">-</span> mu[k])<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fu">sqrt</span>(sigma<span class="sc">/</span><span class="fu">sum</span>(v))</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="do">##Check convergence</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  KLn <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>      KLn <span class="ot">=</span> KLn <span class="sc">+</span> v[i,k]<span class="sc">*</span>(<span class="fu">log</span>(w[k]) <span class="sc">+</span> <span class="fu">dnorm</span>(x[i], mu[k], sigma, <span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">abs</span>(KLn<span class="sc">-</span>KL)<span class="sc">/</span><span class="fu">abs</span>(KLn)<span class="sc">&lt;</span>epsilon){</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    sw<span class="ot">=</span><span class="cn">TRUE</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  KL <span class="ot">=</span> KLn</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  KL.out <span class="ot">=</span> <span class="fu">c</span>(KL.out, KL)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> s <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(s, KLn))</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1 -835.733942489325"
[1] "2 -828.010809264972"
[1] "3 -824.746233906969"
[1] "4 -822.658999626022"
[1] "5 -821.213895212478"
[1] "6 -820.205593334589"
[1] "7 -819.45255265569"
[1] "8 -818.824551232431"
[1] "9 -818.236534003549"
[1] "10 -817.634208984436"
[1] "11 -816.982967592922"
[1] "12 -816.261886189958"
[1] "13 -815.461265773593"
[1] "14 -814.58192426664"
[1] "15 -813.634925825188"
[1] "16 -812.640825431584"
[1] "17 -811.627832678685"
[1] "18 -810.628730004626"
[1] "19 -809.676914791807"
[1] "20 -808.802324442178"
[1] "21 -808.028006389222"
[1] "22 -807.36782257363"
[1] "23 -806.825578229162"
[1] "24 -806.395771901538"
[1] "25 -806.065864649222"
[1] "26 -805.819434169721"
[1] "27 -805.63925361852"
[1] "28 -805.509531004204"
[1] "29 -805.417065498588"
[1] "30 -805.351515365637"
[1] "31 -805.305136223748"
[1] "32 -805.272302459567"
[1] "33 -805.249006220074"
[1] "34 -805.232424348309"
[1] "35 -805.220578980422"
[1] "36 -805.212086217934"
[1] "37 -805.205976247832"
[1] "38 -805.201567151818"
[1] "39 -805.19837733157"
[1] "40 -805.196065008484"
[1] "41 -805.194386438224"
[1] "42 -805.193166975027"
[1] "43 -805.192280944541"
[1] "44 -805.191637566216"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>xx  <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">5000</span>,<span class="dv">37000</span>,<span class="at">length=</span><span class="dv">300</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>nxx <span class="ot">=</span> <span class="fu">length</span>(xx)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>density.EM <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, nxx)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nxx){</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    density.EM[s] <span class="ot">=</span> density.EM[s] <span class="sc">+</span> w[k]<span class="sc">*</span><span class="fu">dnorm</span>(xx[s], mu[k], sigma)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="do">### Get a "Bayesian" kernel density estimator based on the same location mixture of 6 normals</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Priors set up using an "empirical Bayes" approach</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>aa  <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)  </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">=</span> <span class="fu">mean</span>(x)    </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(x))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>dd  <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>qq  <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Initialize the parameters</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>w     <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>mu    <span class="ot">=</span> <span class="fu">rnorm</span>(KK, <span class="fu">mean</span>(x), <span class="fu">sd</span>(x))</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">sd</span>(x)<span class="sc">/</span>KK</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>cc    <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>KK, n, <span class="at">replace=</span>T, <span class="at">prob=</span>w)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of iterations of the sampler</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>rrr   <span class="ot">=</span> <span class="dv">12000</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>burn  <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Storing the samples</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>cc.out    <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr, n))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>w.out     <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr, KK))</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>mu.out    <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr, KK))</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>sigma.out <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, rrr)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>logpost   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, rrr)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>rrr){</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the indicators</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,KK)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      v[k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> <span class="fu">dnorm</span>(x[i], mu[k], sigma, <span class="at">log=</span><span class="cn">TRUE</span>)  <span class="co">#Compute the log of the weights</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span> <span class="fu">exp</span>(v <span class="sc">-</span> <span class="fu">max</span>(v))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v <span class="sc">-</span> <span class="fu">max</span>(v)))</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    cc[i] <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>KK, <span class="dv">1</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span>v)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the weights</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">rdirichlet</span>(<span class="dv">1</span>, aa <span class="sc">+</span> <span class="fu">tabulate</span>(cc, <span class="at">nbins=</span>KK)))</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the means</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    nk    <span class="ot">=</span> <span class="fu">sum</span>(cc<span class="sc">==</span>k)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    xsumk <span class="ot">=</span> <span class="fu">sum</span>(x[cc<span class="sc">==</span>k])</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    tau2.hat <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(nk<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>tau<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    mu.hat  <span class="ot">=</span> tau2.hat<span class="sc">*</span>(xsumk<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> eta<span class="sc">/</span>tau<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    mu[k]   <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, mu.hat, <span class="fu">sqrt</span>(tau2.hat))</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the variances</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  dd.star <span class="ot">=</span> dd <span class="sc">+</span> n<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  qq.star <span class="ot">=</span> qq <span class="sc">+</span> <span class="fu">sum</span>((x <span class="sc">-</span> mu[cc])<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>, dd.star, qq.star))</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store samples</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  cc.out[s,]   <span class="ot">=</span> cc</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>  w.out[s,]    <span class="ot">=</span> w</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>  mu.out[s,]   <span class="ot">=</span> mu</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  sigma.out[s] <span class="ot">=</span> sigma</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">log</span>(w[cc[i]]) <span class="sc">+</span> <span class="fu">dnorm</span>(x[i], mu[cc[i]], sigma, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>  logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">log</span>(<span class="fu">ddirichlet</span>(w, aa))</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">dnorm</span>(mu[k], eta, tau, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>  logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">dgamma</span>(<span class="dv">1</span><span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span>, dd, qq, <span class="at">log=</span><span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">4</span><span class="sc">*</span><span class="fu">log</span>(sigma)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(s<span class="sc">/</span><span class="dv">500</span><span class="sc">==</span><span class="fu">floor</span>(s<span class="sc">/</span><span class="dv">500</span>)){</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"s ="</span>,s))</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "s = 500"
[1] "s = 1000"
[1] "s = 1500"
[1] "s = 2000"
[1] "s = 2500"
[1] "s = 3000"
[1] "s = 3500"
[1] "s = 4000"
[1] "s = 4500"
[1] "s = 5000"
[1] "s = 5500"
[1] "s = 6000"
[1] "s = 6500"
[1] "s = 7000"
[1] "s = 7500"
[1] "s = 8000"
[1] "s = 8500"
[1] "s = 9000"
[1] "s = 9500"
[1] "s = 10000"
[1] "s = 10500"
[1] "s = 11000"
[1] "s = 11500"
[1] "s = 12000"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the samples of the density over a dense grid</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>density.mcmc <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr<span class="sc">-</span>burn,<span class="fu">length</span>(xx)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(rrr<span class="sc">-</span>burn)){</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        density.mcmc[s,] <span class="ot">=</span> density.mcmc[s,] <span class="sc">+</span> w.out[s<span class="sc">+</span>burn,k]<span class="sc">*</span><span class="fu">dnorm</span>(xx,mu.out[s<span class="sc">+</span>burn,k],sigma.out[s<span class="sc">+</span>burn])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>density.mcmc.m <span class="ot">=</span> <span class="fu">apply</span>(density.mcmc , <span class="dv">2</span>, mean)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot Bayesian estimate with pointwise credible bands along with kernel density estimate and frequentist point estimate</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>yy <span class="ot">=</span> <span class="fu">density</span>(x)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>density.mcmc.lq <span class="ot">=</span> <span class="fu">apply</span>(density.mcmc, <span class="dv">2</span>, quantile, <span class="fl">0.025</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>density.mcmc.uq <span class="ot">=</span> <span class="fu">apply</span>(density.mcmc, <span class="dv">2</span>, quantile, <span class="fl">0.975</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xx, density.mcmc.m, <span class="at">type=</span><span class="st">"n"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(density.mcmc.uq)),<span class="at">xlab=</span><span class="st">"Velocity"</span>, <span class="at">ylab=</span><span class="st">"Density"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xx,<span class="fu">rev</span>(xx)), <span class="fu">c</span>(density.mcmc.lq, <span class="fu">rev</span>(density.mcmc.uq)), <span class="at">col=</span><span class="st">"grey"</span>, <span class="at">border=</span><span class="st">"grey"</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx, density.mcmc.m, <span class="at">col=</span>colscale[<span class="dv">1</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx, density.EM, <span class="at">col=</span>colscale[<span class="dv">2</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(yy, <span class="at">col=</span>colscale[<span class="dv">3</span>], <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, <span class="fu">rep</span>(<span class="dv">0</span>,n))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">27000</span>, <span class="fl">0.00017</span>, <span class="fu">c</span>(<span class="st">"KDE"</span>,<span class="st">"EM"</span>,<span class="st">"MCMC"</span>), <span class="at">col=</span>colscale[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)], <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">bty=</span><span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C3-L04_files/figure-html/lbl-density-estimation-example-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="C3-L04_files/figure-html/lbl-density-estimation-example-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="clustering" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="clustering"><span class="header-section-number">1.2</span> Clustering</h2>
<section id="mixture-models-for-clustering" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="mixture-models-for-clustering"><span class="header-section-number">1.2.1</span> Mixture Models for Clustering</h3>
</section>
<section id="clustering-example" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="clustering-example"><span class="header-section-number">1.2.2</span> Clustering example</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mixture models for clustering in the iris dataset</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare k-means clustering and a location and scale mixture model with K normals</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading data and setting up global variables</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Package 'mclust' version 6.1.1
Type 'citation("mclust")' for citing this R package in publications.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mvtnorm'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:mclust':

    dmvnorm</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Defining a custom function to create pair plots</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">### This is an alternative to the R function pairs() that allows for </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">### more flexibility. In particular, it allows us to use text to label </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">### the points</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>pairs2 <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">labels=</span><span class="cn">NULL</span>, <span class="at">names =</span> <span class="fu">colnames</span>(x)){</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(p,p))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(l <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(k<span class="sc">!=</span>l){</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">+</span><span class="fl">0.1</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(x[,k], x[,l], <span class="at">type=</span><span class="st">"n"</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.null</span>(labels)){</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">points</span>(x[,k], x[,l], <span class="at">pch=</span>pch, <span class="at">col=</span>col)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span>{</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">text</span>(x[,k], x[,l], <span class="at">labels=</span>labels, <span class="at">col=</span>col)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">type=</span><span class="st">"n"</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text</span>(<span class="fl">2.5</span>,<span class="fl">2.5</span>,names[k], <span class="at">cex=</span><span class="fl">1.2</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Setup data</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>x       <span class="ot">=</span> <span class="fu">as.matrix</span>(iris[,<span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>n       <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>p       <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]       <span class="co"># Number of features</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>KK      <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">=</span> <span class="fl">0.0000001</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>shortnam  <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"s"</span>,<span class="st">"c"</span>,<span class="st">"g"</span>)</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs2</span>(x, <span class="at">col=</span>colscale[iris[,<span class="dv">5</span>]], <span class="at">labels=</span>shortnam[<span class="fu">as.numeric</span>(iris[,<span class="dv">5</span>])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C3-L04_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="C3-L04_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the parameters of the algorithm</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">63252</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>numruns <span class="ot">=</span> <span class="dv">15</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>v.sum   <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(numruns, n, KK))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>QQ.sum  <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, numruns)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(ss <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numruns){</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  w   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK  <span class="co">#Assign equal weight to each component to start with</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  mu  <span class="ot">=</span> <span class="fu">rmvnorm</span>(KK, <span class="fu">apply</span>(x,<span class="dv">2</span>,mean), <span class="dv">3</span><span class="sc">*</span><span class="fu">var</span>(x))   <span class="co">#Cluster centers randomly spread over the support of the data</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  Sigma      <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(KK,p,p))  <span class="co">#Initial variances are assumed to be the same</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  Sigma[<span class="dv">1</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  Sigma[<span class="dv">2</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  Sigma[<span class="dv">3</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  sw     <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  QQ     <span class="ot">=</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  QQ.out <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  s      <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="sc">!</span>sw){</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="do">## E step</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(n,KK))</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){  <span class="co">#Compute the log of the weights</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>      v[,k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x, mu[k,], Sigma[k,,], <span class="at">log=</span><span class="cn">TRUE</span>) </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      v[i,] <span class="ot">=</span> <span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,])))  <span class="co">#Go from logs to actual weights in a numerically stable manner</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="do">## M step</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">=</span> <span class="fu">apply</span>(v,<span class="dv">2</span>,mean)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>KK, <span class="at">ncol=</span>p)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>        mu[k,]    <span class="ot">=</span> mu[k,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>x[i,]</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>      mu[k,] <span class="ot">=</span> mu[k,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(KK, p, p))</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>        Sigma[k,,] <span class="ot">=</span> Sigma[k,,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>(x[i,] <span class="sc">-</span> mu[k,])<span class="sc">%*%</span><span class="fu">t</span>(x[i,] <span class="sc">-</span> mu[k,])</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>      Sigma[k,,] <span class="ot">=</span> Sigma[k,,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="do">##Check convergence</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    QQn <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>        QQn <span class="ot">=</span> QQn <span class="sc">+</span> v[i,k]<span class="sc">*</span>(<span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x[i,],mu[k,],Sigma[k,,],<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">abs</span>(QQn<span class="sc">-</span>QQ)<span class="sc">/</span><span class="fu">abs</span>(QQn)<span class="sc">&lt;</span>epsilon){</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>      sw<span class="ot">=</span><span class="cn">TRUE</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    QQ <span class="ot">=</span> QQn</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    QQ.out <span class="ot">=</span> <span class="fu">c</span>(QQ.out, QQ)</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">=</span> s <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>  v.sum[ss,,] <span class="ot">=</span> v</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  QQ.sum[ss]  <span class="ot">=</span> QQ.out[s]</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"ss ="</span>, ss))</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ss = 1"
[1] "ss = 2"
[1] "ss = 3"
[1] "ss = 4"
[1] "ss = 5"
[1] "ss = 6"
[1] "ss = 7"
[1] "ss = 8"
[1] "ss = 9"
[1] "ss = 10"
[1] "ss = 11"
[1] "ss = 12"
[1] "ss = 13"
[1] "ss = 14"
[1] "ss = 15"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster reconstruction under the mixture model</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">=</span> <span class="fu">apply</span>(v.sum[<span class="fu">which.max</span>(QQ.sum),,], <span class="dv">1</span> ,which.max)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs2</span>(x, <span class="at">col=</span>colscale[cc], <span class="at">labels=</span>cc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C3-L04_files/figure-html/unnamed-chunk-2-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="C3-L04_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ARImle <span class="ot">=</span> <span class="fu">adjustedRandIndex</span>(cc, <span class="fu">as.numeric</span>(iris[,<span class="dv">5</span>]))  <span class="co"># Higher values indicate larger agreement</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster reconstruction under the K-means algorithm</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>irisCluster <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(x, <span class="dv">3</span>, <span class="at">nstart =</span> numruns)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs2</span>(x, <span class="at">col=</span>colscale[irisCluster<span class="sc">$</span>cluster], <span class="at">labels=</span>irisCluster<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C3-L04_files/figure-html/unnamed-chunk-2-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="C3-L04_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ARIkmeans <span class="ot">=</span> <span class="fu">adjustedRandIndex</span>(irisCluster<span class="sc">$</span>cluster, <span class="fu">as.numeric</span>(iris[,<span class="dv">5</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="classification" class="level2 page-columns page-full" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="classification"><span class="header-section-number">1.3</span> Classification</h2>
<p>Classification is a supervised learning problem where we want to predict the class of a new observation based on its features.</p>
<p>According to the instructor the main difference from clustering is that in classification we have a training set. I would think the main difference is that we have labels for some of the data, while in clustering we do not have labels at all.</p>
<p>The fact that we have labels and a training set means we should know how many classes we have and we can use these labels to train a model and use it to predict the class of a new observation.</p>
<p>The instructor mentions Support Vector Machines (SVM), logistic regression and linear discriminant analysis (LDA) as familiar examples of classification methods. These and a number of others are covered in <span class="citation" data-cites="isl">(<a href="#ref-isl" role="doc-biblioref"><strong>isl?</strong></a>)</span>. We will focus on Naive Bayes classifiers as it is the most similar to mixture models and the EM algorithm which we have seen earlier</p>
<section id="mixture-models-and-naive-bayes-classifiers" class="level3 page-columns page-full" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="mixture-models-and-naive-bayes-classifiers"><span class="header-section-number">1.3.1</span> Mixture Models and naive Bayes classifiers</h3>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c3l4-ss-04-classification-overview.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="K-means clustering"><img src="images/c3l4-ss-04-classification-overview.png" class="img-fluid figure-img" alt="K-means clustering"></a></p>
<figcaption>K-means clustering</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c3l4-ss-05-classification-naive-bayes.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="K-means clustering"><img src="images/c3l4-ss-05-classification-naive-bayes.png" class="img-fluid figure-img" alt="K-means clustering"></a></p>
<figcaption>K-means clustering</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c3l4-ss-06-classification-mixtures.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Mixture Models for Clustering"><img src="images/c3l4-ss-06-classification-mixtures.png" class="img-fluid figure-img" alt="Mixture Models for Clustering"></a></p>
<figcaption>Mixture Models for Clustering</figcaption>
</figure>
</div></div>

<section id="naive-bayes-classifiers" class="level4" data-number="1.3.1.1">
<h4 data-number="1.3.1.1" class="anchored" data-anchor-id="naive-bayes-classifiers"><span class="header-section-number">1.3.1.1</span> Naive Bayes classifiers</h4>
<p>The idea of Naive Bayes classifiers is that we want to know what is the probability that observation i belongs to class k and we can obtain this using Bayes’ theorem by computing the prior probability that an observation is in that class. This is just the frequency of the class multiplied by the density of that class and divided by the sum over the classes of the same expression.</p>
<p><span id="eq-bayes-classifier"><span class="math display">
P(x_i \in \text{class}_k) = \frac{w_k \cdot g_k(x_i|\theta_k)}{\sum_{j=1}^K w_j \cdot g_j(x_i|\theta_j)}
\tag{4}</span></span></p>
<p>where <span class="math inline">w_k</span> is the prior probability of class k, <span class="math inline">g_k(x_i|\theta_k)</span> is the density of class k, and <span class="math inline">\theta_k</span> is the parameter of class k.</p>
<p>with</p>
<p><span class="math display">
\tilde{c}_i = \arg \max_k \mathbb{P}r(x_i \in \text{class}_k)\ for \; i=n+1,\ldots,n+m
</span></p>
<p>The naive Bayes classifier assumes that the features are conditionally independent given the class. This means that the density of class k can be written as the product of the densities of each feature given the class: <span class="math display">
g_k(x_i|\theta_k) = \prod_{l=1}^p g_{kl}(x_{il}|\theta_{kl})
</span></p>
<p>where <span class="math inline">g_{kl}(x_{il}|\theta_{kl})</span> is the density of feature l given class k and <span class="math inline">\theta_{kl}</span> is the parameter of feature l given class k. This means that we can estimate the density of each feature separately and then multiply them together to get the density of the class.</p>
<p>This is a very strong assumption and is not true in general. However, it works well in practice and is often used in text classification problems where the features are the words in the text.</p>
<p>The naive Bayes classifier is a special case of the mixture model where the components are the classes and the densities are the product of the densities of each feature given the class. This means that we can use the EM algorithm to estimate the parameters of the model in the same way as we did for the mixture model. The only difference is that we need to estimate the densities of each feature separately and then multiply them together to get the density of the class.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Video Transcript
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The last class of problems for which mixture models are very useful is classification problems. If you come from the machine learning literature, you will call this supervised classification to contrast, again, unsupervised classification that I called clustering before. The goal in supervised classification is to start with a training set and use the information in a training set to determine the classes or the labels of a second group of observations that you call the test set. So you start with a training set that contains known labels classes. You also have a test set that has unknown labels, and you want to use this information to make predictions about the test set labels. For example, you may want to decide whether a person suffers from a disease or not based on a set of medical tests, maybe P medical tests, and you have gone out and measured those tests in a number of individuals. So you know those individuals whether they are sick or they are not sick. Based on that training set that is labeled where you know what the real quality of the individuals is, then you go out and you are going to pick just a random person that comes into your medical appointment, and based on the results of the test, now you want to decide if that individual suffers from the disease or not. So the presence of the training set is really what distinguishes clustering problems from classification problems. In clustering problems, we don’t have a training set. We don’t have anything that gives us a hint about how the classes look like. We’re trying to do the process of dividing the observations into groups in some sense blindly. That’s why it’s sometimes called unsupervised classification because you can think that the training set provides supervision in how you do the classification. In typical supervised classification problems on the other hand, you do have that training set. You do have that group of labeled observations that can help you make decisions about how the new groups will look like. So in some sense, supervised classification is a simpler problem than unsupervised classification because of the presence of the training set. Now, there are a number of classification procedures out there. This is a fairly common problem in the literature. You may be familiar with things like support vector machines or logistic regression for classification. I want to discuss today the similarities between using mixture models for classification and some techniques such as linear discriminant analysis, and in particular with Naive Bayes classifiers. The idea of Naive Bayes classifiers is very simple. So if you want to know what is the probability that observation i belongs to class k, you can typically obtain that by just using Bayes’ theorem by computing the prior probability that an observation is in that class. That is typically just the frequency of the class multiplied by the density of that class and divided by the sum over the classes of the same expression. Now, again, this should be very familiar. This quantity here is essentially what we used both in the EM algorithm to compute the [inaudible] case and in the MCMC algorithm if you are fitting a mixture model from a Bayesian perspective to sample the class labels C sub x. So in other words, it’s clear just from writing the expression from Naive Bayes that there should be a very close relationship between doing Naive Bayes and doing mixture models. In fact, you can cast Naive Bayes classifiers as just as a special case of mixture models. Let’s discuss Naive Bayes classifiers where we use Gaussian kernels for the classification. Let’s enter this a little bit of notation. So remember that we have both a test set and a training set. So let’s call X_1 up to X_n my training set, and let’s call X_n plus 1 up to X_n plus m the test set. In other words, we have n observations in the training set, we have m observations in the test set and we just group the observations together so that the first n in the sample are the training and last m are the test. In addition to this, because the training set is labeled, we’re going to have C_1 up to C_n are known, but C_1 or C_n plus 1 up to C_m plus n are unknown and we want to protect them. Let’s write a Naive Bayes classifier that uses Gaussian kernels, and we’re going to use the more general Gaussian kernels that we can. So in that case, the probability that observation i belongs to class k, it’s going to be equal to Omega_k 1 over the square root 2 Pi to the p.&nbsp;Remember that we’re working with P variate normal. So we can have P features for each individual, determinant of Sigma_k to the minus one 1/2 X of minus one 1/2 X_i minus Mu k transpose sigma sub k inverse X_i minus Mu k, divided by the sum over the components of exactly the same expression. This has to be l, minus Mu sub l transpose sigma l inverse X_i minus Mu l. So this is just Bayes theorem as we have written multiple times in this course. So what you do is, you need this expression only for the training set because for the test set you already know what class you are in. So what you typically do is a two-step process in which you get Mu k hat and Sigma hat sub k are estimated from the training set. You could do different things, but it’s very fairly common to just fit a multivariate Gaussian to each one of the components. So your Cs, your labels divide your training set into groups. For each one of those groups, you fit one different normal and that gives you Sigma and Mu. Similarly, for Omega k, you want to get an estimate for Omega k, and the natural thing to do is to just use the frequency, the fraction of the observations in the training set that belong to each one of the classes. Once you have those, then you classify new observations as by letting C_i be equal to the org max of that probability. Where the probabilities are computed by plugging in these maximum likelihood estimators in this formula up here. As I said, this is done for n plus 1 all the way to n plus m. So you don’t need to do this for the training set, the training set you know the labels and you use those labels to compute the MLEs that get plugged into this. Now, with additional observations in those MLEs, you can decide what are the classes for them. So this is what a naive Bayes classifier based on Gaussian distributions for each one of the classes would look like. Now, this is exactly the same as the EM algorithm that we have discussed in the past for mixture models, if we make a couple of assumptions or if we incorporate a couple of assumptions into the algorithm. So let’s write down that next. We can recast the algorithms that we just saw for naive Bayes classifier based on Gaussian kernels in the context of the EM algorithm that we have been discussing for mixtures. That is very easy, we’re going to think, again, about an E-step and an M-step, and we’re going to add an additional post-processing step, if you will. In our E-step, if you remember, what we did in the past was to compute the indicators for the variables. So that is our variables V_i,k that corresponds to the weights that are associated with each one of the components. What we’re going to do in this case is we’re going to define the V_i,k in a very simple fashion rather than doing it using Bayes theorem. Because we actually know what observations or what components are generating each of the observations in the training set, we can call V_i,k just one or zero if C_i is equal to k and zero otherwise, for all the observations that go from one to n.&nbsp;In other words, this is for the training set. Once we have defined our E-step in this way, we’re going to have an M-step where we compute Mu sub k and Omega sub k. To put it in the same way that we did with the EM algorithm, this is going to have a very particular shape. It’s going to have the sum from one to n of V_i,k X_i divided by the sum from one to n of V_i,k. In a similar expression for my matrix Sigma, Sigma is going to be Sigma sub k, it’s going to be one over the sum of the V_i,k from one to n, sum from one to n of V_i,k X_i minus Mu k, X_i minus Mu k transpose. These are expressions that we have seen in the past when filling mixtures of multivariate Gaussians to data. This is just a fancy way, so casting it in terms of the E-step and the M-step, it’s just a fancy way to say, I know what my assignments are, for sure, because this is a training set. So this is just computing the average of the observations that are in category K because, in this case, these are either zeros or ones. Similarly, here, this is just the variance covariance matrix of the observations that are in component K, but it’s written in a fancy way using this V_i,k as indicators. Then, we have a post-processing. It’s in the post-processing step where the test set comes into play. So for now, we have only used the training set for our calculations. In the post-processing step, what we do is we allocate C_i based on the arc max over K of the posterior distribution of the class allocations. So that is probability that X_i belongs to class K. So this is just another way to write the algorithms as we had before, that is very simple in the context of [inaudible]. So why did I go through the trouble of expressing this in this complicated manner when I had a very simple description before? Well, because now you can try to generalize this from this supervised setting where you completely break apart the estimation of the parameters that only uses the training set and the classification that only uses the test set. You can actually try to combine information from both, and it should be clear that if you have training sets that are just very small compared to the test set, the estimates that you get for Mu and Sigma will be very bad because they will be based on very few observations, very few data points. So if you could somehow use some of the information that you are recovering by doing the classification to help you estimate what Mu and Sigma are, they’ll probably give you more robust, stronger algorithm. How to do that should be relatively straightforward once you think about it in this context. For the observations to the training set, we have the value of the V_i,k, but we could add an estimate of the value of the V_i,k for the observations in the test set to this calculation. We already know how to do that. So we’re going to turn the algorithm iterative now. So these guys are always going to be defined in this way because I know the C’s, but these guys are refined at every iteration of the algorithm. I’ll just make this essentially equal to the probability that X_i belongs to class K given the current parameters of the model, so given the current Omegas, the current Mus, and the current Sigmas. Then, I can extend my sums to m down here and down here. Now, what I’m doing is, for the observations that I know what class they are in, these weights are either zeros or ones. For the ones that I don’t know but I’m trying to classify, they will be some number between zero and one, and I’m just going to do a weighted average so you can think about this, again, as a weighted average of the information that I know for sure, and the information that I’m recovering about Mu and Sigma from the classification. So again, this now becomes an iterative algorithm, so I need to think about t plus 1, t plus 1, t plus 1, t plus 1, t plus 1, t plus 1, and t plus 1. So I have turned what was just a two-step algorithm that doesn’t require any iteration, I turned it into an iterative algorithm that uses the whole sample to estimate the parameters of the classes. This is sometimes called a semi-supervised; I don’t necessarily like the term very much. But this is sometimes called a semi-supervised algorithm, in the sense that it’s not completely supervised because of the addition of this information and the fact that now, the sums go up to m. But it’s also not fully unsupervised because I’m using the information, I’m using this piece up here that has information where I know their true labels. Once the algorithm converges, I’m still going to do the post-processing step that is to go from this V_i,k’s that I computed here for the test set to generate what are the labels for those observations.</p>
</div>
</div>
</div>
</section>
</section>
<section id="lda-and-the-em-algorithm" class="level3 page-columns page-full" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="lda-and-the-em-algorithm"><span class="header-section-number">1.3.2</span> LDA and the EM algorithm</h3>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c3l4-ss-08-lda.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="LDA"><img src="images/c3l4-ss-08-lda.png" class="img-fluid figure-img" alt="LDA"></a></p>
<figcaption>LDA</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c3l4-ss-09-lda.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="LDA"><img src="images/c3l4-ss-09-lda.png" class="img-fluid figure-img" alt="LDA"></a></p>
<figcaption>LDA</figcaption>
</figure>
</div></div>
<p>It is important to understand the connection between using mixture models for classification and other procedures that are commonly used out there for classification. One example of those procedures that has a strong connection is linear discriminant analysis and also to quadratic discriminant analysis.</p>
<p>To illustrate that connection, we start with a very simple mixture model.</p>
<p>So let’s start with a mixture model of the form,</p>
<p><span class="math display">
f(x) = \sum_{k=1}^2 \omega_k \frac{1}{\sqrt{2\pi}} \frac{1}{\sqrt{\text{det}(\Sigma)}} e^{-\frac{1}{2}(x - \mu_k)^T \Sigma^{-1} (x - \mu_k)}.
</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Video Transcript
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It is important to understand the connection between using mixture models for classification and other procedures that are commonly used out there for classification. One example of those procedures that has a strong connection is linear discriminant analysis. And also, by the way, quadratic discriminant analysis. But let’s start with linear discriminant analysis.</p>
<p>And to illustrate that connection, let’s start with a very simple mixture model.</p>
<p>So let’s start with a mixture model of the form, <span class="math inline">f(x) =</span> the sum from 1 to 2. So I’m going to be working only with two components of omega k, 1 over the square root 2pi to the p determinant of sigma to the -1 half, x- 1 half, x, mu sub k, transpose sigma inverse, x- mu sub k. So this is two-component mixture with locations bearing with a component, but the same variance-covariance matrix for the two components that I have in the mixture.</p>
<p>And let’s think about how the procedure would look like if we were to do Naive Bayes classification using this mixture. If I follow the unsupervised example that I have discussed before, the probability that I put observation i in class, 1, say, I only have two classes.</p>
<p>So as you see again, consider one of them and the other one is just 1- the numbers that I get here. It’s going to be equal.</p>
<p>And I’m going to expand this in all its glory. It’s going to be a little bit long. So it’s going to be omega 1, 1 over the square root 2pi to the p determinant of sigma to the- 1 half, x of- 1 half, x- mu k transpose sigma inverse x- mu k. And in the denominator, we’re going to have the same expression first. And then we’re going to have omega 2, that is just 1- omega 1 but 2pi to the p determinant of sigma to the- 1 half x- 1 half x- mu 2, sigma inverse x- mu 2. Okay, and we know that the probability that xi belongs to class 1 is exactly the same expression but replacing mu, 1 which is what should be up here, replacing mu1 with mu2.</p>
<p>So, in the post processing step, we are going to assign C sub i = 1 if and only if the probability that xi belongs to class 1 is greater than the probability that xi belongs to class 2. And because the two expressions are the same in the denominator, the only thing that changes is the numerator, then this happens if and only if omega 1, 1 over the square root 2pi to the p determinant sigma to the- 1 half x- 1 half, X- mu1 transpose sigma inverse x- mu1, Is greater than omega 2, 1 over the square root 2pi to the p determinant of sigma to the- 1 half x of- 1 half x- mu2, sigma inverse x- mu2. So probability of class 1 greater than probability of class 2 only if this quantity is greater than the same thing but evaluated for the second component in the mixture. So let’s do a little bit of algebra and let’s try to simplify this expression a little bit and we will see that that simplification leads to a very nice expression that matches exactly what you get out of linear discriminant analysis. So now we want to simplify this expression that corresponds to the situation where we’re going to label an observation coming from class 1, and we want to make it much more compact. So a few things that we can observe. So one of them is we have 1 over square root 2pi to the p on both sides, so we can cancel that. The other thing that we observe is that we have the determinant of the variance-covariance matrix on both sides. And because we’re assuming that the two components have the same variance- covariance matrix, we can again just simplify both terms on either side. And the next thing that I’m going to do is I’m going to move all the omegas to one side and bring all the terms with the exponentials to the other side. If I do that, I’m going to end up on the left hand side with the exponent of- 1 half, X- mu1 transpose sigma inverse x- mu1. And then this term came to the other side in the denominator, but that just means that when it goes into the exponential, I need to change all to reverse signs. So it’s going to be- x- mu2 transpose sigma inverse x- mu2. So that’s the expression once you move this to the denominator and combine the two exponentials. And this needs to be greater than omega 2 divided by omega 1. Now, some further simplifications. I can take the logarithm on both sides and I can multiply by -2 on both sides, and I end up with an expression that looks like x- mu 1 transpose sigma inverse x- mu1- x- mu 2 transpose sigma inverse x- mu 2 has to be less than, because I’m going to end up multiplying by a -2. So less than -2 log of omega 2 divided by omega 1. So now we have this difference of two quadratic forms needs to be less than a certain constant that depends on what are my prior weights for each one of the two components. Now, to finish simplifying this, we need to expand these two squares, which is pretty straightforward. So first we’re going to have x sigma inverse x transpose sigma inverse x. This is just a square. So it’s going to be 2 times x transpose sigma inverse mu1. And finally, <span class="math inline">\mu_1</span> transpose sigma inverse <span class="math inline">\mu_1</span>. And then we need to subtract a similar expression but using mu2 for it turns. So it’s going to be x transpose sigma inverse x. It’s going to be +, in this case, 2x transpose sigma inverse mu2. And finally, again,- mu2 transpose sigma inverse mu2, and all of these needs to be less than -2 log of omega 2, Divided by omega 1. So you can see that the expressions are relatively straightforward.</p>
<p>And one of the things that is very nice, and it’s a consequence of having the same variance-covariance matrix for each one of the components, is that now this quadratic term of the data is going to cancel out. And so, we can just basically learn together a couple of terms. So we can write, 2 times, X transpose sigma inverse multiplied by mu2- mu1. So I’m taking this term and combining it with this term. So, the term here and the term here.</p>
<p>And then I’m going to say that this has to be less than -2 times log of omega 2 divided by omega 1, and I’m going to move this two terms to the right. So,+ mu2 transpose sigma inverse mu2- mu1 transpose sigma inverse mu1. So this is actually quite a bit of simplification and it’s a very interesting one. Because you can think about this, Thing on the right hand side, just call this T for threshold. So this is your sum threshold and that threshold is basically computed based on the training data. So if I know the classes of some observations, I can get what the means for each one of the classes are, I can estimate the common sigma, and I can estimate the relative frequencies. And with that, I can obtain a stress score from the training set. And I can think about this matrix product as sum vector a. The form of this simplified expression is very interesting. You can see that the right-hand side, all this expression in the box, it’s just a threshold that can be easily computed from the training set. We can estimate the weight and we can estimate the mean and the covariance of the two components. And then, this product of the variance-covariance or the inverse of the variance-covariance matrix times the difference of the means corresponds to a vector a that can also be computed from the training set. So essentially, the decision of whether we classify an observation in class 1 or class 2 is going to depend on whether a linear combination, and that’s what x transpose times a is, is just a linear combination of the values of x. So whether this linear combination of the values of x is greater than a given threshold or not. In other words, what we’re doing, In a setting where we only have two variables, for example, x1 and x2, the linear combination of the entries is just a line on the plane. So this product just corresponds to a line. And by deciding whether we are above the line or below the line, we’re just saying that one of the regions corresponds to class, 2, and the other region corresponds to class 1. So this is the reason why the procedure is called linear discriminant analysis because it uses a straight line to decide whether observations should be classified in class 1 and class 2. Now, there are some more interesting things that you can do. For example, you don’t have to assume that the sigmas are the same, you could assume that the sigmas are different. If you were to do that, then you’d be in a situation that is analogous to this one with the main difference being that now these terms here wouldn’t necessarily simplify. But then, you can rearrange terms in such a way that now, you’re going to have a quadratic form of x being less than a certain threshold. And in that case, you’re separating hyperplane. Instead of being a hyperplane or line, it’s going to be a quadratic form. And that is the reason why when you’re doing Naive Bayes and you’re working with kernels that are Gaussian and have different variance-covariance matrices, you call the procedure quadratic discriminant analysis. Because it uses a quadratic form, a parabola or something like that to separate the two classes that you’re working with. The nice thing about thinking about this classification procedures in the context of mixture models is again, thinking about ways in which you can generalize and address the shortcomings of the procedure. It’s clear that the main issue with classification procedures based on Gaussians is that data in the real world sometimes doesn’t look like multivariate Gaussian distributions. So one possible extension is to instead of considering the density, this ps here to be a single Gaussian, you can kind of use mixtures a second time and borrow some ideas from when we did density estimation. And say well, I’m going to have a mixture and each component of that mixture is in turn a second mixture that may have a few components. And that may allow for the shape of the clusters to be much more general, and that’s what we call mixture discriminant analysis. As before, if you instead of doing the Algorithm and the simple maximum likelihood estimation that I described before, you instead use Bayesian estimators for your process, then you will have Bayesian equivalent of linear discriminant analysis and quadratic discriminant analysis. So it is very useful to think about your statistical methods in the context of mixture models for the purpose of both generalizing and understanding the shortcomings of what you’re doing.</p>
</div>
</div>
</div>
</section>
<section id="linear-and-quadratic-discriminant-analysis-in-the-context-of-mixture-models" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="linear-and-quadratic-discriminant-analysis-in-the-context-of-mixture-models"><span class="header-section-number">1.3.3</span> Linear and quadratic discriminant analysis in the context of Mixture Models</h3>
</section>
<section id="classification-example" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="classification-example"><span class="header-section-number">1.3.4</span> Classification example</h3>
<p>This video discusses the code in the next section.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Video Transcript
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I’m going to illustrate now to use of mixture models for classification using the wind dataset. Unlike the previous datasets that we work with, this one is not included in R by default. So the two files that you need wind training and wind tests are available on the website, make sure that you download them and that you have them in the right directory for R to read them. And in this case, I made sure that I change the directory where I’m looking at before I start working with this, and that I put my files in there.</p>
<p>Okay, so the wind dataset is an interesting one, it’s a series of measurements for different varieties of wine. They come from three different cultivars, and for each particular variety of wine. They did a chemical analysis and measure 13 different variables that have to do with different chemical components present in the world. So we have a label set where we know which samples from which of the three cultivars. And now we want to use the information that we clean out of that to classify to decide a series of new wines to assign them to the cultivar that we think they come from. We actually do know the truth for the test set, so we will actually first do the predictions we’ll act as if we don’t know what the cultivar of the test set is. And then we will compare the predictions that we’re making against the truth, as a way to tell how well the algorithm is to it, okay. So the first thing that we need to do is load our dataset as I said, you need to make sure that the two files are in the directory where you’re working. So make sure of that, remember that we called n the sample size of the training set and m the training size the size of the test set. So I’m just calling the variables that way, and I’m going to use mixture of normals mixture of multivariate normals by location and scale. So I’m going to use a method that is essentially equivalent to doing quadratic discriminant analysis. And, I want to run the Algorithm that I discussed on the board, but in a situation which we assume that we’re going to work with semi-supervised learning. In other words, I went around the Version of the algorithm in which we’re going to use all the observation both in the training and the test set, to learn the parameters of the classes. So it’s going to be an iterative algorithm. So we know in advance as we have three classes because we have three cultivars. B in this case is going to be 13 because there are 13 features that were measured on each wine. So if you come down here, you can see that B 13, we can try to do a graph of the data. In this case the graph is not going to be terribly readable because there are so many variables, but it may still provide a little bit of intuition. So the variables that are measured things like alcohol, the ash, the alkalinity, the level of magnesium, the hue that has to do with how dark the wine is, proline. So you can see here where the variables are there are measured, and even though the graph is not very readable at least you can see that the classes do not fully overlap. So we do have some hope that we may be able to do classification in the problem. That’s pretty much the main thing that you can say out of this graph here, okay. So, as I said before mixture of models with different components, different variances and different means for each component its normal component in the mixture. Same type of standard initialization that we have done before. And we’re going to do the E and the M step here, remember that for the observations in the training set. We know the class, so the value of B are either 0 or 1, and because we do the calculation first in the log scale, then we do either 0 or minus infinity. So 0 corresponds to probability of 1 and minus infinity corresponds to a probability of 0 in the log scale. And then for the observations in the test set, we have just a regular way in which we compute the probability that the observation comes from each class. And once we have done this then we subtract, we do as we have always done subtract maximums and then restandardize. So this is how the ES step gets adapted in the case of semisupervised classification. And then the structure of the m-step is exactly the same structure of the regular Algorithm. So we compute means and variances for each one of the components as weighted averages of the different quantities. We check conversions in the standard way, in which we have been checking convergence. And finally once everything is done, we will get a classification, so let’s run it for this dataset. It runs actually quite quickly, we have only 12 iterations and we have converged. Now what the Algorithm gives gave us is just the B values, that is the probability that an observation comes from a given class. Now, we typically are going to want to convert those peas into Cs and as we saw on the board, that is done by just selecting the class that has the highest probability.</p>
<p>So if we do that for our training set in this case, and if you look at the indexes here, they run from n + 1 to n + m, which means that we’re looking at test set. If we just get what is the maximum we can see that the first block of observations is assigned to component two. Most of this block is assigned to component two except for this guy here, and then the the remaining block of observation is assigned to components three. So now how does that compare with the truth? So we can actually go into winder test, and the first column of that file contains the true labels, and we can say that it matches actually pretty well. So the ones all match, the twos match except for one guy, the one we had kind of identified before, and the threes all match together. And we can actually if you just want to have a summary of how many errors you make. You can do a little comparison like this, and you can find that there is only a single error in the classification that the algorithm does.</p>
<p>Now let’s compare that with just using quadratic discriminant analysis and linear discriminant analysis. The way they are implemented in R, so QDA and LDA are the two functions that you will need, they are part of the mass package. So, We first feed the QDA model and then we that fitted model to predict the classes. And now if we see what the regular QDA does is it’s going to give me this long list of probabilities for the test set. And we can turn those into labels and in particular we can see how many errors we’re making in the prediction. And you can see that we make a single mistake, which is actually not the mistake that we had made before. So if we just look at this one here and we compare it against the, Classification that our algorithm did, and we compared it against the truth.</p>
<p>We see that our algorithm makes a mistake in this observation and QDA does not, and instead the error is somewhere else in this sample. It’s basically here, so you can see that the QDA classifies this as two, when the reality is that it’s a three. So our results are not identical to QDA even though our method is asymptotically going to be equivalent to QDA but they don’t give us exactly the same result, but they give us very similar accuracy. Interestingly if you run LDA and you try to look at how many errors you have in that case, you will see that LDA in this case has no errors, even though it’s a simpler more restrictive classification procedure. So this can happen, so it’s a relatively large sample, so a single a difference in a single error is not a very large difference. So, hopefully this illustrates how classification or how measurements can be used for classification in a real life setting.</p>
</div>
</div>
</div>
</section>
<section id="sample-em-algorithm-for-classification-problems" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="sample-em-algorithm-for-classification-problems"><span class="header-section-number">1.3.5</span> Sample EM algorithm for classification problems</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mixture models for classification in the wine dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare linear and quadratic discriminant analysis and a </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   (semi-supervised) location and scale mixture model with K normals</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Comparing only against the EM algorithm</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Semi-supervised, quadratic discriminant analysis </span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading data and setting up global variables</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>wine.training <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"data/wine_training.txt"</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>wine.test <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"data/wine_test.txt"</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">dim</span>(wine.training)[<span class="dv">1</span>]  <span class="co"># Size of the training set</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">dim</span>(wine.test)[<span class="dv">1</span>]      <span class="co"># Size of the test set</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">as.matrix</span>(wine.training[,<span class="sc">-</span><span class="dv">1</span>]), <span class="fu">as.matrix</span>(wine.test[,<span class="sc">-</span><span class="dv">1</span>]))   <span class="co"># Create dataset of observations, first n belong to the training set, and the rest belong to the test set</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>p       <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]              <span class="co"># Number of features</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>KK      <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">=</span> <span class="fl">0.00001</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)<span class="sc">+</span><span class="fl">0.1</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"blue"</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(wine.training[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">col=</span>colscale[wine.training[,<span class="dv">1</span>]], <span class="at">pch=</span>wine.training[,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C3-L04_files/figure-html/lbl-em-algorithm-classification-sample-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="C3-L04_files/figure-html/lbl-em-algorithm-classification-sample-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the parameters of the algorithm</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">63252</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>w   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK  <span class="co">#Assign equal weight to each component to start with</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>mu  <span class="ot">=</span> <span class="fu">rmvnorm</span>(KK, <span class="fu">apply</span>(x,<span class="dv">2</span>,mean), <span class="fu">var</span>(x))   <span class="co">#Cluster centers randomly spread over the support of the data</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>Sigma      <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(KK,p,p))  <span class="co">#Initial variances are assumed to be the same</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>Sigma[<span class="dv">1</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK  </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>Sigma[<span class="dv">2</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>Sigma[<span class="dv">3</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>sw     <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>KL     <span class="ot">=</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>KL.out <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>s      <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="sc">!</span>sw){</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## E step</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(n<span class="sc">+</span>m,KK))</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){  <span class="co">#Compute the log of the weights</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    v[<span class="dv">1</span><span class="sc">:</span>n,k] <span class="ot">=</span> <span class="fu">ifelse</span>(wine.training[,<span class="dv">1</span>]<span class="sc">==</span>k,<span class="dv">0</span>,<span class="sc">-</span><span class="cn">Inf</span>)  <span class="co"># Training set</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    v[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m),k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m),], mu[k,], Sigma[k,,],<span class="at">log=</span><span class="cn">TRUE</span>)  <span class="co"># Test set</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    v[i,] <span class="ot">=</span> <span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,])))  <span class="co">#Go from logs to actual weights in a numerically stable manner</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">## M step</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">=</span> <span class="fu">apply</span>(v,<span class="dv">2</span>,mean)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>KK, <span class="at">ncol=</span>p)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>      mu[k,]    <span class="ot">=</span> mu[k,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>x[i,]</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    mu[k,] <span class="ot">=</span> mu[k,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(KK,p,p))</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>      Sigma[k,,] <span class="ot">=</span> Sigma[k,,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>(x[i,] <span class="sc">-</span> mu[k,])<span class="sc">%*%</span><span class="fu">t</span>(x[i,] <span class="sc">-</span> mu[k,])</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    Sigma[k,,] <span class="ot">=</span> Sigma[k,,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">##Check convergence</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  KLn <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>      KLn <span class="ot">=</span> KLn <span class="sc">+</span> v[i,k]<span class="sc">*</span>(<span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x[i,],mu[k,],Sigma[k,,],<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">abs</span>(KLn<span class="sc">-</span>KL)<span class="sc">/</span><span class="fu">abs</span>(KLn)<span class="sc">&lt;</span>epsilon){</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    sw<span class="ot">=</span><span class="cn">TRUE</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>  KL <span class="ot">=</span> KLn</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>  KL.out <span class="ot">=</span> <span class="fu">c</span>(KL.out, KL)</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> s <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(s, KLn))</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1 -3146.58419305226"
[1] "2 -2942.48222029706"
[1] "3 -2873.76499310479"
[1] "4 -2852.76768638231"
[1] "5 -2796.247735428"
[1] "6 -2791.29098585679"
[1] "7 -2791.23059641487"
[1] "8 -2791.14094416728"
[1] "9 -2791.05612416221"
[1] "10 -2790.99254414223"
[1] "11 -2790.95228067601"
[1] "12 -2790.92945838389"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicted labels</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(v, <span class="dv">1</span>, which.max)[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 1 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3
[39] 3 3 3 3 3 3 3 3</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## True labels</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>wine.test[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3
[39] 3 3 3 3 3 3 3 3</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Comparison</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(v, <span class="dv">1</span>, which.max)[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m)] <span class="sc">==</span> wine.test[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
[13]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE
[25]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
[37]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(<span class="fu">apply</span>(v, <span class="dv">1</span>, which.max)[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m)] <span class="sc">==</span> wine.test[,<span class="dv">1</span>])) <span class="co"># One error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the qda and lda functions in R</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># qda</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>modqda <span class="ot">=</span> <span class="fu">qda</span>(<span class="at">grouping=</span>wine.training[,<span class="dv">1</span>], <span class="at">x=</span>wine.training[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">method=</span><span class="st">"mle"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>ccpredqda <span class="ot">=</span> <span class="fu">predict</span>(modqda,<span class="at">newdata=</span>wine.test[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(ccpredqda<span class="sc">$</span>class <span class="sc">==</span> wine.test[,<span class="dv">1</span>])) <span class="co"># One error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lda</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>modlda <span class="ot">=</span> <span class="fu">lda</span>(<span class="at">grouping=</span>wine.training[,<span class="dv">1</span>], <span class="at">x=</span>wine.training[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">method=</span><span class="st">"mle"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ccpredlda <span class="ot">=</span> <span class="fu">predict</span>(modlda,<span class="at">newdata=</span>wine.test[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(ccpredlda<span class="sc">$</span>class <span class="sc">==</span> wine.test[,<span class="dv">1</span>])) <span class="co"># No errors!!!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
</section>
<section id="advanced-density-estimation-and-classification" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="advanced-density-estimation-and-classification"><span class="header-section-number">1.4</span> Advanced Density Estimation and Classification</h2>
<section id="practice-graded-assignment-the-em-algorithm-and-density-estimation" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="practice-graded-assignment-the-em-algorithm-and-density-estimation"><span class="header-section-number">1.4.1</span> Practice Graded Assignment: The EM algorithm and density estimation</h3>
</section>
<section id="honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation"><span class="header-section-number">1.4.2</span> Honors Peer-graded Assignment: MCMC algorithms and density estimation</h3>
</section>
<section id="honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation-1" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="honors-peer-graded-assignment-mcmc-algorithms-and-density-estimation-1"><span class="header-section-number">1.4.3</span> Honors Peer-graded Assignment: MCMC algorithms and density estimation</h3>
</section>
<section id="honors-peer-graded-assignment-classification" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="honors-peer-graded-assignment-classification"><span class="header-section-number">1.4.4</span> Honors Peer-graded Assignment: Classification</h3>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="an">title :</span><span class="co"> 'Applications of Mixture Models'</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle :</span><span class="co"> 'Bayesian Statistics: Mixture Models'</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - Bayesian Statistics</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - Mixture Models</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Kernel Density Estimation</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - Mixture Density Estimation</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - Clustering</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - Classification</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - notes</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Applications of Mixture Models</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Density Estimation</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="fu">### Density Estimation using Mixture Models</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="al">![Density Estimation using Mixture Models](images/c3l04-ss-01-density-estimation-using-mixture-models.png)</span>{.column-margin}</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="fu">#### KDE</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the typical method for estimating the density of a random variable is to use a kernel density estimator (KDE)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the KDE is a non-parametric method that estimates the density of a random variable by averaging the contributions of a set of kernel functions centered at each data point</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>X_1, \ldots, X_n \sim f(x)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>\tilde{f}(x) = \frac{1}{n} \sum_{i=1}^n \frac{1}{h}  g(\frac{|X - X_i|}{h})</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>where $h$ is the bandwidth of the kernel and $g$ is a kernel function. The kernel function is a non-negative function that integrates to 1 and is symmetric around 0. </span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>For example, the Gaussian kernel is given by:</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>g(x) = \frac{1}{\sqrt{2\pi}} e^{-\frac{x^2}{2}}</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>giving us:</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>\tilde{f}(x) = \frac{1}{n} \sum_{i=1}^n \frac{1}{h}  \frac{1}{\sqrt{2\pi}} e^{-\frac{|X - X_i|^2}{2h^2}}</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>$$ {#eq-kde}</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mixture of K components</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a mixture of K components is a parametric method that estimates the density of a random variable by averaging the contributions of K kernel functions, each centered at a different location and with a different scale</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the mixture model is given by:</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>X_1, \ldots, X_n \sim f(x) = \sum_{k=1}^K w_k g(x \mid \hat{\theta}_k)</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>$$ {#eq-mixture-density-estimation}</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>where $w_k$ is the weight of the $k$-th component, $\hat{\theta}_k$ is the location and scale of the $k$-th component, and $g(x \mid \hat{\theta}_k)$ is the kernel function centered at $\hat{\theta}_k$. The weights are non-negative and sum to 1.</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>Example: a location mixture of K Gaussian distributions is given by:</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>X_1, \ldots, X_n \sim \hat{f}(x) = \sum_{k=1}^K \hat{w}_k \frac{1}{\sqrt{2\pi}\hat{\sigma}} \exp^{-\frac{(x - \hat{\mu}_k)^2}{2\hat{\sigma}^2}}</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>$$ {#eq-mixture-density-estimation-gaussian-location}</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>where $\hat{w}_k$ is the weight of the $k$-th component, $\hat{\mu}_k$ is the mean of the $k$-th component, and $\hat{\sigma}$ is the standard deviation of the $k$-th component.</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>we can see the the two methods are quite similar, but the mixture model is more flexible and can capture more complex shapes in the data. </span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The KDE is a special case of the mixture model where all the components have the same scale and location.</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>KDE needs as many components as the number of data points, while the mixture model can have fewer components.</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>KDE uses a fixed bandwidth, </span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>MDE can adaptively choose the bandwidth for each component. In fact we have a weight for each component and a scale parameter that controls the width of the kernel function. </span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>MDE tends to use less components and the weights tend to be 1/K</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>The above model can be improved by:</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>using a scale-location mixture model, where the scale and location of each component are estimated from the data.</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a><span class="fu">### Density Estimation Example</span></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>We use the galaxies dataset to illustrate the differences between the two methods.</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>The galaxies dataset contains the velocities of 82 galaxies in the Virgo cluster. </span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>The data is available in the MASS package.</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample code for Density Estimation Problem</span></span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "lbl-density-estimation-example"</span></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mixture models for density estimation in the galaxies dataset</span></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare kernel density estimation, and estimates from mixtures of KK=6</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a><span class="do">## components obtained using both frequentist and Bayesian procedures</span></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading data and setting up global variables</span></span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCpack)</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(galaxies)</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>KK <span class="ot">=</span> <span class="dv">6</span>          <span class="co"># Based on the description of the dataset</span></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>x  <span class="ot">=</span> galaxies</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">=</span> <span class="fu">length</span>(x)</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">781209</span>)</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a><span class="do">### First, compute the "Maximum Likelihood" density estimate associated with a location mixture of 6 Gaussian distributions using the EM algorithm</span></span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a><span class="do">## Initialize the parameters</span></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>w     <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK</span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a>mu    <span class="ot">=</span> <span class="fu">rnorm</span>(KK, <span class="fu">mean</span>(x), <span class="fu">sd</span>(x))</span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">sd</span>(x)<span class="sc">/</span>KK</span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">=</span> <span class="fl">0.000001</span></span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a>s       <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a>sw      <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a>KL      <span class="ot">=</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a>KL.out  <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="sc">!</span>sw){</span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>  <span class="do">## E step</span></span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(n,KK))</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a>    v[,k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> <span class="fu">dnorm</span>(x, mu[k], sigma,<span class="at">log=</span><span class="cn">TRUE</span>)  </span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>    v[i,] <span class="ot">=</span> <span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,])))</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a>  <span class="do">## M step</span></span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weights</span></span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">=</span> <span class="fu">apply</span>(v,<span class="dv">2</span>,mean)</span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, KK)</span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a>      mu[k]    <span class="ot">=</span> mu[k] <span class="sc">+</span> v[i,k]<span class="sc">*</span>x[i]</span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>    mu[k] <span class="ot">=</span> mu[k]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standard deviations</span></span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a>      sigma <span class="ot">=</span> sigma <span class="sc">+</span> v[i,k]<span class="sc">*</span>(x[i] <span class="sc">-</span> mu[k])<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fu">sqrt</span>(sigma<span class="sc">/</span><span class="fu">sum</span>(v))</span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a>  <span class="do">##Check convergence</span></span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a>  KLn <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a>      KLn <span class="ot">=</span> KLn <span class="sc">+</span> v[i,k]<span class="sc">*</span>(<span class="fu">log</span>(w[k]) <span class="sc">+</span> <span class="fu">dnorm</span>(x[i], mu[k], sigma, <span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">abs</span>(KLn<span class="sc">-</span>KL)<span class="sc">/</span><span class="fu">abs</span>(KLn)<span class="sc">&lt;</span>epsilon){</span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>    sw<span class="ot">=</span><span class="cn">TRUE</span></span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a>  KL <span class="ot">=</span> KLn</span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a>  KL.out <span class="ot">=</span> <span class="fu">c</span>(KL.out, KL)</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> s <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(s, KLn))</span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a>xx  <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">5000</span>,<span class="dv">37000</span>,<span class="at">length=</span><span class="dv">300</span>)</span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a>nxx <span class="ot">=</span> <span class="fu">length</span>(xx)</span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a>density.EM <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, nxx)</span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nxx){</span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a>    density.EM[s] <span class="ot">=</span> density.EM[s] <span class="sc">+</span> w[k]<span class="sc">*</span><span class="fu">dnorm</span>(xx[s], mu[k], sigma)</span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a><span class="do">### Get a "Bayesian" kernel density estimator based on the same location mixture of 6 normals</span></span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a><span class="do">## Priors set up using an "empirical Bayes" approach</span></span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a>aa  <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)  </span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">=</span> <span class="fu">mean</span>(x)    </span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(x))</span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a>dd  <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a>qq  <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK</span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a><span class="do">## Initialize the parameters</span></span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a>w     <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK</span>
<span id="cb38-185"><a href="#cb38-185" aria-hidden="true" tabindex="-1"></a>mu    <span class="ot">=</span> <span class="fu">rnorm</span>(KK, <span class="fu">mean</span>(x), <span class="fu">sd</span>(x))</span>
<span id="cb38-186"><a href="#cb38-186" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">sd</span>(x)<span class="sc">/</span>KK</span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a>cc    <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>KK, n, <span class="at">replace=</span>T, <span class="at">prob=</span>w)</span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a><span class="do">## Number of iterations of the sampler</span></span>
<span id="cb38-190"><a href="#cb38-190" aria-hidden="true" tabindex="-1"></a>rrr   <span class="ot">=</span> <span class="dv">12000</span></span>
<span id="cb38-191"><a href="#cb38-191" aria-hidden="true" tabindex="-1"></a>burn  <span class="ot">=</span> <span class="dv">2000</span></span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a><span class="do">## Storing the samples</span></span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a>cc.out    <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr, n))</span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a>w.out     <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr, KK))</span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a>mu.out    <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr, KK))</span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a>sigma.out <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, rrr)</span>
<span id="cb38-198"><a href="#cb38-198" aria-hidden="true" tabindex="-1"></a>logpost   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, rrr)</span>
<span id="cb38-199"><a href="#cb38-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>rrr){</span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the indicators</span></span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,KK)</span>
<span id="cb38-205"><a href="#cb38-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-206"><a href="#cb38-206" aria-hidden="true" tabindex="-1"></a>      v[k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> <span class="fu">dnorm</span>(x[i], mu[k], sigma, <span class="at">log=</span><span class="cn">TRUE</span>)  <span class="co">#Compute the log of the weights</span></span>
<span id="cb38-207"><a href="#cb38-207" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-208"><a href="#cb38-208" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span> <span class="fu">exp</span>(v <span class="sc">-</span> <span class="fu">max</span>(v))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v <span class="sc">-</span> <span class="fu">max</span>(v)))</span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a>    cc[i] <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>KK, <span class="dv">1</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span>v)</span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-211"><a href="#cb38-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-212"><a href="#cb38-212" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the weights</span></span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">rdirichlet</span>(<span class="dv">1</span>, aa <span class="sc">+</span> <span class="fu">tabulate</span>(cc, <span class="at">nbins=</span>KK)))</span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the means</span></span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-217"><a href="#cb38-217" aria-hidden="true" tabindex="-1"></a>    nk    <span class="ot">=</span> <span class="fu">sum</span>(cc<span class="sc">==</span>k)</span>
<span id="cb38-218"><a href="#cb38-218" aria-hidden="true" tabindex="-1"></a>    xsumk <span class="ot">=</span> <span class="fu">sum</span>(x[cc<span class="sc">==</span>k])</span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a>    tau2.hat <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>(nk<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>tau<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a>    mu.hat  <span class="ot">=</span> tau2.hat<span class="sc">*</span>(xsumk<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> eta<span class="sc">/</span>tau<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a>    mu[k]   <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, mu.hat, <span class="fu">sqrt</span>(tau2.hat))</span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-224"><a href="#cb38-224" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample the variances</span></span>
<span id="cb38-225"><a href="#cb38-225" aria-hidden="true" tabindex="-1"></a>  dd.star <span class="ot">=</span> dd <span class="sc">+</span> n<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb38-226"><a href="#cb38-226" aria-hidden="true" tabindex="-1"></a>  qq.star <span class="ot">=</span> qq <span class="sc">+</span> <span class="fu">sum</span>((x <span class="sc">-</span> mu[cc])<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb38-227"><a href="#cb38-227" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>, dd.star, qq.star))</span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-229"><a href="#cb38-229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store samples</span></span>
<span id="cb38-230"><a href="#cb38-230" aria-hidden="true" tabindex="-1"></a>  cc.out[s,]   <span class="ot">=</span> cc</span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a>  w.out[s,]    <span class="ot">=</span> w</span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a>  mu.out[s,]   <span class="ot">=</span> mu</span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a>  sigma.out[s] <span class="ot">=</span> sigma</span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a>    logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">log</span>(w[cc[i]]) <span class="sc">+</span> <span class="fu">dnorm</span>(x[i], mu[cc[i]], sigma, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-236"><a href="#cb38-236" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-237"><a href="#cb38-237" aria-hidden="true" tabindex="-1"></a>  logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">log</span>(<span class="fu">ddirichlet</span>(w, aa))</span>
<span id="cb38-238"><a href="#cb38-238" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-239"><a href="#cb38-239" aria-hidden="true" tabindex="-1"></a>    logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">dnorm</span>(mu[k], eta, tau, <span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a>  logpost[s] <span class="ot">=</span> logpost[s] <span class="sc">+</span> <span class="fu">dgamma</span>(<span class="dv">1</span><span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span>, dd, qq, <span class="at">log=</span><span class="cn">TRUE</span>) <span class="sc">-</span> <span class="dv">4</span><span class="sc">*</span><span class="fu">log</span>(sigma)</span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(s<span class="sc">/</span><span class="dv">500</span><span class="sc">==</span><span class="fu">floor</span>(s<span class="sc">/</span><span class="dv">500</span>)){</span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"s ="</span>,s))</span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a><span class="do">## Compute the samples of the density over a dense grid</span></span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a>density.mcmc <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(rrr<span class="sc">-</span>burn,<span class="fu">length</span>(xx)))</span>
<span id="cb38-249"><a href="#cb38-249" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(rrr<span class="sc">-</span>burn)){</span>
<span id="cb38-250"><a href="#cb38-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a>        density.mcmc[s,] <span class="ot">=</span> density.mcmc[s,] <span class="sc">+</span> w.out[s<span class="sc">+</span>burn,k]<span class="sc">*</span><span class="fu">dnorm</span>(xx,mu.out[s<span class="sc">+</span>burn,k],sigma.out[s<span class="sc">+</span>burn])</span>
<span id="cb38-252"><a href="#cb38-252" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-253"><a href="#cb38-253" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a>density.mcmc.m <span class="ot">=</span> <span class="fu">apply</span>(density.mcmc , <span class="dv">2</span>, mean)</span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot Bayesian estimate with pointwise credible bands along with kernel density estimate and frequentist point estimate</span></span>
<span id="cb38-257"><a href="#cb38-257" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span>
<span id="cb38-258"><a href="#cb38-258" aria-hidden="true" tabindex="-1"></a>yy <span class="ot">=</span> <span class="fu">density</span>(x)</span>
<span id="cb38-259"><a href="#cb38-259" aria-hidden="true" tabindex="-1"></a>density.mcmc.lq <span class="ot">=</span> <span class="fu">apply</span>(density.mcmc, <span class="dv">2</span>, quantile, <span class="fl">0.025</span>)</span>
<span id="cb38-260"><a href="#cb38-260" aria-hidden="true" tabindex="-1"></a>density.mcmc.uq <span class="ot">=</span> <span class="fu">apply</span>(density.mcmc, <span class="dv">2</span>, quantile, <span class="fl">0.975</span>)</span>
<span id="cb38-261"><a href="#cb38-261" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(xx, density.mcmc.m, <span class="at">type=</span><span class="st">"n"</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(density.mcmc.uq)),<span class="at">xlab=</span><span class="st">"Velocity"</span>, <span class="at">ylab=</span><span class="st">"Density"</span>)</span>
<span id="cb38-262"><a href="#cb38-262" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xx,<span class="fu">rev</span>(xx)), <span class="fu">c</span>(density.mcmc.lq, <span class="fu">rev</span>(density.mcmc.uq)), <span class="at">col=</span><span class="st">"grey"</span>, <span class="at">border=</span><span class="st">"grey"</span>)</span>
<span id="cb38-263"><a href="#cb38-263" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx, density.mcmc.m, <span class="at">col=</span>colscale[<span class="dv">1</span>], <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb38-264"><a href="#cb38-264" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xx, density.EM, <span class="at">col=</span>colscale[<span class="dv">2</span>], <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb38-265"><a href="#cb38-265" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(yy, <span class="at">col=</span>colscale[<span class="dv">3</span>], <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb38-266"><a href="#cb38-266" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, <span class="fu">rep</span>(<span class="dv">0</span>,n))</span>
<span id="cb38-267"><a href="#cb38-267" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">27000</span>, <span class="fl">0.00017</span>, <span class="fu">c</span>(<span class="st">"KDE"</span>,<span class="st">"EM"</span>,<span class="st">"MCMC"</span>), <span class="at">col=</span>colscale[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>)], <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb38-268"><a href="#cb38-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-269"><a href="#cb38-269" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-270"><a href="#cb38-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-271"><a href="#cb38-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-272"><a href="#cb38-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clustering</span></span>
<span id="cb38-273"><a href="#cb38-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-274"><a href="#cb38-274" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mixture Models for Clustering</span></span>
<span id="cb38-275"><a href="#cb38-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-276"><a href="#cb38-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-277"><a href="#cb38-277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Clustering example</span></span>
<span id="cb38-278"><a href="#cb38-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-281"><a href="#cb38-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-282"><a href="#cb38-282" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mixture models for clustering in the iris dataset</span></span>
<span id="cb38-283"><a href="#cb38-283" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare k-means clustering and a location and scale mixture model with K normals</span></span>
<span id="cb38-284"><a href="#cb38-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-285"><a href="#cb38-285" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading data and setting up global variables</span></span>
<span id="cb38-286"><a href="#cb38-286" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb38-287"><a href="#cb38-287" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mclust)</span>
<span id="cb38-288"><a href="#cb38-288" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb38-289"><a href="#cb38-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-290"><a href="#cb38-290" aria-hidden="true" tabindex="-1"></a><span class="do">### Defining a custom function to create pair plots</span></span>
<span id="cb38-291"><a href="#cb38-291" aria-hidden="true" tabindex="-1"></a><span class="do">### This is an alternative to the R function pairs() that allows for </span></span>
<span id="cb38-292"><a href="#cb38-292" aria-hidden="true" tabindex="-1"></a><span class="do">### more flexibility. In particular, it allows us to use text to label </span></span>
<span id="cb38-293"><a href="#cb38-293" aria-hidden="true" tabindex="-1"></a><span class="do">### the points</span></span>
<span id="cb38-294"><a href="#cb38-294" aria-hidden="true" tabindex="-1"></a>pairs2 <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">labels=</span><span class="cn">NULL</span>, <span class="at">names =</span> <span class="fu">colnames</span>(x)){</span>
<span id="cb38-295"><a href="#cb38-295" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]</span>
<span id="cb38-296"><a href="#cb38-296" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]</span>
<span id="cb38-297"><a href="#cb38-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(p,p))</span>
<span id="cb38-298"><a href="#cb38-298" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb38-299"><a href="#cb38-299" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(l <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb38-300"><a href="#cb38-300" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(k<span class="sc">!=</span>l){</span>
<span id="cb38-301"><a href="#cb38-301" aria-hidden="true" tabindex="-1"></a>        <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">+</span><span class="fl">0.1</span>)</span>
<span id="cb38-302"><a href="#cb38-302" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(x[,k], x[,l], <span class="at">type=</span><span class="st">"n"</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>)</span>
<span id="cb38-303"><a href="#cb38-303" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.null</span>(labels)){</span>
<span id="cb38-304"><a href="#cb38-304" aria-hidden="true" tabindex="-1"></a>          <span class="fu">points</span>(x[,k], x[,l], <span class="at">pch=</span>pch, <span class="at">col=</span>col)</span>
<span id="cb38-305"><a href="#cb38-305" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span>{</span>
<span id="cb38-306"><a href="#cb38-306" aria-hidden="true" tabindex="-1"></a>          <span class="fu">text</span>(x[,k], x[,l], <span class="at">labels=</span>labels, <span class="at">col=</span>col)</span>
<span id="cb38-307"><a href="#cb38-307" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-308"><a href="#cb38-308" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb38-309"><a href="#cb38-309" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">type=</span><span class="st">"n"</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb38-310"><a href="#cb38-310" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text</span>(<span class="fl">2.5</span>,<span class="fl">2.5</span>,names[k], <span class="at">cex=</span><span class="fl">1.2</span>)</span>
<span id="cb38-311"><a href="#cb38-311" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-312"><a href="#cb38-312" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-313"><a href="#cb38-313" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-314"><a href="#cb38-314" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-315"><a href="#cb38-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-316"><a href="#cb38-316" aria-hidden="true" tabindex="-1"></a><span class="do">## Setup data</span></span>
<span id="cb38-317"><a href="#cb38-317" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb38-318"><a href="#cb38-318" aria-hidden="true" tabindex="-1"></a>x       <span class="ot">=</span> <span class="fu">as.matrix</span>(iris[,<span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-319"><a href="#cb38-319" aria-hidden="true" tabindex="-1"></a>n       <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">1</span>]</span>
<span id="cb38-320"><a href="#cb38-320" aria-hidden="true" tabindex="-1"></a>p       <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]       <span class="co"># Number of features</span></span>
<span id="cb38-321"><a href="#cb38-321" aria-hidden="true" tabindex="-1"></a>KK      <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb38-322"><a href="#cb38-322" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">=</span> <span class="fl">0.0000001</span></span>
<span id="cb38-323"><a href="#cb38-323" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb38-324"><a href="#cb38-324" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb38-325"><a href="#cb38-325" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>)</span>
<span id="cb38-326"><a href="#cb38-326" aria-hidden="true" tabindex="-1"></a>shortnam  <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"s"</span>,<span class="st">"c"</span>,<span class="st">"g"</span>)</span>
<span id="cb38-327"><a href="#cb38-327" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs2</span>(x, <span class="at">col=</span>colscale[iris[,<span class="dv">5</span>]], <span class="at">labels=</span>shortnam[<span class="fu">as.numeric</span>(iris[,<span class="dv">5</span>])])</span>
<span id="cb38-328"><a href="#cb38-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-329"><a href="#cb38-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-330"><a href="#cb38-330" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the parameters of the algorithm</span></span>
<span id="cb38-331"><a href="#cb38-331" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">63252</span>)</span>
<span id="cb38-332"><a href="#cb38-332" aria-hidden="true" tabindex="-1"></a>numruns <span class="ot">=</span> <span class="dv">15</span></span>
<span id="cb38-333"><a href="#cb38-333" aria-hidden="true" tabindex="-1"></a>v.sum   <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(numruns, n, KK))</span>
<span id="cb38-334"><a href="#cb38-334" aria-hidden="true" tabindex="-1"></a>QQ.sum  <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, numruns)</span>
<span id="cb38-335"><a href="#cb38-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-336"><a href="#cb38-336" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(ss <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numruns){</span>
<span id="cb38-337"><a href="#cb38-337" aria-hidden="true" tabindex="-1"></a>  w   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK  <span class="co">#Assign equal weight to each component to start with</span></span>
<span id="cb38-338"><a href="#cb38-338" aria-hidden="true" tabindex="-1"></a>  mu  <span class="ot">=</span> <span class="fu">rmvnorm</span>(KK, <span class="fu">apply</span>(x,<span class="dv">2</span>,mean), <span class="dv">3</span><span class="sc">*</span><span class="fu">var</span>(x))   <span class="co">#Cluster centers randomly spread over the support of the data</span></span>
<span id="cb38-339"><a href="#cb38-339" aria-hidden="true" tabindex="-1"></a>  Sigma      <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(KK,p,p))  <span class="co">#Initial variances are assumed to be the same</span></span>
<span id="cb38-340"><a href="#cb38-340" aria-hidden="true" tabindex="-1"></a>  Sigma[<span class="dv">1</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)</span>
<span id="cb38-341"><a href="#cb38-341" aria-hidden="true" tabindex="-1"></a>  Sigma[<span class="dv">2</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)</span>
<span id="cb38-342"><a href="#cb38-342" aria-hidden="true" tabindex="-1"></a>  Sigma[<span class="dv">3</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)</span>
<span id="cb38-343"><a href="#cb38-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-344"><a href="#cb38-344" aria-hidden="true" tabindex="-1"></a>  sw     <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb38-345"><a href="#cb38-345" aria-hidden="true" tabindex="-1"></a>  QQ     <span class="ot">=</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb38-346"><a href="#cb38-346" aria-hidden="true" tabindex="-1"></a>  QQ.out <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb38-347"><a href="#cb38-347" aria-hidden="true" tabindex="-1"></a>  s      <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-348"><a href="#cb38-348" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-349"><a href="#cb38-349" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="sc">!</span>sw){</span>
<span id="cb38-350"><a href="#cb38-350" aria-hidden="true" tabindex="-1"></a>    <span class="do">## E step</span></span>
<span id="cb38-351"><a href="#cb38-351" aria-hidden="true" tabindex="-1"></a>    v <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(n,KK))</span>
<span id="cb38-352"><a href="#cb38-352" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){  <span class="co">#Compute the log of the weights</span></span>
<span id="cb38-353"><a href="#cb38-353" aria-hidden="true" tabindex="-1"></a>      v[,k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x, mu[k,], Sigma[k,,], <span class="at">log=</span><span class="cn">TRUE</span>) </span>
<span id="cb38-354"><a href="#cb38-354" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-355"><a href="#cb38-355" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-356"><a href="#cb38-356" aria-hidden="true" tabindex="-1"></a>      v[i,] <span class="ot">=</span> <span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,])))  <span class="co">#Go from logs to actual weights in a numerically stable manner</span></span>
<span id="cb38-357"><a href="#cb38-357" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-358"><a href="#cb38-358" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-359"><a href="#cb38-359" aria-hidden="true" tabindex="-1"></a>    <span class="do">## M step</span></span>
<span id="cb38-360"><a href="#cb38-360" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">=</span> <span class="fu">apply</span>(v,<span class="dv">2</span>,mean)</span>
<span id="cb38-361"><a href="#cb38-361" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>KK, <span class="at">ncol=</span>p)</span>
<span id="cb38-362"><a href="#cb38-362" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-363"><a href="#cb38-363" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-364"><a href="#cb38-364" aria-hidden="true" tabindex="-1"></a>        mu[k,]    <span class="ot">=</span> mu[k,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>x[i,]</span>
<span id="cb38-365"><a href="#cb38-365" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-366"><a href="#cb38-366" aria-hidden="true" tabindex="-1"></a>      mu[k,] <span class="ot">=</span> mu[k,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb38-367"><a href="#cb38-367" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-368"><a href="#cb38-368" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(KK, p, p))</span>
<span id="cb38-369"><a href="#cb38-369" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-370"><a href="#cb38-370" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-371"><a href="#cb38-371" aria-hidden="true" tabindex="-1"></a>        Sigma[k,,] <span class="ot">=</span> Sigma[k,,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>(x[i,] <span class="sc">-</span> mu[k,])<span class="sc">%*%</span><span class="fu">t</span>(x[i,] <span class="sc">-</span> mu[k,])</span>
<span id="cb38-372"><a href="#cb38-372" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-373"><a href="#cb38-373" aria-hidden="true" tabindex="-1"></a>      Sigma[k,,] <span class="ot">=</span> Sigma[k,,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb38-374"><a href="#cb38-374" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-375"><a href="#cb38-375" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-376"><a href="#cb38-376" aria-hidden="true" tabindex="-1"></a>    <span class="do">##Check convergence</span></span>
<span id="cb38-377"><a href="#cb38-377" aria-hidden="true" tabindex="-1"></a>    QQn <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-378"><a href="#cb38-378" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb38-379"><a href="#cb38-379" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-380"><a href="#cb38-380" aria-hidden="true" tabindex="-1"></a>        QQn <span class="ot">=</span> QQn <span class="sc">+</span> v[i,k]<span class="sc">*</span>(<span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x[i,],mu[k,],Sigma[k,,],<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb38-381"><a href="#cb38-381" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-382"><a href="#cb38-382" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-383"><a href="#cb38-383" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">abs</span>(QQn<span class="sc">-</span>QQ)<span class="sc">/</span><span class="fu">abs</span>(QQn)<span class="sc">&lt;</span>epsilon){</span>
<span id="cb38-384"><a href="#cb38-384" aria-hidden="true" tabindex="-1"></a>      sw<span class="ot">=</span><span class="cn">TRUE</span></span>
<span id="cb38-385"><a href="#cb38-385" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-386"><a href="#cb38-386" aria-hidden="true" tabindex="-1"></a>    QQ <span class="ot">=</span> QQn</span>
<span id="cb38-387"><a href="#cb38-387" aria-hidden="true" tabindex="-1"></a>    QQ.out <span class="ot">=</span> <span class="fu">c</span>(QQ.out, QQ)</span>
<span id="cb38-388"><a href="#cb38-388" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">=</span> s <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb38-389"><a href="#cb38-389" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-390"><a href="#cb38-390" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-391"><a href="#cb38-391" aria-hidden="true" tabindex="-1"></a>  v.sum[ss,,] <span class="ot">=</span> v</span>
<span id="cb38-392"><a href="#cb38-392" aria-hidden="true" tabindex="-1"></a>  QQ.sum[ss]  <span class="ot">=</span> QQ.out[s]</span>
<span id="cb38-393"><a href="#cb38-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"ss ="</span>, ss))</span>
<span id="cb38-394"><a href="#cb38-394" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-395"><a href="#cb38-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-396"><a href="#cb38-396" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster reconstruction under the mixture model</span></span>
<span id="cb38-397"><a href="#cb38-397" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">=</span> <span class="fu">apply</span>(v.sum[<span class="fu">which.max</span>(QQ.sum),,], <span class="dv">1</span> ,which.max)</span>
<span id="cb38-398"><a href="#cb38-398" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>)</span>
<span id="cb38-399"><a href="#cb38-399" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs2</span>(x, <span class="at">col=</span>colscale[cc], <span class="at">labels=</span>cc)</span>
<span id="cb38-400"><a href="#cb38-400" aria-hidden="true" tabindex="-1"></a>ARImle <span class="ot">=</span> <span class="fu">adjustedRandIndex</span>(cc, <span class="fu">as.numeric</span>(iris[,<span class="dv">5</span>]))  <span class="co"># Higher values indicate larger agreement</span></span>
<span id="cb38-401"><a href="#cb38-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-402"><a href="#cb38-402" aria-hidden="true" tabindex="-1"></a><span class="do">## Cluster reconstruction under the K-means algorithm</span></span>
<span id="cb38-403"><a href="#cb38-403" aria-hidden="true" tabindex="-1"></a>irisCluster <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(x, <span class="dv">3</span>, <span class="at">nstart =</span> numruns)</span>
<span id="cb38-404"><a href="#cb38-404" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>)</span>
<span id="cb38-405"><a href="#cb38-405" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs2</span>(x, <span class="at">col=</span>colscale[irisCluster<span class="sc">$</span>cluster], <span class="at">labels=</span>irisCluster<span class="sc">$</span>cluster)</span>
<span id="cb38-406"><a href="#cb38-406" aria-hidden="true" tabindex="-1"></a>ARIkmeans <span class="ot">=</span> <span class="fu">adjustedRandIndex</span>(irisCluster<span class="sc">$</span>cluster, <span class="fu">as.numeric</span>(iris[,<span class="dv">5</span>]))</span>
<span id="cb38-407"><a href="#cb38-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-408"><a href="#cb38-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-409"><a href="#cb38-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-410"><a href="#cb38-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classification</span></span>
<span id="cb38-411"><a href="#cb38-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-412"><a href="#cb38-412" aria-hidden="true" tabindex="-1"></a>Classification is a supervised learning problem where we want to predict the class of a new observation based on its features.</span>
<span id="cb38-413"><a href="#cb38-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-414"><a href="#cb38-414" aria-hidden="true" tabindex="-1"></a>According to the instructor the main difference from clustering is that in classification we have a training set. I would think the main difference is that we have labels for some of the data, while in clustering we do not have labels at all.</span>
<span id="cb38-415"><a href="#cb38-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-416"><a href="#cb38-416" aria-hidden="true" tabindex="-1"></a>The fact that we have labels and a training set means we should know how many classes we have and we can use these labels to train a model and use it to predict the class of a new observation.</span>
<span id="cb38-417"><a href="#cb38-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-418"><a href="#cb38-418" aria-hidden="true" tabindex="-1"></a>The instructor mentions Support Vector Machines (SVM), logistic regression and linear discriminant analysis (LDA) as familiar examples of classification methods. These and a number of others are covered in <span class="co">[</span><span class="ot">@isl</span><span class="co">]</span>. We will focus on Naive Bayes classifiers as it is the most similar to mixture models and the EM algorithm which we have seen earlier</span>
<span id="cb38-419"><a href="#cb38-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-420"><a href="#cb38-420" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mixture Models and naive Bayes classifiers</span></span>
<span id="cb38-421"><a href="#cb38-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-422"><a href="#cb38-422" aria-hidden="true" tabindex="-1"></a><span class="al">![K-means clustering](images/c3l4-ss-04-classification-overview.png)</span>{.column-margin}</span>
<span id="cb38-423"><a href="#cb38-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-424"><a href="#cb38-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-425"><a href="#cb38-425" aria-hidden="true" tabindex="-1"></a><span class="al">![K-means clustering](images/c3l4-ss-05-classification-naive-bayes.png)</span>{.column-margin}</span>
<span id="cb38-426"><a href="#cb38-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-427"><a href="#cb38-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-428"><a href="#cb38-428" aria-hidden="true" tabindex="-1"></a><span class="al">![Mixture Models for Clustering](images/c3l4-ss-06-classification-mixtures.png)</span>{.column-margin}</span>
<span id="cb38-429"><a href="#cb38-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-430"><a href="#cb38-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-431"><a href="#cb38-431" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Naive Bayes classifiers</span></span>
<span id="cb38-432"><a href="#cb38-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-433"><a href="#cb38-433" aria-hidden="true" tabindex="-1"></a>The idea of Naive Bayes classifiers is that we want to know what is the probability that observation i belongs to class k and we can obtain this using Bayes' theorem by computing the prior probability that an observation is in that class. This is just the frequency of the class multiplied by the density of that class and divided by the sum over the classes of the same expression.</span>
<span id="cb38-434"><a href="#cb38-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-435"><a href="#cb38-435" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-436"><a href="#cb38-436" aria-hidden="true" tabindex="-1"></a>P(x_i \in \text{class}_k) = \frac{w_k \cdot g_k(x_i|\theta_k)}{\sum_{j=1}^K w_j \cdot g_j(x_i|\theta_j)}</span>
<span id="cb38-437"><a href="#cb38-437" aria-hidden="true" tabindex="-1"></a>$$ {#eq-bayes-classifier}</span>
<span id="cb38-438"><a href="#cb38-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-439"><a href="#cb38-439" aria-hidden="true" tabindex="-1"></a>where $w_k$ is the prior probability of class k, $g_k(x_i|\theta_k)$ is the density of class k, and $\theta_k$ is the parameter of class k.</span>
<span id="cb38-440"><a href="#cb38-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-441"><a href="#cb38-441" aria-hidden="true" tabindex="-1"></a>with </span>
<span id="cb38-442"><a href="#cb38-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-443"><a href="#cb38-443" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-444"><a href="#cb38-444" aria-hidden="true" tabindex="-1"></a>\tilde{c}_i = \arg \max_k \mathbb{P}r(x_i \in \text{class}_k)\ for \; i=n+1,\ldots,n+m</span>
<span id="cb38-445"><a href="#cb38-445" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-446"><a href="#cb38-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-447"><a href="#cb38-447" aria-hidden="true" tabindex="-1"></a>The naive Bayes classifier assumes that the features are conditionally independent given the class. This means that the density of class k can be written as the product of the densities of each feature given the class:</span>
<span id="cb38-448"><a href="#cb38-448" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-449"><a href="#cb38-449" aria-hidden="true" tabindex="-1"></a>g_k(x_i|\theta_k) = \prod_{l=1}^p g_{kl}(x_{il}|\theta_{kl})</span>
<span id="cb38-450"><a href="#cb38-450" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-451"><a href="#cb38-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-452"><a href="#cb38-452" aria-hidden="true" tabindex="-1"></a>where $g_{kl}(x_{il}|\theta_{kl})$ is the density of feature l given class k and $\theta_{kl}$ is the parameter of feature l given class k. This means that we can estimate the density of each feature separately and then multiply them together to get the density of the class.</span>
<span id="cb38-453"><a href="#cb38-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-454"><a href="#cb38-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-455"><a href="#cb38-455" aria-hidden="true" tabindex="-1"></a>This is a very strong assumption and is not true in general. However, it works well in practice and is often used in text classification problems where the features are the words in the text.</span>
<span id="cb38-456"><a href="#cb38-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-457"><a href="#cb38-457" aria-hidden="true" tabindex="-1"></a>The naive Bayes classifier is a special case of the mixture model where the components are the classes and the densities are the product of the densities of each feature given the class. This means that we can use the EM algorithm to estimate the parameters of the model in the same way as we did for the mixture model. The only difference is that we need to estimate the densities of each feature separately and then multiply them together to get the density of the class.</span>
<span id="cb38-458"><a href="#cb38-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-459"><a href="#cb38-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-460"><a href="#cb38-460" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"} </span>
<span id="cb38-461"><a href="#cb38-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-462"><a href="#cb38-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Video Transcript</span></span>
<span id="cb38-463"><a href="#cb38-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-464"><a href="#cb38-464" aria-hidden="true" tabindex="-1"></a>The last class of problems for which mixture models are very useful is classification problems.  If you come from the machine learning literature, you will call this supervised classification to contrast, again, unsupervised classification that I called clustering before. The goal in supervised classification is to start with a training set and use the information in a training set to determine the classes or the labels of a second group of observations that you call the test set. So you start with a training set that contains known labels classes. You also have a test set that has unknown labels, and you want to use this information to make predictions about the test set labels. For example, you may want to decide whether a person suffers from a disease or not based on a set of medical tests, maybe P medical tests, and you have gone out and measured those tests in a number of individuals. So you know those individuals whether they are sick or they are not sick. Based on that training set that is labeled where you know what the real quality</span>
<span id="cb38-465"><a href="#cb38-465" aria-hidden="true" tabindex="-1"></a>of the individuals is, then you go out and</span>
<span id="cb38-466"><a href="#cb38-466" aria-hidden="true" tabindex="-1"></a>you are going to pick just a random person that comes into your medical appointment, and based on the</span>
<span id="cb38-467"><a href="#cb38-467" aria-hidden="true" tabindex="-1"></a>results of the test, now you want to decide</span>
<span id="cb38-468"><a href="#cb38-468" aria-hidden="true" tabindex="-1"></a>if that individual suffers from the disease or not. So the presence of the</span>
<span id="cb38-469"><a href="#cb38-469" aria-hidden="true" tabindex="-1"></a>training set is really what distinguishes</span>
<span id="cb38-470"><a href="#cb38-470" aria-hidden="true" tabindex="-1"></a>clustering problems from classification problems. In clustering problems, we</span>
<span id="cb38-471"><a href="#cb38-471" aria-hidden="true" tabindex="-1"></a>don't have a training set. We don't have anything</span>
<span id="cb38-472"><a href="#cb38-472" aria-hidden="true" tabindex="-1"></a>that gives us a hint about how the</span>
<span id="cb38-473"><a href="#cb38-473" aria-hidden="true" tabindex="-1"></a>classes look like. We're trying to do the process of dividing the observations into groups in some sense blindly. That's why it's sometimes called unsupervised classification</span>
<span id="cb38-474"><a href="#cb38-474" aria-hidden="true" tabindex="-1"></a>because you can think that the training set provides supervision in how you</span>
<span id="cb38-475"><a href="#cb38-475" aria-hidden="true" tabindex="-1"></a>do the classification. In typical supervised classification</span>
<span id="cb38-476"><a href="#cb38-476" aria-hidden="true" tabindex="-1"></a>problems on the other hand, you do have that training set. You do have that group of labeled observations</span>
<span id="cb38-477"><a href="#cb38-477" aria-hidden="true" tabindex="-1"></a>that can help you make decisions about how the new groups</span>
<span id="cb38-478"><a href="#cb38-478" aria-hidden="true" tabindex="-1"></a>will look like. So in some sense, supervised classification</span>
<span id="cb38-479"><a href="#cb38-479" aria-hidden="true" tabindex="-1"></a>is a simpler problem than unsupervised</span>
<span id="cb38-480"><a href="#cb38-480" aria-hidden="true" tabindex="-1"></a>classification because of the presence of</span>
<span id="cb38-481"><a href="#cb38-481" aria-hidden="true" tabindex="-1"></a>the training set. Now, there are a number of classification</span>
<span id="cb38-482"><a href="#cb38-482" aria-hidden="true" tabindex="-1"></a>procedures out there. This is a fairly common</span>
<span id="cb38-483"><a href="#cb38-483" aria-hidden="true" tabindex="-1"></a>problem in the literature. You may be familiar with things like support vector machines or logistic regression</span>
<span id="cb38-484"><a href="#cb38-484" aria-hidden="true" tabindex="-1"></a>for classification. I want to discuss today the similarities between</span>
<span id="cb38-485"><a href="#cb38-485" aria-hidden="true" tabindex="-1"></a>using mixture models for classification and</span>
<span id="cb38-486"><a href="#cb38-486" aria-hidden="true" tabindex="-1"></a>some techniques such as linear discriminant analysis, and in particular with Naive Bayes classifiers. The idea of Naive Bayes</span>
<span id="cb38-487"><a href="#cb38-487" aria-hidden="true" tabindex="-1"></a>classifiers is very simple. So if you want to know what</span>
<span id="cb38-488"><a href="#cb38-488" aria-hidden="true" tabindex="-1"></a>is the probability that observation i belongs to class k, you can typically obtain</span>
<span id="cb38-489"><a href="#cb38-489" aria-hidden="true" tabindex="-1"></a>that by just using Bayes' theorem by computing the prior probability that an observation is in that class. That is typically</span>
<span id="cb38-490"><a href="#cb38-490" aria-hidden="true" tabindex="-1"></a>just the frequency of the class multiplied by the density of that class and divided by the sum over the classes</span>
<span id="cb38-491"><a href="#cb38-491" aria-hidden="true" tabindex="-1"></a>of the same expression. Now, again, this should</span>
<span id="cb38-492"><a href="#cb38-492" aria-hidden="true" tabindex="-1"></a>be very familiar. This quantity here is</span>
<span id="cb38-493"><a href="#cb38-493" aria-hidden="true" tabindex="-1"></a>essentially what we used both in the EM</span>
<span id="cb38-494"><a href="#cb38-494" aria-hidden="true" tabindex="-1"></a>algorithm to compute the <span class="co">[</span><span class="ot">inaudible</span><span class="co">]</span> case and in the MCMC algorithm if you are fitting a mixture model from a Bayesian perspective to sample the class labels C sub x. So in other words, it's clear just from writing the expression</span>
<span id="cb38-495"><a href="#cb38-495" aria-hidden="true" tabindex="-1"></a>from Naive Bayes that there should be a very</span>
<span id="cb38-496"><a href="#cb38-496" aria-hidden="true" tabindex="-1"></a>close relationship between doing Naive Bayes</span>
<span id="cb38-497"><a href="#cb38-497" aria-hidden="true" tabindex="-1"></a>and doing mixture models. In fact, you can cast Naive Bayes</span>
<span id="cb38-498"><a href="#cb38-498" aria-hidden="true" tabindex="-1"></a>classifiers as just as a special case of mixture models. Let's discuss Naive</span>
<span id="cb38-499"><a href="#cb38-499" aria-hidden="true" tabindex="-1"></a>Bayes classifiers where we use Gaussian kernels</span>
<span id="cb38-500"><a href="#cb38-500" aria-hidden="true" tabindex="-1"></a>for the classification. Let's enter this a</span>
<span id="cb38-501"><a href="#cb38-501" aria-hidden="true" tabindex="-1"></a>little bit of notation. So remember that we have both a test set and</span>
<span id="cb38-502"><a href="#cb38-502" aria-hidden="true" tabindex="-1"></a>a training set. So let's call X_1 up to</span>
<span id="cb38-503"><a href="#cb38-503" aria-hidden="true" tabindex="-1"></a>X_n my training set, and let's call X_n plus 1 up</span>
<span id="cb38-504"><a href="#cb38-504" aria-hidden="true" tabindex="-1"></a>to X_n plus m the test set. In other words, we have n observations in</span>
<span id="cb38-505"><a href="#cb38-505" aria-hidden="true" tabindex="-1"></a>the training set, we have m observations in the test set and we just</span>
<span id="cb38-506"><a href="#cb38-506" aria-hidden="true" tabindex="-1"></a>group the observations together so that the</span>
<span id="cb38-507"><a href="#cb38-507" aria-hidden="true" tabindex="-1"></a>first n in the sample are the training and</span>
<span id="cb38-508"><a href="#cb38-508" aria-hidden="true" tabindex="-1"></a>last m are the test. In addition to this, because the training</span>
<span id="cb38-509"><a href="#cb38-509" aria-hidden="true" tabindex="-1"></a>set is labeled, we're going to have C_1</span>
<span id="cb38-510"><a href="#cb38-510" aria-hidden="true" tabindex="-1"></a>up to C_n are known, but C_1 or C_n plus</span>
<span id="cb38-511"><a href="#cb38-511" aria-hidden="true" tabindex="-1"></a>1 up to C_m plus n are unknown and we</span>
<span id="cb38-512"><a href="#cb38-512" aria-hidden="true" tabindex="-1"></a>want to protect them. Let's write a Naive</span>
<span id="cb38-513"><a href="#cb38-513" aria-hidden="true" tabindex="-1"></a>Bayes classifier that uses Gaussian kernels, and we're going to use the more general Gaussian</span>
<span id="cb38-514"><a href="#cb38-514" aria-hidden="true" tabindex="-1"></a>kernels that we can. So in that case, the probability</span>
<span id="cb38-515"><a href="#cb38-515" aria-hidden="true" tabindex="-1"></a>that observation i belongs to class k, it's going to be</span>
<span id="cb38-516"><a href="#cb38-516" aria-hidden="true" tabindex="-1"></a>equal to Omega_k 1 over the square root 2 Pi to the p. Remember that we're working</span>
<span id="cb38-517"><a href="#cb38-517" aria-hidden="true" tabindex="-1"></a>with P variate normal. So we can have P features</span>
<span id="cb38-518"><a href="#cb38-518" aria-hidden="true" tabindex="-1"></a>for each individual, determinant of Sigma_k to the minus one 1/2</span>
<span id="cb38-519"><a href="#cb38-519" aria-hidden="true" tabindex="-1"></a>X of minus one 1/2 X_i minus Mu k transpose sigma sub k</span>
<span id="cb38-520"><a href="#cb38-520" aria-hidden="true" tabindex="-1"></a>inverse X_i minus Mu k, divided by the sum over the components of</span>
<span id="cb38-521"><a href="#cb38-521" aria-hidden="true" tabindex="-1"></a>exactly the same expression. This has to be l, minus Mu sub l transpose</span>
<span id="cb38-522"><a href="#cb38-522" aria-hidden="true" tabindex="-1"></a>sigma l inverse X_i minus Mu l. So this is just Bayes theorem as we have written multiple</span>
<span id="cb38-523"><a href="#cb38-523" aria-hidden="true" tabindex="-1"></a>times in this course. So what you do is, you need this expression</span>
<span id="cb38-524"><a href="#cb38-524" aria-hidden="true" tabindex="-1"></a>only for the training set because for the test</span>
<span id="cb38-525"><a href="#cb38-525" aria-hidden="true" tabindex="-1"></a>set you already know what class you are in. So what you typically do is</span>
<span id="cb38-526"><a href="#cb38-526" aria-hidden="true" tabindex="-1"></a>a two-step process in which you get Mu k hat and Sigma hat sub k are estimated from the training set. You could do different things, but it's very fairly</span>
<span id="cb38-527"><a href="#cb38-527" aria-hidden="true" tabindex="-1"></a>common to just fit a multivariate Gaussian to each one of the components. So your Cs, your labels divide your</span>
<span id="cb38-528"><a href="#cb38-528" aria-hidden="true" tabindex="-1"></a>training set into groups. For each one of those groups, you fit one different</span>
<span id="cb38-529"><a href="#cb38-529" aria-hidden="true" tabindex="-1"></a>normal and that gives you Sigma and Mu. Similarly, for Omega k, you want to get an</span>
<span id="cb38-530"><a href="#cb38-530" aria-hidden="true" tabindex="-1"></a>estimate for Omega k, and the natural thing to do</span>
<span id="cb38-531"><a href="#cb38-531" aria-hidden="true" tabindex="-1"></a>is to just use the frequency, the fraction of the observations in the training set that belong to each one</span>
<span id="cb38-532"><a href="#cb38-532" aria-hidden="true" tabindex="-1"></a>of the classes. Once you have those, then you classify</span>
<span id="cb38-533"><a href="#cb38-533" aria-hidden="true" tabindex="-1"></a>new observations as by letting C_i be equal to the org max</span>
<span id="cb38-534"><a href="#cb38-534" aria-hidden="true" tabindex="-1"></a>of that probability. Where the probabilities</span>
<span id="cb38-535"><a href="#cb38-535" aria-hidden="true" tabindex="-1"></a>are computed by plugging in these maximum</span>
<span id="cb38-536"><a href="#cb38-536" aria-hidden="true" tabindex="-1"></a>likelihood estimators in this formula up here. As I said, this is done</span>
<span id="cb38-537"><a href="#cb38-537" aria-hidden="true" tabindex="-1"></a>for n plus 1 all the way to n plus m. So you don't need to do this</span>
<span id="cb38-538"><a href="#cb38-538" aria-hidden="true" tabindex="-1"></a>for the training set, the training set</span>
<span id="cb38-539"><a href="#cb38-539" aria-hidden="true" tabindex="-1"></a>you know the labels and you use those labels to compute the MLEs that</span>
<span id="cb38-540"><a href="#cb38-540" aria-hidden="true" tabindex="-1"></a>get plugged into this. Now, with additional</span>
<span id="cb38-541"><a href="#cb38-541" aria-hidden="true" tabindex="-1"></a>observations in those MLEs, you can decide what are</span>
<span id="cb38-542"><a href="#cb38-542" aria-hidden="true" tabindex="-1"></a>the classes for them. So this is what a naive</span>
<span id="cb38-543"><a href="#cb38-543" aria-hidden="true" tabindex="-1"></a>Bayes classifier based on Gaussian distributions for each one of the classes</span>
<span id="cb38-544"><a href="#cb38-544" aria-hidden="true" tabindex="-1"></a>would look like. Now, this is exactly the same as the EM algorithm that we have discussed in the</span>
<span id="cb38-545"><a href="#cb38-545" aria-hidden="true" tabindex="-1"></a>past for mixture models, if we make a couple of assumptions or if we incorporate a couple of assumptions</span>
<span id="cb38-546"><a href="#cb38-546" aria-hidden="true" tabindex="-1"></a>into the algorithm. So let's write down that next. We can recast the</span>
<span id="cb38-547"><a href="#cb38-547" aria-hidden="true" tabindex="-1"></a>algorithms that we just saw for naive Bayes</span>
<span id="cb38-548"><a href="#cb38-548" aria-hidden="true" tabindex="-1"></a>classifier based on Gaussian kernels</span>
<span id="cb38-549"><a href="#cb38-549" aria-hidden="true" tabindex="-1"></a>in the context of the EM algorithm that we have been discussing</span>
<span id="cb38-550"><a href="#cb38-550" aria-hidden="true" tabindex="-1"></a>for mixtures. That is very easy, we're going to think, again, about an E-step and an M-step, and we're going to add an additional post-processing</span>
<span id="cb38-551"><a href="#cb38-551" aria-hidden="true" tabindex="-1"></a>step, if you will. In our E-step, if you remember, what we did in the</span>
<span id="cb38-552"><a href="#cb38-552" aria-hidden="true" tabindex="-1"></a>past was to compute the indicators for the variables. So that is our variables V_i,k that corresponds to the weights that are associated with each</span>
<span id="cb38-553"><a href="#cb38-553" aria-hidden="true" tabindex="-1"></a>one of the components. What we're going to do</span>
<span id="cb38-554"><a href="#cb38-554" aria-hidden="true" tabindex="-1"></a>in this case is we're going to define the V_i,k in a very simple fashion</span>
<span id="cb38-555"><a href="#cb38-555" aria-hidden="true" tabindex="-1"></a>rather than doing it using Bayes theorem. Because we actually know what observations</span>
<span id="cb38-556"><a href="#cb38-556" aria-hidden="true" tabindex="-1"></a>or what components are generating each of the observations in the training set, we can call V_i,k</span>
<span id="cb38-557"><a href="#cb38-557" aria-hidden="true" tabindex="-1"></a>just one or zero if C_i is equal to k</span>
<span id="cb38-558"><a href="#cb38-558" aria-hidden="true" tabindex="-1"></a>and zero otherwise, for all the observations</span>
<span id="cb38-559"><a href="#cb38-559" aria-hidden="true" tabindex="-1"></a>that go from one to n. In other words, this is for the training set. Once we have defined</span>
<span id="cb38-560"><a href="#cb38-560" aria-hidden="true" tabindex="-1"></a>our E-step in this way, we're going to have an</span>
<span id="cb38-561"><a href="#cb38-561" aria-hidden="true" tabindex="-1"></a>M-step where we compute Mu sub k and Omega sub k. To put it in the same way that we</span>
<span id="cb38-562"><a href="#cb38-562" aria-hidden="true" tabindex="-1"></a>did with the EM algorithm, this is going to have a</span>
<span id="cb38-563"><a href="#cb38-563" aria-hidden="true" tabindex="-1"></a>very particular shape. It's going to have the sum</span>
<span id="cb38-564"><a href="#cb38-564" aria-hidden="true" tabindex="-1"></a>from one to n of V_i,k X_i divided by the sum from one to n of V_i,k. In a similar expression</span>
<span id="cb38-565"><a href="#cb38-565" aria-hidden="true" tabindex="-1"></a>for my matrix Sigma, Sigma is going to be Sigma sub k, it's going to be</span>
<span id="cb38-566"><a href="#cb38-566" aria-hidden="true" tabindex="-1"></a>one over the sum of the V_i,k from one to n, sum from one to n of V_i,k X_i minus Mu k, X_i minus Mu k transpose. These are expressions that we</span>
<span id="cb38-567"><a href="#cb38-567" aria-hidden="true" tabindex="-1"></a>have seen in the past when filling mixtures of</span>
<span id="cb38-568"><a href="#cb38-568" aria-hidden="true" tabindex="-1"></a>multivariate Gaussians to data. This is just a fancy way, so casting it in terms of</span>
<span id="cb38-569"><a href="#cb38-569" aria-hidden="true" tabindex="-1"></a>the E-step and the M-step, it's just a fancy way to say, I know what my assignments are, for sure, because this</span>
<span id="cb38-570"><a href="#cb38-570" aria-hidden="true" tabindex="-1"></a>is a training set. So this is just computing the average of the</span>
<span id="cb38-571"><a href="#cb38-571" aria-hidden="true" tabindex="-1"></a>observations that are in category K because, in this case, these are</span>
<span id="cb38-572"><a href="#cb38-572" aria-hidden="true" tabindex="-1"></a>either zeros or ones. Similarly, here, this is just the variance</span>
<span id="cb38-573"><a href="#cb38-573" aria-hidden="true" tabindex="-1"></a>covariance matrix of the observations that</span>
<span id="cb38-574"><a href="#cb38-574" aria-hidden="true" tabindex="-1"></a>are in component K, but it's written in</span>
<span id="cb38-575"><a href="#cb38-575" aria-hidden="true" tabindex="-1"></a>a fancy way using this V_i,k as indicators. Then, we have a post-processing. It's in the</span>
<span id="cb38-576"><a href="#cb38-576" aria-hidden="true" tabindex="-1"></a>post-processing step where the test set comes into play. So for now, we have only used the training set for</span>
<span id="cb38-577"><a href="#cb38-577" aria-hidden="true" tabindex="-1"></a>our calculations. In the post-processing step, what we do is we</span>
<span id="cb38-578"><a href="#cb38-578" aria-hidden="true" tabindex="-1"></a>allocate C_i based on the arc max over K of the posterior distribution</span>
<span id="cb38-579"><a href="#cb38-579" aria-hidden="true" tabindex="-1"></a>of the class allocations. So that is probability that X_i belongs to class K. So this is just another way to write the algorithms</span>
<span id="cb38-580"><a href="#cb38-580" aria-hidden="true" tabindex="-1"></a>as we had before, that is very simple in the</span>
<span id="cb38-581"><a href="#cb38-581" aria-hidden="true" tabindex="-1"></a>context of <span class="co">[</span><span class="ot">inaudible</span><span class="co">]</span>. So why did I go through the</span>
<span id="cb38-582"><a href="#cb38-582" aria-hidden="true" tabindex="-1"></a>trouble of expressing this in this complicated manner when I had a very simple</span>
<span id="cb38-583"><a href="#cb38-583" aria-hidden="true" tabindex="-1"></a>description before? Well, because now you can try to generalize this from</span>
<span id="cb38-584"><a href="#cb38-584" aria-hidden="true" tabindex="-1"></a>this supervised setting where you</span>
<span id="cb38-585"><a href="#cb38-585" aria-hidden="true" tabindex="-1"></a>completely break apart the estimation</span>
<span id="cb38-586"><a href="#cb38-586" aria-hidden="true" tabindex="-1"></a>of the parameters that only uses the training set and the classification that</span>
<span id="cb38-587"><a href="#cb38-587" aria-hidden="true" tabindex="-1"></a>only uses the test set. You can actually try to</span>
<span id="cb38-588"><a href="#cb38-588" aria-hidden="true" tabindex="-1"></a>combine information from both, and it should be</span>
<span id="cb38-589"><a href="#cb38-589" aria-hidden="true" tabindex="-1"></a>clear that if you have training sets that are just very small</span>
<span id="cb38-590"><a href="#cb38-590" aria-hidden="true" tabindex="-1"></a>compared to the test set, the estimates that you get</span>
<span id="cb38-591"><a href="#cb38-591" aria-hidden="true" tabindex="-1"></a>for Mu and Sigma will be very bad because they will be based on very few observations,</span>
<span id="cb38-592"><a href="#cb38-592" aria-hidden="true" tabindex="-1"></a>very few data points. So if you could somehow use some of the information</span>
<span id="cb38-593"><a href="#cb38-593" aria-hidden="true" tabindex="-1"></a>that you are recovering by doing the</span>
<span id="cb38-594"><a href="#cb38-594" aria-hidden="true" tabindex="-1"></a>classification to help you estimate what</span>
<span id="cb38-595"><a href="#cb38-595" aria-hidden="true" tabindex="-1"></a>Mu and Sigma are, they'll probably give you more robust, stronger algorithm. How to do that should be</span>
<span id="cb38-596"><a href="#cb38-596" aria-hidden="true" tabindex="-1"></a>relatively straightforward once you think about</span>
<span id="cb38-597"><a href="#cb38-597" aria-hidden="true" tabindex="-1"></a>it in this context. For the observations</span>
<span id="cb38-598"><a href="#cb38-598" aria-hidden="true" tabindex="-1"></a>to the training set, we have the value of the V_i,k, but we could add an estimate of the</span>
<span id="cb38-599"><a href="#cb38-599" aria-hidden="true" tabindex="-1"></a>value of the V_i,k for the observations in the test</span>
<span id="cb38-600"><a href="#cb38-600" aria-hidden="true" tabindex="-1"></a>set to this calculation. We already know how to do that. So we're going to turn the</span>
<span id="cb38-601"><a href="#cb38-601" aria-hidden="true" tabindex="-1"></a>algorithm iterative now. So these guys are always going to be defined in this way because</span>
<span id="cb38-602"><a href="#cb38-602" aria-hidden="true" tabindex="-1"></a>I know the C's, but these guys are refined at every iteration</span>
<span id="cb38-603"><a href="#cb38-603" aria-hidden="true" tabindex="-1"></a>of the algorithm. I'll just make this essentially</span>
<span id="cb38-604"><a href="#cb38-604" aria-hidden="true" tabindex="-1"></a>equal to the probability that X_i belongs to class K given the current</span>
<span id="cb38-605"><a href="#cb38-605" aria-hidden="true" tabindex="-1"></a>parameters of the model, so given the current Omegas, the current Mus, and</span>
<span id="cb38-606"><a href="#cb38-606" aria-hidden="true" tabindex="-1"></a>the current Sigmas. Then, I can extend my sums to</span>
<span id="cb38-607"><a href="#cb38-607" aria-hidden="true" tabindex="-1"></a>m down here and down here. Now, what I'm doing is, for the observations that I</span>
<span id="cb38-608"><a href="#cb38-608" aria-hidden="true" tabindex="-1"></a>know what class they are in, these weights are</span>
<span id="cb38-609"><a href="#cb38-609" aria-hidden="true" tabindex="-1"></a>either zeros or ones. For the ones that I don't know but I'm trying to classify, they will be some number</span>
<span id="cb38-610"><a href="#cb38-610" aria-hidden="true" tabindex="-1"></a>between zero and one, and I'm just going to do a weighted average so you</span>
<span id="cb38-611"><a href="#cb38-611" aria-hidden="true" tabindex="-1"></a>can think about this, again, as a weighted average of the information that</span>
<span id="cb38-612"><a href="#cb38-612" aria-hidden="true" tabindex="-1"></a>I know for sure, and the information that</span>
<span id="cb38-613"><a href="#cb38-613" aria-hidden="true" tabindex="-1"></a>I'm recovering about Mu and Sigma from the</span>
<span id="cb38-614"><a href="#cb38-614" aria-hidden="true" tabindex="-1"></a>classification. So again, this now becomes</span>
<span id="cb38-615"><a href="#cb38-615" aria-hidden="true" tabindex="-1"></a>an iterative algorithm, so I need to think about</span>
<span id="cb38-616"><a href="#cb38-616" aria-hidden="true" tabindex="-1"></a>t plus 1, t plus 1, t plus 1, t plus 1, t plus 1, t plus 1, and t plus 1. So I have turned what was just a two-step algorithm that doesn't require</span>
<span id="cb38-617"><a href="#cb38-617" aria-hidden="true" tabindex="-1"></a>any iteration, I turned it into an iterative</span>
<span id="cb38-618"><a href="#cb38-618" aria-hidden="true" tabindex="-1"></a>algorithm that uses the whole sample to estimate the parameters</span>
<span id="cb38-619"><a href="#cb38-619" aria-hidden="true" tabindex="-1"></a>of the classes. This is sometimes called</span>
<span id="cb38-620"><a href="#cb38-620" aria-hidden="true" tabindex="-1"></a>a semi-supervised; I don't necessarily like</span>
<span id="cb38-621"><a href="#cb38-621" aria-hidden="true" tabindex="-1"></a>the term very much. But this is sometimes called</span>
<span id="cb38-622"><a href="#cb38-622" aria-hidden="true" tabindex="-1"></a>a semi-supervised algorithm, in the sense that it's</span>
<span id="cb38-623"><a href="#cb38-623" aria-hidden="true" tabindex="-1"></a>not completely supervised because of the addition of this information</span>
<span id="cb38-624"><a href="#cb38-624" aria-hidden="true" tabindex="-1"></a>and the fact that now, the sums go up to m.</span>
<span id="cb38-625"><a href="#cb38-625" aria-hidden="true" tabindex="-1"></a>But it's also not fully unsupervised because</span>
<span id="cb38-626"><a href="#cb38-626" aria-hidden="true" tabindex="-1"></a>I'm using the information, I'm using this piece</span>
<span id="cb38-627"><a href="#cb38-627" aria-hidden="true" tabindex="-1"></a>up here that has information where I</span>
<span id="cb38-628"><a href="#cb38-628" aria-hidden="true" tabindex="-1"></a>know their true labels. Once the algorithm converges, I'm still going to do the post-processing</span>
<span id="cb38-629"><a href="#cb38-629" aria-hidden="true" tabindex="-1"></a>step that is to go from this V_i,k's that I computed here for the test set to generate what are the</span>
<span id="cb38-630"><a href="#cb38-630" aria-hidden="true" tabindex="-1"></a>labels for those observations.</span>
<span id="cb38-631"><a href="#cb38-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-632"><a href="#cb38-632" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb38-633"><a href="#cb38-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-634"><a href="#cb38-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-635"><a href="#cb38-635" aria-hidden="true" tabindex="-1"></a><span class="fu">### LDA and the EM algorithm</span></span>
<span id="cb38-636"><a href="#cb38-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-637"><a href="#cb38-637" aria-hidden="true" tabindex="-1"></a><span class="al">![LDA](images/c3l4-ss-08-lda.png)</span>{.column-margin}</span>
<span id="cb38-638"><a href="#cb38-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-639"><a href="#cb38-639" aria-hidden="true" tabindex="-1"></a><span class="al">![LDA](images/c3l4-ss-09-lda.png)</span>{.column-margin}</span>
<span id="cb38-640"><a href="#cb38-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-641"><a href="#cb38-641" aria-hidden="true" tabindex="-1"></a>It is important to understand the connection between using mixture models for classification and other procedures that are commonly used out there for classification. One example of those procedures that has a strong connection is linear discriminant analysis and also  to quadratic discriminant analysis.</span>
<span id="cb38-642"><a href="#cb38-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-643"><a href="#cb38-643" aria-hidden="true" tabindex="-1"></a>To illustrate that connection, we start with a very simple mixture model. </span>
<span id="cb38-644"><a href="#cb38-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-645"><a href="#cb38-645" aria-hidden="true" tabindex="-1"></a>So let's start with a mixture model of the form, </span>
<span id="cb38-646"><a href="#cb38-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-647"><a href="#cb38-647" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-648"><a href="#cb38-648" aria-hidden="true" tabindex="-1"></a>f(x) = \sum_{k=1}^2 \omega_k \frac{1}{\sqrt{2\pi}} \frac{1}{\sqrt{\text{det}(\Sigma)}} e^{-\frac{1}{2}(x - \mu_k)^T \Sigma^{-1} (x - \mu_k)}.</span>
<span id="cb38-649"><a href="#cb38-649" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-650"><a href="#cb38-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-651"><a href="#cb38-651" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb38-652"><a href="#cb38-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-653"><a href="#cb38-653" aria-hidden="true" tabindex="-1"></a><span class="fu">## Video Transcript</span></span>
<span id="cb38-654"><a href="#cb38-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-655"><a href="#cb38-655" aria-hidden="true" tabindex="-1"></a>It is important to understand the connection between using mixture models for classification and other procedures that are commonly used out there for classification. One example of those procedures that has a strong connection is linear discriminant analysis. </span>
<span id="cb38-656"><a href="#cb38-656" aria-hidden="true" tabindex="-1"></a>And also, by the way, quadratic discriminant analysis.  But let's start with linear discriminant analysis. </span>
<span id="cb38-657"><a href="#cb38-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-658"><a href="#cb38-658" aria-hidden="true" tabindex="-1"></a>And to illustrate that connection, let's start with a very simple mixture model. </span>
<span id="cb38-659"><a href="#cb38-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-660"><a href="#cb38-660" aria-hidden="true" tabindex="-1"></a>So let's start with a mixture model of the form, $f(x) =$ the sum from 1 to 2. </span>
<span id="cb38-661"><a href="#cb38-661" aria-hidden="true" tabindex="-1"></a>So I'm going to be working only with two components of omega k, 1 over the square root 2pi to the p determinant of sigma to the -1 half, x- 1 half, x, mu sub k, transpose sigma inverse, x- mu sub k. </span>
<span id="cb38-662"><a href="#cb38-662" aria-hidden="true" tabindex="-1"></a>So this is two-component mixture with locations bearing with a component, but the same variance-covariance matrix for the two components that I have in the mixture. </span>
<span id="cb38-663"><a href="#cb38-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-664"><a href="#cb38-664" aria-hidden="true" tabindex="-1"></a>And let's think about how the procedure would look like if we were to do Naive Bayes classification using this mixture. </span>
<span id="cb38-665"><a href="#cb38-665" aria-hidden="true" tabindex="-1"></a>If I follow the unsupervised example that I have discussed before, the probability that I put observation i in class, 1, say, I only have two classes. </span>
<span id="cb38-666"><a href="#cb38-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-667"><a href="#cb38-667" aria-hidden="true" tabindex="-1"></a>So as you see again, consider one of them and the other one is just 1- the numbers that I get here. </span>
<span id="cb38-668"><a href="#cb38-668" aria-hidden="true" tabindex="-1"></a>It's going to be equal. </span>
<span id="cb38-669"><a href="#cb38-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-670"><a href="#cb38-670" aria-hidden="true" tabindex="-1"></a>And I'm going to expand this in all its glory. </span>
<span id="cb38-671"><a href="#cb38-671" aria-hidden="true" tabindex="-1"></a>It's going to be a little bit long. So it's going to be omega 1, 1 over the square root 2pi to the p determinant of sigma to the- 1 half, x of- 1 half, x- mu k transpose sigma inverse x- mu k. </span>
<span id="cb38-672"><a href="#cb38-672" aria-hidden="true" tabindex="-1"></a>And in the denominator, we're going to have the same expression first. </span>
<span id="cb38-673"><a href="#cb38-673" aria-hidden="true" tabindex="-1"></a>And then we're going to have omega 2, that is just 1- omega 1 but 2pi to the p determinant of sigma to the- 1 half x- 1 half x- mu 2, sigma inverse x- mu 2. </span>
<span id="cb38-674"><a href="#cb38-674" aria-hidden="true" tabindex="-1"></a>Okay, and we know that the probability that xi belongs to class 1 is exactly the same expression but replacing mu, 1 which is what should be up here, replacing mu1 with mu2. </span>
<span id="cb38-675"><a href="#cb38-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-676"><a href="#cb38-676" aria-hidden="true" tabindex="-1"></a>So, in the post processing step, we are going to assign C sub i = 1 if and only if the probability that xi belongs to class 1 is greater than the probability that xi belongs to class 2. </span>
<span id="cb38-677"><a href="#cb38-677" aria-hidden="true" tabindex="-1"></a>And because the two expressions are the same in the denominator, the only thing that</span>
<span id="cb38-678"><a href="#cb38-678" aria-hidden="true" tabindex="-1"></a>changes is the numerator, then this happens if and only if omega 1, 1 over the square root 2pi to the p determinant sigma to the- 1 half x- 1 half, X- mu1 transpose sigma inverse x- mu1, Is greater than omega 2, 1 over the square root 2pi to the p determinant of sigma to the- 1 half x of- 1 half x- mu2, sigma inverse x- mu2. </span>
<span id="cb38-679"><a href="#cb38-679" aria-hidden="true" tabindex="-1"></a>So probability of class 1 greater than probability of class 2 only if this quantity is greater than the same thing but evaluated for the second component in the mixture. </span>
<span id="cb38-680"><a href="#cb38-680" aria-hidden="true" tabindex="-1"></a>So let's do a little bit of algebra and</span>
<span id="cb38-681"><a href="#cb38-681" aria-hidden="true" tabindex="-1"></a>let's try to simplify this expression a little bit and we will see that that simplification leads to a very nice expression that matches exactly what you get out of linear discriminant analysis. </span>
<span id="cb38-682"><a href="#cb38-682" aria-hidden="true" tabindex="-1"></a>So now we want to simplify this expression that corresponds to the situation where we're going to label an observation coming from class 1, and we want to make it much more compact. </span>
<span id="cb38-683"><a href="#cb38-683" aria-hidden="true" tabindex="-1"></a>So a few things that we can observe. So one of them is we have 1 over square root 2pi to the p on both sides, so we can cancel that. </span>
<span id="cb38-684"><a href="#cb38-684" aria-hidden="true" tabindex="-1"></a>The other thing that we observe is that we have the determinant of the variance-covariance matrix on both sides. </span>
<span id="cb38-685"><a href="#cb38-685" aria-hidden="true" tabindex="-1"></a>And because we're assuming that the two components have the same variance- covariance matrix, we can again just simplify both terms on either side. </span>
<span id="cb38-686"><a href="#cb38-686" aria-hidden="true" tabindex="-1"></a>And the next thing that I'm going to do is I'm going to move all the omegas to one side and bring all the terms with the exponentials to the other side. </span>
<span id="cb38-687"><a href="#cb38-687" aria-hidden="true" tabindex="-1"></a>If I do that, I'm going to end up on the left hand side with the exponent of- 1 half, X- mu1 transpose sigma inverse x- mu1. </span>
<span id="cb38-688"><a href="#cb38-688" aria-hidden="true" tabindex="-1"></a>And then this term came to the other side in the denominator, but that just means that when it goes into the exponential, I need to change all to reverse signs. So it's going to be- x- mu2 transpose sigma inverse x- mu2. </span>
<span id="cb38-689"><a href="#cb38-689" aria-hidden="true" tabindex="-1"></a>So that's the expression once you move this to the denominator and combine the two exponentials. </span>
<span id="cb38-690"><a href="#cb38-690" aria-hidden="true" tabindex="-1"></a>And this needs to be greater than omega 2 divided by omega 1. Now, some further simplifications. I can take the logarithm on both sides and I can multiply by -2 on both sides, and I end up with an expression that looks like x- mu 1 transpose sigma inverse x- mu1- x- mu 2 transpose sigma inverse x- mu 2 has to be less than, because I'm going to end up multiplying by a -2. </span>
<span id="cb38-691"><a href="#cb38-691" aria-hidden="true" tabindex="-1"></a>So less than -2 log of omega 2 divided by omega 1. </span>
<span id="cb38-692"><a href="#cb38-692" aria-hidden="true" tabindex="-1"></a>So now we have this difference of two quadratic forms needs to be less than a certain constant that depends on what are my prior weights for each one of the two components. </span>
<span id="cb38-693"><a href="#cb38-693" aria-hidden="true" tabindex="-1"></a>Now, to finish simplifying this, we need to expand these two squares, which is pretty straightforward. </span>
<span id="cb38-694"><a href="#cb38-694" aria-hidden="true" tabindex="-1"></a>So first we're going to have x sigma inverse x transpose sigma inverse x. </span>
<span id="cb38-695"><a href="#cb38-695" aria-hidden="true" tabindex="-1"></a>This is just a square. So it's going to be 2 times x transpose sigma inverse mu1. </span>
<span id="cb38-696"><a href="#cb38-696" aria-hidden="true" tabindex="-1"></a>And finally, $\mu_1$ transpose sigma inverse $\mu_1$. </span>
<span id="cb38-697"><a href="#cb38-697" aria-hidden="true" tabindex="-1"></a>And then we need to subtract a similar expression but using mu2 for it turns. </span>
<span id="cb38-698"><a href="#cb38-698" aria-hidden="true" tabindex="-1"></a>So it's going to be x transpose sigma inverse x. </span>
<span id="cb38-699"><a href="#cb38-699" aria-hidden="true" tabindex="-1"></a>It's going to be +, in this case, 2x transpose sigma inverse mu2. </span>
<span id="cb38-700"><a href="#cb38-700" aria-hidden="true" tabindex="-1"></a>And finally, again,- mu2 transpose sigma inverse mu2, and all of these needs to be less than -2 log of omega 2, Divided by omega 1. </span>
<span id="cb38-701"><a href="#cb38-701" aria-hidden="true" tabindex="-1"></a>So you can see that the expressions are relatively straightforward. </span>
<span id="cb38-702"><a href="#cb38-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-703"><a href="#cb38-703" aria-hidden="true" tabindex="-1"></a>And one of the things that is very nice, and it's a consequence of having the same variance-covariance matrix for each one of the components, is that now this quadratic term of the data is going to cancel out. </span>
<span id="cb38-704"><a href="#cb38-704" aria-hidden="true" tabindex="-1"></a>And so, we can just basically learn together a couple of terms. So we can write, 2 times, X transpose sigma inverse multiplied by mu2- mu1. </span>
<span id="cb38-705"><a href="#cb38-705" aria-hidden="true" tabindex="-1"></a>So I'm taking this term and combining it with this term. So, the term here and the term here. </span>
<span id="cb38-706"><a href="#cb38-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-707"><a href="#cb38-707" aria-hidden="true" tabindex="-1"></a>And then I'm going to say that this has to be less than -2 times log of omega 2 divided by omega 1, and I'm going to move this two terms to the right. </span>
<span id="cb38-708"><a href="#cb38-708" aria-hidden="true" tabindex="-1"></a>So,+ mu2 transpose sigma inverse mu2- mu1 transpose sigma inverse mu1. </span>
<span id="cb38-709"><a href="#cb38-709" aria-hidden="true" tabindex="-1"></a>So this is actually quite a bit of simplification and it's a very interesting one. </span>
<span id="cb38-710"><a href="#cb38-710" aria-hidden="true" tabindex="-1"></a>Because you can think about this, Thing on the right hand side, just call this T for threshold. </span>
<span id="cb38-711"><a href="#cb38-711" aria-hidden="true" tabindex="-1"></a>So this is your sum threshold and that threshold is basically computed based on the training data. </span>
<span id="cb38-712"><a href="#cb38-712" aria-hidden="true" tabindex="-1"></a>So if I know the classes of some observations, I can get what the means for each one of the classes are, I can estimate the common sigma, and I can estimate the relative frequencies. </span>
<span id="cb38-713"><a href="#cb38-713" aria-hidden="true" tabindex="-1"></a>And with that, I can obtain a stress score from the training set. </span>
<span id="cb38-714"><a href="#cb38-714" aria-hidden="true" tabindex="-1"></a>And I can think about this matrix product as sum vector a. </span>
<span id="cb38-715"><a href="#cb38-715" aria-hidden="true" tabindex="-1"></a>The form of this simplified expression is very interesting. </span>
<span id="cb38-716"><a href="#cb38-716" aria-hidden="true" tabindex="-1"></a>You can see that the right-hand side, all this expression in the box, it's just a threshold that can be easily computed from the training set. </span>
<span id="cb38-717"><a href="#cb38-717" aria-hidden="true" tabindex="-1"></a>We can estimate the weight and we can estimate the mean and the covariance of the two components. </span>
<span id="cb38-718"><a href="#cb38-718" aria-hidden="true" tabindex="-1"></a>And then, this product of the variance-covariance or the inverse of the variance-covariance matrix times the difference of the means corresponds to a vector a that can also be computed from the training set. </span>
<span id="cb38-719"><a href="#cb38-719" aria-hidden="true" tabindex="-1"></a>So essentially, the decision of whether we classify an observation in class 1 or class 2 is going to depend on whether a linear combination, and that's what x transpose times a is, is just a linear combination of the values of x. </span>
<span id="cb38-720"><a href="#cb38-720" aria-hidden="true" tabindex="-1"></a>So whether this linear combination of the values of x is greater than a given threshold or not. </span>
<span id="cb38-721"><a href="#cb38-721" aria-hidden="true" tabindex="-1"></a>In other words, what we're doing, In a setting where we only have two variables, for example, x1 and x2, the linear combination of</span>
<span id="cb38-722"><a href="#cb38-722" aria-hidden="true" tabindex="-1"></a>the entries is just a line on the plane. </span>
<span id="cb38-723"><a href="#cb38-723" aria-hidden="true" tabindex="-1"></a>So this product just corresponds to a line. </span>
<span id="cb38-724"><a href="#cb38-724" aria-hidden="true" tabindex="-1"></a>And by deciding whether we are above</span>
<span id="cb38-725"><a href="#cb38-725" aria-hidden="true" tabindex="-1"></a>the line or below the line, we're just saying that one of the regions corresponds to class, 2, and</span>
<span id="cb38-726"><a href="#cb38-726" aria-hidden="true" tabindex="-1"></a>the other region corresponds to class 1. </span>
<span id="cb38-727"><a href="#cb38-727" aria-hidden="true" tabindex="-1"></a>So this is the reason why the procedure is called linear discriminant analysis because it uses a straight line to decide whether observations should be classified in class 1 and class 2. </span>
<span id="cb38-728"><a href="#cb38-728" aria-hidden="true" tabindex="-1"></a>Now, there are some more interesting things that you can do. </span>
<span id="cb38-729"><a href="#cb38-729" aria-hidden="true" tabindex="-1"></a>For example, you don't have to assume that the sigmas are the same, you could assume that the sigmas are different. </span>
<span id="cb38-730"><a href="#cb38-730" aria-hidden="true" tabindex="-1"></a>If you were to do that, then you'd be in a situation that is analogous to this one with the main difference being that now these terms here wouldn't necessarily simplify. </span>
<span id="cb38-731"><a href="#cb38-731" aria-hidden="true" tabindex="-1"></a>But then, you can rearrange terms in such a way that now, you're going to have a quadratic form of x being less than a certain threshold. And in that case, you're separating hyperplane. </span>
<span id="cb38-732"><a href="#cb38-732" aria-hidden="true" tabindex="-1"></a>Instead of being a hyperplane or line, it's going to be a quadratic form. </span>
<span id="cb38-733"><a href="#cb38-733" aria-hidden="true" tabindex="-1"></a>And that is the reason why when you're doing Naive Bayes and you're working with kernels that are Gaussian and have different variance-covariance matrices, you call the procedure quadratic discriminant analysis. </span>
<span id="cb38-734"><a href="#cb38-734" aria-hidden="true" tabindex="-1"></a>Because it uses a quadratic form, a parabola or something like that to separate the two classes that you're working with. </span>
<span id="cb38-735"><a href="#cb38-735" aria-hidden="true" tabindex="-1"></a>The nice thing about thinking about this classification procedures in the context of mixture models is again, thinking about ways in which you can generalize and address the shortcomings of the procedure. </span>
<span id="cb38-736"><a href="#cb38-736" aria-hidden="true" tabindex="-1"></a>It's clear that the main issue with classification procedures based on Gaussians is that data in the real world sometimes doesn't look like multivariate Gaussian distributions. </span>
<span id="cb38-737"><a href="#cb38-737" aria-hidden="true" tabindex="-1"></a>So one possible extension is to instead of considering the density, this ps here to be a single Gaussian, you can kind of use mixtures a second time and borrow some ideas from when we did density estimation. </span>
<span id="cb38-738"><a href="#cb38-738" aria-hidden="true" tabindex="-1"></a>And say well, I'm going to have a mixture and each component of that mixture is in turn a second mixture that may have a few components. </span>
<span id="cb38-739"><a href="#cb38-739" aria-hidden="true" tabindex="-1"></a>And that may allow for the shape of the clusters to be much more general, and that's what we call mixture discriminant analysis. </span>
<span id="cb38-740"><a href="#cb38-740" aria-hidden="true" tabindex="-1"></a>As before, if you instead of doing the Algorithm and the simple maximum likelihood estimation that I described before, you instead use Bayesian estimators for your process, then you will have Bayesian equivalent of linear discriminant analysis and quadratic discriminant analysis. </span>
<span id="cb38-741"><a href="#cb38-741" aria-hidden="true" tabindex="-1"></a>So it is very useful to think about your statistical methods in the context of mixture models for the purpose of both generalizing and understanding the shortcomings of what you're doing.</span>
<span id="cb38-742"><a href="#cb38-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-743"><a href="#cb38-743" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb38-744"><a href="#cb38-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-745"><a href="#cb38-745" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear and quadratic discriminant analysis in the context of Mixture Models</span></span>
<span id="cb38-746"><a href="#cb38-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-747"><a href="#cb38-747" aria-hidden="true" tabindex="-1"></a><span class="fu">### Classification example</span></span>
<span id="cb38-748"><a href="#cb38-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-749"><a href="#cb38-749" aria-hidden="true" tabindex="-1"></a>This video discusses the code in the next section.</span>
<span id="cb38-750"><a href="#cb38-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-751"><a href="#cb38-751" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb38-752"><a href="#cb38-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-753"><a href="#cb38-753" aria-hidden="true" tabindex="-1"></a><span class="fu">## Video Transcript</span></span>
<span id="cb38-754"><a href="#cb38-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-755"><a href="#cb38-755" aria-hidden="true" tabindex="-1"></a>I'm going to illustrate now to use of mixture models for classification using the wind dataset. </span>
<span id="cb38-756"><a href="#cb38-756" aria-hidden="true" tabindex="-1"></a>Unlike the previous datasets that we work with, this one is not included in R by default. </span>
<span id="cb38-757"><a href="#cb38-757" aria-hidden="true" tabindex="-1"></a>So the two files that you need wind training and wind tests are available on the website, make sure that you download them and that you have them in the right directory for R to read them. </span>
<span id="cb38-758"><a href="#cb38-758" aria-hidden="true" tabindex="-1"></a>And in this case, I made sure that I change the directory where I'm looking at before I start working with this, and that I put my files in there. </span>
<span id="cb38-759"><a href="#cb38-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-760"><a href="#cb38-760" aria-hidden="true" tabindex="-1"></a>Okay, so the wind dataset is an interesting one, it's a series of measurements for different varieties of wine. </span>
<span id="cb38-761"><a href="#cb38-761" aria-hidden="true" tabindex="-1"></a>They come from three different cultivars, and for each particular variety of wine. </span>
<span id="cb38-762"><a href="#cb38-762" aria-hidden="true" tabindex="-1"></a>They did a chemical analysis and measure 13 different variables that have to do with different chemical components present in the world. </span>
<span id="cb38-763"><a href="#cb38-763" aria-hidden="true" tabindex="-1"></a>So we have a label set where we know which samples from which of the three cultivars. </span>
<span id="cb38-764"><a href="#cb38-764" aria-hidden="true" tabindex="-1"></a>And now we want to use the information that we clean out of that to classify to decide a series of new wines to assign them to the cultivar</span>
<span id="cb38-765"><a href="#cb38-765" aria-hidden="true" tabindex="-1"></a>that we think they come from. </span>
<span id="cb38-766"><a href="#cb38-766" aria-hidden="true" tabindex="-1"></a>We actually do know the truth for the test set, so we will actually first do the predictions we'll act as if we don't know what the cultivar of the test set is. And then we will compare the predictions that we're making against the truth, as a way to tell how well the algorithm is to it, okay. </span>
<span id="cb38-767"><a href="#cb38-767" aria-hidden="true" tabindex="-1"></a>So the first thing that we need to do is load our dataset as I said, you need to make sure that the two files are in the directory where you're working. </span>
<span id="cb38-768"><a href="#cb38-768" aria-hidden="true" tabindex="-1"></a>So make sure of that, remember that we called n the sample size of the training set and m the training size the size of the test set. </span>
<span id="cb38-769"><a href="#cb38-769" aria-hidden="true" tabindex="-1"></a>So I'm just calling the variables that way, and I'm going to use mixture of normals mixture of multivariate normals by location and scale. So I'm going to use a method that is essentially equivalent to doing quadratic discriminant analysis. </span>
<span id="cb38-770"><a href="#cb38-770" aria-hidden="true" tabindex="-1"></a>And, I want to run the Algorithm that I discussed on the board, but in a situation which we assume that we're going to work with semi-supervised learning. </span>
<span id="cb38-771"><a href="#cb38-771" aria-hidden="true" tabindex="-1"></a>In other words, I went around the Version of the algorithm in which we're going to use all the observation both in the training and the test set, to learn the parameters of the classes. </span>
<span id="cb38-772"><a href="#cb38-772" aria-hidden="true" tabindex="-1"></a>So it's going to be an iterative algorithm. </span>
<span id="cb38-773"><a href="#cb38-773" aria-hidden="true" tabindex="-1"></a>So we know in advance as we have three classes because we have three cultivars. </span>
<span id="cb38-774"><a href="#cb38-774" aria-hidden="true" tabindex="-1"></a>B in this case is going to be 13 because there are 13 features that were measured on each wine. </span>
<span id="cb38-775"><a href="#cb38-775" aria-hidden="true" tabindex="-1"></a>So if you come down here, you can see that B 13, we can try to do a graph of the data. </span>
<span id="cb38-776"><a href="#cb38-776" aria-hidden="true" tabindex="-1"></a>In this case the graph is not going to be terribly readable because there are so many variables, but it may still provide a little bit of intuition. </span>
<span id="cb38-777"><a href="#cb38-777" aria-hidden="true" tabindex="-1"></a>So the variables that are measured things like alcohol, the ash, the alkalinity, the level of magnesium, the hue that has to do with</span>
<span id="cb38-778"><a href="#cb38-778" aria-hidden="true" tabindex="-1"></a>how dark the wine is, proline. </span>
<span id="cb38-779"><a href="#cb38-779" aria-hidden="true" tabindex="-1"></a>So you can see here where the variables are there are measured, and even though the graph is not very readable at least you can see that the classes do not fully overlap. </span>
<span id="cb38-780"><a href="#cb38-780" aria-hidden="true" tabindex="-1"></a>So we do have some hope that we may be able to do classification in the problem. </span>
<span id="cb38-781"><a href="#cb38-781" aria-hidden="true" tabindex="-1"></a>That's pretty much the main thing that you can say out of this graph here, okay. </span>
<span id="cb38-782"><a href="#cb38-782" aria-hidden="true" tabindex="-1"></a>So, as I said before mixture of models with different components, different variances and different means for each component its normal</span>
<span id="cb38-783"><a href="#cb38-783" aria-hidden="true" tabindex="-1"></a>component in the mixture. Same type of standard initialization that we have done before. </span>
<span id="cb38-784"><a href="#cb38-784" aria-hidden="true" tabindex="-1"></a>And we're going to do the E and the M step here, remember that for the observations in the training set. </span>
<span id="cb38-785"><a href="#cb38-785" aria-hidden="true" tabindex="-1"></a>We know the class, so the value of B are either 0 or 1, and because we do the calculation first in the log scale, then we do either 0 or minus infinity. </span>
<span id="cb38-786"><a href="#cb38-786" aria-hidden="true" tabindex="-1"></a>So 0 corresponds to probability of 1 and minus infinity corresponds to a probability of 0 in the log scale. </span>
<span id="cb38-787"><a href="#cb38-787" aria-hidden="true" tabindex="-1"></a>And then for the observations in the test set, we have just a regular way in which we compute the probability that the observation comes from each class. </span>
<span id="cb38-788"><a href="#cb38-788" aria-hidden="true" tabindex="-1"></a>And once we have done this then we subtract, we do as we have always done subtract maximums and then restandardize. </span>
<span id="cb38-789"><a href="#cb38-789" aria-hidden="true" tabindex="-1"></a>So this is how the ES step gets adapted in the case of semisupervised classification. </span>
<span id="cb38-790"><a href="#cb38-790" aria-hidden="true" tabindex="-1"></a>And then the structure of the m-step is exactly the same structure of the regular Algorithm. </span>
<span id="cb38-791"><a href="#cb38-791" aria-hidden="true" tabindex="-1"></a>So we compute means and variances for each one of the components as weighted averages of the different quantities. </span>
<span id="cb38-792"><a href="#cb38-792" aria-hidden="true" tabindex="-1"></a>We check conversions in the standard way, in which we have been checking convergence. </span>
<span id="cb38-793"><a href="#cb38-793" aria-hidden="true" tabindex="-1"></a>And finally once everything is done, we will get a classification, so let's run it for this dataset. </span>
<span id="cb38-794"><a href="#cb38-794" aria-hidden="true" tabindex="-1"></a>It runs actually quite quickly, we have only 12 iterations and we have converged. </span>
<span id="cb38-795"><a href="#cb38-795" aria-hidden="true" tabindex="-1"></a>Now what the Algorithm gives gave us is just the B values, that is the probability that an observation comes from a given class. </span>
<span id="cb38-796"><a href="#cb38-796" aria-hidden="true" tabindex="-1"></a>Now, we typically are going to want to convert those peas into Cs and as we saw on the board, that is done by just selecting the class that has the highest probability. </span>
<span id="cb38-797"><a href="#cb38-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-798"><a href="#cb38-798" aria-hidden="true" tabindex="-1"></a>So if we do that for our training set in this case, and if you look at the indexes here, they run from n + 1 to n + m, which means that we're looking at test set. </span>
<span id="cb38-799"><a href="#cb38-799" aria-hidden="true" tabindex="-1"></a>If we just get what is the maximum we can see that the first block of observations is assigned to component two.</span>
<span id="cb38-800"><a href="#cb38-800" aria-hidden="true" tabindex="-1"></a>Most of this block is assigned to component two except for this guy here, and then the the remaining block of observation is assigned to components three. </span>
<span id="cb38-801"><a href="#cb38-801" aria-hidden="true" tabindex="-1"></a>So now how does that compare with the truth? So we can actually go into winder test, and the first column of that file contains the true labels, and we can say that it matches actually pretty well. </span>
<span id="cb38-802"><a href="#cb38-802" aria-hidden="true" tabindex="-1"></a>So the ones all match, the twos match except for one guy, the one we had kind of identified before, and the threes all match together. </span>
<span id="cb38-803"><a href="#cb38-803" aria-hidden="true" tabindex="-1"></a>And we can actually if you just want to have a summary of how many errors you make. </span>
<span id="cb38-804"><a href="#cb38-804" aria-hidden="true" tabindex="-1"></a>You can do a little comparison like this, and you can find that there is only a single error in the classification that the algorithm does. </span>
<span id="cb38-805"><a href="#cb38-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-806"><a href="#cb38-806" aria-hidden="true" tabindex="-1"></a>Now let's compare that with just using quadratic discriminant analysis and linear discriminant analysis. </span>
<span id="cb38-807"><a href="#cb38-807" aria-hidden="true" tabindex="-1"></a>The way they are implemented in R, so QDA and LDA are the two functions that you will need, they are part of the mass package. </span>
<span id="cb38-808"><a href="#cb38-808" aria-hidden="true" tabindex="-1"></a>So, We first feed the QDA model and then we that fitted model to predict the classes. </span>
<span id="cb38-809"><a href="#cb38-809" aria-hidden="true" tabindex="-1"></a>And now if we see what the regular QDA does is it's going to give me this long list of probabilities for the test set. </span>
<span id="cb38-810"><a href="#cb38-810" aria-hidden="true" tabindex="-1"></a>And we can turn those into labels and in particular we can see how many errors we're making in the prediction. </span>
<span id="cb38-811"><a href="#cb38-811" aria-hidden="true" tabindex="-1"></a>And you can see that we make a single mistake, which is actually not the mistake that we had made before. </span>
<span id="cb38-812"><a href="#cb38-812" aria-hidden="true" tabindex="-1"></a>So if we just look at this one here and we compare it against the, Classification that our algorithm did, and we compared it against the truth. </span>
<span id="cb38-813"><a href="#cb38-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-814"><a href="#cb38-814" aria-hidden="true" tabindex="-1"></a>We see that our algorithm makes a mistake in this observation and QDA does not, and instead the error is somewhere else in this sample. </span>
<span id="cb38-815"><a href="#cb38-815" aria-hidden="true" tabindex="-1"></a>It's basically here, so you can see that the QDA classifies this as two, when the reality is that it's a three. </span>
<span id="cb38-816"><a href="#cb38-816" aria-hidden="true" tabindex="-1"></a>So our results are not identical to QDA even though our method is asymptotically going to be equivalent to QDA but they</span>
<span id="cb38-817"><a href="#cb38-817" aria-hidden="true" tabindex="-1"></a>don't give us exactly the same result, but they give us very similar accuracy. </span>
<span id="cb38-818"><a href="#cb38-818" aria-hidden="true" tabindex="-1"></a>Interestingly if you run LDA and you try to look at how many errors you have in that case, you will see that LDA in this case has no errors, even though it's a simpler more restrictive classification procedure. </span>
<span id="cb38-819"><a href="#cb38-819" aria-hidden="true" tabindex="-1"></a>So this can happen, so it's a relatively large sample, so a single a difference in a single error is not a very large difference. </span>
<span id="cb38-820"><a href="#cb38-820" aria-hidden="true" tabindex="-1"></a>So, hopefully this illustrates how classification or how measurements can be used for classification in a real life setting.</span>
<span id="cb38-821"><a href="#cb38-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-822"><a href="#cb38-822" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb38-823"><a href="#cb38-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-824"><a href="#cb38-824" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample EM algorithm for classification problems</span></span>
<span id="cb38-825"><a href="#cb38-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-828"><a href="#cb38-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-829"><a href="#cb38-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lbl-em-algorithm-classification-sample</span></span>
<span id="cb38-830"><a href="#cb38-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-831"><a href="#cb38-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-832"><a href="#cb38-832" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mixture models for classification in the wine dataset</span></span>
<span id="cb38-833"><a href="#cb38-833" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare linear and quadratic discriminant analysis and a </span></span>
<span id="cb38-834"><a href="#cb38-834" aria-hidden="true" tabindex="-1"></a><span class="do">##   (semi-supervised) location and scale mixture model with K normals</span></span>
<span id="cb38-835"><a href="#cb38-835" aria-hidden="true" tabindex="-1"></a><span class="do">## Comparing only against the EM algorithm</span></span>
<span id="cb38-836"><a href="#cb38-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-837"><a href="#cb38-837" aria-hidden="true" tabindex="-1"></a><span class="co"># Semi-supervised, quadratic discriminant analysis </span></span>
<span id="cb38-838"><a href="#cb38-838" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading data and setting up global variables</span></span>
<span id="cb38-839"><a href="#cb38-839" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb38-840"><a href="#cb38-840" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb38-841"><a href="#cb38-841" aria-hidden="true" tabindex="-1"></a>wine.training <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"data/wine_training.txt"</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-842"><a href="#cb38-842" aria-hidden="true" tabindex="-1"></a>wine.test <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"data/wine_test.txt"</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-843"><a href="#cb38-843" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">dim</span>(wine.training)[<span class="dv">1</span>]  <span class="co"># Size of the training set</span></span>
<span id="cb38-844"><a href="#cb38-844" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">dim</span>(wine.test)[<span class="dv">1</span>]      <span class="co"># Size of the test set</span></span>
<span id="cb38-845"><a href="#cb38-845" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">as.matrix</span>(wine.training[,<span class="sc">-</span><span class="dv">1</span>]), <span class="fu">as.matrix</span>(wine.test[,<span class="sc">-</span><span class="dv">1</span>]))   <span class="co"># Create dataset of observations, first n belong to the training set, and the rest belong to the test set</span></span>
<span id="cb38-846"><a href="#cb38-846" aria-hidden="true" tabindex="-1"></a>p       <span class="ot">=</span> <span class="fu">dim</span>(x)[<span class="dv">2</span>]              <span class="co"># Number of features</span></span>
<span id="cb38-847"><a href="#cb38-847" aria-hidden="true" tabindex="-1"></a>KK      <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb38-848"><a href="#cb38-848" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">=</span> <span class="fl">0.00001</span></span>
<span id="cb38-849"><a href="#cb38-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-850"><a href="#cb38-850" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb38-851"><a href="#cb38-851" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>)<span class="sc">+</span><span class="fl">0.1</span>)</span>
<span id="cb38-852"><a href="#cb38-852" aria-hidden="true" tabindex="-1"></a>colscale <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"blue"</span>)</span>
<span id="cb38-853"><a href="#cb38-853" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(wine.training[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">col=</span>colscale[wine.training[,<span class="dv">1</span>]], <span class="at">pch=</span>wine.training[,<span class="dv">1</span>])</span>
<span id="cb38-854"><a href="#cb38-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-855"><a href="#cb38-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-856"><a href="#cb38-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the parameters of the algorithm</span></span>
<span id="cb38-857"><a href="#cb38-857" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">63252</span>)</span>
<span id="cb38-858"><a href="#cb38-858" aria-hidden="true" tabindex="-1"></a>w   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>,KK)<span class="sc">/</span>KK  <span class="co">#Assign equal weight to each component to start with</span></span>
<span id="cb38-859"><a href="#cb38-859" aria-hidden="true" tabindex="-1"></a>mu  <span class="ot">=</span> <span class="fu">rmvnorm</span>(KK, <span class="fu">apply</span>(x,<span class="dv">2</span>,mean), <span class="fu">var</span>(x))   <span class="co">#Cluster centers randomly spread over the support of the data</span></span>
<span id="cb38-860"><a href="#cb38-860" aria-hidden="true" tabindex="-1"></a>Sigma      <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(KK,p,p))  <span class="co">#Initial variances are assumed to be the same</span></span>
<span id="cb38-861"><a href="#cb38-861" aria-hidden="true" tabindex="-1"></a>Sigma[<span class="dv">1</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK  </span>
<span id="cb38-862"><a href="#cb38-862" aria-hidden="true" tabindex="-1"></a>Sigma[<span class="dv">2</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK</span>
<span id="cb38-863"><a href="#cb38-863" aria-hidden="true" tabindex="-1"></a>Sigma[<span class="dv">3</span>,,] <span class="ot">=</span> <span class="fu">var</span>(x)<span class="sc">/</span>KK</span>
<span id="cb38-864"><a href="#cb38-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-865"><a href="#cb38-865" aria-hidden="true" tabindex="-1"></a>sw     <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb38-866"><a href="#cb38-866" aria-hidden="true" tabindex="-1"></a>KL     <span class="ot">=</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb38-867"><a href="#cb38-867" aria-hidden="true" tabindex="-1"></a>KL.out <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb38-868"><a href="#cb38-868" aria-hidden="true" tabindex="-1"></a>s      <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-869"><a href="#cb38-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-870"><a href="#cb38-870" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="sc">!</span>sw){</span>
<span id="cb38-871"><a href="#cb38-871" aria-hidden="true" tabindex="-1"></a>  <span class="do">## E step</span></span>
<span id="cb38-872"><a href="#cb38-872" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(n<span class="sc">+</span>m,KK))</span>
<span id="cb38-873"><a href="#cb38-873" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){  <span class="co">#Compute the log of the weights</span></span>
<span id="cb38-874"><a href="#cb38-874" aria-hidden="true" tabindex="-1"></a>    v[<span class="dv">1</span><span class="sc">:</span>n,k] <span class="ot">=</span> <span class="fu">ifelse</span>(wine.training[,<span class="dv">1</span>]<span class="sc">==</span>k,<span class="dv">0</span>,<span class="sc">-</span><span class="cn">Inf</span>)  <span class="co"># Training set</span></span>
<span id="cb38-875"><a href="#cb38-875" aria-hidden="true" tabindex="-1"></a>    v[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m),k] <span class="ot">=</span> <span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m),], mu[k,], Sigma[k,,],<span class="at">log=</span><span class="cn">TRUE</span>)  <span class="co"># Test set</span></span>
<span id="cb38-876"><a href="#cb38-876" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-877"><a href="#cb38-877" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb38-878"><a href="#cb38-878" aria-hidden="true" tabindex="-1"></a>    v[i,] <span class="ot">=</span> <span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,]))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(v[i,] <span class="sc">-</span> <span class="fu">max</span>(v[i,])))  <span class="co">#Go from logs to actual weights in a numerically stable manner</span></span>
<span id="cb38-879"><a href="#cb38-879" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-880"><a href="#cb38-880" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-881"><a href="#cb38-881" aria-hidden="true" tabindex="-1"></a>  <span class="do">## M step</span></span>
<span id="cb38-882"><a href="#cb38-882" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">=</span> <span class="fu">apply</span>(v,<span class="dv">2</span>,mean)</span>
<span id="cb38-883"><a href="#cb38-883" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>KK, <span class="at">ncol=</span>p)</span>
<span id="cb38-884"><a href="#cb38-884" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-885"><a href="#cb38-885" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb38-886"><a href="#cb38-886" aria-hidden="true" tabindex="-1"></a>      mu[k,]    <span class="ot">=</span> mu[k,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>x[i,]</span>
<span id="cb38-887"><a href="#cb38-887" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-888"><a href="#cb38-888" aria-hidden="true" tabindex="-1"></a>    mu[k,] <span class="ot">=</span> mu[k,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb38-889"><a href="#cb38-889" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-890"><a href="#cb38-890" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">=</span> <span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(KK,p,p))</span>
<span id="cb38-891"><a href="#cb38-891" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-892"><a href="#cb38-892" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb38-893"><a href="#cb38-893" aria-hidden="true" tabindex="-1"></a>      Sigma[k,,] <span class="ot">=</span> Sigma[k,,] <span class="sc">+</span> v[i,k]<span class="sc">*</span>(x[i,] <span class="sc">-</span> mu[k,])<span class="sc">%*%</span><span class="fu">t</span>(x[i,] <span class="sc">-</span> mu[k,])</span>
<span id="cb38-894"><a href="#cb38-894" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-895"><a href="#cb38-895" aria-hidden="true" tabindex="-1"></a>    Sigma[k,,] <span class="ot">=</span> Sigma[k,,]<span class="sc">/</span><span class="fu">sum</span>(v[,k])</span>
<span id="cb38-896"><a href="#cb38-896" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-897"><a href="#cb38-897" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-898"><a href="#cb38-898" aria-hidden="true" tabindex="-1"></a>  <span class="do">##Check convergence</span></span>
<span id="cb38-899"><a href="#cb38-899" aria-hidden="true" tabindex="-1"></a>  KLn <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb38-900"><a href="#cb38-900" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="sc">+</span>m)){</span>
<span id="cb38-901"><a href="#cb38-901" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>KK){</span>
<span id="cb38-902"><a href="#cb38-902" aria-hidden="true" tabindex="-1"></a>      KLn <span class="ot">=</span> KLn <span class="sc">+</span> v[i,k]<span class="sc">*</span>(<span class="fu">log</span>(w[k]) <span class="sc">+</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(x[i,],mu[k,],Sigma[k,,],<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb38-903"><a href="#cb38-903" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-904"><a href="#cb38-904" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-905"><a href="#cb38-905" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">abs</span>(KLn<span class="sc">-</span>KL)<span class="sc">/</span><span class="fu">abs</span>(KLn)<span class="sc">&lt;</span>epsilon){</span>
<span id="cb38-906"><a href="#cb38-906" aria-hidden="true" tabindex="-1"></a>    sw<span class="ot">=</span><span class="cn">TRUE</span></span>
<span id="cb38-907"><a href="#cb38-907" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-908"><a href="#cb38-908" aria-hidden="true" tabindex="-1"></a>  KL <span class="ot">=</span> KLn</span>
<span id="cb38-909"><a href="#cb38-909" aria-hidden="true" tabindex="-1"></a>  KL.out <span class="ot">=</span> <span class="fu">c</span>(KL.out, KL)</span>
<span id="cb38-910"><a href="#cb38-910" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> s <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb38-911"><a href="#cb38-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(s, KLn))</span>
<span id="cb38-912"><a href="#cb38-912" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-913"><a href="#cb38-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-914"><a href="#cb38-914" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicted labels</span></span>
<span id="cb38-915"><a href="#cb38-915" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(v, <span class="dv">1</span>, which.max)[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m)]</span>
<span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a><span class="do">## True labels</span></span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a>wine.test[,<span class="dv">1</span>]</span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a><span class="do">## Comparison</span></span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(v, <span class="dv">1</span>, which.max)[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m)] <span class="sc">==</span> wine.test[,<span class="dv">1</span>]</span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(<span class="fu">apply</span>(v, <span class="dv">1</span>, which.max)[(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n<span class="sc">+</span>m)] <span class="sc">==</span> wine.test[,<span class="dv">1</span>])) <span class="co"># One error</span></span>
<span id="cb38-921"><a href="#cb38-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-922"><a href="#cb38-922" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the qda and lda functions in R</span></span>
<span id="cb38-923"><a href="#cb38-923" aria-hidden="true" tabindex="-1"></a><span class="co"># qda</span></span>
<span id="cb38-924"><a href="#cb38-924" aria-hidden="true" tabindex="-1"></a>modqda <span class="ot">=</span> <span class="fu">qda</span>(<span class="at">grouping=</span>wine.training[,<span class="dv">1</span>], <span class="at">x=</span>wine.training[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">method=</span><span class="st">"mle"</span>)</span>
<span id="cb38-925"><a href="#cb38-925" aria-hidden="true" tabindex="-1"></a>ccpredqda <span class="ot">=</span> <span class="fu">predict</span>(modqda,<span class="at">newdata=</span>wine.test[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb38-926"><a href="#cb38-926" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(ccpredqda<span class="sc">$</span>class <span class="sc">==</span> wine.test[,<span class="dv">1</span>])) <span class="co"># One error</span></span>
<span id="cb38-927"><a href="#cb38-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-928"><a href="#cb38-928" aria-hidden="true" tabindex="-1"></a><span class="co"># lda</span></span>
<span id="cb38-929"><a href="#cb38-929" aria-hidden="true" tabindex="-1"></a>modlda <span class="ot">=</span> <span class="fu">lda</span>(<span class="at">grouping=</span>wine.training[,<span class="dv">1</span>], <span class="at">x=</span>wine.training[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">method=</span><span class="st">"mle"</span>)</span>
<span id="cb38-930"><a href="#cb38-930" aria-hidden="true" tabindex="-1"></a>ccpredlda <span class="ot">=</span> <span class="fu">predict</span>(modlda,<span class="at">newdata=</span>wine.test[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb38-931"><a href="#cb38-931" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span>(ccpredlda<span class="sc">$</span>class <span class="sc">==</span> wine.test[,<span class="dv">1</span>])) <span class="co"># No errors!!!</span></span>
<span id="cb38-932"><a href="#cb38-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-933"><a href="#cb38-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-934"><a href="#cb38-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-935"><a href="#cb38-935" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Density Estimation and Classification</span></span>
<span id="cb38-936"><a href="#cb38-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-937"><a href="#cb38-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-938"><a href="#cb38-938" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice Graded Assignment: The EM algorithm and density estimation</span></span>
<span id="cb38-939"><a href="#cb38-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-940"><a href="#cb38-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-941"><a href="#cb38-941" aria-hidden="true" tabindex="-1"></a><span class="fu">### Honors Peer-graded Assignment: MCMC algorithms and density estimation</span></span>
<span id="cb38-942"><a href="#cb38-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-943"><a href="#cb38-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-944"><a href="#cb38-944" aria-hidden="true" tabindex="-1"></a><span class="fu">### Honors Peer-graded Assignment: MCMC algorithms and density estimation</span></span>
<span id="cb38-945"><a href="#cb38-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-946"><a href="#cb38-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-947"><a href="#cb38-947" aria-hidden="true" tabindex="-1"></a><span class="fu">### Honors Peer-graded Assignment: Classification</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":true,"openEffect":"fade","selector":".lightbox","skin":"my-css-class"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>