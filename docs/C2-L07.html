<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oren Bochman">
<meta name="keywords" content="convergence diagnostics, trace plots, autocorrelation, effective sample size, Gelman-Rubin diagnostic, R programming, statistical modeling, Bayesian statistics">
<meta name="description" content="An overview of methods for assessing convergence in Markov Chain Monte Carlo simulations.">

<title>40&nbsp; Linear regression - M3L7 – Bayesian Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./C2-L07-Ex1.html" rel="next">
<link href="./C2-L06-Ex2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-923206e44a13b4518db4dede9f4ebdc9.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cec409635dab7d42c7b562035797153a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-987387ce273b62b48f1747d606bce1d5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-cec409635dab7d42c7b562035797153a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(images/banner_deep.jpg);
background-size: cover;
      }
</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C2-L00.html">Techniques and Models</a></li><li class="breadcrumb-item"><a href="./C2-L07.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Linear regression - M3L7</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C2-L00.html">Techniques and Models</a></li><li class="breadcrumb-item"><a href="./C2-L07.html"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Linear regression - M3L7</span></a></li></ol></nav>
      <div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Linear regression - M3L7</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Bayesian Statistics: Techniques and Models</p>
                  <div>
        <div class="description">
          An overview of methods for assessing convergence in Markov Chain Monte Carlo simulations.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Monte Carlo Estimation</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Oren Bochman </p>
            </div>
    </div>
      
    
      
    </div>
    

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>convergence diagnostics, trace plots, autocorrelation, effective sample size, Gelman-Rubin diagnostic, R programming, statistical modeling, Bayesian statistics</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian Statistics</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./C1-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">From Concept to Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Probability - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Paradigms of probability - M1L1HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bayes’ Theorem - M1L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Conditional Probability and Bayes’ Law - M1L2HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Probability and Bayes’ Theorem - M1L2HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distributions - M1L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Random Variables - M1L3HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Homework on Distributions - M1L3HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Frequentist Inference - M2L4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Frequentist MLE - M2L3HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Bayesian Inference - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Homework on Likelihoods and MLEs - M2L5HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Homework on Bayesian Inference - M2L5HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Priors - M3L6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Homework Posterior Probabilities - M3L6HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">M3L7 - Binomial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Homework on Priors - M2L7HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Poisson Data - M3L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Homework on Poisson Data - M3L8HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Beta Bernoulli - M3L8HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">M4L9 - Exponential Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Homework on Exponential Data - M4L9HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Normally distributed Data - M4L10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Homework on Normal Data - M4L10HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Non-Informative Priors - M4L11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Homework Alternative Priors - M4L11HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Brief Review of Regression - M4L12</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Homework Regression - M4L12HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Homework Regression - M4L12HW2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./C2-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Techniques and Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Statistical Modeling - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">M1L2 - Bayesian Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Monte Carlo estimation - M1L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Metropolis-Hastings - M2L4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Homework on the Metropolis-Hastings algorithm - M2L4HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Gibbs sampling - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Homework Gibbs-Sampling algorithm - M2L22HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Assessing Convergence - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Homework on the Gibbs-Sampling algorithm - M2L5HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Homework on M-H algorithm M2L5HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Linear regression - M3L7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Homework on Linear Regression Model Part 1 - M2L5HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Homework on Deviance information criterion - M2L5HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">ANOVA - M3L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Homework on ANOVA - M3L8HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Homework on Multiple Factor ANOVA - M3L8HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Logistic regression - M3L9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Homework on Logistic Regression - M3L9HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Poisson regression - M4L10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Homework on Poisson regression - M4L10HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Hierarchical modeling - M4L11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Homework on Hierarchical Models - M4L11HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Homework on Non-Normal Hierarchical Models - M4L11HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Capstone Project - M4L12</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Homework on Predictive distributions and mixture models - M4L12HW1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./C3-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixture Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Definition of Mixture Models - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex1-Basic-Definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Basic Concepts of Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex2-Gaussian-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Mixtures of Gaussians</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex3-Zero-Inflated-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Zero inflated distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex4-Def-mixture-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">Definition of Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">Likelihood functions for Mixture Models - M1L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">Homework The Likelihood function - M1L2HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Homework Identifiability - M1L2HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Homework The likelihood function M1L2HW3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">Homework on simulating from a Poisson Mixture Model - M1L2HW4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">HW - Simulation of Poisson mixture model - M1L2HW5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Homework Sim mixture of exponential distributions - M1L2HW6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">The EM algorithm for Mixture models - M2L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">The EM algorithm for Zero-Inflated Mixtures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">The EM algorithm for Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">MCMC for Mixture Models - M4L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">The MCMC algorithm for Zero-Inflated Mixtures - M4L1HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">Markov chain Monte Carlo algorithms for Mixture Models - M4L1HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title">Density Estimation - M4L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">74</span>&nbsp; <span class="chapter-title">Clustering - M4L6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">75</span>&nbsp; <span class="chapter-title">Classification - M4L7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">76</span>&nbsp; <span class="chapter-title">Old Faithful eruptions density estimation with the EM algorithm - M4L7HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">77</span>&nbsp; <span class="chapter-title">Old Faithful eruptions density estimation with the MCMC algorithms - M4L7HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">78</span>&nbsp; <span class="chapter-title">Homework on Bayesian Mixture Models for Classification of Banknotes - M4L7HW3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">79</span>&nbsp; <span class="chapter-title">Computational Considerations - M5L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">80</span>&nbsp; <span class="chapter-title">Computational considerations for Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">81</span>&nbsp; <span class="chapter-title">Determining the number of components - M5L9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">82</span>&nbsp; <span class="chapter-title">Homework on Bayesian Information Criteria (BIC) - M5L09HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">83</span>&nbsp; <span class="chapter-title">Homework on Estimating the number of components in Bayesian settings - M5L09HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">84</span>&nbsp; <span class="chapter-title">Homework on Estimating the partition structure in Bayesian models - M5L09HW3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">85</span>&nbsp; <span class="chapter-title">Homework on BIC for zero-inflated mixtures - M5L09HW4</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./C4-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">86</span>&nbsp; <span class="chapter-title">Stationarity, The ACF and the PCF M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">87</span>&nbsp; <span class="chapter-title">The AR(1) process: definitions and properties - M1L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">88</span>&nbsp; <span class="chapter-title">The AR(1): MLE and Bayesian inference - M1L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">89</span>&nbsp; <span class="chapter-title">The AR(p) process - M2L4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">90</span>&nbsp; <span class="chapter-title">Bayesian Inference in the AR(p) - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">91</span>&nbsp; <span class="chapter-title">Quiz: Spectral representation of the AR(p) - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">92</span>&nbsp; <span class="chapter-title">Graded Assignment: Bayesian analysis of an EEG dataset using an AR(p) - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">93</span>&nbsp; <span class="chapter-title">Normal Dynamic Linear Models, Part 1 - M3L6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">94</span>&nbsp; <span class="chapter-title">Bayesian Inference in the NDLM: Part 1 M3L7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">95</span>&nbsp; <span class="chapter-title">Seasonal NDLMs M4L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">96</span>&nbsp; <span class="chapter-title">Bayesian Inference in the NDLM: Part 2 - M4L9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">97</span>&nbsp; <span class="chapter-title">Final Project</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">98</span>&nbsp; <span class="chapter-title">Week 0: Feynman Notebook on Bayesian Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./C5-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Capstone Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">99</span>&nbsp; <span class="chapter-title">Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L01-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">100</span>&nbsp; <span class="chapter-title">Homework - Practice Quiz for Week 1 – M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L01-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">101</span>&nbsp; <span class="chapter-title">Homework - first-step-for-the-project – M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">102</span>&nbsp; <span class="chapter-title">Model Selection Criteria - M2L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">103</span>&nbsp; <span class="chapter-title">Homework - Determine the order of your data – M2L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">104</span>&nbsp; <span class="chapter-title">Homework - Calculate DIC for single AR model – M2L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">105</span>&nbsp; <span class="chapter-title">Bayesian location mixture of AR(p) models - M3L3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./C6-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Non-Parametric Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C6-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">106</span>&nbsp; <span class="chapter-title">Gaussian Processes for Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C6-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">107</span>&nbsp; <span class="chapter-title">Dirichlet Process</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Appendix: Notation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Appendix: Discrete Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Appendix: Continuous Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Appendix: Exponents &amp; Logarithms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Appendix: The Law of Large Numbers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Appendix: The Central Limit Theorem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Appendix: Conjugate Priors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Appendix: Link Function</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Appendix: Bayes by backprop</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Bayesian Books in R &amp; Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Appendix: Yule-Walker Equations &amp; Durbin-Levinson Recursion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Moore-Penrose Inversion &amp; Cholesky Decomposition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">Appendix: Inequalities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">N</span>&nbsp; <span class="chapter-title">Appendix: Wold’s theorem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">O</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-introduction-to-linear-regression" id="toc-sec-introduction-to-linear-regression" class="nav-link active" data-scroll-target="#sec-introduction-to-linear-regression"><span class="header-section-number">40.1</span> Introduction to linear regression</a>
  <ul class="collapse">
  <li><a href="#sec-priors" id="toc-sec-priors" class="nav-link" data-scroll-target="#sec-priors"><span class="header-section-number">40.1.1</span> Priors</a></li>
  </ul></li>
  <li><a href="#sec-setup-data" id="toc-sec-setup-data" class="nav-link" data-scroll-target="#sec-setup-data"><span class="header-section-number">41</span> Lesson 7.2 Code - Setup &amp; Data</a>
  <ul class="collapse">
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda"><span class="header-section-number">41.1</span> EDA</a>
  <ul class="collapse">
  <li><a href="#sec-modeling" id="toc-sec-modeling" class="nav-link" data-scroll-target="#sec-modeling"><span class="header-section-number">41.1.1</span> Modeling</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-model-in-jags" id="toc-sec-model-in-jags" class="nav-link" data-scroll-target="#sec-model-in-jags"><span class="header-section-number">42</span> Lesson 7.3 Code - Model in <code>JAGS</code></a></li>
  <li><a href="#sec-model-checking-mcmc" id="toc-sec-model-checking-mcmc" class="nav-link" data-scroll-target="#sec-model-checking-mcmc"><span class="header-section-number">43</span> Lesson 7.4 Model Checking- MCMC convergence</a>
  <ul class="collapse">
  <li><a href="#sec-convergence-diagnostics-for-the-markov-chains" id="toc-sec-convergence-diagnostics-for-the-markov-chains" class="nav-link" data-scroll-target="#sec-convergence-diagnostics-for-the-markov-chains"><span class="header-section-number">43.0.1</span> Convergence diagnostics for the Markov Chains</a></li>
  <li><a href="#sec-residual-checks" id="toc-sec-residual-checks" class="nav-link" data-scroll-target="#sec-residual-checks"><span class="header-section-number">43.1</span> Residual checks</a></li>
  </ul></li>
  <li><a href="#sec-alternative-models" id="toc-sec-alternative-models" class="nav-link" data-scroll-target="#sec-alternative-models"><span class="header-section-number">44</span> Lesson 7.5 - Alternative models</a>
  <ul class="collapse">
  <li><a href="#sec-additional-covariates" id="toc-sec-additional-covariates" class="nav-link" data-scroll-target="#sec-additional-covariates"><span class="header-section-number">44.1</span> Additional covariates</a>
  <ul class="collapse">
  <li><a href="#sec-student-t-likelihood" id="toc-sec-student-t-likelihood" class="nav-link" data-scroll-target="#sec-student-t-likelihood"><span class="header-section-number">44.1.1</span> Student-t likelihood</a></li>
  </ul></li>
  <li><a href="#sec-compare-models-using-deviance-information-criterion-dic" id="toc-sec-compare-models-using-deviance-information-criterion-dic" class="nav-link" data-scroll-target="#sec-compare-models-using-deviance-information-criterion-dic"><span class="header-section-number">44.2</span> Compare models using Deviance information criterion (DIC)</a></li>
  <li><a href="#sec-regression-diagnostics" id="toc-sec-regression-diagnostics" class="nav-link" data-scroll-target="#sec-regression-diagnostics"><span class="header-section-number">44.3</span> Regression Diagnostics</a>
  <ul class="collapse">
  <li><a href="#sec-residuals-vs-fitted" id="toc-sec-residuals-vs-fitted" class="nav-link" data-scroll-target="#sec-residuals-vs-fitted"><span class="header-section-number">44.3.1</span> Residuals v.s. Fitted</a></li>
  <li><a href="#sec-qq-plot-of-the-residuals" id="toc-sec-qq-plot-of-the-residuals" class="nav-link" data-scroll-target="#sec-qq-plot-of-the-residuals"><span class="header-section-number">44.3.2</span> QQ plot of the residuals</a></li>
  <li><a href="#sec-scale-location-plot" id="toc-sec-scale-location-plot" class="nav-link" data-scroll-target="#sec-scale-location-plot"><span class="header-section-number">44.3.3</span> Scale Location plot</a></li>
  <li><a href="#sec-cooks-distance" id="toc-sec-cooks-distance" class="nav-link" data-scroll-target="#sec-cooks-distance"><span class="header-section-number">44.3.4</span> Cook’s Distance</a></li>
  <li><a href="#sec-residuals-vs-leverage" id="toc-sec-residuals-vs-leverage" class="nav-link" data-scroll-target="#sec-residuals-vs-leverage"><span class="header-section-number">44.3.5</span> Residuals vs Leverage</a></li>
  <li><a href="#sec-cooks-distance-vs-leverage" id="toc-sec-cooks-distance-vs-leverage" class="nav-link" data-scroll-target="#sec-cooks-distance-vs-leverage"><span class="header-section-number">44.3.6</span> Cook’s Distance vs Leverage</a></li>
  <li><a href="#sec-python" id="toc-sec-python" class="nav-link" data-scroll-target="#sec-python"><span class="header-section-number">44.3.7</span> Python</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">






<section id="sec-introduction-to-linear-regression" class="level2 page-columns page-full" data-number="40.1">
<h2 data-number="40.1" class="anchored" data-anchor-id="sec-introduction-to-linear-regression"><span class="header-section-number">40.1</span> Introduction to linear regression</h2>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/c2l07-ss-01-Linear-Regression.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Introduction to linear regression"><img src="images/c2l07-ss-01-Linear-Regression.png" class="img-fluid figure-img" style="width:53mm" alt="Introduction to linear regression"></a></p>
<figcaption>Introduction to linear regression</figcaption>
</figure>
</div></div><p> We discussed linear regression briefly in the previous course. And we fit a few models with non-informative priors. Here, we’ll provide a brief review, demonstrate fitting linear regression models in JAGS And discuss a few practical skills that are helpful when fitting linear models in general.</p>
<p> This is not meant to be a comprehensive treatment of <strong>linear models</strong>, which you can find in numerous courses and textbooks.</p>
<p>Linear regression is perhaps the simplest way to relate a continuous response variable to multiple explanatory variables.</p>
<p>This may arise from observing several variables together and investigating which variables correlate with the response variable. Or it could arise from conducting an experiment, where we carefully assign values of explanatory variables to randomly selected subjects. And try to establish a cause-and-effect relationship.</p>
<p>A linear regression model has the following form:</p>
<p><span id="eq-linear-regression-epsilon"><span class="math display">
y_i=\beta_0+\beta_1 x_i +\ldots+ \beta_k x_k + \varepsilon_i
\\ \varepsilon_i \stackrel {iid} \sim N(0,\sigma^2)
\tag{40.1}</span></span></p>
<p>This describes the mean, and then we would also add an error, individual term for each observation. We would assume that the errors are IID from a normal distribution means 0 variance <span class="math inline">\sigma^2</span> for observations <span class="math inline">1 \ldots k</span>.</p>
<p>Equivalently we can write this model for <span class="math inline">y_i</span> directly as <span class="math inline">y_i</span> given all of the <span class="math inline">x_i</span> values, betas and a constant variance <span class="math inline">\sigma^2</span>. Again, <span class="math inline">k</span> is the number of predictor variables.</p>
<p><span id="eq-linear-regression-normal"><span class="math display">
y_i\mid x_i,\beta_i,\sigma^2 \sim N(\beta_0+\beta_1 x_i +\ldots+ \beta_k x_k, \sigma^2)\\
\beta_i \sim \mathbb{P}r(\beta_i) \\
\sigma^2 \sim \mathbb{P}r(\sigma^2)
\tag{40.2}</span></span></p>
<p>This yields the following graphical model structure.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>findfont: Font family ['STIXGeneral'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXGeneral'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXGeneral'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXGeneral'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXNonUnicode'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXNonUnicode'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXNonUnicode'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXSizeOneSym'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXSizeTwoSym'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXSizeThreeSym'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXSizeFourSym'] not found. Falling back to DejaVu Sans.
findfont: Font family ['STIXSizeFiveSym'] not found. Falling back to DejaVu Sans.
findfont: Font family ['cmtt10'] not found. Falling back to DejaVu Sans.
findfont: Font family ['cmb10'] not found. Falling back to DejaVu Sans.
findfont: Font family ['cmss10'] not found. Falling back to DejaVu Sans.
findfont: Font family ['DejaVu Sans Display'] not found. Falling back to DejaVu Sans.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-graphical-model-linear-regression" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphical-model-linear-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-graphical-model-linear-regression-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;40.1: The graphical model for linear regression"><img src="C2-L07_files/figure-html/fig-graphical-model-linear-regression-1.png" class="img-fluid figure-img" width="453"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphical-model-linear-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.1: The graphical model for linear regression
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Understanding the Graphical Models
</div>
</div>
<div class="callout-body-container callout-body">
<p> - This graphical model uses <a href="https://en.wikipedia.org/wiki/Plate_notation">plate notation</a> - We’ll start with a <em>plate</em> for all of our different <span class="math inline">y</span> variables, - It is repeated <span class="math inline">i = 1 \ldots N</span> times - <span class="math inline">y_i</span>, are random variable - (indicated by a circle) - they are observed - indicated by a filled shape. - <span class="math inline">X_i</span> variables. - they are drawn as squares around to indicate that they are constants and not random variables. - We’re always conditioning on the <span class="math inline">X</span>s. So they’ll just be constants. - they are observed, so they are filled in. - The <span class="math inline">y_i</span> depend on the values of the <span class="math inline">x</span> and the values of these parameters. So, we have <span class="math inline">\beta_0, \ldots, \beta_k</span>. - Sigma squared. - Since the <span class="math inline">y_i</span> depend on all of these, so this would be the graphical model representation.</p>
</div>
</div>
<p>The terms of a linear model are always linearly related because of the structure of the model.</p>
<p>But the model does not have to be linear necessarily in the xy relationship. For example, it may be that <span class="math inline">y</span> is related linearly to <span class="math inline">x^2</span>. Hence we could transform the x and y variables to get new <span class="math inline">x</span>’s and new <span class="math inline">y</span>’s but we would still have a linear model. However, in that case, if we transform the variables, we must be careful about how this changes the final interpretation of the results.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Interpreting Coefficients
</div>
</div>
<div class="callout-body-container callout-body">
<p>The basic interpretation of the <span class="math inline">\beta_i</span> coefficients is:</p>
<p><mark>While holding all other <span class="math inline">X</span> variables constant, if we increases <span class="math inline">X_i</span> by one then the mean of <span class="math inline">\bar{y}</span> is expected to increase by <span class="math inline">\beta_i</span> .</mark></p>
<p>That is <span class="math inline">\beta_i</span> describes how the <span class="math inline">\bar{y}</span> changes with changes in <span class="math inline">X_i</span>, while accounting for all the other <span class="math inline">X</span> variables.</p>
<p><span id="eq-beta-interpretation"><span class="math display">
\beta \approx  \frac{\partial \bar{y} }{\partial x_i}
\tag{40.3}</span></span></p>
<p>That’s true for all of the x variables.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Regression assumptions
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’re going to assume that</p>
<ul>
<li>The <span class="math inline">y</span> s are independent of each other, given the <span class="math inline">x</span> s.</li>
<li>The <span class="math inline">y_i</span> s have the same variance.</li>
<li>The residuals are normally distributed with mean 0 and variance <span class="math inline">\sigma^2</span>.</li>
</ul>
<p>These are actually strong assumptions that are not often not realistic in many situations.</p>
<p>There are many statistical models to address that.</p>
<p>We’ll look at some hierarchical methods in the coming lessons.</p>
</div>
</div>
<section id="sec-priors" class="level3 page-columns page-full" data-number="40.1.1">
<h3 data-number="40.1.1" class="anchored" data-anchor-id="sec-priors"><span class="header-section-number">40.1.1</span> Priors</h3>
<p> The model is not complete until we add the prior distributions.</p>
<p>So we might say <span class="math inline">\beta_0</span> comes from its prior.</p>
<p><span class="math inline">\beta_1</span> would come from its prior, and so forth for all the <span class="math inline">\beta</span>s. And sigma squared would come from its prior.</p>
<p>The most common choice for prior on the <span class="math inline">\beta</span> s, is a <strong>Normal distribution</strong>. Or we can do a Multivariate normal for all of the betas at once.</p>
<p><span class="marked">This is conditionally conjugate and allows us to do Gibbs sampling.</span></p>
<p>If we want to be non-informative, we can choose <span class="math inline">Normal(0,\sigma^2=1e6)</span> priors with very large variance. Which are practically flat for realistic values of beta. The non-informative priors used in the last class are equivalent to using normal priors with infinite variance.</p>
<p>We can also use the <em>conditionally conjugate</em> <strong>InverseGamma()</strong> prior for <span class="math inline">\sigma^2</span> that we’re familiar with.</p>
<p>Another common prior for the betas is <strong>Double exponential</strong>, or the <strong>Laplace prior</strong>, or <strong>Laplace distribution</strong>.</p>
<p> </p>
<p>The Laplace prior has this density:</p>
<p><span id="eq-general-double-exponential-distribution"><span class="math display">
f(x\mid \mu,\beta)=\frac{1}{2\beta} e^{|\frac{x-\mu}{\beta}|}
\tag{40.4}</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\mu</span> is the location parameter and</li>
<li><span class="math inline">\beta</span> is the scale parameter.</li>
</ul>
<p>The case where <span class="math inline">\mu = 0</span> and <span class="math inline">\beta = 1</span> is called the <strong>standard double exponential distribution</strong></p>
<p><span id="eq-standard-double-exponential-distribution"><span class="math display">
f(x)=\frac{1}{2} e^{|x|}
\tag{40.5}</span></span></p>
<p>And the density looks like this.</p>
<div class="tabset-margin-container page-columns page-full"><div class="no-row-height column-margin column-container"><div class="cell-output-display tabset-margin-content tabset-1-1-tab-margin-content">
<div id="fig-double-exp-pdf-r" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-double-exp-pdf-r-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-double-exp-pdf-r-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;40.2: The Double Exponential Distribution"><img src="C2-L07_files/figure-html/fig-double-exp-pdf-r-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-double-exp-pdf-r-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.2: The Double Exponential Distribution
</figcaption>
</figure>
</div>
</div><div class="cell-output-display tabset-margin-content tabset-1-2-tab-margin-content collapse">
<div id="fig-double-exponential-distribution-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-double-exponential-distribution-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-double-exponential-distribution-plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;40.3: The Double Exponential Distribution"><img src="C2-L07_files/figure-html/fig-double-exponential-distribution-plot-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-double-exponential-distribution-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;40.3: The Double Exponential Distribution
</figcaption>
</figure>
</div>
</div></div></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid of X-axis values</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,  <span class="fu">ddexp</span>(x, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">ddexp</span>(x, <span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">ddexp</span>(x, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(, beta)), <span class="st">"1.5"</span>,<span class="st">"1"</span>, <span class="st">"2"</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>, <span class="st">"blue"</span>), <span class="at">box.lty =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#x &lt;- rdexp(500, location = 2, scale = 1)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#de_sample=ddexp(x, 2, 1)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#CDF &lt;- ecdf(de_sample )</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(CDF)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>loc, scale <span class="op">=</span> <span class="fl">0.</span>, <span class="fl">1.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> np.random.laplace(loc, scale, <span class="dv">1000</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>count, bins, ignored <span class="op">=</span> plt.hist(s, <span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">8.</span>, <span class="fl">8.</span>, <span class="fl">.01</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> np.exp(<span class="op">-</span><span class="bu">abs</span>(x<span class="op">-</span>loc)<span class="op">/</span>scale)<span class="op">/</span>(<span class="fl">2.</span><span class="op">*</span>scale)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>plt.plot(x, pdf)<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> (<span class="dv">1</span><span class="op">/</span>(scale <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi)) <span class="op">*</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>     np.exp(<span class="op">-</span>(x <span class="op">-</span> loc)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> scale<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>plt.plot(x,g)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
</div>
</div>
</div>
<p>It’s called <em>double exponential</em> because it looks like the exponential distribution except it’s been reflected over the y axis. It has a sharp peak at x equals 0, or beta equals 0 in this case, which can be useful if we want to do variable selection among our x’s. Because it’ll favor values in your 0 for these betas.</p>
<p>This is related to the popular regression technique known as the <strong>LASSO</strong>. </p>
<p>More information is available from:</p>
<ul>
<li><a href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda366c.htm">NIST</a></li>
<li><a href="https://en.wikipedia.org/wiki/Laplace_distribution">Wikipedia</a></li>
</ul>
</section>
</section>
<section id="sec-setup-data" class="level1" data-number="41">
<h1 data-number="41"><span class="header-section-number">41</span> Lesson 7.2 Code - Setup &amp; Data</h1>
<p> As an example of linear regression, we’ll look at the <em>Leinhardt</em> data from the <code>car</code> package in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1">1</button><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Leinhardt"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2">2</button><span id="annotated-cell-1-2" class="code-annotation-target"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>?Leinhardt</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3">3</button><span id="annotated-cell-1-3" class="code-annotation-target"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Leinhardt)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="1" data-code-annotation="1">use the <code>data</code> function and tell it which data set we want.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="2" data-code-annotation="2">browse the documentation for the dataset using <code>?</code> operator</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-1" data-code-lines="3" data-code-annotation="3">look at the <code>head</code> of the data set.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          income infant   region oil
Australia   3426   26.7     Asia  no
Austria     3350   23.7   Europe  no
Belgium     3346   17.0   Europe  no
Canada      4751   16.8 Americas  no
Denmark     5029   13.5   Europe  no
Finland     3312   10.1   Europe  no</code></pre>
</div>
</div>
<p>As an example of linear regression, we’ll look at the <em>Leinhardt</em> data from the <code>car</code> package in <code>R</code>.</p>
<p>The <code>Leinhardt</code> dataset contains data on infant mortality for 105 nations of the world around the year 1970. It contains four variables:</p>
<ul>
<li><em>Per capita income</em> in USD.</li>
<li><em>Infant mortality</em> rate per 1,000 live births.</li>
<li>A factor indicating which <em>region</em> of the world this country is located.</li>
<li>And finally, whether this country exports <em>oil</em> as an indicator variable.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Leinhardt)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">We can also look at the structure of the data using <code>str</code> function</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   105 obs. of  4 variables:
 $ income: int  3426 3350 3346 4751 5029 3312 3403 5040 2009 2298 ...
 $ infant: num  26.7 23.7 17 16.8 13.5 10.1 12.9 20.4 17.8 25.7 ...
 $ region: Factor w/ 4 levels "Africa","Americas",..: 3 4 4 2 4 4 4 4 4 4 ...
 $ oil   : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<section id="eda" class="level2" data-number="41.1">
<h2 data-number="41.1" class="anchored" data-anchor-id="eda"><span class="header-section-number">41.1</span> EDA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(Leinhardt)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="1" data-code-annotation="1">Using <code>pairs</code> to investigate the marginal relationships between each of the four variables.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="C2-L07_files/figure-html/C2-L07-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="sec-simple-linear-model" class="level4" data-number="41.1.0.1">
<h4 data-number="41.1.0.1" class="anchored" data-anchor-id="sec-simple-linear-model"><span class="header-section-number">41.1.0.1</span> Simple linear Model</h4>
<p>We’ll start with a simple linear regression model that relates infant mortality to per capita income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(infant <span class="sc">~</span> income, <span class="at">data=</span>Leinhardt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="C2-L07_files/figure-html/C2-L07-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Leinhardt<span class="sc">$</span>infant)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="C2-L07_files/figure-html/C2-L07-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>this is <strong>right-skewed</strong> (many small values and a number of much larger one)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Leinhardt<span class="sc">$</span>income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="C2-L07_files/figure-html/C2-L07-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>also right-skewed.</p>
<p>this indicates that we may do better if we do a <strong>log transform</strong> on these two variables.</p>
</section>
<section id="sec-log-log-linear-model" class="level4" data-number="41.1.0.2">
<h4 data-number="41.1.0.2" class="anchored" data-anchor-id="sec-log-log-linear-model"><span class="header-section-number">41.1.0.2</span> Log-Log Linear Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a>Leinhardt<span class="sc">$</span>loginfant <span class="ot">=</span> <span class="fu">log</span>(Leinhardt<span class="sc">$</span>infant)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>Leinhardt<span class="sc">$</span>logincome <span class="ot">=</span> <span class="fu">log</span>(Leinhardt<span class="sc">$</span>income)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loginfant <span class="sc">~</span> logincome,<span class="at">data=</span>Leinhardt)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1">log transform <em>infant</em> column.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="2">log transform <em>income</em> column.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="3">scatter plot of the log log transformed data.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div id="fig-log-log-transform" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-log-log-transform-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-log-log-transform-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;41.1: log log transformed infant mortality vs income"><img src="C2-L07_files/figure-html/fig-log-log-transform-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-log-log-transform-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;41.1: log log transformed infant mortality vs income
</figcaption>
</figure>
</div>
</div>
</div>
<p>Since infant mortality and per capita income are positive and right-skewed quantities, we consider modeling them on the logarithmic scale. A linear model appears much more appropriate on this scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-8"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-1" class="code-annotation-target"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(loginfant <span class="sc">~</span> logincome,<span class="at">data=</span>Leinhardt)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="1" data-code-annotation="1">scatterplot with a regression fit and uncertainty for the data</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div id="fig-log-log-transformed-scaterplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-log-log-transformed-scaterplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-log-log-transformed-scaterplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;41.2: log log transformed infant mortality vs income scatterplot"><img src="C2-L07_files/figure-html/fig-log-log-transformed-scaterplot-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-log-log-transformed-scaterplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;41.2: log log transformed infant mortality vs income scatterplot
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="C2-L07_files/figure-html/C2-L07-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-modeling" class="level3" data-number="41.1.1">
<h3 data-number="41.1.1" class="anchored" data-anchor-id="sec-modeling"><span class="header-section-number">41.1.1</span> Modeling</h3>
<p>The reference Bayesian analysis (with a non-informative prior) is available directly in <code>R</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lmod0 <span class="ot">=</span> <span class="fu">lm</span>(loginfant <span class="sc">~</span> logincome, <span class="at">data=</span>Leinhardt)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> loginfant <span class="sc">~</span> logincome, <span class="at">data =</span> Leinhardt)</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a>     Min       <span class="dv">1</span>Q   Median       <span class="dv">3</span>Q      Max </span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.66694</span> <span class="sc">-</span><span class="fl">0.42779</span> <span class="sc">-</span><span class="fl">0.02649</span>  <span class="fl">0.30441</span>  <span class="fl">3.08415</span> </span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span> </span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-9" class="code-annotation-target"><a href="#annotated-cell-10-9" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">7.14582</span>    <span class="fl">0.31654</span>  <span class="fl">22.575</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-10" class="code-annotation-target"><a href="#annotated-cell-10-10" aria-hidden="true" tabindex="-1"></a>logincome   <span class="sc">-</span><span class="fl">0.51179</span>    <span class="fl">0.05122</span>  <span class="sc">-</span><span class="fl">9.992</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="annotated-cell-10-11"><a href="#annotated-cell-10-11" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="annotated-cell-10-12"><a href="#annotated-cell-10-12" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">'***'</span> <span class="fl">0.001</span> <span class="st">'**'</span> <span class="fl">0.01</span> <span class="st">'*'</span> <span class="fl">0.05</span> <span class="st">'.'</span> <span class="fl">0.1</span> <span class="st">' '</span> <span class="dv">1</span></span>
<span id="annotated-cell-10-13"><a href="#annotated-cell-10-13" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3">3</button><span id="annotated-cell-10-14" class="code-annotation-target"><a href="#annotated-cell-10-14" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.6867</span> on <span class="dv">99</span> degrees of freedom</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4">4</button><span id="annotated-cell-10-15" class="code-annotation-target"><a href="#annotated-cell-10-15" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">4</span> observations deleted due to missingness)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5">5</button><span id="annotated-cell-10-16" class="code-annotation-target"><a href="#annotated-cell-10-16" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.5021</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4971</span></span>
<span id="annotated-cell-10-17"><a href="#annotated-cell-10-17" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">99.84</span> on <span class="dv">1</span> and <span class="dv">99</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="9" data-code-annotation="1">intercept is <span class="math inline">\gg</span> its error so it appears statistically significant (***)</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="10" data-code-annotation="2">posterior mean <code>logincome</code> too</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="14" data-code-annotation="3">Residual standard error gives us an estimate of the left over variance after fitting the model.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="15" data-code-annotation="4"><strong>4 rows were dropped due to missing values</strong></span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="16" data-code-annotation="5"><em>Adjusted R-squared</em> is the explained variance adjusted for degrees of freedom</span>
</dd>
</dl>
</div>
</div>
</section>
</section>
</section>
<section id="sec-model-in-jags" class="level1" data-number="42">
<h1 data-number="42"><span class="header-section-number">42</span> Lesson 7.3 Code - Model in <code>JAGS</code></h1>
<p>Now we’ll fit this model in <code>JAGS</code>. A few countries have missing values, and for simplicity, we will omit those.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">na.omit</span>(Leinhardt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: coda</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linked to JAGS 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded modules: basemod,bugs</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a>mod1_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n) {</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-3" class="code-annotation-target"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a><span class="st">        y[i] ~ dnorm(mu[i], prec)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2">2</button><span id="annotated-cell-12-4" class="code-annotation-target"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i] = b[1] + b[2]*log_income[i]</span></span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:2) {</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3">3</button><span id="annotated-cell-12-8" class="code-annotation-target"><a href="#annotated-cell-12-8" aria-hidden="true" tabindex="-1"></a><span class="st">        b[i] ~ dnorm(0.0, 1.0/1.0e6)</span></span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4">4</button><span id="annotated-cell-12-11" class="code-annotation-target"><a href="#annotated-cell-12-11" aria-hidden="true" tabindex="-1"></a><span class="st">    prec ~ dgamma(5/2.0, 5*10.0/2.0)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="5">5</button><span id="annotated-cell-12-12" class="code-annotation-target"><a href="#annotated-cell-12-12" aria-hidden="true" tabindex="-1"></a><span class="st">    sig2 = 1.0 / prec</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6">6</button><span id="annotated-cell-12-13" class="code-annotation-target"><a href="#annotated-cell-12-13" aria-hidden="true" tabindex="-1"></a><span class="st">    sig = sqrt(sig2)</span></span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="annotated-cell-12-15"><a href="#annotated-cell-12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">72</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="7">7</button><span id="annotated-cell-12-17" class="code-annotation-target"><a href="#annotated-cell-12-17" aria-hidden="true" tabindex="-1"></a>data1_jags <span class="ot">=</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>loginfant, <span class="at">n=</span><span class="fu">nrow</span>(dat), <span class="at">log_income=</span>dat<span class="sc">$</span>logincome)</span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-19"><a href="#annotated-cell-12-19" aria-hidden="true" tabindex="-1"></a>params1 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"sig"</span>)</span>
<span id="annotated-cell-12-20"><a href="#annotated-cell-12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-21"><a href="#annotated-cell-12-21" aria-hidden="true" tabindex="-1"></a>inits1 <span class="ot">=</span> <span class="cf">function</span>() {</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="8">8</button><span id="annotated-cell-12-22" class="code-annotation-target"><a href="#annotated-cell-12-22" aria-hidden="true" tabindex="-1"></a>    inits <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"b"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fl">0.0</span>,<span class="fl">100.0</span>), <span class="st">"prec"</span><span class="ot">=</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="fl">1.0</span>,<span class="fl">1.0</span>))</span>
<span id="annotated-cell-12-23"><a href="#annotated-cell-12-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-12-24"><a href="#annotated-cell-12-24" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="9">9</button><span id="annotated-cell-12-25" class="code-annotation-target"><a href="#annotated-cell-12-25" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod1_string), <span class="at">data=</span>data1_jags, <span class="at">inits=</span>inits1, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="10">10</button><span id="annotated-cell-12-26" class="code-annotation-target"><a href="#annotated-cell-12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod1, <span class="dv">1000</span>)</span>
<span id="annotated-cell-12-27"><a href="#annotated-cell-12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-12-28"><a href="#annotated-cell-12-28" aria-hidden="true" tabindex="-1"></a>mod1_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod1, <span class="at">variable.names=</span>params1, <span class="at">n.iter=</span><span class="dv">5000</span>)</span>
<span id="annotated-cell-12-29"><a href="#annotated-cell-12-29" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="11">11</button><span id="annotated-cell-12-30" class="code-annotation-target"><a href="#annotated-cell-12-30" aria-hidden="true" tabindex="-1"></a>mod1_csim <span class="ot">=</span> <span class="fu">do.call</span>(rbind, mod1_sim)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="3" data-code-annotation="1">likelihood (we are using jags’ mean, precision parameterization)</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="4" data-code-annotation="2">linear part of the model</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="8" data-code-annotation="3">prior for the betas</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="11" data-code-annotation="4">prior - Inverse Gamma on the variation via a <em>precision</em> = <span class="math inline">1/\sigma^2</span></span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="12" data-code-annotation="5">we use the deterministic relationship between the precision and the variance to get to the standard deviation</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="13" data-code-annotation="6">we wish to monitor the standard deviation is more interpretable than the precision</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="17" data-code-annotation="7">the data is a list of the log-transformed infant mortality, the number of observations, and the log-transformed income</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="22" data-code-annotation="8">initial values: two Normals for beta and one from the gamma</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="25" data-code-annotation="9">putting the parts of the spec together</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="26" data-code-annotation="10">1000 iterations to burn in</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="30" data-code-annotation="11">combine multiple chains by stacking the matrices</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 101
   Unobserved stochastic nodes: 3
   Total graph size: 404

Initializing model</code></pre>
</div>
</div>
</section>
<section id="sec-model-checking-mcmc" class="level1" data-number="43">
<h1 data-number="43"><span class="header-section-number">43</span> Lesson 7.4 Model Checking- MCMC convergence</h1>
<section id="sec-convergence-diagnostics-for-the-markov-chains" class="level3" data-number="43.0.1">
<h3 data-number="43.0.1" class="anchored" data-anchor-id="sec-convergence-diagnostics-for-the-markov-chains"><span class="header-section-number">43.0.1</span> Convergence diagnostics for the Markov Chains</h3>
<p>Before we check the inferences from the model, we should perform convergence diagnostics for our Markov chains.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="C2-L07_files/figure-html/C2-L07-20-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1">1</button><span id="annotated-cell-14-1" class="code-annotation-target"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod1_sim)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="1" data-code-annotation="1">Gelman Rubin diagnostics scale reduction close to 1 indicated MCMC convergence </span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

     Point est. Upper C.I.
b[1]       1.01       1.03
b[2]       1.01       1.03
sig        1.00       1.00

Multivariate psrf

1.01</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1">1</button><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod1_sim)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">high autocorrelation indicates a low sample size</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              b[1]       b[2]          sig
Lag 0  1.000000000 1.00000000  1.000000000
Lag 1  0.949675866 0.94935463  0.037538025
Lag 5  0.770751988 0.77106379  0.017238803
Lag 10 0.583314015 0.58365532  0.009383568
Lag 50 0.008805731 0.00765042 -0.010936485</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#autocorr.plot(mod1_sim , auto.layout = F)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod1_csim , <span class="at">auto.layout =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><a href="C2-L07_files/figure-html/C2-L07-23-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="C2-L07_files/figure-html/C2-L07-23-1.png" class="img-fluid" width="672"></a></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><a href="C2-L07_files/figure-html/C2-L07-23-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="C2-L07_files/figure-html/C2-L07-23-2.png" class="img-fluid" width="672"></a></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><a href="C2-L07_files/figure-html/C2-L07-23-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="C2-L07_files/figure-html/C2-L07-23-3.png" class="img-fluid" width="672"></a></p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1">1</button><span id="annotated-cell-17-1" class="code-annotation-target"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod1_sim)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="1" data-code-annotation="1">checking the ESS</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      b[1]       b[2]        sig 
  387.1386   389.6780 13812.6132 </code></pre>
</div>
</div>
<p>the ess for sigma is good but for the betas 350 this is too low for estimating quantiles, it is enough to estimate the mean.</p>
<p>We can get a posterior summary of the parameters in our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1001:6000
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 5000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

        Mean      SD  Naive SE Time-series SE
b[1]  7.1630 0.43405 0.0035440      0.0221144
b[2] -0.5146 0.07027 0.0005738      0.0035686
sig   0.9703 0.06812 0.0005562      0.0005797

2. Quantiles for each variable:

        2.5%     25%     50%     75%   97.5%
b[1]  6.3227  6.8766  7.1656  7.4558  7.9929
b[2] -0.6492 -0.5614 -0.5148 -0.4685 -0.3778
sig   0.8508  0.9231  0.9660  1.0131  1.1170</code></pre>
</div>
</div>
<p>Don’t forget that these results are for a regression model relating the logarithm of infant mortality to the logarithm of income.</p>
</section>
<section id="sec-residual-checks" class="level2" data-number="43.1">
<h2 data-number="43.1" class="anchored" data-anchor-id="sec-residual-checks"><span class="header-section-number">43.1</span> Residual checks</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Analysis gets complicated quickly when we have multiple models. What we shall soon see is how to get residuals from the Bayesian model in Stan so we can compare it visually with the reference model we got using LM.</p>
</div>
</div>
<p>Checking residuals (the difference between the response and the model’s prediction for that value) is important with linear models since residuals can reveal violations of the assumptions we made to specify the model. In particular, we are looking for any sign that the model is <em>not linear</em>, <em>normally distributed</em>, or that the <em>observations are not independent</em> (conditional on covariates).</p>
<p>First, let’s look at what would have happened if we fit the reference linear model to the un-transformed variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lmod0 <span class="ot">=</span> <span class="fu">lm</span>(infant <span class="sc">~</span> income, <span class="at">data=</span>Leinhardt)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(lmod0)) <span class="co"># to check independence (looks okay)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="C2-L07_files/figure-html/C2-L07-26-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>there should not be a pattern - but we can see an increase. This is not an issue and due to the data being presorted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(lmod0), <span class="fu">resid</span>(lmod0)) <span class="co"># to check for linearity, constant variance (looks bad)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="C2-L07_files/figure-html/C2-L07-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>after 80 the variance starts increasing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">resid</span>(lmod0)) <span class="co"># to check Normality assumption (we want this to be a straight line)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="C2-L07_files/figure-html/C2-L07-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#?qqnorm</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks good except for the last few points.</p>
<p>Now let’s return to our model fit to the log-transformed variables. In a Bayesian model, we have distributions for residuals, but we’ll simplify and look only at the residuals evaluated at the posterior mean of the parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fl">1.0</span>, data1_jags<span class="sc">$</span>n), data1_jags<span class="sc">$</span>log_income)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]     [,2]
[1,]    1 8.139149
[2,]    1 8.116716
[3,]    1 8.115521
[4,]    1 8.466110
[5,]    1 8.522976
[6,]    1 8.105308</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1">1</button><span id="annotated-cell-24-1" class="code-annotation-target"><a href="#annotated-cell-24-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pm_params1 =</span> <span class="fu">colMeans</span>(mod1_csim))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="1" data-code-annotation="1">posterior mean - using (var = expr) forces R to return the value of var</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      b[1]       b[2]        sig 
 7.1629996 -0.5145837  0.9702829 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-25"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="1">1</button><span id="annotated-cell-25-1" class="code-annotation-target"><a href="#annotated-cell-25-1" aria-hidden="true" tabindex="-1"></a>yhat1 <span class="ot">=</span> <span class="fu">drop</span>(X <span class="sc">%*%</span> pm_params1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="2">2</button><span id="annotated-cell-25-2" class="code-annotation-target"><a href="#annotated-cell-25-2" aria-hidden="true" tabindex="-1"></a>resid1 <span class="ot">=</span> data1_jags<span class="sc">$</span>y <span class="sc">-</span> yhat1</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="3">3</button><span id="annotated-cell-25-3" class="code-annotation-target"><a href="#annotated-cell-25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid1)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-25" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="1" data-code-annotation="1">we are evaluating <span class="math inline">\hat{y} = b_0 \times 1 + b_1 \times x_1</span> via matrix multiplication of [1, data1_jags$log_income] *[b_0,b_1]</span>
</dd>
<dt data-target-cell="annotated-cell-25" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="2" data-code-annotation="2"><span class="math inline">res_i = y_i- \hat y = y_i - (b_0 \times 1 + b_1 \times x_{1,i})</span></span>
</dd>
<dt data-target-cell="annotated-cell-25" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="3" data-code-annotation="3">plots the residual against the data index</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="C2-L07_files/figure-html/C2-L07-31-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>So to get the residuals from Stan we extract the b parameter.</p>
<p>Although we did not discuss it we could estimate <span class="math inline">\hat y</span> by drawing K predictions for each x_i and look at <span class="math inline">res_i=\frac{1}{K}\sum_k|y_i -\hat y_{i,k}|</span> and plot upper and fit a line as well as lower and upper bounds as well. Also I’m not sure but I guess we can also do with using the predictive posterior dist. Anyhow here is a link to something like this: <a href="https://mjskay.github.io/tidybayes/articles/tidybayes-residuals.html#probability-residuals-and-quantile-residuals">Extracting and visualizing tidy residuals from Bayesian models</a> -jk</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat1, resid1) <span class="co"># against predicted values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-32-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="C2-L07_files/figure-html/C2-L07-32-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(resid1) <span class="co"># checking normality of residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="C2-L07_files/figure-html/C2-L07-33-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(lmod0), <span class="fu">resid</span>(mod1)) <span class="co"># to compare with reference linear model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="C2-L07_files/figure-html/C2-L07-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dat)[<span class="fu">order</span>(resid1, <span class="at">decreasing=</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]] <span class="co"># which countries have the largest positive residuals?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Saudi.Arabia" "Libya"        "Zambia"       "Brazil"       "Afganistan"  </code></pre>
</div>
</div>
<p>The residuals look pretty good here (no patterns, shapes) except for two strong outliers, Saudi Arabia and Libya. When outliers appear, it is a good idea to double check that they are not just errors in data entry. If the values are correct, you may reconsider whether these data points really are representative of the data you are trying to model. If you conclude that they are not (for example, they were recorded on different years), you may be able to justify dropping these data points from the data set.</p>
<p>If you conclude that the outliers are part of data and should not be removed, we have several modeling options to accommodate them. We will address these in the next segment.</p>
</section>
</section>
<section id="sec-alternative-models" class="level1 page-columns page-full" data-number="44">
<h1 data-number="44"><span class="header-section-number">44</span> Lesson 7.5 - Alternative models</h1>
<p>In the previous segment, we saw two outliers in the model relating the logarithm of infant mortality to the logarithm of income. Here we will discuss options for when we conclude that these outliers belong in the data set.</p>
<section id="sec-additional-covariates" class="level2 page-columns page-full" data-number="44.1">
<h2 data-number="44.1" class="anchored" data-anchor-id="sec-additional-covariates"><span class="header-section-number">44.1</span> Additional covariates</h2>
<p><mark>The first approach is to look for additional covariates that may be able to explain the outliers</mark>. For example, there could be a number of variables that provide information about infant mortality above and beyond what income provides.</p>
<p>Looking back at our data, there are two variables we haven’t used yet: <code>region</code> and <code>oil</code>. The <code>oil</code> variable indicates oil-exporting countries. Both Saudi Arabia and Libya are oil-exporting countries, so perhaps this might explain part of the anomaly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-30"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-30-1"><a href="#annotated-cell-30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="annotated-cell-30-2"><a href="#annotated-cell-30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-3"><a href="#annotated-cell-30-3" aria-hidden="true" tabindex="-1"></a>mod2_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="annotated-cell-30-4"><a href="#annotated-cell-30-4" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(y)) {</span></span>
<span id="annotated-cell-30-5"><a href="#annotated-cell-30-5" aria-hidden="true" tabindex="-1"></a><span class="st">        y[i] ~ dnorm(mu[i], prec)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="1">1</button><span id="annotated-cell-30-6" class="code-annotation-target"><a href="#annotated-cell-30-6" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i] = b[1] + b[2]*log_income[i] + b[3]*is_oil[i]</span></span>
<span id="annotated-cell-30-7"><a href="#annotated-cell-30-7" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-30-8"><a href="#annotated-cell-30-8" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="2">2</button><span id="annotated-cell-30-9" class="code-annotation-target"><a href="#annotated-cell-30-9" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:3) {</span></span>
<span id="annotated-cell-30-10"><a href="#annotated-cell-30-10" aria-hidden="true" tabindex="-1"></a><span class="st">        b[i] ~ dnorm(0.0, 1.0/1.0e6)</span></span>
<span id="annotated-cell-30-11"><a href="#annotated-cell-30-11" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-30-12"><a href="#annotated-cell-30-12" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="annotated-cell-30-13"><a href="#annotated-cell-30-13" aria-hidden="true" tabindex="-1"></a><span class="st">    prec ~ dgamma(5/2.0, 5*10.0/2.0)</span></span>
<span id="annotated-cell-30-14"><a href="#annotated-cell-30-14" aria-hidden="true" tabindex="-1"></a><span class="st">    sig = sqrt( 1.0 / prec )</span></span>
<span id="annotated-cell-30-15"><a href="#annotated-cell-30-15" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="annotated-cell-30-16"><a href="#annotated-cell-30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-17"><a href="#annotated-cell-30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-18"><a href="#annotated-cell-30-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">73</span>)</span>
<span id="annotated-cell-30-19"><a href="#annotated-cell-30-19" aria-hidden="true" tabindex="-1"></a>data2_jags <span class="ot">=</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>loginfant, <span class="at">log_income=</span>dat<span class="sc">$</span>logincome,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="3">3</button><span id="annotated-cell-30-20" class="code-annotation-target"><a href="#annotated-cell-30-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">is_oil=</span><span class="fu">as.numeric</span>(dat<span class="sc">$</span>oil<span class="sc">==</span><span class="st">"yes"</span>))</span>
<span id="annotated-cell-30-21"><a href="#annotated-cell-30-21" aria-hidden="true" tabindex="-1"></a>data2_jags<span class="sc">$</span>is_oil</span>
<span id="annotated-cell-30-22"><a href="#annotated-cell-30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-23"><a href="#annotated-cell-30-23" aria-hidden="true" tabindex="-1"></a>params2 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"sig"</span>)</span>
<span id="annotated-cell-30-24"><a href="#annotated-cell-30-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-25"><a href="#annotated-cell-30-25" aria-hidden="true" tabindex="-1"></a>inits2 <span class="ot">=</span> <span class="cf">function</span>() {</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-30" data-target-annotation="4">4</button><span id="annotated-cell-30-26" class="code-annotation-target"><a href="#annotated-cell-30-26" aria-hidden="true" tabindex="-1"></a>    inits <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"b"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="fl">0.0</span>,<span class="fl">100.0</span>), <span class="st">"prec"</span><span class="ot">=</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="fl">1.0</span>,<span class="fl">1.0</span>))</span>
<span id="annotated-cell-30-27"><a href="#annotated-cell-30-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-30-28"><a href="#annotated-cell-30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-29"><a href="#annotated-cell-30-29" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod2_string), <span class="at">data=</span>data2_jags, <span class="at">inits=</span>inits2, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="annotated-cell-30-30"><a href="#annotated-cell-30-30" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod2, <span class="fl">1e3</span>) <span class="co"># burn-in</span></span>
<span id="annotated-cell-30-31"><a href="#annotated-cell-30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-32"><a href="#annotated-cell-30-32" aria-hidden="true" tabindex="-1"></a>mod2_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod2,</span>
<span id="annotated-cell-30-33"><a href="#annotated-cell-30-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params2,</span>
<span id="annotated-cell-30-34"><a href="#annotated-cell-30-34" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="annotated-cell-30-35"><a href="#annotated-cell-30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-30-36"><a href="#annotated-cell-30-36" aria-hidden="true" tabindex="-1"></a>mod2_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod2_sim)) <span class="co"># combine multiple chains</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-30" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="6" data-code-annotation="1">we add the is_oil indicator parameter</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="9" data-code-annotation="2">we increment the number of parameters</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="20" data-code-annotation="3">encode the is_oil from text to be binary</span>
</dd>
<dt data-target-cell="annotated-cell-30" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-30" data-code-lines="26" data-code-annotation="4">draw another var for b.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0
 [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
 [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 101
   Unobserved stochastic nodes: 4
   Total graph size: 507

Initializing model</code></pre>
</div>
</div>
<p>As usual, check the convergence diagnostics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.</span>, <span class="dv">1</span>, <span class="fl">2.</span>, <span class="dv">1</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod2_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-37-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="C2-L07_files/figure-html/C2-L07-37-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod2_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

     Point est. Upper C.I.
b[1]       1.02       1.08
b[2]       1.02       1.08
b[3]       1.00       1.00
sig        1.00       1.00

Multivariate psrf

1.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod2_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             b[1]       b[2]         b[3]          sig
Lag 0  1.00000000 1.00000000  1.000000000  1.000000000
Lag 1  0.95355204 0.95411078  0.075527344  0.011608978
Lag 5  0.79240663 0.79231297  0.005632259 -0.014078257
Lag 10 0.62136146 0.61943227 -0.004981950  0.016824890
Lag 50 0.05441138 0.05419786  0.013927682 -0.009574322</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#autocorr.plot(mod2_sim,auto.layout=FALSE )</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod2_csim,<span class="at">auto.layout=</span><span class="cn">FALSE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-autocorr-plot-mod2-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-autocorr-plot-mod2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24" title="Figure&nbsp;44.1: auto-correlation plot"><img src="C2-L07_files/figure-html/fig-autocorr-plot-mod2-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-autocorr-plot-mod2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;44.1: auto-correlation plot
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-autocorr-plot-mod2-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-autocorr-plot-mod2-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25" title="Figure&nbsp;44.2: auto-correlation plot"><img src="C2-L07_files/figure-html/fig-autocorr-plot-mod2-2.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-autocorr-plot-mod2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;44.2: auto-correlation plot
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-autocorr-plot-mod2-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod2-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-autocorr-plot-mod2-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26" title="Figure&nbsp;44.3: auto-correlation plot"><img src="C2-L07_files/figure-html/fig-autocorr-plot-mod2-3.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-autocorr-plot-mod2-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;44.3: auto-correlation plot
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-autocorr-plot-mod2-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod2-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-autocorr-plot-mod2-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="Figure&nbsp;44.4: auto-correlation plot"><img src="C2-L07_files/figure-html/fig-autocorr-plot-mod2-4.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-autocorr-plot-mod2-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;44.4: auto-correlation plot
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod2_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      b[1]       b[2]       b[3]        sig 
  346.1109   351.9927 13310.3959 13461.4887 </code></pre>
</div>
</div>
<p>We can get a posterior summary of the parameters in our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 1001:6000
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 5000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

        Mean      SD  Naive SE Time-series SE
b[1]  7.1540 0.44640 0.0036449      0.0239256
b[2] -0.5233 0.07225 0.0005899      0.0038422
b[3]  0.7864 0.35140 0.0028692      0.0030497
sig   0.9523 0.06686 0.0005459      0.0005841

2. Quantiles for each variable:

        2.5%     25%     50%     75%   97.5%
b[1]  6.2280  6.8716  7.1552  7.4449  8.0259
b[2] -0.6652 -0.5705 -0.5236 -0.4776 -0.3737
b[3]  0.0881  0.5536  0.7870  1.0171  1.4726
sig   0.8303  0.9061  0.9484  0.9951  1.0924</code></pre>
</div>
</div>
<p>It looks like there is a positive relationship between oil-production and log-infant mortality. Because these data are merely observational, we cannot say that oil-production causes an increase in infant mortality (indeed that most certainly isn’t the case), but we can say that they are positively correlated.</p>
<p>Now let’s check the residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fl">1.0</span>, data1_jags<span class="sc">$</span>n), data2_jags<span class="sc">$</span>log_income, data2_jags<span class="sc">$</span>is_oil)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]     [,2] [,3]
[1,]    1 8.139149    0
[2,]    1 8.116716    0
[3,]    1 8.115521    0
[4,]    1 8.466110    0
[5,]    1 8.522976    0
[6,]    1 8.105308    0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pm_params2 =</span> <span class="fu">colMeans</span>(mod2_csim)) <span class="co"># posterior mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      b[1]       b[2]       b[3]        sig 
 7.1539649 -0.5233306  0.7863810  0.9522874 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>yhat2 <span class="ot">=</span> <span class="fu">drop</span>(X2 <span class="sc">%*%</span> pm_params2[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>resid2 <span class="ot">=</span> data2_jags<span class="sc">$</span>y <span class="sc">-</span> yhat2</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid2) <span class="co"># against data index</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-44-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="C2-L07_files/figure-html/C2-L07-44-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat2, resid2) <span class="co"># against predicted values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="C2-L07_files/figure-html/C2-L07-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat1, resid1) <span class="co"># residuals from the first model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="C2-L07_files/figure-html/C2-L07-46-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(resid2) <span class="co"># standard deviation of residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6488772</code></pre>
</div>
</div>
<p>These look much better, although the residuals for Saudi Arabia and Libya are still more than three standard deviations away from the mean of the residuals. We might consider adding the other covariate <code>region</code>, but instead let’s look at another option when we are faced with strong outliers.</p>
<section id="sec-student-t-likelihood" class="level3 page-columns page-full" data-number="44.1.1">
<h3 data-number="44.1.1" class="anchored" data-anchor-id="sec-student-t-likelihood"><span class="header-section-number">44.1.1</span> Student-t likelihood</h3>
<ul>
<li>Let’s consider changing the likelihood.</li>
<li>The normal likelihood has thin tails (almost all of the probability is concentrated within the first few standard deviations from the mean).</li>
<li>This does not accommodate outliers well.</li>
<li>Consequently, models with the normal likelihood might be overly-influenced by outliers.</li>
<li>Recall that the <span class="math inline">t</span> distribution is similar to the normal distribution, but it has thicker tails which can accommodate outliers.</li>
</ul>
<p>The <span class="math inline">t</span> linear model might look something like this. Notice that the <span class="math inline">t</span> distribution has three parameters, including a positive “degrees of freedom” parameter. The smaller the degrees of freedom, the heavier the tails of the distribution. We might fix the degrees of freedom to some number, or we can assign it a prior distribution.</p>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x), <span class="at">from =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">to =</span> <span class="dv">5</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dt</span>(x,<span class="dv">1</span>), <span class="at">from =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">to =</span> <span class="dv">5</span>,<span class="at">col=</span><span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31" title="normal and t distributions"><img src="C2-L07_files/figure-html/C2-L07-48-1.png" class="img-fluid figure-img" width="672" alt="normal and t distributions"></a></p>
<figcaption>normal and t distributions</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-44"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-44-1"><a href="#annotated-cell-44-1" aria-hidden="true" tabindex="-1"></a>mod3_string <span class="ot">=</span> <span class="st">" model {</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="1">1</button><span id="annotated-cell-44-2" class="code-annotation-target"><a href="#annotated-cell-44-2" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(y)) {</span></span>
<span id="annotated-cell-44-3"><a href="#annotated-cell-44-3" aria-hidden="true" tabindex="-1"></a><span class="st">        y[i] ~ dt( mu[i], tau, df )</span></span>
<span id="annotated-cell-44-4"><a href="#annotated-cell-44-4" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i] = b[1] + b[2]*log_income[i] + b[3]*is_oil[i]</span></span>
<span id="annotated-cell-44-5"><a href="#annotated-cell-44-5" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-44-6"><a href="#annotated-cell-44-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="annotated-cell-44-7"><a href="#annotated-cell-44-7" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:3) {</span></span>
<span id="annotated-cell-44-8"><a href="#annotated-cell-44-8" aria-hidden="true" tabindex="-1"></a><span class="st">        b[i] ~ dnorm(0.0, 1.0/1.0e6)</span></span>
<span id="annotated-cell-44-9"><a href="#annotated-cell-44-9" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-44-10"><a href="#annotated-cell-44-10" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="2">2</button><span id="annotated-cell-44-11" class="code-annotation-target"><a href="#annotated-cell-44-11" aria-hidden="true" tabindex="-1"></a><span class="st">    nu ~ dexp(1.0)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="3">3</button><span id="annotated-cell-44-12" class="code-annotation-target"><a href="#annotated-cell-44-12" aria-hidden="true" tabindex="-1"></a><span class="st">    df = nu + 2.0</span></span>
<span id="annotated-cell-44-13"><a href="#annotated-cell-44-13" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="4">4</button><span id="annotated-cell-44-14" class="code-annotation-target"><a href="#annotated-cell-44-14" aria-hidden="true" tabindex="-1"></a><span class="st">    tau ~ dgamma(5/2.0, 5*10.0/2.0)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="5">5</button><span id="annotated-cell-44-15" class="code-annotation-target"><a href="#annotated-cell-44-15" aria-hidden="true" tabindex="-1"></a><span class="st">    sig = sqrt( 1.0 / tau * df / (df - 2.0) )</span></span>
<span id="annotated-cell-44-16"><a href="#annotated-cell-44-16" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-44" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="2" data-code-annotation="1">we replaced normal likelihood with a student t likelihood which has thicker tails</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="11" data-code-annotation="2"><span class="math inline">\nu</span> <code>nu</code> is the degrees of freedom (dof) but the outcome can be 0 or 1</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="12" data-code-annotation="3">we force the degrees of freedom <code>dof&gt;2</code> to guarantee the existence of mean and variance in the t dist.</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="14" data-code-annotation="4"><span class="math inline">\tau</span> <code>tau</code> is the <strong>inverse scale</strong> is close to, but not equal to the <strong>precision</strong> from above so we use the same prior as we used for precision.</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="15" data-code-annotation="5"><span class="math inline">\sigma</span> <code>sig</code> standard deviation of errors is a deterministic function of <code>tau</code>, and <code>df</code></span>
</dd>
</dl>
</div>
</div>
<p>We fit this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-45"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-45-1"><a href="#annotated-cell-45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">73</span>)</span>
<span id="annotated-cell-45-2"><a href="#annotated-cell-45-2" aria-hidden="true" tabindex="-1"></a>data3_jags <span class="ot">=</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>loginfant, <span class="at">log_income=</span>dat<span class="sc">$</span>logincome,</span>
<span id="annotated-cell-45-3"><a href="#annotated-cell-45-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">is_oil=</span><span class="fu">as.numeric</span>(dat<span class="sc">$</span>oil<span class="sc">==</span><span class="st">"yes"</span>))</span>
<span id="annotated-cell-45-4"><a href="#annotated-cell-45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-5"><a href="#annotated-cell-45-5" aria-hidden="true" tabindex="-1"></a>params3 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"sig"</span>)</span>
<span id="annotated-cell-45-6"><a href="#annotated-cell-45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-7"><a href="#annotated-cell-45-7" aria-hidden="true" tabindex="-1"></a>inits3 <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="annotated-cell-45-8"><a href="#annotated-cell-45-8" aria-hidden="true" tabindex="-1"></a>    inits <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"b"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="fl">0.0</span>,<span class="fl">100.0</span>), <span class="st">"prec"</span><span class="ot">=</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="fl">1.0</span>,<span class="fl">1.0</span>))</span>
<span id="annotated-cell-45-9"><a href="#annotated-cell-45-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-45-10"><a href="#annotated-cell-45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-11"><a href="#annotated-cell-45-11" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod3_string), <span class="at">data=</span>data3_jags, <span class="at">inits=</span>inits3, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="annotated-cell-45-12"><a href="#annotated-cell-45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod3, <span class="fl">1e3</span>) <span class="co"># burn-in</span></span>
<span id="annotated-cell-45-13"><a href="#annotated-cell-45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-14"><a href="#annotated-cell-45-14" aria-hidden="true" tabindex="-1"></a>mod3_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod3,</span>
<span id="annotated-cell-45-15"><a href="#annotated-cell-45-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params3,</span>
<span id="annotated-cell-45-16"><a href="#annotated-cell-45-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="annotated-cell-45-17"><a href="#annotated-cell-45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-18"><a href="#annotated-cell-45-18" aria-hidden="true" tabindex="-1"></a>mod3_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod3_sim)) <span class="co"># combine multiple chains</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 101
   Unobserved stochastic nodes: 5
   Total graph size: 512

Initializing model</code></pre>
</div>
</div>
<p>check MCMC convergence visually</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-51-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="C2-L07_files/figure-html/C2-L07-51-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>check MCMC convergence quantitatively using <em>Rubin Gelman</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

     Point est. Upper C.I.
b[1]       1.00       1.00
b[2]       1.00       1.00
b[3]       1.00       1.00
sig        1.03       1.03

Multivariate psrf

1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     b[1]      b[2]      b[3]       sig 
 280.0158  288.1415 8620.2342 9995.0903 </code></pre>
</div>
</div>
</section>
</section>
<section id="sec-compare-models-using-deviance-information-criterion-dic" class="level2" data-number="44.2">
<h2 data-number="44.2" class="anchored" data-anchor-id="sec-compare-models-using-deviance-information-criterion-dic"><span class="header-section-number">44.2</span> Compare models using Deviance information criterion (DIC)</h2>
<p> We have now proposed three different models. How do we compare their performance on our data? In the previous course, we discussed estimating parameters in models using the maximum likelihood method. Similarly, we can choose between competing models using the same idea.</p>
<p>We will use a quantity known as the deviance information criterion (DIC). It essentially calculates the posterior mean of the log-likelihood and adds a penalty for model complexity.</p>
<p>Let’s calculate the DIC for our first two models:</p>
<p>the simple linear regression on log-income,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dic.samples</span>(mod1, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean deviance:  231.7 
penalty 3.398 
Penalized deviance: 235.1 </code></pre>
</div>
</div>
<p>and the second model where we add oil production.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dic.samples</span>(mod2, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean deviance:  225.1 
penalty 3.998 
Penalized deviance: 229.1 </code></pre>
</div>
</div>
<p>and the second model where we introduce the Student t likelihood.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dic.samples</span>(mod3, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean deviance:  230.5 
penalty 3.793 
Penalized deviance: 234.3 </code></pre>
</div>
</div>
<p>The first number is the Monte Carlo estimated posterior mean deviance, which equals <span class="math inline">-2</span> times the log-likelihood (plus a constant that will be irrelevant for comparing models). Because of that <span class="math inline">-2</span> factor, <strong>a smaller deviance means a higher likelihood</strong>.</p>
<p>Next, we are given a penalty for the complexity of our model. This penalty is necessary because we can always increase the likelihood of the model by making it more complex to fit the data exactly. We don’t want to do this because over-fit models generalize poorly. This penalty is roughly equal to the effective number of parameters in your model. You can see this here. With the first model, we had a variance parameter and two betas, for a total of three parameters. In the second model, we added one more beta for the oil effect.</p>
<p> We add these two quantities to get the DIC (the last number). The better-fitting model has a lower DIC value. In this case, the gains we receive in deviance by adding the <code>is_oil</code> covariate outweigh the penalty for adding an extra parameter. The final DIC for the second model is lower than for the first, so we would prefer using the second model.</p>
<p>We encourage you to explore different model specifications and compare their fit to the data using DIC. <a href="https://en.wikipedia.org/wiki/Deviance_information_criterion">Wikipedia</a> provides a good introduction to DIC and we can find more details about the <code>JAGS</code> implementation through the <code>rjags</code> package documentation by entering <code>?dic.samples</code> in the <code>R</code> console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#?dic.samples</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-regression-diagnostics" class="level2" data-number="44.3">
<h2 data-number="44.3" class="anchored" data-anchor-id="sec-regression-diagnostics"><span class="header-section-number">44.3</span> Regression Diagnostics</h2>
<p> In production we want to flag regression issues in an automated fashion. However while we develop models we should try to examine these issues visually.</p>
<p>Regression diagnostics help identify:</p>
<ul>
<li>shortcoming of our model and the preferred ways to improve them
<ul>
<li>transforms of variables</li>
<li>different likelihood</li>
<li>adding missing covariate relations to remove patterns in the residuals</li>
<li>increasing interpretability by removing covariates that do not contribute to the fit.</li>
</ul></li>
<li>issues in the data
<ul>
<li>transformation</li>
</ul></li>
</ul>
<p>we should consider the following issues: 1. testing <code>heteroscedasticity</code> with the <em>Breusch-Pagan</em> test</p>
<p>Let’s try to cover the diagnostic plots which help us validate a regression model.</p>
<section id="sec-residuals-vs-fitted" class="level3" data-number="44.3.1">
<h3 data-number="44.3.1" class="anchored" data-anchor-id="sec-residuals-vs-fitted"><span class="header-section-number">44.3.1</span> Residuals v.s. Fitted</h3>
<p></p>
<ul>
<li><p>The “residuals versus fits plot” is the most first diagnostic tool we should look at to determine if the regression is valid. If the regression assumptions are violated we should be able to identify the issues and possibly correct them.</p></li>
<li><p>It is a scatter plot of residuals on the y axis and fitted values (estimated responses) on the x axis.</p></li>
<li><p>The plot can be used to detect:</p>
<ul>
<li>non-linearity,</li>
<li>unequal error variances, and</li>
<li>outliers.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-58-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33" title="Residuals vs Fitted plot"><img src="C2-L07_files/figure-html/C2-L07-58-1.png" class="img-fluid figure-img" width="672" alt="Residuals vs Fitted plot"></a></p>
<figcaption>Residuals vs Fitted plot</figcaption>
</figure>
</div>
</div>
</div>
<p>Residuals will enable us to assess visually whether an appropriate model has been fit to the data no matter how many predictor variables are used. We can checking the validity of a linear regression model by plotting residuals versus x and look for patterns. - Lack of a discernible pattern is indicative of a valid model. - A pattern is is indicative that a function or transformation of X is missing from the model.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>What to look for
</div>
</div>
<div class="callout-body-container callout-body">
<p>Look for <em>patterns</em> that can indicate non-linearity,</p>
<ul>
<li>that the residuals all are high in some areas and low in others. Change in variability as X changes - U shape missing quadratic term · we can get this plot as follows.</li>
</ul>
<p>The blue line is there to aid the eye - it should ideally be relatively close to a straight line (in this case, it isn’t perfectly straight, which could indicate a mild non-linearity).</p>
</div>
</div>
</section>
<section id="sec-qq-plot-of-the-residuals" class="level3" data-number="44.3.2">
<h3 data-number="44.3.2" class="anchored" data-anchor-id="sec-qq-plot-of-the-residuals"><span class="header-section-number">44.3.2</span> QQ plot of the residuals</h3>
<p> This plot shows if residuals are normally distributed. Do residuals follow a straight line well or do they deviate severely?</p>
<p>The regression is valid if the residuals are lined well on the straight dashed line.</p>
<p>we can get this plot as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-59-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="C2-L07_files/figure-html/C2-L07-59-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>notice that the two outliers are labeled and should be reviewed for - removal - more robust likelihood</p>
<p>for more info see <a href="https://data.library.virginia.edu/understanding-q-q-plots/">understanding QQ plots</a></p>
</section>
<section id="sec-scale-location-plot" class="level3" data-number="44.3.3">
<h3 data-number="44.3.3" class="anchored" data-anchor-id="sec-scale-location-plot"><span class="header-section-number">44.3.3</span> Scale Location plot</h3>
<p>This plot shows if residuals are spread equally along the ranges of predictors. This is how you can check the assumption of equal variance (homoscedasticity). It’s good if you see a horizontal line with equally (randomly) spread points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-60-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="C2-L07_files/figure-html/C2-L07-60-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>in this case: - most of the points are to the right - the red line is almost flat which is good - there is increasing variance after 80</p>
</section>
<section id="sec-cooks-distance" class="level3" data-number="44.3.4">
<h3 data-number="44.3.4" class="anchored" data-anchor-id="sec-cooks-distance"><span class="header-section-number">44.3.4</span> Cook’s Distance</h3>
<p> - Originally introduced in <span class="citation" data-cites="cook1977">(<a href="references.html#ref-cook1977" role="doc-biblioref">Cook 1977</a>)</span> <a href="https://en.wikipedia.org/wiki/Cook%27s_distance">Cook’s Distance</a> is an estimate of the influence of a data point. - It takes into account both the leverage and residual of each observation. - Cook’s Distance is a summary of how much a regression model changes when the ith observation is removed. - When it comes to outliers we care about outliers that have a high Cook’s distance as they can have a large impact on the regression model. by shifting the sample fit from the population fit. - Another aspect of Cook’s distance is it can be used to identify regions of the design space where the model is poorly supported by the data - i.e.&nbsp;where the model is extrapolating and if we can get more data in that region we can improve the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-61-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="C2-L07_files/figure-html/C2-L07-61-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Used to detect highly influential outliers, i.e.&nbsp;points that can shift the sample fit from the population fit. For large sample sizes, a rough guideline is to consider values above <span class="math inline">4/(n-p)</span>, where <span class="math inline">n</span> is the sample size and <span class="math inline">p</span> is the number of predictors including the intercept, to indicate highly influential points.</p>
<p>see <span class="citation" data-cites="cook1977">Williams (<a href="references.html#ref-williams1987" role="doc-biblioref">1987</a>)</span></p>
</section>
<section id="sec-residuals-vs-leverage" class="level3" data-number="44.3.5">
<h3 data-number="44.3.5" class="anchored" data-anchor-id="sec-residuals-vs-leverage"><span class="header-section-number">44.3.5</span> Residuals vs Leverage</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L07_files/figure-html/C2-L07-62-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="C2-L07_files/figure-html/C2-L07-62-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(mod3, 5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This plot helps us to sort through the outliers, if there are any. Not all outliers are influential in linear regression analysis. Even though data have extreme values, they might not be influential to determine a regression line. i.e.&nbsp;the fit wouldn’t be much different if we choose to omit them from the analysis. If a point is able to exert a influence on the regression line we call it a high leverage point. Even in this case it might not alter the trend. So we want to identify high leverage points that are at a large distance from their predictor’s mean.</p>
<p>Unlike the other plots, this time patterns are not relevant. We watch out for outlying values at the upper right corner or at the lower right corner. Those spots are the places where cases can be influential against a regression line. Look for cases outside of the dashed lines. When cases are outside of the dashed lines (meaning they have high “Cook’s distance” scores), the cases are influential to the regression results. The regression results will be altered if we exclude those cases.</p>
<p>In this case we see that the pints are within the cook’s distance contours so our outliers are not high leverage points.</p>
</section>
<section id="sec-cooks-distance-vs-leverage" class="level3" data-number="44.3.6">
<h3 data-number="44.3.6" class="anchored" data-anchor-id="sec-cooks-distance-vs-leverage"><span class="header-section-number">44.3.6</span> Cook’s Distance vs Leverage</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cooks-distance-vs-leverage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cooks-distance-vs-leverage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L07_files/figure-html/fig-cooks-distance-vs-leverage-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38" title="Figure&nbsp;44.5: Cooks distance v.s. Leverage"><img src="C2-L07_files/figure-html/fig-cooks-distance-vs-leverage-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cooks-distance-vs-leverage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;44.5: Cooks distance v.s. Leverage
</figcaption>
</figure>
</div>
</div>
</div>
<p>Cook’s distance and leverage are used to detect highly leverage points, i.e.&nbsp;data points that can shift the sample fit from the population fit.</p>
<p>For large sample sizes, a rough guideline is to consider <mark>Cook’s distance values above 1 to indicate highly influential points and leverage values greater than 2 times the number of predictors divided by the sample size to indicate high leverage observations</mark>. High leverage observations are ones which have predictor values very far from their averages, which can greatly influence the fitted model.</p>
<p>The contours in the scatterplot are standardized residuals labelled with their magnitudes</p>
<p>see <span class="citation" data-cites="cook1977">Williams (<a href="references.html#ref-williams1987" role="doc-biblioref">1987</a>)</span></p>
</section>
<section id="sec-python" class="level3" data-number="44.3.7">
<h3 data-number="44.3.7" class="anchored" data-anchor-id="sec-python"><span class="header-section-number">44.3.7</span> Python</h3>
<ul>
<li>https://emredjan.xyz/blog/2017/07/11/emulating-r-plots-in-python/</li>
<li>https://towardsdatascience.com/going-from-r-to-python-linear-regression-diagnostic-plots-144d1c4aa5a</li>
<li>https://modernstatisticswithr.com/regression.html</li>
</ul>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-cook1977" class="csl-entry" role="listitem">
Cook, R. Dennis. 1977. <span>“Detection of Influential Observation in Linear Regression.”</span> <em>Technometrics</em> 19 (1): 15. <a href="https://doi.org/10.2307/1268249">https://doi.org/10.2307/1268249</a>.
</div>
<div id="ref-williams1987" class="csl-entry" role="listitem">
Williams, D. A. 1987. <span>“Generalized Linear Model Diagnostics Using the Deviance and Single Case Deletions.”</span> <em>Applied Statistics</em> 36 (2): 181. <a href="https://doi.org/10.2307/2347550">https://doi.org/10.2307/2347550</a>.
</div>
</div>
</section>
</section>
</section>

</main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./C2-L06-Ex2.html" class="pagination-link" aria-label="Homework on M-H algorithm M2L5HW2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Homework on M-H algorithm M2L5HW2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./C2-L07-Ex1.html" class="pagination-link" aria-label="Homework on Linear Regression Model Part 1 - M2L5HW1">
        <span class="nav-page-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Homework on Linear Regression Model Part 1 - M2L5HW1</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb75" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Linear regression - M3L7"</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Bayesian Statistics: Techniques and Models"</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "An overview of methods for assessing convergence in Markov Chain Monte Carlo simulations."</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - Monte Carlo Estimation</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - convergence diagnostics</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - trace plots</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - autocorrelation</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - effective sample size</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - Gelman-Rubin diagnostic</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - R programming</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - statistical modeling</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - Bayesian statistics</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to linear regression {#sec-introduction-to-linear-regression}</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a><span class="al">![Introduction to linear regression](images/c2l07-ss-01-Linear-Regression.png)</span>{.column-margin width="53mm"}</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>\index{regression!linear}</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>We discussed linear regression briefly in the previous course. And we fit a few models with non-informative priors. Here, we'll provide a brief review, demonstrate fitting linear regression models in JAGS And discuss a few practical skills that are helpful when fitting linear models in general. </span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>\index{model!linear regression}</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>This is not meant to be a comprehensive treatment of **linear models**, which you can find in numerous courses and textbooks. </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>Linear regression is perhaps the simplest way to relate a continuous response variable to multiple explanatory variables.</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>This may arise from observing several variables together and investigating which variables correlate with the response variable. Or it could arise from conducting an experiment, where we carefully assign values of explanatory variables to randomly selected subjects. And try to establish a cause-and-effect relationship.</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>A linear regression model has the following form:</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>y_i=\beta_0+\beta_1 x_i +\ldots+ \beta_k x_k + \varepsilon_i</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> \varepsilon_i \stackrel {iid} \sim N(0,\sigma^2) </span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>$$ {#eq-linear-regression-epsilon}</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>This describes the mean, and then we would also add an error, individual term for each observation. We would assume that the errors are IID from a normal distribution means 0 variance $\sigma^2$ for observations $1 \ldots k$.</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>Equivalently we can write this model for $y_i$ directly as $y_i$ given all of the $x_i$ values, betas and a constant variance $\sigma^2$. Again, $k$ is the number of predictor variables.</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>y_i\mid x_i,\beta_i,\sigma^2 \sim N(\beta_0+\beta_1 x_i +\ldots+ \beta_k x_k, \sigma^2)<span class="sc">\\</span> </span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>\beta_i \sim \mathbb{P}r(\beta_i) <span class="sc">\\</span> </span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>\sigma^2 \sim \mathbb{P}r(\sigma^2)</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>$$ {#eq-linear-regression-normal}</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>This yields the following graphical model structure.</span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-graphical-model-linear-regression</span></span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The graphical model for linear regression</span></span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-dpi: 300</span></span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: true</span></span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> daft <span class="im">as</span> daft</span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a>pgm <span class="op">=</span> daft.PGM([<span class="dv">6</span>, <span class="fl">3.2</span>], node_unit<span class="op">=</span><span class="fl">1.0</span>,alternate_style<span class="op">=</span><span class="st">'outer'</span>,dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"beta0"</span>, <span class="vs">r"</span><span class="dv">$\b</span><span class="vs">eta_0</span><span class="dv">$</span><span class="vs">"</span>, <span class="op">-</span><span class="fl">1.0</span>, <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"beta1"</span>, <span class="vs">r"</span><span class="dv">$\b</span><span class="vs">eta_1</span><span class="dv">$</span><span class="vs">"</span>,  <span class="fl">0.0</span>, <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"betak"</span>, <span class="vs">r"</span><span class="dv">$\b</span><span class="vs">eta_k</span><span class="dv">$</span><span class="vs">"</span>,  <span class="fl">1.0</span>, <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"sigma"</span>, <span class="vs">r"</span><span class="dv">$\s</span><span class="vs">igma</span><span class="dv">^</span><span class="vs">2</span><span class="dv">$</span><span class="vs">"</span>, <span class="fl">2.0</span>, <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"y"</span>, <span class="vs">r"</span><span class="dv">$</span><span class="vs">y_i</span><span class="dv">$</span><span class="vs">"</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, observed<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"x1"</span>, <span class="vs">r"</span><span class="dv">$</span><span class="vs">X_{1_i}</span><span class="dv">$</span><span class="vs">"</span>,  <span class="op">-</span><span class="fl">0.2</span>, <span class="dv">0</span>, shape<span class="op">=</span><span class="st">'rectangle'</span>,aspect<span class="op">=</span><span class="dv">1</span>,scale<span class="op">=</span><span class="fl">0.75</span>, observed<span class="op">=</span><span class="va">True</span> )<span class="op">;</span></span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"x2"</span>, <span class="vs">r"</span><span class="dv">$</span><span class="vs">X_{2_i}</span><span class="dv">$</span><span class="vs">"</span>,   <span class="fl">0.5</span>, <span class="dv">0</span>, shape<span class="op">=</span><span class="st">'rectangle'</span>,aspect<span class="op">=</span><span class="dv">1</span>,scale<span class="op">=</span><span class="fl">0.75</span>, observed<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>pgm.add_node(<span class="st">"xk"</span>, <span class="vs">r"</span><span class="dv">$</span><span class="vs">X_{k_i}</span><span class="dv">$</span><span class="vs">"</span>,   <span class="fl">1.2</span>, <span class="dv">0</span>, shape<span class="op">=</span><span class="st">'rectangle'</span>,aspect<span class="op">=</span><span class="dv">1</span>,scale<span class="op">=</span><span class="fl">0.75</span>,observed<span class="op">=</span><span class="va">True</span> )<span class="op">;</span></span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"beta0"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"beta1"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"betak"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"sigma"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"x1"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"x2"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a>pgm.add_edge(<span class="st">"xk"</span>, <span class="st">"y"</span>)<span class="op">;</span></span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a>pgm.add_plate([<span class="op">-</span><span class="fl">0.75</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">2.5</span>, <span class="dv">2</span>], label<span class="op">=</span><span class="vs">r"</span><span class="dv">$</span><span class="vs">n = 1</span><span class="dv">...</span><span class="vs">N</span><span class="dv">$</span><span class="vs">"</span>, position<span class="op">=</span><span class="st">"bottom right"</span>)</span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a>pgm.render()</span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding the Graphical Models {.unnumbered}</span></span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a>\index{model!graphical model}</span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This graphical model uses <span class="co">[</span><span class="ot">plate notation</span><span class="co">](https://en.wikipedia.org/wiki/Plate_notation)</span></span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We'll start with a *plate* for all of our different $y$ variables,</span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>It is repeated $i = 1 \ldots N$ times</span>
<span id="cb75-95"><a href="#cb75-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$y_i$, are random variable - (indicated by a circle)</span>
<span id="cb75-96"><a href="#cb75-96" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>they are observed - indicated by a filled shape.</span>
<span id="cb75-97"><a href="#cb75-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X_i$ variables.</span>
<span id="cb75-98"><a href="#cb75-98" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>they are drawn as squares around to indicate that they are constants and not random variables.</span>
<span id="cb75-99"><a href="#cb75-99" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We're always conditioning on the $X$s. So they'll just be constants.</span>
<span id="cb75-100"><a href="#cb75-100" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>they are observed, so they are filled in.</span>
<span id="cb75-101"><a href="#cb75-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The $y_i$ depend on the values of the $x$ and the values of these parameters. So, we have $\beta_0, \ldots, \beta_k$.</span>
<span id="cb75-102"><a href="#cb75-102" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sigma squared.</span>
<span id="cb75-103"><a href="#cb75-103" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Since the $y_i$ depend on all of these, so this would be the graphical model representation.</span>
<span id="cb75-104"><a href="#cb75-104" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb75-105"><a href="#cb75-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-106"><a href="#cb75-106" aria-hidden="true" tabindex="-1"></a>The terms of a linear model are always linearly related because of the structure of the model.</span>
<span id="cb75-107"><a href="#cb75-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-108"><a href="#cb75-108" aria-hidden="true" tabindex="-1"></a>But the model does not have to be linear necessarily in the xy relationship. For example, it may be that $y$ is related linearly to $x^2$. Hence we could transform the x and y variables to get new $x$'s and new $y$'s but we would still have a linear model. However, in that case, if we transform the variables, we must be careful about how this changes the final interpretation of the results.</span>
<span id="cb75-109"><a href="#cb75-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-110"><a href="#cb75-110" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb75-111"><a href="#cb75-111" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpreting Coefficients {.unnumbered}</span></span>
<span id="cb75-112"><a href="#cb75-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-113"><a href="#cb75-113" aria-hidden="true" tabindex="-1"></a>The basic interpretation of the $\beta_i$ coefficients is:</span>
<span id="cb75-114"><a href="#cb75-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-115"><a href="#cb75-115" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">While holding all other $X$ variables constant, if we increases $X_i$ by one then the mean of $\bar{y}$ is expected to increase by $\beta_i$ .</span><span class="co">]</span>{.mark}</span>
<span id="cb75-116"><a href="#cb75-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-117"><a href="#cb75-117" aria-hidden="true" tabindex="-1"></a>That is $\beta_i$ describes how the $\bar{y}$ changes with changes in $X_i$, while accounting for all the other $X$ variables.</span>
<span id="cb75-118"><a href="#cb75-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-119"><a href="#cb75-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb75-120"><a href="#cb75-120" aria-hidden="true" tabindex="-1"></a>\beta \approx  \frac{\partial \bar{y} }{\partial x_i} </span>
<span id="cb75-121"><a href="#cb75-121" aria-hidden="true" tabindex="-1"></a>$$ {#eq-beta-interpretation}</span>
<span id="cb75-122"><a href="#cb75-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-123"><a href="#cb75-123" aria-hidden="true" tabindex="-1"></a>That's true for all of the x variables.</span>
<span id="cb75-124"><a href="#cb75-124" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb75-125"><a href="#cb75-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-126"><a href="#cb75-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-127"><a href="#cb75-127" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb75-128"><a href="#cb75-128" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regression assumptions {.unnumbered}</span></span>
<span id="cb75-129"><a href="#cb75-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-130"><a href="#cb75-130" aria-hidden="true" tabindex="-1"></a>We're going to assume that</span>
<span id="cb75-131"><a href="#cb75-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-132"><a href="#cb75-132" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The $y$ s are independent of each other, given the $x$ s.</span>
<span id="cb75-133"><a href="#cb75-133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The $y_i$ s have the same variance.</span>
<span id="cb75-134"><a href="#cb75-134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The residuals are normally distributed with mean 0 and variance $\sigma^2$.</span>
<span id="cb75-135"><a href="#cb75-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-136"><a href="#cb75-136" aria-hidden="true" tabindex="-1"></a>These are actually strong assumptions that are not often not realistic in many situations.</span>
<span id="cb75-137"><a href="#cb75-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-138"><a href="#cb75-138" aria-hidden="true" tabindex="-1"></a>There are many statistical models to address that.</span>
<span id="cb75-139"><a href="#cb75-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-140"><a href="#cb75-140" aria-hidden="true" tabindex="-1"></a>We'll look at some hierarchical methods in the coming lessons.</span>
<span id="cb75-141"><a href="#cb75-141" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb75-142"><a href="#cb75-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-143"><a href="#cb75-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### Priors {#sec-priors}</span></span>
<span id="cb75-144"><a href="#cb75-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-145"><a href="#cb75-145" aria-hidden="true" tabindex="-1"></a>\index{prior}</span>
<span id="cb75-146"><a href="#cb75-146" aria-hidden="true" tabindex="-1"></a>The model is not complete until we add the prior distributions.</span>
<span id="cb75-147"><a href="#cb75-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-148"><a href="#cb75-148" aria-hidden="true" tabindex="-1"></a>So we might say $\beta_0$ comes from its prior.</span>
<span id="cb75-149"><a href="#cb75-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-150"><a href="#cb75-150" aria-hidden="true" tabindex="-1"></a>$\beta_1$ would come from its prior, and so forth for all the $\beta$s. And sigma squared would come from its prior.</span>
<span id="cb75-151"><a href="#cb75-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-152"><a href="#cb75-152" aria-hidden="true" tabindex="-1"></a>The most common choice for prior on the $\beta$ s, is a **Normal distribution**. Or we can do a Multivariate normal for all of the betas at once.</span>
<span id="cb75-153"><a href="#cb75-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-154"><a href="#cb75-154" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">This is conditionally conjugate and allows us to do Gibbs sampling.</span><span class="co">]</span>{.marked}</span>
<span id="cb75-155"><a href="#cb75-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-156"><a href="#cb75-156" aria-hidden="true" tabindex="-1"></a>If we want to be non-informative, we can choose $Normal(0,\sigma^2=1e6)$ priors with very large variance. Which are practically flat for realistic values of beta. The non-informative priors used in the last class are equivalent to using normal priors with infinite variance.</span>
<span id="cb75-157"><a href="#cb75-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-158"><a href="#cb75-158" aria-hidden="true" tabindex="-1"></a>We can also use the *conditionally conjugate* **InverseGamma()** prior for $\sigma^2$ that we're familiar with.</span>
<span id="cb75-159"><a href="#cb75-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-160"><a href="#cb75-160" aria-hidden="true" tabindex="-1"></a>Another common prior for the betas is **Double exponential**, or the **Laplace prior**, or **Laplace distribution**. </span>
<span id="cb75-161"><a href="#cb75-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-162"><a href="#cb75-162" aria-hidden="true" tabindex="-1"></a>\index{distribution!double exponential} </span>
<span id="cb75-163"><a href="#cb75-163" aria-hidden="true" tabindex="-1"></a>\index{distribution!Laplace}</span>
<span id="cb75-164"><a href="#cb75-164" aria-hidden="true" tabindex="-1"></a>\index{prior!Laplace} </span>
<span id="cb75-165"><a href="#cb75-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-166"><a href="#cb75-166" aria-hidden="true" tabindex="-1"></a>The Laplace prior has this density:</span>
<span id="cb75-167"><a href="#cb75-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-168"><a href="#cb75-168" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb75-169"><a href="#cb75-169" aria-hidden="true" tabindex="-1"></a>f(x\mid \mu,\beta)=\frac{1}{2\beta} e^{|\frac{x-\mu}{\beta}|}</span>
<span id="cb75-170"><a href="#cb75-170" aria-hidden="true" tabindex="-1"></a>$$ {#eq-general-double-exponential-distribution}</span>
<span id="cb75-171"><a href="#cb75-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-172"><a href="#cb75-172" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb75-173"><a href="#cb75-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-174"><a href="#cb75-174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\mu$ is the location parameter and</span>
<span id="cb75-175"><a href="#cb75-175" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta$ is the scale parameter.</span>
<span id="cb75-176"><a href="#cb75-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-177"><a href="#cb75-177" aria-hidden="true" tabindex="-1"></a>The case where $\mu = 0$ and $\beta = 1$ is called the **standard double exponential distribution**</span>
<span id="cb75-178"><a href="#cb75-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-179"><a href="#cb75-179" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb75-180"><a href="#cb75-180" aria-hidden="true" tabindex="-1"></a>f(x)=\frac{1}{2} e^{|x|}</span>
<span id="cb75-181"><a href="#cb75-181" aria-hidden="true" tabindex="-1"></a>$$ {#eq-standard-double-exponential-distribution}</span>
<span id="cb75-182"><a href="#cb75-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-183"><a href="#cb75-183" aria-hidden="true" tabindex="-1"></a>And the density looks like this.</span>
<span id="cb75-184"><a href="#cb75-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-187"><a href="#cb75-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-188"><a href="#cb75-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_package_R</span></span>
<span id="cb75-189"><a href="#cb75-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb75-190"><a href="#cb75-190" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb75-191"><a href="#cb75-191" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('nimble')</span></span>
<span id="cb75-192"><a href="#cb75-192" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nimble, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span> )</span>
<span id="cb75-193"><a href="#cb75-193" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"car"</span>)</span>
<span id="cb75-194"><a href="#cb75-194" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-195"><a href="#cb75-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-198"><a href="#cb75-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb75-199"><a href="#cb75-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_package_python</span></span>
<span id="cb75-200"><a href="#cb75-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb75-201"><a href="#cb75-201" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb75-202"><a href="#cb75-202" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb75-203"><a href="#cb75-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-204"><a href="#cb75-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-205"><a href="#cb75-205" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb75-206"><a href="#cb75-206" aria-hidden="true" tabindex="-1"></a><span class="fu">## R</span></span>
<span id="cb75-207"><a href="#cb75-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-210"><a href="#cb75-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-211"><a href="#cb75-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-double-exp-pdf-r</span></span>
<span id="cb75-212"><a href="#cb75-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Double Exponential Distribution"</span></span>
<span id="cb75-213"><a href="#cb75-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-column: margin</span></span>
<span id="cb75-214"><a href="#cb75-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid of X-axis values</span></span>
<span id="cb75-215"><a href="#cb75-215" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="fl">0.1</span>)</span>
<span id="cb75-216"><a href="#cb75-216" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,  <span class="fu">ddexp</span>(x, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb75-217"><a href="#cb75-217" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">ddexp</span>(x, <span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"green"</span>)</span>
<span id="cb75-218"><a href="#cb75-218" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">ddexp</span>(x, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb75-219"><a href="#cb75-219" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,</span>
<span id="cb75-220"><a href="#cb75-220" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(, beta)), <span class="st">"1.5"</span>,<span class="st">"1"</span>, <span class="st">"2"</span>),</span>
<span id="cb75-221"><a href="#cb75-221" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb75-222"><a href="#cb75-222" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"green"</span>, <span class="st">"blue"</span>), <span class="at">box.lty =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb75-223"><a href="#cb75-223" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb75-224"><a href="#cb75-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-225"><a href="#cb75-225" aria-hidden="true" tabindex="-1"></a><span class="co">#x &lt;- rdexp(500, location = 2, scale = 1)</span></span>
<span id="cb75-226"><a href="#cb75-226" aria-hidden="true" tabindex="-1"></a><span class="co">#de_sample=ddexp(x, 2, 1)</span></span>
<span id="cb75-227"><a href="#cb75-227" aria-hidden="true" tabindex="-1"></a><span class="co">#CDF &lt;- ecdf(de_sample )</span></span>
<span id="cb75-228"><a href="#cb75-228" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(CDF)</span></span>
<span id="cb75-229"><a href="#cb75-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-230"><a href="#cb75-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-231"><a href="#cb75-231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb75-232"><a href="#cb75-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-235"><a href="#cb75-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb75-236"><a href="#cb75-236" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-double-exponential-distribution-plot</span></span>
<span id="cb75-237"><a href="#cb75-237" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The Double Exponential Distribution"</span></span>
<span id="cb75-238"><a href="#cb75-238" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-column: margin</span></span>
<span id="cb75-239"><a href="#cb75-239" aria-hidden="true" tabindex="-1"></a>loc, scale <span class="op">=</span> <span class="fl">0.</span>, <span class="fl">1.</span></span>
<span id="cb75-240"><a href="#cb75-240" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> np.random.laplace(loc, scale, <span class="dv">1000</span>)</span>
<span id="cb75-241"><a href="#cb75-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-242"><a href="#cb75-242" aria-hidden="true" tabindex="-1"></a>count, bins, ignored <span class="op">=</span> plt.hist(s, <span class="dv">30</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-243"><a href="#cb75-243" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span><span class="fl">8.</span>, <span class="fl">8.</span>, <span class="fl">.01</span>)</span>
<span id="cb75-244"><a href="#cb75-244" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> np.exp(<span class="op">-</span><span class="bu">abs</span>(x<span class="op">-</span>loc)<span class="op">/</span>scale)<span class="op">/</span>(<span class="fl">2.</span><span class="op">*</span>scale)</span>
<span id="cb75-245"><a href="#cb75-245" aria-hidden="true" tabindex="-1"></a>plt.plot(x, pdf)<span class="op">;</span></span>
<span id="cb75-246"><a href="#cb75-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-247"><a href="#cb75-247" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> (<span class="dv">1</span><span class="op">/</span>(scale <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi)) <span class="op">*</span></span>
<span id="cb75-248"><a href="#cb75-248" aria-hidden="true" tabindex="-1"></a>     np.exp(<span class="op">-</span>(x <span class="op">-</span> loc)<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> scale<span class="op">**</span><span class="dv">2</span>)))</span>
<span id="cb75-249"><a href="#cb75-249" aria-hidden="true" tabindex="-1"></a>plt.plot(x,g)<span class="op">;</span></span>
<span id="cb75-250"><a href="#cb75-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-251"><a href="#cb75-251" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb75-252"><a href="#cb75-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-253"><a href="#cb75-253" aria-hidden="true" tabindex="-1"></a>It's called *double exponential* because it looks like the exponential distribution except it's been reflected over the y axis. It has a sharp peak at x equals 0, or beta equals 0 in this case, which can be useful if we want to do variable selection among our x's. Because it'll favor values in your 0 for these betas.</span>
<span id="cb75-254"><a href="#cb75-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-255"><a href="#cb75-255" aria-hidden="true" tabindex="-1"></a>This is related to the popular regression technique known as the **LASSO**. \index{LASSO}</span>
<span id="cb75-256"><a href="#cb75-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-257"><a href="#cb75-257" aria-hidden="true" tabindex="-1"></a>More information is available from:</span>
<span id="cb75-258"><a href="#cb75-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-259"><a href="#cb75-259" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">NIST</span><span class="co">](https://www.itl.nist.gov/div898/handbook/eda/section3/eda366c.htm)</span></span>
<span id="cb75-260"><a href="#cb75-260" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/Laplace_distribution)</span></span>
<span id="cb75-261"><a href="#cb75-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-262"><a href="#cb75-262" aria-hidden="true" tabindex="-1"></a><span class="fu"># Lesson 7.2 Code - Setup &amp; Data {#sec-setup-data}</span></span>
<span id="cb75-263"><a href="#cb75-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-264"><a href="#cb75-264" aria-hidden="true" tabindex="-1"></a>\index{dataset!Leinhardt} </span>
<span id="cb75-265"><a href="#cb75-265" aria-hidden="true" tabindex="-1"></a>\index{model!linear regression}</span>
<span id="cb75-266"><a href="#cb75-266" aria-hidden="true" tabindex="-1"></a>As an example of linear regression, we'll look at the  *Leinhardt* data from the <span class="in">`car`</span> package in R.</span>
<span id="cb75-267"><a href="#cb75-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-270"><a href="#cb75-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-271"><a href="#cb75-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-data-Leinhardt</span></span>
<span id="cb75-272"><a href="#cb75-272" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Leinhardt"</span>)   <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-273"><a href="#cb75-273" aria-hidden="true" tabindex="-1"></a>?Leinhardt          <span class="co"># &lt;2&gt;</span></span>
<span id="cb75-274"><a href="#cb75-274" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Leinhardt)     <span class="co"># &lt;3&gt;</span></span>
<span id="cb75-275"><a href="#cb75-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-276"><a href="#cb75-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-277"><a href="#cb75-277" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>use the <span class="in">`data`</span> function and tell it which data set we want.</span>
<span id="cb75-278"><a href="#cb75-278" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>browse the documentation for the dataset using <span class="in">`?`</span> operator</span>
<span id="cb75-279"><a href="#cb75-279" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>look at the <span class="in">`head`</span> of the data set.</span>
<span id="cb75-280"><a href="#cb75-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-281"><a href="#cb75-281" aria-hidden="true" tabindex="-1"></a>As an example of linear regression, we'll look at the *Leinhardt* data from the <span class="in">`car`</span> package in <span class="in">`R`</span>.</span>
<span id="cb75-282"><a href="#cb75-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-283"><a href="#cb75-283" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Leinhardt`</span> dataset contains data on infant mortality for 105 nations of the world around the year 1970. It contains four variables:</span>
<span id="cb75-284"><a href="#cb75-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-285"><a href="#cb75-285" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Per capita income* in USD.</span>
<span id="cb75-286"><a href="#cb75-286" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*Infant mortality* rate per 1,000 live births.</span>
<span id="cb75-287"><a href="#cb75-287" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A factor indicating which *region* of the world this country is located.</span>
<span id="cb75-288"><a href="#cb75-288" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>And finally, whether this country exports *oil* as an indicator variable.</span>
<span id="cb75-289"><a href="#cb75-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-292"><a href="#cb75-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-293"><a href="#cb75-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: inspect-Leinhardt</span></span>
<span id="cb75-294"><a href="#cb75-294" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Leinhardt) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-295"><a href="#cb75-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-296"><a href="#cb75-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-297"><a href="#cb75-297" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>We can also look at the structure of the data using <span class="in">`str`</span> function</span>
<span id="cb75-298"><a href="#cb75-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-299"><a href="#cb75-299" aria-hidden="true" tabindex="-1"></a><span class="fu">## EDA</span></span>
<span id="cb75-300"><a href="#cb75-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-303"><a href="#cb75-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-304"><a href="#cb75-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-8</span></span>
<span id="cb75-305"><a href="#cb75-305" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(Leinhardt) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-306"><a href="#cb75-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-307"><a href="#cb75-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-308"><a href="#cb75-308" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Using <span class="in">`pairs`</span> to investigate the marginal relationships between each of the four variables.</span>
<span id="cb75-309"><a href="#cb75-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-310"><a href="#cb75-310" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Simple linear Model {#sec-simple-linear-model}</span></span>
<span id="cb75-311"><a href="#cb75-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-312"><a href="#cb75-312" aria-hidden="true" tabindex="-1"></a>We'll start with a simple linear regression model that relates infant mortality to per capita income.</span>
<span id="cb75-313"><a href="#cb75-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-316"><a href="#cb75-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-317"><a href="#cb75-317" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-9</span></span>
<span id="cb75-318"><a href="#cb75-318" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(infant <span class="sc">~</span> income, <span class="at">data=</span>Leinhardt)</span>
<span id="cb75-319"><a href="#cb75-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-320"><a href="#cb75-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-323"><a href="#cb75-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-324"><a href="#cb75-324" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-10</span></span>
<span id="cb75-325"><a href="#cb75-325" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Leinhardt<span class="sc">$</span>infant)</span>
<span id="cb75-326"><a href="#cb75-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-327"><a href="#cb75-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-328"><a href="#cb75-328" aria-hidden="true" tabindex="-1"></a>this is **right-skewed** (many small values and a number of much larger one)</span>
<span id="cb75-329"><a href="#cb75-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-332"><a href="#cb75-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-333"><a href="#cb75-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-11</span></span>
<span id="cb75-334"><a href="#cb75-334" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Leinhardt<span class="sc">$</span>income)</span>
<span id="cb75-335"><a href="#cb75-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-336"><a href="#cb75-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-337"><a href="#cb75-337" aria-hidden="true" tabindex="-1"></a>also right-skewed.</span>
<span id="cb75-338"><a href="#cb75-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-339"><a href="#cb75-339" aria-hidden="true" tabindex="-1"></a>this indicates that we may do better if we do a **log transform** on these two variables.</span>
<span id="cb75-340"><a href="#cb75-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-341"><a href="#cb75-341" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Log-Log Linear Model {#sec-log-log-linear-model}</span></span>
<span id="cb75-342"><a href="#cb75-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-345"><a href="#cb75-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-346"><a href="#cb75-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-log-log-transform</span></span>
<span id="cb75-347"><a href="#cb75-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "log log transformed infant mortality vs income"</span></span>
<span id="cb75-348"><a href="#cb75-348" aria-hidden="true" tabindex="-1"></a>Leinhardt<span class="sc">$</span>loginfant <span class="ot">=</span> <span class="fu">log</span>(Leinhardt<span class="sc">$</span>infant) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-349"><a href="#cb75-349" aria-hidden="true" tabindex="-1"></a>Leinhardt<span class="sc">$</span>logincome <span class="ot">=</span> <span class="fu">log</span>(Leinhardt<span class="sc">$</span>income) <span class="co"># &lt;2&gt;</span></span>
<span id="cb75-350"><a href="#cb75-350" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loginfant <span class="sc">~</span> logincome,<span class="at">data=</span>Leinhardt)  <span class="co"># &lt;3&gt;</span></span>
<span id="cb75-351"><a href="#cb75-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-352"><a href="#cb75-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-353"><a href="#cb75-353" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>log transform *infant* column.</span>
<span id="cb75-354"><a href="#cb75-354" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>log transform *income* column.</span>
<span id="cb75-355"><a href="#cb75-355" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>scatter plot of the log log transformed data.</span>
<span id="cb75-356"><a href="#cb75-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-357"><a href="#cb75-357" aria-hidden="true" tabindex="-1"></a>Since infant mortality and per capita income are positive and right-skewed quantities, we consider modeling them on the logarithmic scale. A linear model appears much more appropriate on this scale.</span>
<span id="cb75-358"><a href="#cb75-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-361"><a href="#cb75-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-362"><a href="#cb75-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-log-log-transformed-scaterplot</span></span>
<span id="cb75-363"><a href="#cb75-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "log log transformed infant mortality vs income scatterplot"</span></span>
<span id="cb75-364"><a href="#cb75-364" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot</span>(loginfant <span class="sc">~</span> logincome,<span class="at">data=</span>Leinhardt) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-365"><a href="#cb75-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-366"><a href="#cb75-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-367"><a href="#cb75-367" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>scatterplot with a regression fit and uncertainty for the data</span>
<span id="cb75-368"><a href="#cb75-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-371"><a href="#cb75-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-372"><a href="#cb75-372" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-14</span></span>
<span id="cb75-373"><a href="#cb75-373" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb75-374"><a href="#cb75-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb75-375"><a href="#cb75-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb75-376"><a href="#cb75-376" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb75-377"><a href="#cb75-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-378"><a href="#cb75-378" aria-hidden="true" tabindex="-1"></a>Leinhardt<span class="sc">$</span>country <span class="ot">=</span> <span class="fu">row.names</span>(Leinhardt)</span>
<span id="cb75-379"><a href="#cb75-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-380"><a href="#cb75-380" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">ggscatterstats</span>(Leinhardt, <span class="at">x=</span>logincome, <span class="at">y=</span>loginfant,  <span class="at">type =</span> <span class="st">"bayes"</span>,  <span class="at">conf.level =</span> <span class="fl">0.95</span>,  <span class="at">bf.prior =</span> <span class="fl">0.707</span>, </span>
<span id="cb75-381"><a href="#cb75-381" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># show row name</span></span>
<span id="cb75-382"><a href="#cb75-382" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label.var =</span> country, </span>
<span id="cb75-383"><a href="#cb75-383" aria-hidden="true" tabindex="-1"></a>                      <span class="at">label.expression =</span> (loginfant <span class="sc">-</span> <span class="dv">2</span> <span class="sc">+</span>  <span class="fl">0.9</span><span class="sc">*</span> logincome <span class="sc">-</span> <span class="dv">4</span>) <span class="sc">&gt;</span> <span class="fl">4.5</span> <span class="sc">|</span> (loginfant <span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.9</span><span class="sc">*</span>logincome<span class="dv">-4</span>) <span class="sc">&lt;</span> <span class="fl">2.0</span></span>
<span id="cb75-384"><a href="#cb75-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-385"><a href="#cb75-385" aria-hidden="true" tabindex="-1"></a>                      ) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">geom_rug</span>(<span class="at">sides =</span> <span class="st">"bl"</span>) </span>
<span id="cb75-386"><a href="#cb75-386" aria-hidden="true" tabindex="-1"></a>plt</span>
<span id="cb75-387"><a href="#cb75-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-388"><a href="#cb75-388" aria-hidden="true" tabindex="-1"></a><span class="co">#extract_stats(plt)</span></span>
<span id="cb75-389"><a href="#cb75-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-390"><a href="#cb75-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-391"><a href="#cb75-391" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modeling {#sec-modeling}</span></span>
<span id="cb75-392"><a href="#cb75-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-393"><a href="#cb75-393" aria-hidden="true" tabindex="-1"></a>The reference Bayesian analysis (with a non-informative prior) is available directly in <span class="in">`R`</span>.</span>
<span id="cb75-394"><a href="#cb75-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-397"><a href="#cb75-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-398"><a href="#cb75-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-15</span></span>
<span id="cb75-399"><a href="#cb75-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: False</span></span>
<span id="cb75-400"><a href="#cb75-400" aria-hidden="true" tabindex="-1"></a>lmod0 <span class="ot">=</span> <span class="fu">lm</span>(loginfant <span class="sc">~</span> logincome, <span class="at">data=</span>Leinhardt)</span>
<span id="cb75-401"><a href="#cb75-401" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod0)</span>
<span id="cb75-402"><a href="#cb75-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-403"><a href="#cb75-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-406"><a href="#cb75-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-407"><a href="#cb75-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-16</span></span>
<span id="cb75-408"><a href="#cb75-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: False</span></span>
<span id="cb75-409"><a href="#cb75-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: regression output</span></span>
<span id="cb75-410"><a href="#cb75-410" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> loginfant <span class="sc">~</span> logincome, <span class="at">data =</span> Leinhardt)</span>
<span id="cb75-411"><a href="#cb75-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-412"><a href="#cb75-412" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb75-413"><a href="#cb75-413" aria-hidden="true" tabindex="-1"></a>     Min       <span class="dv">1</span>Q   Median       <span class="dv">3</span>Q      Max </span>
<span id="cb75-414"><a href="#cb75-414" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.66694</span> <span class="sc">-</span><span class="fl">0.42779</span> <span class="sc">-</span><span class="fl">0.02649</span>  <span class="fl">0.30441</span>  <span class="fl">3.08415</span> </span>
<span id="cb75-415"><a href="#cb75-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-416"><a href="#cb75-416" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span> </span>
<span id="cb75-417"><a href="#cb75-417" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb75-418"><a href="#cb75-418" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">7.14582</span>    <span class="fl">0.31654</span>  <span class="fl">22.575</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span> <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-419"><a href="#cb75-419" aria-hidden="true" tabindex="-1"></a>logincome   <span class="sc">-</span><span class="fl">0.51179</span>    <span class="fl">0.05122</span>  <span class="sc">-</span><span class="fl">9.992</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span> <span class="co"># &lt;2&gt;</span></span>
<span id="cb75-420"><a href="#cb75-420" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb75-421"><a href="#cb75-421" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">'***'</span> <span class="fl">0.001</span> <span class="st">'**'</span> <span class="fl">0.01</span> <span class="st">'*'</span> <span class="fl">0.05</span> <span class="st">'.'</span> <span class="fl">0.1</span> <span class="st">' '</span> <span class="dv">1</span></span>
<span id="cb75-422"><a href="#cb75-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-423"><a href="#cb75-423" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.6867</span> on <span class="dv">99</span> degrees of freedom    <span class="co"># &lt;3&gt;</span></span>
<span id="cb75-424"><a href="#cb75-424" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">4</span> observations deleted due to missingness)               <span class="co"># &lt;4&gt;</span></span>
<span id="cb75-425"><a href="#cb75-425" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.5021</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4971</span> <span class="co"># &lt;5&gt;</span></span>
<span id="cb75-426"><a href="#cb75-426" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">99.84</span> on <span class="dv">1</span> and <span class="dv">99</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb75-427"><a href="#cb75-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-428"><a href="#cb75-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-429"><a href="#cb75-429" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>intercept is $\gg$ its error so it appears statistically significant (<span class="sc">\*\*\*</span>)</span>
<span id="cb75-430"><a href="#cb75-430" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>posterior mean <span class="in">`logincome`</span> too</span>
<span id="cb75-431"><a href="#cb75-431" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Residual standard error gives us an estimate of the left over variance after fitting the model.</span>
<span id="cb75-432"><a href="#cb75-432" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**4 rows were dropped due to missing values**</span>
<span id="cb75-433"><a href="#cb75-433" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>*Adjusted R-squared* is the explained variance adjusted for degrees of freedom</span>
<span id="cb75-434"><a href="#cb75-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-435"><a href="#cb75-435" aria-hidden="true" tabindex="-1"></a><span class="fu"># Lesson 7.3 Code - Model in `JAGS` {#sec-model-in-jags}</span></span>
<span id="cb75-436"><a href="#cb75-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-437"><a href="#cb75-437" aria-hidden="true" tabindex="-1"></a>Now we'll fit this model in <span class="in">`JAGS`</span>. A few countries have missing values, and for simplicity, we will omit those.</span>
<span id="cb75-438"><a href="#cb75-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-441"><a href="#cb75-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-442"><a href="#cb75-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-17</span></span>
<span id="cb75-443"><a href="#cb75-443" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">na.omit</span>(Leinhardt)</span>
<span id="cb75-444"><a href="#cb75-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-445"><a href="#cb75-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-448"><a href="#cb75-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-449"><a href="#cb75-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-18</span></span>
<span id="cb75-450"><a href="#cb75-450" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb75-451"><a href="#cb75-451" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="cb75-452"><a href="#cb75-452" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-453"><a href="#cb75-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-456"><a href="#cb75-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-457"><a href="#cb75-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: linear-regression-annotated-jags-code</span></span>
<span id="cb75-458"><a href="#cb75-458" aria-hidden="true" tabindex="-1"></a>mod1_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb75-459"><a href="#cb75-459" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:n) {</span></span>
<span id="cb75-460"><a href="#cb75-460" aria-hidden="true" tabindex="-1"></a><span class="st">        y[i] ~ dnorm(mu[i], prec)         # &lt;1&gt;</span></span>
<span id="cb75-461"><a href="#cb75-461" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i] = b[1] + b[2]*log_income[i] # &lt;2&gt;</span></span>
<span id="cb75-462"><a href="#cb75-462" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-463"><a href="#cb75-463" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-464"><a href="#cb75-464" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:2) {</span></span>
<span id="cb75-465"><a href="#cb75-465" aria-hidden="true" tabindex="-1"></a><span class="st">        b[i] ~ dnorm(0.0, 1.0/1.0e6)      # &lt;3&gt;</span></span>
<span id="cb75-466"><a href="#cb75-466" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-467"><a href="#cb75-467" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-468"><a href="#cb75-468" aria-hidden="true" tabindex="-1"></a><span class="st">    prec ~ dgamma(5/2.0, 5*10.0/2.0)      # &lt;4&gt;</span></span>
<span id="cb75-469"><a href="#cb75-469" aria-hidden="true" tabindex="-1"></a><span class="st">    sig2 = 1.0 / prec                     # &lt;5&gt;</span></span>
<span id="cb75-470"><a href="#cb75-470" aria-hidden="true" tabindex="-1"></a><span class="st">    sig = sqrt(sig2)                      # &lt;6&gt;</span></span>
<span id="cb75-471"><a href="#cb75-471" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb75-472"><a href="#cb75-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-473"><a href="#cb75-473" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">72</span>)</span>
<span id="cb75-474"><a href="#cb75-474" aria-hidden="true" tabindex="-1"></a>data1_jags <span class="ot">=</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>loginfant, <span class="at">n=</span><span class="fu">nrow</span>(dat), <span class="at">log_income=</span>dat<span class="sc">$</span>logincome) <span class="co"># &lt;7&gt;</span></span>
<span id="cb75-475"><a href="#cb75-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-476"><a href="#cb75-476" aria-hidden="true" tabindex="-1"></a>params1 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"sig"</span>)</span>
<span id="cb75-477"><a href="#cb75-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-478"><a href="#cb75-478" aria-hidden="true" tabindex="-1"></a>inits1 <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb75-479"><a href="#cb75-479" aria-hidden="true" tabindex="-1"></a>    inits <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"b"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="fl">0.0</span>,<span class="fl">100.0</span>), <span class="st">"prec"</span><span class="ot">=</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="fl">1.0</span>,<span class="fl">1.0</span>)) <span class="co"># &lt;8&gt;</span></span>
<span id="cb75-480"><a href="#cb75-480" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-481"><a href="#cb75-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-482"><a href="#cb75-482" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod1_string), <span class="at">data=</span>data1_jags, <span class="at">inits=</span>inits1, <span class="at">n.chains=</span><span class="dv">3</span>) <span class="co"># &lt;9&gt;</span></span>
<span id="cb75-483"><a href="#cb75-483" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod1, <span class="dv">1000</span>) <span class="co"># &lt;10&gt;</span></span>
<span id="cb75-484"><a href="#cb75-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-485"><a href="#cb75-485" aria-hidden="true" tabindex="-1"></a>mod1_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod1, <span class="at">variable.names=</span>params1, <span class="at">n.iter=</span><span class="dv">5000</span>)</span>
<span id="cb75-486"><a href="#cb75-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-487"><a href="#cb75-487" aria-hidden="true" tabindex="-1"></a>mod1_csim <span class="ot">=</span> <span class="fu">do.call</span>(rbind, mod1_sim) <span class="co"># &lt;11&gt;</span></span>
<span id="cb75-488"><a href="#cb75-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-489"><a href="#cb75-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-490"><a href="#cb75-490" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>likelihood (we are using jags' mean, precision parameterization)</span>
<span id="cb75-491"><a href="#cb75-491" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>linear part of the model</span>
<span id="cb75-492"><a href="#cb75-492" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>prior for the betas</span>
<span id="cb75-493"><a href="#cb75-493" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>prior - Inverse Gamma on the variation via a *precision* = $1/\sigma^2$</span>
<span id="cb75-494"><a href="#cb75-494" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>we use the deterministic relationship between the precision and the variance to get to the standard deviation</span>
<span id="cb75-495"><a href="#cb75-495" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>we wish to monitor the standard deviation is more interpretable than the precision</span>
<span id="cb75-496"><a href="#cb75-496" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>the data is a list of the log-transformed infant mortality, the number of observations, and the log-transformed income</span>
<span id="cb75-497"><a href="#cb75-497" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>initial values: two Normals for beta and one from the gamma</span>
<span id="cb75-498"><a href="#cb75-498" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>putting the parts of the spec together</span>
<span id="cb75-499"><a href="#cb75-499" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>1000 iterations to burn in</span>
<span id="cb75-500"><a href="#cb75-500" aria-hidden="true" tabindex="-1"></a><span class="ss">11. </span>combine multiple chains by stacking the matrices</span>
<span id="cb75-501"><a href="#cb75-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-502"><a href="#cb75-502" aria-hidden="true" tabindex="-1"></a><span class="fu"># Lesson 7.4 Model Checking- MCMC convergence {#sec-model-checking-mcmc}</span></span>
<span id="cb75-503"><a href="#cb75-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-504"><a href="#cb75-504" aria-hidden="true" tabindex="-1"></a><span class="fu">### Convergence diagnostics for the Markov Chains {#sec-convergence-diagnostics-for-the-markov-chains}</span></span>
<span id="cb75-505"><a href="#cb75-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-506"><a href="#cb75-506" aria-hidden="true" tabindex="-1"></a>Before we check the inferences from the model, we should perform convergence diagnostics for our Markov chains.</span>
<span id="cb75-507"><a href="#cb75-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-510"><a href="#cb75-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-511"><a href="#cb75-511" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-20</span></span>
<span id="cb75-512"><a href="#cb75-512" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb75-513"><a href="#cb75-513" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1_sim)</span>
<span id="cb75-514"><a href="#cb75-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-515"><a href="#cb75-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-518"><a href="#cb75-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-519"><a href="#cb75-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-21</span></span>
<span id="cb75-520"><a href="#cb75-520" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod1_sim) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-521"><a href="#cb75-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-522"><a href="#cb75-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-523"><a href="#cb75-523" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Gelman Rubin diagnostics scale reduction close to 1 indicated MCMC convergence</span>
<span id="cb75-524"><a href="#cb75-524" aria-hidden="true" tabindex="-1"></a>\index{MCMC!Gelman-Rubin diagnostic}</span>
<span id="cb75-525"><a href="#cb75-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-528"><a href="#cb75-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-529"><a href="#cb75-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-22</span></span>
<span id="cb75-530"><a href="#cb75-530" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod1_sim) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-531"><a href="#cb75-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-532"><a href="#cb75-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-533"><a href="#cb75-533" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>high autocorrelation indicates a low sample size</span>
<span id="cb75-534"><a href="#cb75-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-537"><a href="#cb75-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-538"><a href="#cb75-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-23</span></span>
<span id="cb75-539"><a href="#cb75-539" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 1</span></span>
<span id="cb75-540"><a href="#cb75-540" aria-hidden="true" tabindex="-1"></a><span class="co">#autocorr.plot(mod1_sim , auto.layout = F)</span></span>
<span id="cb75-541"><a href="#cb75-541" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod1_csim , <span class="at">auto.layout =</span> F)</span>
<span id="cb75-542"><a href="#cb75-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-543"><a href="#cb75-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-544"><a href="#cb75-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-547"><a href="#cb75-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-548"><a href="#cb75-548" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-24</span></span>
<span id="cb75-549"><a href="#cb75-549" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod1_sim) <span class="co">#&lt;1&gt;</span></span>
<span id="cb75-550"><a href="#cb75-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-551"><a href="#cb75-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-552"><a href="#cb75-552" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>checking the ESS</span>
<span id="cb75-553"><a href="#cb75-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-554"><a href="#cb75-554" aria-hidden="true" tabindex="-1"></a>the ess for sigma is good but for the betas 350 this is too low for estimating quantiles, it is enough to estimate the mean.</span>
<span id="cb75-555"><a href="#cb75-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-556"><a href="#cb75-556" aria-hidden="true" tabindex="-1"></a>We can get a posterior summary of the parameters in our model.</span>
<span id="cb75-557"><a href="#cb75-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-560"><a href="#cb75-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-561"><a href="#cb75-561" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-25</span></span>
<span id="cb75-562"><a href="#cb75-562" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1_sim)</span>
<span id="cb75-563"><a href="#cb75-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-564"><a href="#cb75-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-565"><a href="#cb75-565" aria-hidden="true" tabindex="-1"></a>Don't forget that these results are for a regression model relating the logarithm of infant mortality to the logarithm of income.</span>
<span id="cb75-566"><a href="#cb75-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-567"><a href="#cb75-567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Residual checks {#sec-residual-checks}</span></span>
<span id="cb75-568"><a href="#cb75-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-569"><a href="#cb75-569" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb75-570"><a href="#cb75-570" aria-hidden="true" tabindex="-1"></a>Analysis gets complicated quickly when we have multiple models. What we shall soon see is how to get residuals from the Bayesian model in Stan so we can compare it visually with the reference model we got using LM.</span>
<span id="cb75-571"><a href="#cb75-571" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb75-572"><a href="#cb75-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-573"><a href="#cb75-573" aria-hidden="true" tabindex="-1"></a>Checking residuals (the difference between the response and the model's prediction for that value) is important with linear models since residuals can reveal violations of the assumptions we made to specify the model. In particular, we are looking for any sign that the model is *not linear*, *normally distributed*, or that the *observations are not independent* (conditional on covariates).</span>
<span id="cb75-574"><a href="#cb75-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-575"><a href="#cb75-575" aria-hidden="true" tabindex="-1"></a>First, let's look at what would have happened if we fit the reference linear model to the un-transformed variables.</span>
<span id="cb75-576"><a href="#cb75-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-579"><a href="#cb75-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-580"><a href="#cb75-580" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-26</span></span>
<span id="cb75-581"><a href="#cb75-581" aria-hidden="true" tabindex="-1"></a>lmod0 <span class="ot">=</span> <span class="fu">lm</span>(infant <span class="sc">~</span> income, <span class="at">data=</span>Leinhardt)</span>
<span id="cb75-582"><a href="#cb75-582" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">resid</span>(lmod0)) <span class="co"># to check independence (looks okay)</span></span>
<span id="cb75-583"><a href="#cb75-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-584"><a href="#cb75-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-585"><a href="#cb75-585" aria-hidden="true" tabindex="-1"></a>there should not be a pattern - but we can see an increase. This is not an issue and due to the data being presorted.</span>
<span id="cb75-586"><a href="#cb75-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-589"><a href="#cb75-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-590"><a href="#cb75-590" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-27</span></span>
<span id="cb75-591"><a href="#cb75-591" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(lmod0), <span class="fu">resid</span>(lmod0)) <span class="co"># to check for linearity, constant variance (looks bad)</span></span>
<span id="cb75-592"><a href="#cb75-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-593"><a href="#cb75-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-594"><a href="#cb75-594" aria-hidden="true" tabindex="-1"></a>after 80 the variance starts increasing</span>
<span id="cb75-595"><a href="#cb75-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-598"><a href="#cb75-598" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-599"><a href="#cb75-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-28</span></span>
<span id="cb75-600"><a href="#cb75-600" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">resid</span>(lmod0)) <span class="co"># to check Normality assumption (we want this to be a straight line)</span></span>
<span id="cb75-601"><a href="#cb75-601" aria-hidden="true" tabindex="-1"></a><span class="co">#?qqnorm</span></span>
<span id="cb75-602"><a href="#cb75-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-603"><a href="#cb75-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-604"><a href="#cb75-604" aria-hidden="true" tabindex="-1"></a>This looks good except for the last few points.</span>
<span id="cb75-605"><a href="#cb75-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-606"><a href="#cb75-606" aria-hidden="true" tabindex="-1"></a>Now let's return to our model fit to the log-transformed variables. In a Bayesian model, we have distributions for residuals, but we'll simplify and look only at the residuals evaluated at the posterior mean of the parameters.</span>
<span id="cb75-607"><a href="#cb75-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-610"><a href="#cb75-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-611"><a href="#cb75-611" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-29</span></span>
<span id="cb75-612"><a href="#cb75-612" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fl">1.0</span>, data1_jags<span class="sc">$</span>n), data1_jags<span class="sc">$</span>log_income)</span>
<span id="cb75-613"><a href="#cb75-613" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span>
<span id="cb75-614"><a href="#cb75-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-615"><a href="#cb75-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-618"><a href="#cb75-618" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-619"><a href="#cb75-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-30</span></span>
<span id="cb75-620"><a href="#cb75-620" aria-hidden="true" tabindex="-1"></a>(<span class="at">pm_params1 =</span> <span class="fu">colMeans</span>(mod1_csim)) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-621"><a href="#cb75-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-622"><a href="#cb75-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-623"><a href="#cb75-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-624"><a href="#cb75-624" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>posterior mean - using (var = expr) forces R to return the value of var</span>
<span id="cb75-625"><a href="#cb75-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-628"><a href="#cb75-628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-629"><a href="#cb75-629" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-31</span></span>
<span id="cb75-630"><a href="#cb75-630" aria-hidden="true" tabindex="-1"></a>yhat1 <span class="ot">=</span> <span class="fu">drop</span>(X <span class="sc">%*%</span> pm_params1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="co"># &lt;1&gt;</span></span>
<span id="cb75-631"><a href="#cb75-631" aria-hidden="true" tabindex="-1"></a>resid1 <span class="ot">=</span> data1_jags<span class="sc">$</span>y <span class="sc">-</span> yhat1       <span class="co"># &lt;2&gt;</span></span>
<span id="cb75-632"><a href="#cb75-632" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid1) <span class="co"># &lt;3&gt;</span></span>
<span id="cb75-633"><a href="#cb75-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-634"><a href="#cb75-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-635"><a href="#cb75-635" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we are evaluating $\hat{y} = b_0 \times 1 + b_1 \times x_1$ via matrix multiplication of <span class="sc">\[</span>1, data1_jags\$log_income<span class="sc">\]</span> <span class="sc">\*\[</span>b_0,b_1<span class="sc">\]</span></span>
<span id="cb75-636"><a href="#cb75-636" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>$res_i = y_i- \hat y = y_i - (b_0 \times 1 + b_1 \times x_{1,i})$</span>
<span id="cb75-637"><a href="#cb75-637" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>plots the residual against the data index</span>
<span id="cb75-638"><a href="#cb75-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-639"><a href="#cb75-639" aria-hidden="true" tabindex="-1"></a>So to get the residuals from Stan we extract the b parameter.</span>
<span id="cb75-640"><a href="#cb75-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-641"><a href="#cb75-641" aria-hidden="true" tabindex="-1"></a>Although we did not discuss it we could estimate $\hat y$ by drawing K predictions for each x_i and look at $res_i=\frac{1}{K}\sum_k|y_i -\hat y_{i,k}|$ and plot upper and fit a line as well as lower and upper bounds as well. Also I'm not sure but I guess we can also do with using the predictive posterior dist. Anyhow here is a link to something like this: <span class="co">[</span><span class="ot">Extracting and visualizing tidy residuals from Bayesian models</span><span class="co">](https://mjskay.github.io/tidybayes/articles/tidybayes-residuals.html#probability-residuals-and-quantile-residuals)</span> -jk</span>
<span id="cb75-642"><a href="#cb75-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-645"><a href="#cb75-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-646"><a href="#cb75-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-32</span></span>
<span id="cb75-647"><a href="#cb75-647" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat1, resid1) <span class="co"># against predicted values</span></span>
<span id="cb75-648"><a href="#cb75-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-649"><a href="#cb75-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-652"><a href="#cb75-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-653"><a href="#cb75-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-33</span></span>
<span id="cb75-654"><a href="#cb75-654" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(resid1) <span class="co"># checking normality of residuals</span></span>
<span id="cb75-655"><a href="#cb75-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-656"><a href="#cb75-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-659"><a href="#cb75-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-660"><a href="#cb75-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-34</span></span>
<span id="cb75-661"><a href="#cb75-661" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predict</span>(lmod0), <span class="fu">resid</span>(mod1)) <span class="co"># to compare with reference linear model</span></span>
<span id="cb75-662"><a href="#cb75-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-663"><a href="#cb75-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-666"><a href="#cb75-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-667"><a href="#cb75-667" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-35</span></span>
<span id="cb75-668"><a href="#cb75-668" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(dat)[<span class="fu">order</span>(resid1, <span class="at">decreasing=</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]] <span class="co"># which countries have the largest positive residuals?</span></span>
<span id="cb75-669"><a href="#cb75-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-670"><a href="#cb75-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-671"><a href="#cb75-671" aria-hidden="true" tabindex="-1"></a>The residuals look pretty good here (no patterns, shapes) except for two strong outliers, Saudi Arabia and Libya. When outliers appear, it is a good idea to double check that they are not just errors in data entry. If the values are correct, you may reconsider whether these data points really are representative of the data you are trying to model. If you conclude that they are not (for example, they were recorded on different years), you may be able to justify dropping these data points from the data set.</span>
<span id="cb75-672"><a href="#cb75-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-673"><a href="#cb75-673" aria-hidden="true" tabindex="-1"></a>If you conclude that the outliers are part of data and should not be removed, we have several modeling options to accommodate them. We will address these in the next segment.</span>
<span id="cb75-674"><a href="#cb75-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-675"><a href="#cb75-675" aria-hidden="true" tabindex="-1"></a><span class="fu"># Lesson 7.5 - Alternative models {#sec-alternative-models}</span></span>
<span id="cb75-676"><a href="#cb75-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-677"><a href="#cb75-677" aria-hidden="true" tabindex="-1"></a>In the previous segment, we saw two outliers in the model relating the logarithm of infant mortality to the logarithm of income. Here we will discuss options for when we conclude that these outliers belong in the data set.</span>
<span id="cb75-678"><a href="#cb75-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-679"><a href="#cb75-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional covariates {#sec-additional-covariates}</span></span>
<span id="cb75-680"><a href="#cb75-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-681"><a href="#cb75-681" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">The first approach is to look for additional covariates that may be able to explain the outliers</span><span class="co">]</span>{.mark}. For example, there could be a number of variables that provide information about infant mortality above and beyond what income provides.</span>
<span id="cb75-682"><a href="#cb75-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-683"><a href="#cb75-683" aria-hidden="true" tabindex="-1"></a>Looking back at our data, there are two variables we haven't used yet: <span class="in">`region`</span> and <span class="in">`oil`</span>. The <span class="in">`oil`</span> variable indicates oil-exporting countries. Both Saudi Arabia and Libya are oil-exporting countries, so perhaps this might explain part of the anomaly.</span>
<span id="cb75-684"><a href="#cb75-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-687"><a href="#cb75-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-688"><a href="#cb75-688" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-36</span></span>
<span id="cb75-689"><a href="#cb75-689" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="cb75-690"><a href="#cb75-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-691"><a href="#cb75-691" aria-hidden="true" tabindex="-1"></a>mod2_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb75-692"><a href="#cb75-692" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(y)) {</span></span>
<span id="cb75-693"><a href="#cb75-693" aria-hidden="true" tabindex="-1"></a><span class="st">        y[i] ~ dnorm(mu[i], prec)</span></span>
<span id="cb75-694"><a href="#cb75-694" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i] = b[1] + b[2]*log_income[i] + b[3]*is_oil[i]  # &lt;1&gt;</span></span>
<span id="cb75-695"><a href="#cb75-695" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-696"><a href="#cb75-696" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-697"><a href="#cb75-697" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:3) {                                        # &lt;2&gt;</span></span>
<span id="cb75-698"><a href="#cb75-698" aria-hidden="true" tabindex="-1"></a><span class="st">        b[i] ~ dnorm(0.0, 1.0/1.0e6)</span></span>
<span id="cb75-699"><a href="#cb75-699" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-700"><a href="#cb75-700" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-701"><a href="#cb75-701" aria-hidden="true" tabindex="-1"></a><span class="st">    prec ~ dgamma(5/2.0, 5*10.0/2.0)</span></span>
<span id="cb75-702"><a href="#cb75-702" aria-hidden="true" tabindex="-1"></a><span class="st">    sig = sqrt( 1.0 / prec )</span></span>
<span id="cb75-703"><a href="#cb75-703" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb75-704"><a href="#cb75-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-705"><a href="#cb75-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-706"><a href="#cb75-706" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">73</span>)</span>
<span id="cb75-707"><a href="#cb75-707" aria-hidden="true" tabindex="-1"></a>data2_jags <span class="ot">=</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>loginfant, <span class="at">log_income=</span>dat<span class="sc">$</span>logincome,</span>
<span id="cb75-708"><a href="#cb75-708" aria-hidden="true" tabindex="-1"></a>                  <span class="at">is_oil=</span><span class="fu">as.numeric</span>(dat<span class="sc">$</span>oil<span class="sc">==</span><span class="st">"yes"</span>))        <span class="co"># &lt;3&gt;</span></span>
<span id="cb75-709"><a href="#cb75-709" aria-hidden="true" tabindex="-1"></a>data2_jags<span class="sc">$</span>is_oil</span>
<span id="cb75-710"><a href="#cb75-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-711"><a href="#cb75-711" aria-hidden="true" tabindex="-1"></a>params2 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"sig"</span>)</span>
<span id="cb75-712"><a href="#cb75-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-713"><a href="#cb75-713" aria-hidden="true" tabindex="-1"></a>inits2 <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb75-714"><a href="#cb75-714" aria-hidden="true" tabindex="-1"></a>    inits <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"b"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="fl">0.0</span>,<span class="fl">100.0</span>), <span class="st">"prec"</span><span class="ot">=</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="fl">1.0</span>,<span class="fl">1.0</span>)) <span class="co"># &lt;4&gt;</span></span>
<span id="cb75-715"><a href="#cb75-715" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-716"><a href="#cb75-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-717"><a href="#cb75-717" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod2_string), <span class="at">data=</span>data2_jags, <span class="at">inits=</span>inits2, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="cb75-718"><a href="#cb75-718" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod2, <span class="fl">1e3</span>) <span class="co"># burn-in</span></span>
<span id="cb75-719"><a href="#cb75-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-720"><a href="#cb75-720" aria-hidden="true" tabindex="-1"></a>mod2_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod2,</span>
<span id="cb75-721"><a href="#cb75-721" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params2,</span>
<span id="cb75-722"><a href="#cb75-722" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb75-723"><a href="#cb75-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-724"><a href="#cb75-724" aria-hidden="true" tabindex="-1"></a>mod2_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod2_sim)) <span class="co"># combine multiple chains</span></span>
<span id="cb75-725"><a href="#cb75-725" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-726"><a href="#cb75-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-727"><a href="#cb75-727" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we add the is_oil indicator parameter</span>
<span id="cb75-728"><a href="#cb75-728" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we increment the number of parameters</span>
<span id="cb75-729"><a href="#cb75-729" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>encode the is_oil from text to be binary</span>
<span id="cb75-730"><a href="#cb75-730" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>draw another var for b.</span>
<span id="cb75-731"><a href="#cb75-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-732"><a href="#cb75-732" aria-hidden="true" tabindex="-1"></a>As usual, check the convergence diagnostics.</span>
<span id="cb75-733"><a href="#cb75-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-736"><a href="#cb75-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-737"><a href="#cb75-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-37</span></span>
<span id="cb75-738"><a href="#cb75-738" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.</span>, <span class="dv">1</span>, <span class="fl">2.</span>, <span class="dv">1</span>))</span>
<span id="cb75-739"><a href="#cb75-739" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod2_sim)</span>
<span id="cb75-740"><a href="#cb75-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-741"><a href="#cb75-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-744"><a href="#cb75-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-745"><a href="#cb75-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-38</span></span>
<span id="cb75-746"><a href="#cb75-746" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod2_sim)</span>
<span id="cb75-747"><a href="#cb75-747" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod2_sim)</span>
<span id="cb75-748"><a href="#cb75-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-749"><a href="#cb75-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-752"><a href="#cb75-752" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-753"><a href="#cb75-753" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-autocorr-plot-mod2</span></span>
<span id="cb75-754"><a href="#cb75-754" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "auto-correlation plot"</span></span>
<span id="cb75-755"><a href="#cb75-755" aria-hidden="true" tabindex="-1"></a><span class="co">#autocorr.plot(mod2_sim,auto.layout=FALSE )</span></span>
<span id="cb75-756"><a href="#cb75-756" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod2_csim,<span class="at">auto.layout=</span><span class="cn">FALSE</span> )</span>
<span id="cb75-757"><a href="#cb75-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-758"><a href="#cb75-758" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-759"><a href="#cb75-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-762"><a href="#cb75-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-763"><a href="#cb75-763" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-40</span></span>
<span id="cb75-764"><a href="#cb75-764" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod2_sim)</span>
<span id="cb75-765"><a href="#cb75-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-766"><a href="#cb75-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-767"><a href="#cb75-767" aria-hidden="true" tabindex="-1"></a>We can get a posterior summary of the parameters in our model.</span>
<span id="cb75-768"><a href="#cb75-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-771"><a href="#cb75-771" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-772"><a href="#cb75-772" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-41</span></span>
<span id="cb75-773"><a href="#cb75-773" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2_sim)</span>
<span id="cb75-774"><a href="#cb75-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-775"><a href="#cb75-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-776"><a href="#cb75-776" aria-hidden="true" tabindex="-1"></a>It looks like there is a positive relationship between oil-production and log-infant mortality. Because these data are merely observational, we cannot say that oil-production causes an increase in infant mortality (indeed that most certainly isn't the case), but we can say that they are positively correlated.</span>
<span id="cb75-777"><a href="#cb75-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-778"><a href="#cb75-778" aria-hidden="true" tabindex="-1"></a>Now let's check the residuals.</span>
<span id="cb75-779"><a href="#cb75-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-782"><a href="#cb75-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-783"><a href="#cb75-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-42</span></span>
<span id="cb75-784"><a href="#cb75-784" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="fl">1.0</span>, data1_jags<span class="sc">$</span>n), data2_jags<span class="sc">$</span>log_income, data2_jags<span class="sc">$</span>is_oil)</span>
<span id="cb75-785"><a href="#cb75-785" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X2)</span>
<span id="cb75-786"><a href="#cb75-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-787"><a href="#cb75-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-790"><a href="#cb75-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-791"><a href="#cb75-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-43</span></span>
<span id="cb75-792"><a href="#cb75-792" aria-hidden="true" tabindex="-1"></a>(<span class="at">pm_params2 =</span> <span class="fu">colMeans</span>(mod2_csim)) <span class="co"># posterior mean</span></span>
<span id="cb75-793"><a href="#cb75-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-794"><a href="#cb75-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-797"><a href="#cb75-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-798"><a href="#cb75-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-44</span></span>
<span id="cb75-799"><a href="#cb75-799" aria-hidden="true" tabindex="-1"></a>yhat2 <span class="ot">=</span> <span class="fu">drop</span>(X2 <span class="sc">%*%</span> pm_params2[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb75-800"><a href="#cb75-800" aria-hidden="true" tabindex="-1"></a>resid2 <span class="ot">=</span> data2_jags<span class="sc">$</span>y <span class="sc">-</span> yhat2</span>
<span id="cb75-801"><a href="#cb75-801" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid2) <span class="co"># against data index</span></span>
<span id="cb75-802"><a href="#cb75-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-803"><a href="#cb75-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-806"><a href="#cb75-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-807"><a href="#cb75-807" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-45</span></span>
<span id="cb75-808"><a href="#cb75-808" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat2, resid2) <span class="co"># against predicted values</span></span>
<span id="cb75-809"><a href="#cb75-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-810"><a href="#cb75-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-813"><a href="#cb75-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-814"><a href="#cb75-814" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-46</span></span>
<span id="cb75-815"><a href="#cb75-815" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat1, resid1) <span class="co"># residuals from the first model</span></span>
<span id="cb75-816"><a href="#cb75-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-817"><a href="#cb75-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-820"><a href="#cb75-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-821"><a href="#cb75-821" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-47</span></span>
<span id="cb75-822"><a href="#cb75-822" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(resid2) <span class="co"># standard deviation of residuals</span></span>
<span id="cb75-823"><a href="#cb75-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-824"><a href="#cb75-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-825"><a href="#cb75-825" aria-hidden="true" tabindex="-1"></a>These look much better, although the residuals for Saudi Arabia and Libya are still more than three standard deviations away from the mean of the residuals. We might consider adding the other covariate <span class="in">`region`</span>, but instead let's look at another option when we are faced with strong outliers.</span>
<span id="cb75-826"><a href="#cb75-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-827"><a href="#cb75-827" aria-hidden="true" tabindex="-1"></a><span class="fu">### Student-t likelihood {#sec-student-t-likelihood}</span></span>
<span id="cb75-828"><a href="#cb75-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-829"><a href="#cb75-829" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Let's consider changing the likelihood.</span>
<span id="cb75-830"><a href="#cb75-830" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The normal likelihood has thin tails (almost all of the probability is concentrated within the first few standard deviations from the mean).</span>
<span id="cb75-831"><a href="#cb75-831" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This does not accommodate outliers well.</span>
<span id="cb75-832"><a href="#cb75-832" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consequently, models with the normal likelihood might be overly-influenced by outliers.</span>
<span id="cb75-833"><a href="#cb75-833" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Recall that the $t$ distribution is similar to the normal distribution, but it has thicker tails which can accommodate outliers.</span>
<span id="cb75-834"><a href="#cb75-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-835"><a href="#cb75-835" aria-hidden="true" tabindex="-1"></a>The $t$ linear model might look something like this. Notice that the $t$ distribution has three parameters, including a positive "degrees of freedom" parameter. The smaller the degrees of freedom, the heavier the tails of the distribution. We might fix the degrees of freedom to some number, or we can assign it a prior distribution.</span>
<span id="cb75-836"><a href="#cb75-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-839"><a href="#cb75-839" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-840"><a href="#cb75-840" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-48</span></span>
<span id="cb75-841"><a href="#cb75-841" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-column: margin</span></span>
<span id="cb75-842"><a href="#cb75-842" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: normal and t distributions</span></span>
<span id="cb75-843"><a href="#cb75-843" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x), <span class="at">from =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">to =</span> <span class="dv">5</span>)</span>
<span id="cb75-844"><a href="#cb75-844" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dt</span>(x,<span class="dv">1</span>), <span class="at">from =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">to =</span> <span class="dv">5</span>,<span class="at">col=</span><span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb75-845"><a href="#cb75-845" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-846"><a href="#cb75-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-849"><a href="#cb75-849" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-850"><a href="#cb75-850" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-49</span></span>
<span id="cb75-851"><a href="#cb75-851" aria-hidden="true" tabindex="-1"></a>mod3_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb75-852"><a href="#cb75-852" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(y)) {                                    # &lt;1&gt;</span></span>
<span id="cb75-853"><a href="#cb75-853" aria-hidden="true" tabindex="-1"></a><span class="st">        y[i] ~ dt( mu[i], tau, df )</span></span>
<span id="cb75-854"><a href="#cb75-854" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i] = b[1] + b[2]*log_income[i] + b[3]*is_oil[i]</span></span>
<span id="cb75-855"><a href="#cb75-855" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-856"><a href="#cb75-856" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-857"><a href="#cb75-857" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:3) {</span></span>
<span id="cb75-858"><a href="#cb75-858" aria-hidden="true" tabindex="-1"></a><span class="st">        b[i] ~ dnorm(0.0, 1.0/1.0e6)</span></span>
<span id="cb75-859"><a href="#cb75-859" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb75-860"><a href="#cb75-860" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-861"><a href="#cb75-861" aria-hidden="true" tabindex="-1"></a><span class="st">    nu ~ dexp(1.0)                                              # &lt;2&gt; </span></span>
<span id="cb75-862"><a href="#cb75-862" aria-hidden="true" tabindex="-1"></a><span class="st">    df = nu + 2.0                                               # &lt;3&gt;</span></span>
<span id="cb75-863"><a href="#cb75-863" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb75-864"><a href="#cb75-864" aria-hidden="true" tabindex="-1"></a><span class="st">    tau ~ dgamma(5/2.0, 5*10.0/2.0)                             # &lt;4&gt;</span></span>
<span id="cb75-865"><a href="#cb75-865" aria-hidden="true" tabindex="-1"></a><span class="st">    sig = sqrt( 1.0 / tau * df / (df - 2.0) )                   # &lt;5&gt;</span></span>
<span id="cb75-866"><a href="#cb75-866" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span></span>
<span id="cb75-867"><a href="#cb75-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-868"><a href="#cb75-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-869"><a href="#cb75-869" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we replaced normal likelihood with a student t likelihood which has thicker tails</span>
<span id="cb75-870"><a href="#cb75-870" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>$\nu$ <span class="in">`nu`</span> is the degrees of freedom (dof) but the outcome can be 0 or 1</span>
<span id="cb75-871"><a href="#cb75-871" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>we force the degrees of freedom <span class="in">`dof&gt;2`</span> to guarantee the existence of mean and variance in the t dist.</span>
<span id="cb75-872"><a href="#cb75-872" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>$\tau$ <span class="in">`tau`</span> is the **inverse scale** is close to, but not equal to the **precision** from above so we use the same prior as we used for precision.</span>
<span id="cb75-873"><a href="#cb75-873" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>$\sigma$ <span class="in">`sig`</span> standard deviation of errors is a deterministic function of <span class="in">`tau`</span>, and <span class="in">`df`</span></span>
<span id="cb75-874"><a href="#cb75-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-875"><a href="#cb75-875" aria-hidden="true" tabindex="-1"></a>We fit this model.</span>
<span id="cb75-876"><a href="#cb75-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-879"><a href="#cb75-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-880"><a href="#cb75-880" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-50</span></span>
<span id="cb75-881"><a href="#cb75-881" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">73</span>)</span>
<span id="cb75-882"><a href="#cb75-882" aria-hidden="true" tabindex="-1"></a>data3_jags <span class="ot">=</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>loginfant, <span class="at">log_income=</span>dat<span class="sc">$</span>logincome,</span>
<span id="cb75-883"><a href="#cb75-883" aria-hidden="true" tabindex="-1"></a>                  <span class="at">is_oil=</span><span class="fu">as.numeric</span>(dat<span class="sc">$</span>oil<span class="sc">==</span><span class="st">"yes"</span>))        <span class="co"># &lt;3&gt;</span></span>
<span id="cb75-884"><a href="#cb75-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-885"><a href="#cb75-885" aria-hidden="true" tabindex="-1"></a>params3 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"sig"</span>)</span>
<span id="cb75-886"><a href="#cb75-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-887"><a href="#cb75-887" aria-hidden="true" tabindex="-1"></a>inits3 <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb75-888"><a href="#cb75-888" aria-hidden="true" tabindex="-1"></a>    inits <span class="ot">=</span> <span class="fu">list</span>(<span class="st">"b"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="fl">0.0</span>,<span class="fl">100.0</span>), <span class="st">"prec"</span><span class="ot">=</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="fl">1.0</span>,<span class="fl">1.0</span>)) <span class="co"># &lt;4&gt;</span></span>
<span id="cb75-889"><a href="#cb75-889" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-890"><a href="#cb75-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-891"><a href="#cb75-891" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod3_string), <span class="at">data=</span>data3_jags, <span class="at">inits=</span>inits3, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="cb75-892"><a href="#cb75-892" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod3, <span class="fl">1e3</span>) <span class="co"># burn-in</span></span>
<span id="cb75-893"><a href="#cb75-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-894"><a href="#cb75-894" aria-hidden="true" tabindex="-1"></a>mod3_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod3,</span>
<span id="cb75-895"><a href="#cb75-895" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params3,</span>
<span id="cb75-896"><a href="#cb75-896" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb75-897"><a href="#cb75-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-898"><a href="#cb75-898" aria-hidden="true" tabindex="-1"></a>mod3_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod3_sim)) <span class="co"># combine multiple chains</span></span>
<span id="cb75-899"><a href="#cb75-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-900"><a href="#cb75-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-901"><a href="#cb75-901" aria-hidden="true" tabindex="-1"></a>check MCMC convergence visually</span>
<span id="cb75-902"><a href="#cb75-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-905"><a href="#cb75-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-906"><a href="#cb75-906" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-51</span></span>
<span id="cb75-907"><a href="#cb75-907" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb75-908"><a href="#cb75-908" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod3_sim)</span>
<span id="cb75-909"><a href="#cb75-909" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-910"><a href="#cb75-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-911"><a href="#cb75-911" aria-hidden="true" tabindex="-1"></a>check MCMC convergence quantitatively using *Rubin Gelman*</span>
<span id="cb75-912"><a href="#cb75-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-915"><a href="#cb75-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-916"><a href="#cb75-916" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-52</span></span>
<span id="cb75-917"><a href="#cb75-917" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod3_sim)</span>
<span id="cb75-918"><a href="#cb75-918" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-919"><a href="#cb75-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-922"><a href="#cb75-922" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-923"><a href="#cb75-923" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-53</span></span>
<span id="cb75-924"><a href="#cb75-924" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod3_sim)</span>
<span id="cb75-925"><a href="#cb75-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-926"><a href="#cb75-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-927"><a href="#cb75-927" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compare models using Deviance information criterion (DIC) {#sec-compare-models-using-deviance-information-criterion-dic}</span></span>
<span id="cb75-928"><a href="#cb75-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-929"><a href="#cb75-929" aria-hidden="true" tabindex="-1"></a>\index{DIC|see {Deviance information criterion}} \index{Deviance information criterion} \index{model selection!DIC}</span>
<span id="cb75-930"><a href="#cb75-930" aria-hidden="true" tabindex="-1"></a>We have now proposed three different models. </span>
<span id="cb75-931"><a href="#cb75-931" aria-hidden="true" tabindex="-1"></a>How do we compare their performance on our data? </span>
<span id="cb75-932"><a href="#cb75-932" aria-hidden="true" tabindex="-1"></a>In the previous course, we discussed estimating parameters in models using the maximum likelihood method. </span>
<span id="cb75-933"><a href="#cb75-933" aria-hidden="true" tabindex="-1"></a>Similarly, we can choose between competing models using the same idea.</span>
<span id="cb75-934"><a href="#cb75-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-935"><a href="#cb75-935" aria-hidden="true" tabindex="-1"></a>We will use a quantity known as the deviance information criterion (DIC). </span>
<span id="cb75-936"><a href="#cb75-936" aria-hidden="true" tabindex="-1"></a>It essentially calculates the posterior mean of the log-likelihood and adds a penalty for model complexity.</span>
<span id="cb75-937"><a href="#cb75-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-938"><a href="#cb75-938" aria-hidden="true" tabindex="-1"></a>Let's calculate the DIC for our first two models:</span>
<span id="cb75-939"><a href="#cb75-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-940"><a href="#cb75-940" aria-hidden="true" tabindex="-1"></a>the simple linear regression on log-income,</span>
<span id="cb75-941"><a href="#cb75-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-944"><a href="#cb75-944" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-945"><a href="#cb75-945" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-54</span></span>
<span id="cb75-946"><a href="#cb75-946" aria-hidden="true" tabindex="-1"></a><span class="fu">dic.samples</span>(mod1, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span>
<span id="cb75-947"><a href="#cb75-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-948"><a href="#cb75-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-949"><a href="#cb75-949" aria-hidden="true" tabindex="-1"></a>and the second model where we add oil production.</span>
<span id="cb75-950"><a href="#cb75-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-953"><a href="#cb75-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-954"><a href="#cb75-954" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-55</span></span>
<span id="cb75-955"><a href="#cb75-955" aria-hidden="true" tabindex="-1"></a><span class="fu">dic.samples</span>(mod2, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span>
<span id="cb75-956"><a href="#cb75-956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-957"><a href="#cb75-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-958"><a href="#cb75-958" aria-hidden="true" tabindex="-1"></a>and the second model where we introduce the Student t likelihood.</span>
<span id="cb75-959"><a href="#cb75-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-962"><a href="#cb75-962" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-963"><a href="#cb75-963" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-56</span></span>
<span id="cb75-964"><a href="#cb75-964" aria-hidden="true" tabindex="-1"></a><span class="fu">dic.samples</span>(mod3, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span>
<span id="cb75-965"><a href="#cb75-965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-966"><a href="#cb75-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-967"><a href="#cb75-967" aria-hidden="true" tabindex="-1"></a>The first number is the Monte Carlo estimated posterior mean deviance, which equals $-2$ times the log-likelihood (plus a constant that will be irrelevant for comparing models). Because of that $-2$ factor, **a smaller deviance means a higher likelihood**.</span>
<span id="cb75-968"><a href="#cb75-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-969"><a href="#cb75-969" aria-hidden="true" tabindex="-1"></a>Next, we are given a penalty for the complexity of our model. This penalty is necessary because we can always increase the likelihood of the model by making it more complex to fit the data exactly. We don't want to do this because over-fit models generalize poorly. This penalty is roughly equal to the effective number of parameters in your model. You can see this here. With the first model, we had a variance parameter and two betas, for a total of three parameters. In the second model, we added one more beta for the oil effect.</span>
<span id="cb75-970"><a href="#cb75-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-971"><a href="#cb75-971" aria-hidden="true" tabindex="-1"></a>\index{model selection} \index{model selection!DIC} \index{DIC} \index{Deviance information criterion}</span>
<span id="cb75-972"><a href="#cb75-972" aria-hidden="true" tabindex="-1"></a>We add these two quantities to get the DIC (the last number). The better-fitting model has a lower DIC value. In this case, the gains we receive in deviance by adding the <span class="in">`is_oil`</span> covariate outweigh the penalty for adding an extra parameter. The final DIC for the second model is lower than for the first, so we would prefer using the second model.</span>
<span id="cb75-973"><a href="#cb75-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-974"><a href="#cb75-974" aria-hidden="true" tabindex="-1"></a>We encourage you to explore different model specifications and compare their fit to the data using DIC. <span class="co">[</span><span class="ot">Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/Deviance_information_criterion)</span> provides a good introduction to DIC and we can find more details about the <span class="in">`JAGS`</span> implementation through the <span class="in">`rjags`</span> package documentation by entering <span class="in">`?dic.samples`</span> in the <span class="in">`R`</span> console.</span>
<span id="cb75-975"><a href="#cb75-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-978"><a href="#cb75-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-979"><a href="#cb75-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-57</span></span>
<span id="cb75-980"><a href="#cb75-980" aria-hidden="true" tabindex="-1"></a><span class="co">#?dic.samples</span></span>
<span id="cb75-981"><a href="#cb75-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-982"><a href="#cb75-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-983"><a href="#cb75-983" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression Diagnostics {#sec-regression-diagnostics}</span></span>
<span id="cb75-984"><a href="#cb75-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-985"><a href="#cb75-985" aria-hidden="true" tabindex="-1"></a>\index{regression diagnostics}</span>
<span id="cb75-986"><a href="#cb75-986" aria-hidden="true" tabindex="-1"></a>\index{regression diagnostics!residuals}</span>
<span id="cb75-987"><a href="#cb75-987" aria-hidden="true" tabindex="-1"></a>\index{regression diagnostics!QQ plot}</span>
<span id="cb75-988"><a href="#cb75-988" aria-hidden="true" tabindex="-1"></a>\index{regression diagnostics!scale location plot}</span>
<span id="cb75-989"><a href="#cb75-989" aria-hidden="true" tabindex="-1"></a>In production we want to flag regression issues in an automated fashion. However while we develop models we should try to examine these issues visually.</span>
<span id="cb75-990"><a href="#cb75-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-991"><a href="#cb75-991" aria-hidden="true" tabindex="-1"></a>Regression diagnostics help identify:</span>
<span id="cb75-992"><a href="#cb75-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-993"><a href="#cb75-993" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>shortcoming of our model and the preferred ways to improve them</span>
<span id="cb75-994"><a href="#cb75-994" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>transforms of variables</span>
<span id="cb75-995"><a href="#cb75-995" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>different likelihood</span>
<span id="cb75-996"><a href="#cb75-996" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>adding missing covariate relations to remove patterns in the residuals</span>
<span id="cb75-997"><a href="#cb75-997" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>increasing interpretability by removing covariates that do not contribute to the fit.</span>
<span id="cb75-998"><a href="#cb75-998" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>issues in the data</span>
<span id="cb75-999"><a href="#cb75-999" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>transformation</span>
<span id="cb75-1000"><a href="#cb75-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1001"><a href="#cb75-1001" aria-hidden="true" tabindex="-1"></a>we should consider the following issues: 1. testing <span class="in">`heteroscedasticity`</span> with the *Breusch-Pagan* test</span>
<span id="cb75-1002"><a href="#cb75-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1003"><a href="#cb75-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1004"><a href="#cb75-1004" aria-hidden="true" tabindex="-1"></a>Let's try to cover the diagnostic plots which help us validate a regression model.</span>
<span id="cb75-1005"><a href="#cb75-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1006"><a href="#cb75-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residuals v.s. Fitted {#sec-residuals-vs-fitted}</span></span>
<span id="cb75-1007"><a href="#cb75-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1008"><a href="#cb75-1008" aria-hidden="true" tabindex="-1"></a>\index{regression diagnostics!residuals v.s. fitted}</span>
<span id="cb75-1009"><a href="#cb75-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1010"><a href="#cb75-1010" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The "residuals versus fits plot" is the most first diagnostic tool we</span>
<span id="cb75-1011"><a href="#cb75-1011" aria-hidden="true" tabindex="-1"></a>    should look at to determine if the regression is valid. If the regression </span>
<span id="cb75-1012"><a href="#cb75-1012" aria-hidden="true" tabindex="-1"></a>    assumptions are violated we should be able to identify the issues and possibly correct them.</span>
<span id="cb75-1013"><a href="#cb75-1013" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-1014"><a href="#cb75-1014" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is a scatter plot of residuals on the y axis and fitted values (estimated responses) on the x axis.</span>
<span id="cb75-1015"><a href="#cb75-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1016"><a href="#cb75-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The plot can be used to detect:</span>
<span id="cb75-1017"><a href="#cb75-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1018"><a href="#cb75-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>non-linearity,</span>
<span id="cb75-1019"><a href="#cb75-1019" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>unequal error variances, and</span>
<span id="cb75-1020"><a href="#cb75-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>outliers.</span>
<span id="cb75-1021"><a href="#cb75-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1024"><a href="#cb75-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-1025"><a href="#cb75-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-58</span></span>
<span id="cb75-1026"><a href="#cb75-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Residuals vs Fitted plot</span></span>
<span id="cb75-1027"><a href="#cb75-1027" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">1</span>)</span>
<span id="cb75-1028"><a href="#cb75-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-1029"><a href="#cb75-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1030"><a href="#cb75-1030" aria-hidden="true" tabindex="-1"></a>Residuals will enable us to assess visually whether an appropriate model has been fit to the data no matter how many predictor variables are used. We can checking the validity of a linear regression model by plotting residuals versus x and look for patterns. - Lack of a discernible pattern is indicative of a valid model. - A pattern is is indicative that a function or transformation of X is missing from the model.</span>
<span id="cb75-1031"><a href="#cb75-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1032"><a href="#cb75-1032" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb75-1033"><a href="#cb75-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">#### What to look for {#sec-what-to-look-for}</span></span>
<span id="cb75-1034"><a href="#cb75-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1035"><a href="#cb75-1035" aria-hidden="true" tabindex="-1"></a>Look for *patterns* that can indicate non-linearity,</span>
<span id="cb75-1036"><a href="#cb75-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1037"><a href="#cb75-1037" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>that the residuals all are high in some areas and low in others. Change in variability as X changes - U shape missing quadratic term · we can get this plot as follows.</span>
<span id="cb75-1038"><a href="#cb75-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1039"><a href="#cb75-1039" aria-hidden="true" tabindex="-1"></a>The blue line is there to aid the eye - it should ideally be relatively close to a straight line (in this case, it isn't perfectly straight, which could indicate a mild non-linearity).</span>
<span id="cb75-1040"><a href="#cb75-1040" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb75-1041"><a href="#cb75-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1042"><a href="#cb75-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">### QQ plot of the residuals {#sec-qq-plot-of-the-residuals}</span></span>
<span id="cb75-1043"><a href="#cb75-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1044"><a href="#cb75-1044" aria-hidden="true" tabindex="-1"></a>\index{chart!QQ plot}</span>
<span id="cb75-1045"><a href="#cb75-1045" aria-hidden="true" tabindex="-1"></a>\index{residual analysis}</span>
<span id="cb75-1046"><a href="#cb75-1046" aria-hidden="true" tabindex="-1"></a>This plot shows if residuals are normally distributed. Do residuals follow a straight line well or do they deviate severely?</span>
<span id="cb75-1047"><a href="#cb75-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1048"><a href="#cb75-1048" aria-hidden="true" tabindex="-1"></a>The regression is valid if the residuals are lined well on the straight dashed line.</span>
<span id="cb75-1049"><a href="#cb75-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1050"><a href="#cb75-1050" aria-hidden="true" tabindex="-1"></a>we can get this plot as follows</span>
<span id="cb75-1051"><a href="#cb75-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1054"><a href="#cb75-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-1055"><a href="#cb75-1055" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-59</span></span>
<span id="cb75-1056"><a href="#cb75-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">2</span>)</span>
<span id="cb75-1057"><a href="#cb75-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-1058"><a href="#cb75-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1059"><a href="#cb75-1059" aria-hidden="true" tabindex="-1"></a>notice that the two outliers are labeled and should be reviewed for - removal - more robust likelihood</span>
<span id="cb75-1060"><a href="#cb75-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1061"><a href="#cb75-1061" aria-hidden="true" tabindex="-1"></a>for more info see <span class="co">[</span><span class="ot">understanding QQ plots</span><span class="co">](https://data.library.virginia.edu/understanding-q-q-plots/)</span></span>
<span id="cb75-1062"><a href="#cb75-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1063"><a href="#cb75-1063" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scale Location plot {#sec-scale-location-plot}</span></span>
<span id="cb75-1064"><a href="#cb75-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1065"><a href="#cb75-1065" aria-hidden="true" tabindex="-1"></a>This plot shows if residuals are spread equally along the ranges of predictors. This is how you can check the assumption of equal variance (homoscedasticity). It's good if you see a horizontal line with equally (randomly) spread points.</span>
<span id="cb75-1066"><a href="#cb75-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1069"><a href="#cb75-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-1070"><a href="#cb75-1070" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-60</span></span>
<span id="cb75-1071"><a href="#cb75-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">3</span>)</span>
<span id="cb75-1072"><a href="#cb75-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-1073"><a href="#cb75-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1074"><a href="#cb75-1074" aria-hidden="true" tabindex="-1"></a>in this case: - most of the points are to the right - the red line is almost flat which is good - there is increasing variance after 80</span>
<span id="cb75-1075"><a href="#cb75-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1076"><a href="#cb75-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cook's Distance {#sec-cooks-distance}</span></span>
<span id="cb75-1077"><a href="#cb75-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1078"><a href="#cb75-1078" aria-hidden="true" tabindex="-1"></a>\index{Cook's distance}</span>
<span id="cb75-1079"><a href="#cb75-1079" aria-hidden="true" tabindex="-1"></a>\index{influence measures}</span>
<span id="cb75-1080"><a href="#cb75-1080" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Originally introduced in <span class="co">[</span><span class="ot">@cook1977</span><span class="co">] [Cook’s Distance]</span>(https://en.wikipedia.org/wiki/Cook%27s_distance) is an estimate of the influence of a data point.</span>
<span id="cb75-1081"><a href="#cb75-1081" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It takes into account both the leverage and residual of each observation.</span>
<span id="cb75-1082"><a href="#cb75-1082" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cook’s Distance is a summary of how much a regression model changes when the ith observation is removed.</span>
<span id="cb75-1083"><a href="#cb75-1083" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When it comes to outliers we care about outliers that have a high Cook's distance as they can have a large impact on the regression model. by shifting the sample fit from the population fit.</span>
<span id="cb75-1084"><a href="#cb75-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Another aspect of Cook's distance is it can be used to identify regions of the design space where the model is poorly supported by the data - i.e. where the model is extrapolating and if we can get more data in that region we can improve the model.</span>
<span id="cb75-1085"><a href="#cb75-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1088"><a href="#cb75-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-1089"><a href="#cb75-1089" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-61</span></span>
<span id="cb75-1090"><a href="#cb75-1090" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">4</span>)</span>
<span id="cb75-1091"><a href="#cb75-1091" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-1092"><a href="#cb75-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1093"><a href="#cb75-1093" aria-hidden="true" tabindex="-1"></a>Used to detect highly influential outliers, i.e. points that can shift the sample fit from the population fit. For large sample sizes, a rough guideline is to consider values above $4/(n-p)$, where $n$ is the sample size and $p$ is the number of predictors including the intercept, to indicate highly influential points.</span>
<span id="cb75-1094"><a href="#cb75-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1095"><a href="#cb75-1095" aria-hidden="true" tabindex="-1"></a>see <span class="co">[</span><span class="ot">@cook1977, @williams1987</span><span class="co">]</span></span>
<span id="cb75-1096"><a href="#cb75-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1097"><a href="#cb75-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residuals vs Leverage {#sec-residuals-vs-leverage}</span></span>
<span id="cb75-1098"><a href="#cb75-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1101"><a href="#cb75-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-1102"><a href="#cb75-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: C2-L07-62</span></span>
<span id="cb75-1103"><a href="#cb75-1103" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">5</span>)</span>
<span id="cb75-1104"><a href="#cb75-1104" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(mod3, 5)</span></span>
<span id="cb75-1105"><a href="#cb75-1105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-1106"><a href="#cb75-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1107"><a href="#cb75-1107" aria-hidden="true" tabindex="-1"></a>This plot helps us to sort through the outliers, if there are any. Not all outliers are influential in linear regression analysis. Even though data have extreme values, they might not be influential to determine a regression line. i.e. the fit wouldn't be much different if we choose to omit them from the analysis. If a point is able to exert a influence on the regression line we call it a high leverage point. Even in this case it might not alter the trend. So we want to identify high leverage points that are at a large distance from their predictor's mean.</span>
<span id="cb75-1108"><a href="#cb75-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1109"><a href="#cb75-1109" aria-hidden="true" tabindex="-1"></a>Unlike the other plots, this time patterns are not relevant. We watch out for outlying values at the upper right corner or at the lower right corner. Those spots are the places where cases can be influential against a regression line. Look for cases outside of the dashed lines. When cases are outside of the dashed lines (meaning they have high "Cook's distance" scores), the cases are influential to the regression results. The regression results will be altered if we exclude those cases.</span>
<span id="cb75-1110"><a href="#cb75-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1111"><a href="#cb75-1111" aria-hidden="true" tabindex="-1"></a>In this case we see that the pints are within the cook's distance contours so our outliers are not high leverage points.</span>
<span id="cb75-1112"><a href="#cb75-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1113"><a href="#cb75-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cook's Distance vs Leverage {#sec-cooks-distance-vs-leverage}</span></span>
<span id="cb75-1114"><a href="#cb75-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1117"><a href="#cb75-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb75-1118"><a href="#cb75-1118" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cooks-distance-vs-leverage</span></span>
<span id="cb75-1119"><a href="#cb75-1119" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Cooks distance v.s. Leverage</span></span>
<span id="cb75-1120"><a href="#cb75-1120" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lmod0, <span class="dv">6</span>)</span>
<span id="cb75-1121"><a href="#cb75-1121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb75-1122"><a href="#cb75-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1123"><a href="#cb75-1123" aria-hidden="true" tabindex="-1"></a>Cook's distance and leverage are used to detect highly leverage points, i.e. data points that can shift the sample fit from the population fit.</span>
<span id="cb75-1124"><a href="#cb75-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1125"><a href="#cb75-1125" aria-hidden="true" tabindex="-1"></a>For large sample sizes, a rough guideline is to consider <span class="co">[</span><span class="ot">Cook's distance values above 1 to indicate highly influential points and leverage values greater than 2 times the number of predictors divided by the sample size to indicate high leverage observations</span><span class="co">]</span>{.mark}. High leverage observations are ones which have predictor values very far from their averages, which can greatly influence the fitted model.</span>
<span id="cb75-1126"><a href="#cb75-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1127"><a href="#cb75-1127" aria-hidden="true" tabindex="-1"></a>The contours in the scatterplot are standardized residuals labelled with their magnitudes</span>
<span id="cb75-1128"><a href="#cb75-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1129"><a href="#cb75-1129" aria-hidden="true" tabindex="-1"></a>see <span class="co">[</span><span class="ot">@cook1977, @williams1987</span><span class="co">]</span></span>
<span id="cb75-1130"><a href="#cb75-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1131"><a href="#cb75-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python {#sec-python}</span></span>
<span id="cb75-1132"><a href="#cb75-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-1133"><a href="#cb75-1133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://emredjan.xyz/blog/2017/07/11/emulating-r-plots-in-python/</span>
<span id="cb75-1134"><a href="#cb75-1134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://towardsdatascience.com/going-from-r-to-python-linear-regression-diagnostic-plots-144d1c4aa5a</span>
<span id="cb75-1135"><a href="#cb75-1135" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://modernstatisticswithr.com/regression.html</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Oren Bochman</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":true,"openEffect":"fade","selector":".lightbox","skin":"my-css-class"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>