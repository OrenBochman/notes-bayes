<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oren Bochman">
<meta name="dcterms.date" content="2025-07-02">
<meta name="keywords" content="Time Series">
<meta name="description" content="Capstone Project: Bayesian Conjugate Analysis for Autogressive Time Series Models">

<title>103&nbsp; Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1 – Bayesian Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./C5-L01-Ex1.html" rel="next">
<link href="./C4-L11.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-923206e44a13b4518db4dede9f4ebdc9.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cec409635dab7d42c7b562035797153a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-987387ce273b62b48f1747d606bce1d5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-cec409635dab7d42c7b562035797153a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(images/banner_deep.jpg);
background-size: cover;
      }
</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C5-L01.html">5. Capstone Project</a></li><li class="breadcrumb-item"><a href="./C5-L01.html"><span class="chapter-number">103</span>&nbsp; <span class="chapter-title">Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C5-L01.html">5. Capstone Project</a></li><li class="breadcrumb-item"><a href="./C5-L01.html"><span class="chapter-number">103</span>&nbsp; <span class="chapter-title">Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1</span></a></li></ol></nav>
      <div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">103</span>&nbsp; <span class="chapter-title">Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
            <p class="subtitle lead">Bayesian Statistics - Capstone Project</p>
                  <div>
        <div class="description">
          Capstone Project: Bayesian Conjugate Analysis for Autogressive Time Series Models
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Bayesian Statistics</div>
                <div class="quarto-category">Capstone Project</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Oren Bochman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 2, 2025</p>
      </div>
    </div>
    
      
    </div>
    

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>Time Series</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian Statistics</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">About</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Bayesian Statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Bayesian Statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">1. From Concept to Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Probability - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Paradigms of probability - M1L1HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bayes’ Theorem - M1L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Conditional Probability and Bayes’ Law - M1L2HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Probability and Bayes’ Theorem - M1L2HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Distributions - M1L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Variables - M1L3HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Homework on Distributions - M1L3HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Frequentist Inference - M2L4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Frequentist MLE - M2L3HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Bayesian Inference - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Homework on Likelihoods and MLEs - M2L5HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Homework on Bayesian Inference - M2L5HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Priors - M3L6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Homework Posterior Probabilities - M3L6HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">M3L7 - Binomial Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Homework on Priors - M2L7HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Poisson Data - M3L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Homework on Poisson Data - M3L8HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Beta Bernoulli - M3L8HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">M4L9 - Exponential Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Homework on Exponential Data - M4L9HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Normally distributed Data - M4L10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Homework on Normal Data - M4L10HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Non-Informative Priors - M4L11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Homework Alternative Priors - M4L11HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Brief Review of Regression - M4L12</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Homework Regression - M4L12HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Homework Regression - M4L12HW2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">2. Techniques and Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Statistical Modeling - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">M1L2 - Bayesian Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Monte Carlo estimation - M1L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Metropolis-Hastings - M2L4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Homework on the Metropolis-Hastings algorithm - M2L4HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Gibbs sampling - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Homework Gibbs-Sampling algorithm - M2L22HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Assessing Convergence - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Homework on the Gibbs-Sampling algorithm - M2L5HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Homework on M-H algorithm M2L5HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Linear regression - M3L7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Homework on Linear Regression Model Part 1 - M2L5HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Homework on Deviance information criterion - M2L5HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">ANOVA - M3L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Homework on ANOVA - M3L8HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">Homework on Multiple Factor ANOVA - M3L8HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Logistic regression - M3L9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Homework on Logistic Regression - M3L9HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Poisson regression - M4L10</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Homework on Poisson regression - M4L10HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Hierarchical modeling - M4L11</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Homework on Hierarchical Models - M4L11HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Homework on Non-Normal Hierarchical Models - M4L11HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Capstone Project - M4L12</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Homework on Predictive distributions and mixture models - M4L12HW1</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">3. Mixture Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Definitions of Mixture Models - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex1-Basic-Definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">Basic Concepts of Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex2-Gaussian-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">Mixtures of Gaussians</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex3-Zero-Inflated-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">Zero inflated distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex4-Def-mixture-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Definition of Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Likelihood functions for Mixture Models - M1L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">Homework The Likelihood function - M1L2HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">Homework Identifiability - M1L2HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Homework The likelihood function M1L2HW3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">Homework on simulating from a Poisson Mixture Model - M1L2HW4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">HW - Simulation of Poisson mixture model - M1L2HW5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">Homework Sim mixture of exponential distributions - M1L2HW6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">The EM algorithm for Mixture models - M2L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">The EM algorithm for Zero-Inflated Mixtures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">The EM algorithm for Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title">MCMC for Mixture Models - M4L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">74</span>&nbsp; <span class="chapter-title">The MCMC algorithm for Zero-Inflated Mixtures - M4L1HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">75</span>&nbsp; <span class="chapter-title">Markov chain Monte Carlo algorithms for Mixture Models - M4L1HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">76</span>&nbsp; <span class="chapter-title">Density Estimation - M4L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">77</span>&nbsp; <span class="chapter-title">Clustering - M4L6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">78</span>&nbsp; <span class="chapter-title">Classification - M4L7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">79</span>&nbsp; <span class="chapter-title">Old Faithful eruptions density estimation with the EM algorithm - M4L7HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">80</span>&nbsp; <span class="chapter-title">Old Faithful eruptions density estimation with the MCMC algorithms - M4L7HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L07-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">81</span>&nbsp; <span class="chapter-title">Homework on Bayesian Mixture Models for Classification of Banknotes - M4L7HW3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">82</span>&nbsp; <span class="chapter-title">Computational Considerations - M5L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">83</span>&nbsp; <span class="chapter-title">Computational considerations for Mixture Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">84</span>&nbsp; <span class="chapter-title">Determining the number of components - M5L9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">85</span>&nbsp; <span class="chapter-title">Homework on Bayesian Information Criteria (BIC) - M5L09HW1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">86</span>&nbsp; <span class="chapter-title">Homework on Estimating the number of components in Bayesian settings - M5L09HW2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">87</span>&nbsp; <span class="chapter-title">Homework on Estimating the partition structure in Bayesian models - M5L09HW3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L09-Ex4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">88</span>&nbsp; <span class="chapter-title">Homework on BIC for zero-inflated mixtures - M5L09HW4</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Time series Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">89</span>&nbsp; <span class="chapter-title">Week 0: Introductions to time series analysis and the AR(1) process</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">90</span>&nbsp; <span class="chapter-title">Stationarity, The ACF and the PCF M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">91</span>&nbsp; <span class="chapter-title">The AR(1) process: definitions and properties - M1L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">92</span>&nbsp; <span class="chapter-title">The AR(1): MLE and Bayesian inference - M1L3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">93</span>&nbsp; <span class="chapter-title">The AR(p) process - M2L4</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">94</span>&nbsp; <span class="chapter-title">Bayesian Inference in the AR(p) - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">95</span>&nbsp; <span class="chapter-title">Quiz: Spectral representation of the AR(p) - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">96</span>&nbsp; <span class="chapter-title">Graded Assignment: Bayesian analysis of an EEG dataset using an AR(p) - M2L5</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">97</span>&nbsp; <span class="chapter-title">Normal Dynamic Linear Models, Part 1 - M3L6</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">98</span>&nbsp; <span class="chapter-title">Bayesian Inference in the NDLM: Part 1 M3L7</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">99</span>&nbsp; <span class="chapter-title">Seasonal NDLMs M4L8</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">100</span>&nbsp; <span class="chapter-title">Bayesian Inference in the NDLM: Part 2 - M4L9</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">101</span>&nbsp; <span class="chapter-title">Final Project</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">102</span>&nbsp; <span class="chapter-title">Week 0: Feynman Notebook on Bayesian Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">5. Capstone Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L01.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">103</span>&nbsp; <span class="chapter-title">Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L01-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">104</span>&nbsp; <span class="chapter-title">Homework - Practice Quiz for Week 1 – M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L01-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">105</span>&nbsp; <span class="chapter-title">Homework - first-step-for-the-project – M1L1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">106</span>&nbsp; <span class="chapter-title">Model Selection Criteria - M2L2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C5-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">107</span>&nbsp; <span class="chapter-title">Bayesian location mixture of AR(p) models - M3L3</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Appendix: Notation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Appendix: Discrete Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Appendix: Continuous Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Appendix: Exponents &amp; Logarithms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Appendix: The Law of Large Numbers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Appendix: The Central Limit Theorem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Appendix: Conjugate Priors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Appendix: Link Function</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Appendix: Bayes by backprop</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Bayesian Books in R &amp; Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Appendix: Yule-Walker Equations &amp; Durbin-Levinson Recursion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Moore-Penrose Inversion &amp; Cholesky Decomposition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">Appendix: Inequalities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">N</span>&nbsp; <span class="chapter-title">Appendix: Wold’s theorem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">O</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-capstone-introduction" id="toc-sec-capstone-introduction" class="nav-link active" data-scroll-target="#sec-capstone-introduction"><span class="header-section-number">103.1</span> Introduction 🎥</a></li>
  <li><a href="#prerequisite-skill-checklist" id="toc-prerequisite-skill-checklist" class="nav-link" data-scroll-target="#prerequisite-skill-checklist"><span class="header-section-number">103.2</span> Prerequisite skill checklist 📖</a></li>
  <li><a href="#read-data-ℛ" id="toc-read-data-ℛ" class="nav-link" data-scroll-target="#read-data-ℛ"><span class="header-section-number">103.3</span> Read Data 📖 ℛ</a>
  <ul class="collapse">
  <li><a href="#earth-quake-data-ℛ" id="toc-earth-quake-data-ℛ" class="nav-link" data-scroll-target="#earth-quake-data-ℛ"><span class="header-section-number">103.3.1</span> Earth Quake Data ℛ</a></li>
  <li><a href="#google-search-index-data-ℛ" id="toc-google-search-index-data-ℛ" class="nav-link" data-scroll-target="#google-search-index-data-ℛ"><span class="header-section-number">103.3.2</span> Google Search Index Data ℛ</a></li>
  </ul></li>
  <li><a href="#model-formulation" id="toc-model-formulation" class="nav-link" data-scroll-target="#model-formulation"><span class="header-section-number">103.4</span> Model Formulation 🎥</a>
  <ul class="collapse">
  <li><a href="#arp-model-formulation" id="toc-arp-model-formulation" class="nav-link" data-scroll-target="#arp-model-formulation"><span class="header-section-number">103.4.1</span> AR(p) model formulation</a></li>
  <li><a href="#multiple-linear-regression-model-formulation" id="toc-multiple-linear-regression-model-formulation" class="nav-link" data-scroll-target="#multiple-linear-regression-model-formulation"><span class="header-section-number">103.4.2</span> Multiple Linear regression model formulation</a></li>
  </ul></li>
  <li><a href="#review-useful-distributions-ℛ" id="toc-review-useful-distributions-ℛ" class="nav-link" data-scroll-target="#review-useful-distributions-ℛ"><span class="header-section-number">103.5</span> Review: Useful Distributions 📖 ℛ</a>
  <ul class="collapse">
  <li><a href="#the-multivariate-normal-distribution" id="toc-the-multivariate-normal-distribution" class="nav-link" data-scroll-target="#the-multivariate-normal-distribution"><span class="header-section-number">103.5.1</span> The multivariate normal distribution</a></li>
  <li><a href="#the-gamma-and-inverse-gamma-distribution" id="toc-the-gamma-and-inverse-gamma-distribution" class="nav-link" data-scroll-target="#the-gamma-and-inverse-gamma-distribution"><span class="header-section-number">103.5.2</span> The gamma and inverse-gamma distribution</a></li>
  <li><a href="#the-multivariate-student-t-distribution" id="toc-the-multivariate-student-t-distribution" class="nav-link" data-scroll-target="#the-multivariate-student-t-distribution"><span class="header-section-number">103.5.3</span> The multivariate Student-t distribution</a></li>
  </ul></li>
  <li><a href="#sec-capstone-posterior" id="toc-sec-capstone-posterior" class="nav-link" data-scroll-target="#sec-capstone-posterior"><span class="header-section-number">103.6</span> Posterior Distribution Derivation 📖</a></li>
  <li><a href="#sec-capstone-ar-fitting" id="toc-sec-capstone-ar-fitting" class="nav-link" data-scroll-target="#sec-capstone-ar-fitting"><span class="header-section-number">103.7</span> AR model fitting example</a>
  <ul class="collapse">
  <li><a href="#bayesian-conjugate-analysis-of-ar-model" id="toc-bayesian-conjugate-analysis-of-ar-model" class="nav-link" data-scroll-target="#bayesian-conjugate-analysis-of-ar-model"><span class="header-section-number">103.7.1</span> Bayesian Conjugate Analysis of AR Model</a></li>
  <li><a href="#model-checking-by-in-sample-point-and-interval-estimation" id="toc-model-checking-by-in-sample-point-and-interval-estimation" class="nav-link" data-scroll-target="#model-checking-by-in-sample-point-and-interval-estimation"><span class="header-section-number">103.7.2</span> Model Checking by In-sample Point and Interval Estimation</a></li>
  </ul></li>
  <li><a href="#sec-capstone-prediction" id="toc-sec-capstone-prediction" class="nav-link" data-scroll-target="#sec-capstone-prediction"><span class="header-section-number">103.8</span> Prediction for AR Models 🎥</a></li>
  <li><a href="#sec-capstone-ar-prediction-example" id="toc-sec-capstone-ar-prediction-example" class="nav-link" data-scroll-target="#sec-capstone-ar-prediction-example"><span class="header-section-number">103.9</span> AR model prediction example 📖 ℛ</a></li>
  <li><a href="#sec-capstone-extended-ar-model" id="toc-sec-capstone-extended-ar-model" class="nav-link" data-scroll-target="#sec-capstone-extended-ar-model"><span class="header-section-number">103.10</span> Extended AR model 📖</a>
  <ul class="collapse">
  <li><a href="#extending-ar-models-for-complex-time-series-data" id="toc-extending-ar-models-for-complex-time-series-data" class="nav-link" data-scroll-target="#extending-ar-models-for-complex-time-series-data"><span class="header-section-number">103.10.1</span> Extending AR Models for Complex Time Series Data</a></li>
  <li><a href="#autoregressive-moving-average-models-arma" id="toc-autoregressive-moving-average-models-arma" class="nav-link" data-scroll-target="#autoregressive-moving-average-models-arma"><span class="header-section-number">103.10.2</span> Autoregressive Moving Average Models (ARMA)</a></li>
  <li><a href="#structure-of-arma-models" id="toc-structure-of-arma-models" class="nav-link" data-scroll-target="#structure-of-arma-models"><span class="header-section-number">103.10.3</span> Structure of ARMA models</a></li>
  <li><a href="#smoothing-and-differencing" id="toc-smoothing-and-differencing" class="nav-link" data-scroll-target="#smoothing-and-differencing"><span class="header-section-number">103.10.4</span> Smoothing and Differencing</a></li>
  <li><a href="#epilogue" id="toc-epilogue" class="nav-link" data-scroll-target="#epilogue"><span class="header-section-number">103.10.5</span> Epilogue</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">






<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Learning Objectives
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul class="task-list">
<li><label><input type="checkbox" checked="">Explain the procedure for sampling from the posterior distribution, and code in R to achieve it.</label></li>
<li><label><input type="checkbox" checked="">Calculate the posterior distributions of model parameters.</label></li>
<li><label><input type="checkbox" checked="">Describe the AR models under Bayesian conjugate setting. Specify the likelihood function and prior distribution.</label></li>
</ul>
</div>
</div>
</div>
<section id="sec-capstone-introduction" class="level2" data-number="103.1">
<h2 data-number="103.1" class="anchored" data-anchor-id="sec-capstone-introduction"><span class="header-section-number">103.1</span> Introduction 🎥</h2>
<p>This is a capstone project for the Bayesian Statistics course. The instructor is a doctoral student Chi Joe Kao. I should point out that while he doesn’t have the pedigree of the other instructors, he was on one of the best explainers of the complex material. One downside is that is english is a little broken but I’ve had much worse. However you can see from the first slide that it covers the key concepts in a clear and concise manner leaving out very little. Also it seems to me that Chi Joe Kao still remembers how hard this material is at first glance which is a great asset for teaching it effectively. You may notice that we revisit some old material this is because this course makes a great effort to be self contained.</p>
<p>Many parts of this course are steps towards completing the capstone project. And perhaps just as exciting we will also cover a new type of model - a mixture version of the autoregressive model from the previous course.</p>
<p>We will cover the Bayesian conjugate analysis for autoregressive time series models. This sounds a bit bombastic, all it means is that we will be using a likelihood and a prior that leads to a conjugate posterior, keeping everything within one distributional family!</p>
</section>
<section id="prerequisite-skill-checklist" class="level2" data-number="103.2">
<h2 data-number="103.2" class="anchored" data-anchor-id="prerequisite-skill-checklist"><span class="header-section-number">103.2</span> Prerequisite skill checklist 📖</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Prerequisite skill checklist
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="bayesian-statistics" class="level3" data-number="103.2.1">
<h3 data-number="103.2.1" class="anchored" data-anchor-id="bayesian-statistics"><span class="header-section-number">103.2.1</span> Bayesian Statistics</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Interpret and specify the components of Bayesian statistical models: likelihood, prior, posterior.</label></li>
<li><label><input type="checkbox" checked="">Explain the basics of sampling algorithms, including sampling from standard distributions and using MCMC to sample from non-standard posterior distributions.</label></li>
<li><label><input type="checkbox" checked="">Assess the performance of a statistical model and compare competing models using posterior samples.</label></li>
<li><label><input type="checkbox" checked="">Coding in R to achieve the above tasks.</label></li>
</ul>
</section>
<section id="mixture-models" class="level3" data-number="103.2.2">
<h3 data-number="103.2.2" class="anchored" data-anchor-id="mixture-models"><span class="header-section-number">103.2.2</span> Mixture Models</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Define mixture model.</label></li>
<li><label><input type="checkbox" checked="">Explain the likelihood function associated with a random sample from a mixture distribution.</label></li>
<li><label><input type="checkbox" checked="">Derive Markov chain Monte Carlo algorithms for fitting mixture models.</label></li>
<li><label><input type="checkbox" checked="">Coding in R to achieve the above tasks.</label></li>
</ul>
</section>
<section id="time-series-analysis" class="level3" data-number="103.2.3">
<h3 data-number="103.2.3" class="anchored" data-anchor-id="time-series-analysis"><span class="header-section-number">103.2.3</span> Time Series Analysis</h3>
<ul class="task-list">
<li><label><input type="checkbox" checked="">Define time series and stochastic processes (univariate, discrete-time, equally-spaced)</label></li>
<li><label><input type="checkbox" checked="">Define strong and weak stationarity</label></li>
<li><label><input type="checkbox" checked="">Define the auto-covariance function, the auto-correlation function (ACF), and the partial autocorrelation function (PACF)</label></li>
<li><label><input type="checkbox" checked="">Definition of the general class of autoregressive processes of order p.</label></li>
</ul>
</section>
</div>
</div>
</div>
</section>
<section id="read-data-ℛ" class="level2" data-number="103.3">
<h2 data-number="103.3" class="anchored" data-anchor-id="read-data-ℛ"><span class="header-section-number">103.3</span> Read Data 📖 ℛ</h2>
<section id="earth-quake-data-ℛ" class="level3" data-number="103.3.1">
<h3 data-number="103.3.1" class="anchored" data-anchor-id="earth-quake-data-ℛ"><span class="header-section-number">103.3.1</span> Earth Quake Data ℛ</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## read data, you need to make sure the data file is in your current working directory&nbsp;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>earthquakes.dat <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"data/earthquakes.txt"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>earthquakes.dat<span class="sc">$</span>Quakes<span class="ot">=</span><span class="fu">as.numeric</span>(earthquakes.dat<span class="sc">$</span>Quakes)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>y.dat<span class="ot">=</span>earthquakes.dat<span class="sc">$</span>Quakes[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="do">## this is the training data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>y.new<span class="ot">=</span>earthquakes.dat<span class="sc">$</span>Quakes[<span class="dv">101</span><span class="sc">:</span><span class="dv">103</span>] <span class="do">## this is the test data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="google-search-index-data-ℛ" class="level3" data-number="103.3.2">
<h3 data-number="103.3.2" class="anchored" data-anchor-id="google-search-index-data-ℛ"><span class="header-section-number">103.3.2</span> Google Search Index Data ℛ</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## read data, you need to make sure the data file is in your current working directory&nbsp;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>covid.dat <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"data/GoogleSearchIndex.txt"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>covid.dat<span class="sc">$</span>Week<span class="ot">=</span><span class="fu">as.Date</span>(<span class="fu">as.character</span>(covid.dat<span class="sc">$</span>Week),<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>y.dat<span class="ot">=</span>covid.dat<span class="sc">$</span>covid[<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>] <span class="do">## this is the training data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>y.new<span class="ot">=</span>covid.dat<span class="sc">$</span>covid[<span class="dv">58</span><span class="sc">:</span><span class="dv">60</span>] <span class="do">## this is the test data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-formulation" class="level2 page-columns page-full" data-number="103.4">
<h2 data-number="103.4" class="anchored" data-anchor-id="model-formulation"><span class="header-section-number">103.4</span> Model Formulation 🎥</h2>

<div class="no-row-height column-margin column-container"><div id="fig-capstone-model-formulation1" class="quarto-float quarto-figure quarto-figure-center anchored" data-group="slides">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-capstone-model-formulation1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/C5-L01-sl01.png" class="lightbox" data-gallery="slides" title="Figure&nbsp;103.1: AR(p) Model Formulation 1"><img src="images/C5-L01-sl01.png" class="img-fluid figure-img" style="width:53mm"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-capstone-model-formulation1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;103.1: AR(p) Model Formulation 1
</figcaption>
</figure>
</div><div id="fig-capstone-model-formulation2" class="quarto-float quarto-figure quarto-figure-center anchored" data-group="slides">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-capstone-model-formulation2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/C5-L01-sl02.png" class="lightbox" data-gallery="slides" title="Figure&nbsp;103.2: Multiple Regression Formulation"><img src="images/C5-L01-sl02.png" class="img-fluid figure-img" style="width:53mm"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-capstone-model-formulation2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;103.2: Multiple Regression Formulation
</figcaption>
</figure>
</div></div>
<section id="arp-model-formulation" class="level3" data-number="103.4.1">
<h3 data-number="103.4.1" class="anchored" data-anchor-id="arp-model-formulation"><span class="header-section-number">103.4.1</span> AR(p) model formulation</h3>
$$ y_t t
<span class="math display">\begin{cases}  T&gt;p \\ T=n+p \\ n&gt;1 \end{cases}</span>
<p>$$</p>
<p><em>AR(p)</em></p>
<p><span id="eq-capstone-ar-model"><span class="math display">
\begin{aligned}
y_t = \sum_{j=1}^p \phi_j y_{t-j} + \underbrace {\varepsilon_t}_{\text{innovations}}
\qquad
\begin{cases}
\varepsilon_t \perp y_\tau\ &amp; \forall \tau&lt;t \\
\varepsilon_t \stackrel{iid}{\sim} \mathcal{N}(0,\nu)
\end{cases}
\end{aligned}
\tag{103.1}</span></span></p>
<p><span class="math display">
\begin{aligned}
y_t &amp;= \sum_{j=1}^p \phi_j y_{t-j} +  {\varepsilon_t} &amp; (\text{ normality of innovation})\\
    &amp;= \sum_{j=1}^p \phi_j y_{t-j} +  \mathcal N(0,\nu) &amp; (\text{linearity}) \\
    &amp;= \mathcal{N}(\sum_{j=1}^p \phi_j y_{t-j},\nu) &amp; (\text{rewrite using design matrix})\\
    &amp;= \mathcal{N}(f_t \boldsymbol \phi,\nu) \\
\end{aligned}
</span></p>
<p><span id="eq-capstone-ar-likelihood"><span class="math display">
\begin{aligned}
\mathbb{P}r(y_{1:T}\mid \phi_1, \ldots, \phi_p, \nu )
&amp;= \mathbb{P}r(y_{p+1:T})\prod_{t=p+1}^T \mathbb{P}r(y_t \mid y_{t-1},\ldots,y_{t-p},\phi_1,\ldots,\phi_p,\nu) \\
&amp;= \prod_{t=p+1}^T \mathcal{N}(f_t\phi,\nu) \\
&amp;= \mathcal{N}(F^\top \boldsymbol{\phi},\nu\mathbb{I}_n) \\
\end{aligned}
\tag{103.2}</span></span></p>
<ul>
<li>where
<ul>
<li><span class="math inline">\boldsymbol{\phi}=(\phi_1,\ldots,\phi_p)^\top</span> is the vector of parameters, and</li>
<li><span class="math inline">\nu</span> is the scale parameter. and</li>
<li><span class="math inline">F</span> is the design matrix</li>
</ul></li>
</ul>
<p><span id="eq-capstone-design-matrix"><span class="math display">
F= \begin{pmatrix}
y_{p} &amp; y_{p+1} &amp; \cdots &amp; y_{T-1} \\
y_{p-1} &amp; y_{p} &amp; \cdots &amp; y_{T-2} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
y_{1} &amp; y_{2} &amp; \cdots &amp; y_{T-p}
\end{pmatrix}
\tag{103.3}</span></span></p>
<hr>
</section>
<section id="multiple-linear-regression-model-formulation" class="level3" data-number="103.4.2">
<h3 data-number="103.4.2" class="anchored" data-anchor-id="multiple-linear-regression-model-formulation"><span class="header-section-number">103.4.2</span> Multiple Linear regression model formulation</h3>
<p><span class="math display">
y=(y_{p+1},\ldots,y_T) \in \mathbb{R}^n
</span></p>
<p><span class="math display">
y = F^\top \boldsymbol{\phi} + \varepsilon \qquad \varepsilon \sim \mathcal{N}(0,\nu\mathbb{I}_n)
</span> <span class="math display">
\mathbb{P}r(y \mid \boldsymbol{\phi},\nu) = \mathcal{N}(F^\top \boldsymbol{\phi},\nu\mathbb{I}_n)
</span> <span id="eq-capstone-model-specification"><span class="math display">
\mathbf{y}\sim \mathcal{N}(\mathbf{F}^\top \boldsymbol{\phi},\nu\mathbf{I}_n),\quad \boldsymbol{\phi}\sim \mathcal{N}(\mathbf{m}_0,\nu\mathbf{C}_0),\quad \nu\sim IG(\frac{n_0}{2},\frac{d_0}{2})
\tag{103.4}</span></span></p>
<p>where:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Question
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Suppose we have a multiple linear regression model <span class="math inline">y=\mathbf{X}\beta+\varepsilon</span> where <span class="math inline">\varepsilon \sim\mathcal{N}(0,\sigma^2I)</span> what is the proper conditional conjugate prior for parameters <span class="math inline">\beta</span> and <span class="math inline">\sigma^2</span>?</p>
<p>Solution</p>
<ul class="task-list">
<li><label><input type="checkbox"><span class="math inline">\mathbb{p}r(\beta,\sigma^2) \quad \propto \frac{1}{σ^2}</span></label></li>
<li><label><input type="checkbox"><span class="math inline">\mathbb{p}r(\beta,\sigma^2) \quad \propto  \mathcal{N}(\beta \mid \mu,\Sigma)\mathcal{IG}(\sigma^2\mid a,b)</span></label></li>
<li><label><input type="checkbox"><span class="math inline">\mathbb{p}r(\beta,\sigma^2) \quad \propto  \mathcal{N}(\beta \mid \mu,\sigma^2\Sigma)\mathcal{IG}(σ^2\mid a,b)</span></label></li>
<li><label><input type="checkbox"><span class="math inline">\mathbb{p}r(\beta,\sigma^2) \quad \propto  1</span></label></li>
</ul>
</div>
</div>
</div>
<p>I got this right the first time by eyeballing it. So I’m not sure why it is right other than the the others are missing something.</p>
</section>
</section>
<section id="review-useful-distributions-ℛ" class="level2" data-number="103.5">
<h2 data-number="103.5" class="anchored" data-anchor-id="review-useful-distributions-ℛ"><span class="header-section-number">103.5</span> Review: Useful Distributions 📖 ℛ</h2>
<p>This is material a review of three distributions we have seen frequently in relation to modeling with Normal distribution - our default model in many cases.</p>
<ul>
<li>The multivariate normal distribution is used to model multiple correlated variables</li>
<li>The inverse-gamma distribution is used as a prior for the variance for Normally distributed data when the mean is known and the variance is unknown.</li>
<li>The multivariate Student-t distribution is a robust alternative to the multivariate normal distribution when the data has outliers or is not normally distributed.</li>
</ul>
<section id="the-multivariate-normal-distribution" class="level3" data-number="103.5.1">
<h3 data-number="103.5.1" class="anchored" data-anchor-id="the-multivariate-normal-distribution"><span class="header-section-number">103.5.1</span> The multivariate normal distribution</h3>
<p>A <span class="math inline">k</span>-dimensional random vector <span class="math inline">x=(x_1, \cdots, x_k)^T</span> that follows a multivariate normal distribution with mean <span class="math inline">\mu</span> and variance-covariance matrix <span class="math inline">\Sigma</span> is denoted as <span class="math inline">x \sim \mathcal{N}(\mu, \Sigma)</span> or <span class="math inline">p(x) = \mathcal{N}(x \mid \mu, \Sigma)</span> has a density function given by: <span id="eq-multivariate-normal-pdf"><span class="math display">
p(\mathbf{x})=(2\pi)^{-k/2}|\boldsymbol{\Sigma}|^{-1/2}\exp[-\frac{1}{2}(\mathbf{x}-\boldsymbol{\mu})^T\boldsymbol{\Sigma}^{-1}(\mathbf{x}-\boldsymbol{\mu})]
\tag{103.5}</span></span></p>
<p>where <span class="math inline">\mathbf{x}</span> is a <span class="math inline">k</span>-dimensional vector, <span class="math inline">|\boldsymbol{\Sigma}|</span> is the determinant of the covariance matrix, and <span class="math inline">\boldsymbol{\Sigma}^{-1}</span> is the inverse of the covariance matrix.</p>
</section>
<section id="the-gamma-and-inverse-gamma-distribution" class="level3" data-number="103.5.2">
<h3 data-number="103.5.2" class="anchored" data-anchor-id="the-gamma-and-inverse-gamma-distribution"><span class="header-section-number">103.5.2</span> The gamma and inverse-gamma distribution</h3>
<p>A random variable <span class="math inline">x</span> that follows a gamma distribution with shape parameter <span class="math inline">\alpha</span> and inverse scale parameter <span class="math inline">\beta</span> , denoted as <span class="math inline">x \sim \mathcal{G}(\alpha, \beta)</span>, or <span class="math inline">\mathbb{P}r(x) = \mathcal{G}(x \mid \alpha, \beta)</span>, has a density of the form <span id="eq-gamma-pdf"><span class="math display">
\mathbb{P}r(x)=\frac{\beta^{\alpha}}{\Gamma(\alpha)}x^{\alpha-1}e^{-\beta x},\quad x&gt;0
\tag{103.6}</span></span></p>
<p>where <span class="math inline">\alpha</span> is the shape parameter, <span class="math inline">\beta</span> is the rate parameter, and <span class="math inline">\Gamma(\alpha)</span> is the gamma function evaluated at <span class="math inline">\alpha</span>.</p>
<p>In addition, <span class="math display">
\mathbb{E}[x]=\frac{\alpha}{\beta}  \qquad \mathbb{V}ar[x]=\frac{\alpha}{\beta^2}
</span></p>
<p>If <span class="math inline">1/x \sim G(\alpha, \beta)</span>, then <span class="math inline">x</span> follows an inverse-gamma distribution <span class="math inline">X\sim \mathcal{IG}(\alpha, \beta)</span>. or <span class="math inline">p(x) = \mathcal{IG}(X\mid \alpha, \beta)</span>. with</p>
<p><span id="eq-inverse-gamma-pdf"><span class="math display">
\mathbb{P}r(x)=\frac{\beta^{\alpha}}{\Gamma(\alpha)}x^{-(\alpha+1)}e^{-\beta/x},\quad x&gt;0
\tag{103.7}</span></span></p>
<p>where <span class="math inline">\alpha</span> is the shape parameter, <span class="math inline">\beta</span> is the scale parameter, and <span class="math inline">\Gamma(\alpha)</span> is the gamma function evaluated at <span class="math inline">\alpha</span>.</p>
<p>in this case</p>
<p><span id="eq-inverse-gamma-moments"><span class="math display">
\mathbb{E}[x]=\frac{\beta}{\alpha-1} \quad \text{for } \alpha &gt; 1 \qquad
\mathbb{V}ar[x]=\frac{\beta^2}{(\alpha-1)^2(\alpha-2)} \quad \text{for } \alpha &gt; 2
\tag{103.8}</span></span></p>
</section>
<section id="the-multivariate-student-t-distribution" class="level3" data-number="103.5.3">
<h3 data-number="103.5.3" class="anchored" data-anchor-id="the-multivariate-student-t-distribution"><span class="header-section-number">103.5.3</span> The multivariate Student-t distribution</h3>
<p>A random vector <span class="math inline">x</span> of dimension <span class="math inline">k</span> follows a multivariate Student-t distribution with <span class="math inline">\nu</span> degrees of freedom, location <span class="math inline">\boldsymbol{\mu}</span>, and scale matrix <span class="math inline">\boldsymbol{\Sigma}</span>, denoted as <span class="math inline">x \sim T_\nu(\boldsymbol{\mu}, \boldsymbol{\Sigma})</span>, if its density is given by:</p>
<p><span class="math display">
\mathbb{P}r(\mathbf{x})=\frac{\Gamma(\frac{\nu+k}{2})}{\Gamma(\frac{\nu}{2})(\nu\pi)^{k/2}}|\boldsymbol{\Sigma}|^{-1/2}[1+\frac{1}{\nu}(\mathbf{x}-\boldsymbol{\mu})^T\boldsymbol{\Sigma}^{-1}(\mathbf{x}-\boldsymbol{\mu})]^{-(\nu+k)/2}
</span></p>
<p><span class="math display">
\mathbb{E}[x]=\mu \text{ for } \nu&gt;1  \qquad \mathbb{V}ar[x]=\frac{\nu\Sigma}{\nu−2} \quad \text{for } \nu&gt;2
</span></p>
</section>
</section>
<section id="sec-capstone-posterior" class="level2" data-number="103.6">
<h2 data-number="103.6" class="anchored" data-anchor-id="sec-capstone-posterior"><span class="header-section-number">103.6</span> Posterior Distribution Derivation 📖</h2>
<p>In this lesson, I present the derivation of the posterior distributions for <span class="math inline">\boldsymbol{\phi}</span> and <span class="math inline">\nu</span> for the following model:</p>
<p><span id="eq-model-specification"><span class="math display">
\mathbf{y}\sim \mathcal{N}(\mathbf{F}^\top \boldsymbol{\phi},\nu\mathbf{I}_n),\quad \boldsymbol{\phi}\sim \mathcal{N}(\mathbf{m}_0,\nu\mathbf{C}_0),\quad \nu\sim IG(\frac{n_0}{2},\frac{d_0}{2})
\tag{103.9}</span></span></p>
<p>where :</p>
<ul>
<li><span class="math inline">\mathbf{y}</span> is the observed data,</li>
<li><span class="math inline">\mathbf{F}</span> is the design matrix,</li>
<li><span class="math inline">\boldsymbol{\phi}</span> is the vector of parameters,</li>
<li><span class="math inline">\nu</span> is the scale parameter,</li>
<li><span class="math inline">\mathbf{m}_0</span> is the prior mean of <span class="math inline">\boldsymbol{\phi}</span>,</li>
<li><span class="math inline">\mathbf{C}_0</span> is the prior covariance matrix of <span class="math inline">\boldsymbol{\phi}</span>,</li>
<li><span class="math inline">n_0</span> and <span class="math inline">d_0</span> are the shape and scale parameters of the inverse-gamma prior for <span class="math inline">\nu</span>.</li>
</ul>
<p>i.e.&nbsp;we start with a Normal likelihood with a Normal prior for <span class="math inline">\boldsymbol{\phi}</span> and an inverse-gamma prior for <span class="math inline">\nu</span>. Since we call the parameters <span class="math inline">\phi</span> and not <span class="math inline">\theta</span> it suggests that this isn’t a typical linear regression but rather an AR(p) model with</p>
<p>I recall that we already did this derivation in the first course by Herbert Lee.</p>
<p><!-- TODO: link the relevant section in the first course as it is unclear what this particular normal model means w.r.t. our knowledge of the mean and variance --></p>
<p>Using Bayes theorem, we have :</p>
<p><span id="eq-posterior-derivation-1"><span class="math display">
\begin{aligned}
\mathbb{p}r(\boldsymbol{\phi},\nu\mid\mathbf{y}) &amp; \propto \mathbb{p}r(\mathbf{y} \mid \boldsymbol{\phi},\nu)\mathbb{p}r(\boldsymbol{\phi}\mid\nu)\mathbb{p}r(\nu)\\
&amp;\propto \nu^{-n/2}\exp \left(-\frac{(\mathbf{y}-\mathbf{F}^T\boldsymbol{\phi})^T(\mathbf{y}-\mathbf{F}^T\boldsymbol{\phi})}{2\nu}\right)\\
&amp;\quad \times \nu^{-p/2}\exp\left(-\frac{(\boldsymbol{\phi}-\mathbf{m}_0)^T\mathbf{C}_0^{-1}(\boldsymbol{\phi}-\mathbf{m}_0)}{2\nu}\right)\\
&amp;\quad \times \nu^{-(\frac{n_0}{2}+1)}\exp\left(-\frac{d_0}{2\nu}\right)\\
&amp;\propto \nu^{-(\frac{n^*}{2}+1)}\exp\left(-\frac{d^*}{2\nu}\right)\\
&amp;\quad \times \nu^{-p/2}\exp\left(-\frac{(\boldsymbol{\phi}-\mathbf{m})^T\mathbf{C}^{-1}(\boldsymbol{\phi}-\mathbf{m})}{2\nu}\right)\\
&amp;\propto \mathbb{p}r(\nu\mid\mathbf{y})\mathbb{p}r(\boldsymbol{\phi}\mid\nu,\mathbf{y})
\end{aligned}
\tag{103.10}</span></span></p>
<p>where</p>
<p><span id="eq-posterior-derivation"><span class="math display">
\begin{aligned}
\mathbf{e}&amp;=\mathbf{y}-\mathbf{F}^T\mathbf{m}_0,
&amp;\mathbf{Q}&amp;=\mathbf{F}^T\mathbf{C}_0\mathbf{F}+\mathbf{I}_n,\quad
\mathbf{A}=\mathbf{C}_0\mathbf{F}\mathbf{Q}^{-1}\\
\mathbf{m}&amp;=\mathbf{m}_0+\mathbf{A}\mathbf{e},\quad
&amp;\mathbf{C}&amp;=\mathbf{C}_0-\mathbf{A}\mathbf{Q}\mathbf{A}^{T}\\
n^* &amp;=n+n_0,\quad
&amp;d^*&amp;=(y-\mathbf{F}^T\mathbf{m}_0)^T\mathbf{Q}^{-1}(y-\mathbf{F}^T\mathbf{m}_0)+d_0
\end{aligned}
\tag{103.11}</span></span></p>
<p>Therefore, we have the posterior distribution of <span class="math inline">\boldsymbol{\phi}</span> and <span class="math inline">\nu</span> as:</p>
<p><span id="eq-posterior-distribution"><span class="math display">
\begin{aligned}
\mathbb{P}r(\boldsymbol{\phi},\nu \mid \mathbf{y}) &amp;=\mathbb{P}r(\boldsymbol{\phi} \mid \nu,\mathbf{y})\mathbb{P}r(\nu\mid \mathbf{y}) \\
&amp;=\mathcal{N}(\boldsymbol{\phi}\mid \mathbf{m},\nu\mathbf{C})\ \mathcal{IG}(\nu\mid \frac{n^*}{2},\frac{d^*}{2}) \end{aligned}
\tag{103.12}</span></span></p>
<p>To get the <span class="math inline">s</span><sup>th</sup> sample of <span class="math inline">(\boldsymbol{\phi}^{(s)},\nu^{(s)})</span> from the joint posterior distribution of <span class="math inline">\boldsymbol{\phi}</span> and <span class="math inline">\nu</span>, we first sample <span class="math inline">\nu^{(s)}</span> from <span class="math inline">\mathcal{IG}(\frac{n^*}{2},\frac{d^*}{2})</span>, then sample <span class="math inline">\boldsymbol{\phi}^{(s)}</span> from <span class="math inline">\mathcal{N}(\boldsymbol{m},\nu^{(s)}\boldsymbol{C})</span>.</p>
<p><strong>One can also obtain posterior samples</strong> of <span class="math inline">\boldsymbol{\phi}</span> by directly sampling from its <strong>marginal posterior distribution.</strong> Integrate out <span class="math inline">\nu</span> from the joint posterior distribution, we have <span class="math inline">\mathbb{P}r(\boldsymbol{\phi} \mid \mathbf{y})=T_{n^*}(\boldsymbol{m},\frac{d^*}{n^*}\boldsymbol{C})</span>.</p>
<p>Denote the <span class="math inline">s</span><sup>th</sup> posterior sample of <span class="math inline">\boldsymbol{\phi}</span> and <span class="math inline">\nu</span> as <span class="math inline">\boldsymbol{\phi}^{(s)}</span> and <span class="math inline">\nu^{(s)}</span>, we can obtain the corresponding <span class="math inline">i</span><sup>th</sup> posterior sample of <span class="math inline">\mathbf{y}^{(s)}</span> by sampling from <span class="math inline">\mathcal{N}(\mathbf{F}^\top \boldsymbol{\phi}^{(s)},\nu^{(s)})</span>. Therefore, we can obtain the posterior point and interval estimates for the time series.</p>
</section>
<section id="sec-capstone-ar-fitting" class="level2" data-number="103.7">
<h2 data-number="103.7" class="anchored" data-anchor-id="sec-capstone-ar-fitting"><span class="header-section-number">103.7</span> AR model fitting example</h2>
<section id="bayesian-conjugate-analysis-of-ar-model" class="level3" data-number="103.7.1">
<h3 data-number="103.7.1" class="anchored" data-anchor-id="bayesian-conjugate-analysis-of-ar-model"><span class="header-section-number">103.7.1</span> Bayesian Conjugate Analysis of AR Model</h3>
<section id="simulate-data" class="level4" data-number="103.7.1.1">
<h4 data-number="103.7.1.1" class="anchored" data-anchor-id="simulate-data"><span class="header-section-number">103.7.1.1</span> Simulate Data</h4>
<p>We give an example about fitting an <span class="math inline">AR(2)</span> model using simulated data. We simulate 200 observations from the following model:</p>
<p><span id="eq-ar2-model"><span class="math display">
y_t=0.5y_{t-1}+0.4y_{t-2}+\varepsilon_t,\quad \varepsilon_t\sim N(0,1)
\tag{103.13}</span></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>phi1<span class="ot">=</span><span class="fl">0.5</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>phi2<span class="ot">=</span><span class="fl">0.4</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>v<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>y.sample<span class="ot">=</span><span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">200</span>,<span class="at">model=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">ar=</span><span class="fu">c</span>(phi1,phi2),<span class="at">sd=</span><span class="fu">sqrt</span>(v)))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(y.sample,<span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">italic</span>(y)[<span class="fu">italic</span>(t)]),<span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">italic</span>(t)),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-capstone-simulate-data" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-capstone-simulate-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C5-L01_files/figure-html/fig-capstone-simulate-data-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;103.3: Simulated AR(2) data"><img src="C5-L01_files/figure-html/fig-capstone-simulate-data-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-capstone-simulate-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;103.3: Simulated AR(2) data
</figcaption>
</figure>
</div>
</div>
</div>
<p>Now, we perform a prior sensitivity analysis for the choice of hyperparameters in prior distribution. We choose three sets of prior hyperparameters and plot the posterior distribution for <span class="math inline">\mathbb{P}r(\phi_1, \phi_2 \mid y_{1:n})</span> below. The three sets of prior hyperparameters are :</p>
<p><span class="math display">
\begin{aligned}
&amp; (1) \quad \mathbf{m}_0=(0,0)^T,\mathbf{C}_0=I_2,n_0=2,d_0=2\\
&amp; (2) \quad \mathbf{m}_0=(0,0)^T,\mathbf{C}_0=I_2,n_0=6,d_0=1\\
&amp; (3) \quad \mathbf{m}_0=(-0.5,-0.5)^T,\mathbf{C}_0=I_2,n_0=6,d_0=1
\end{aligned}
</span></p>
<p>In the plot, the left, middle and right panel correspond to the first, second and last sets of hyperparameters, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## prior sensitivity analysis</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## plot posterior distribution of phi_1 and phi_2 on a grid </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fields)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spam</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Spam version 2.11-1 (2025-01-20) is loaded.
Type 'help( Spam)' or 'demo( spam)' for a short introduction 
and overview of this package.
Help for individual functions is also obtained by adding the
suffix '.spam' to the function name, e.g. 'help( chol.spam)'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'spam'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    backsolve, forwardsolve</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Try help(fields) to get started.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'fields'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:leaflet':

    addLegend</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mvtnorm'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:spam':

    rmvnorm, rmvt</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## generate grid</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>coordinates_1<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>coordinates_2<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>coordinates<span class="ot">=</span><span class="fu">expand.grid</span>(coordinates_1,coordinates_2)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>coordinates<span class="ot">=</span><span class="fu">as.matrix</span>(coordinates)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="do">## set up</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="dv">100</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="dv">2</span>  <span class="do">## order of AR process</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>n.all<span class="ot">=</span><span class="fu">length</span>(y.sample) <span class="do">## T, total number of data</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span><span class="fu">matrix</span>(y.sample[<span class="dv">3</span><span class="sc">:</span>n.all],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>Fmtx<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(y.sample[<span class="dv">2</span><span class="sc">:</span>(n.all<span class="dv">-1</span>)],y.sample[<span class="dv">1</span><span class="sc">:</span>(n.all<span class="dv">-2</span>)]),<span class="at">nrow=</span>p,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">length</span>(Y)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="do">## function to compute parameters for the posterior distribution of phi_1 and phi_2</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="do">## the posterior distribution of phi_1 and phi_2 is a multivariate t distribution</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>cal_parameters<span class="ot">=</span><span class="cf">function</span>(<span class="at">m0=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">nrow=</span><span class="dv">2</span>),<span class="at">C0=</span><span class="fu">diag</span>(<span class="dv">2</span>),n0,d0){</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  e<span class="ot">=</span>Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  Q<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">+</span><span class="fu">diag</span>(n)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  Q.inv<span class="ot">=</span><span class="fu">chol2inv</span>(<span class="fu">chol</span>(Q))  <span class="do">## similar as solve, but more robust</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  A<span class="ot">=</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">%*%</span>Q.inv</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span>m0<span class="sc">+</span>A<span class="sc">%*%</span>e</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  C<span class="ot">=</span>C0<span class="sc">-</span>A<span class="sc">%*%</span>Q<span class="sc">%*%</span><span class="fu">t</span>(A)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  n.star<span class="ot">=</span>n<span class="sc">+</span>n0</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  d.star<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">%*%</span>Q.inv<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">+</span>d0</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  params<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">1</span>]]<span class="ot">=</span>n.star</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">2</span>]]<span class="ot">=</span>d.star</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">3</span>]]<span class="ot">=</span>m</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">4</span>]]<span class="ot">=</span>C</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(params)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="do">## evaluate density at the grid points</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>get_density<span class="ot">=</span><span class="cf">function</span>(param){</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  location<span class="ot">=</span>param[[<span class="dv">3</span>]]</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  scale<span class="ot">=</span><span class="fu">as.numeric</span>(param[[<span class="dv">2</span>]]<span class="sc">/</span>param[[<span class="dv">1</span>]])<span class="sc">*</span>param[[<span class="dv">4</span>]]</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  density<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,N<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N<span class="sc">^</span><span class="dv">2</span>) {</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    xi<span class="ot">=</span>coordinates[i,]</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    density[i]<span class="ot">=</span><span class="fu">dmvt</span>(xi,<span class="at">delta=</span>location,<span class="at">sigma=</span>scale,<span class="at">df=</span>param[[<span class="dv">1</span>]])</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  density_expand<span class="ot">=</span><span class="fu">matrix</span>(density,<span class="at">nrow=</span>N)</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(density_expand)</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate density for three sets of hyperparameters</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>params1<span class="ot">=</span><span class="fu">cal_parameters</span>(<span class="at">n0=</span><span class="dv">2</span>,<span class="at">d0=</span><span class="dv">2</span>)</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>params2<span class="ot">=</span><span class="fu">cal_parameters</span>(<span class="at">n0=</span><span class="dv">6</span>,<span class="at">d0=</span><span class="dv">1</span>)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>params3<span class="ot">=</span><span class="fu">cal_parameters</span>(<span class="at">m0=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="sc">-</span><span class="fl">0.5</span>),<span class="at">nrow=</span><span class="dv">2</span>),<span class="at">n0=</span><span class="dv">6</span>,<span class="at">d0=</span><span class="dv">1</span>)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>col.list<span class="ot">=</span><span class="fu">matlab.like2</span>(N)</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>Z<span class="ot">=</span><span class="fu">list</span>(<span class="fu">get_density</span>(params1),<span class="fu">get_density</span>(params2),<span class="fu">get_density</span>(params3))</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.1</span>,</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.2</span>)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(coordinates_1,coordinates_2,Z[[<span class="dv">1</span>]],<span class="at">col=</span>col.list,</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim=</span><span class="fu">range</span>(<span class="fu">unlist</span>(Z)),<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]))</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(coordinates_1,coordinates_2,Z[[<span class="dv">2</span>]],<span class="at">col=</span>col.list,</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim=</span><span class="fu">range</span>(<span class="fu">unlist</span>(Z)),<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]))</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(coordinates_1,coordinates_2,Z[[<span class="dv">3</span>]],<span class="at">col=</span>col.list,</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim=</span><span class="fu">range</span>(<span class="fu">unlist</span>(Z)),<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-capstone-prior-sensitivity" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-capstone-prior-sensitivity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C5-L01_files/figure-html/fig-capstone-prior-sensitivity-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;103.4: Prior sensitivity analysis of AR coefficients"><img src="C5-L01_files/figure-html/fig-capstone-prior-sensitivity-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-capstone-prior-sensitivity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;103.4: Prior sensitivity analysis of AR coefficients
</figcaption>
</figure>
</div>
</div>
</div>
<p>Since we change the value of hyperparameters but the posterior is almost the same, we can conclude that the posterior distribution of both AR coefficients and variance are robust w.r.t. the choice of hyperparameters.</p>
<p>Posterior Inference We now sample 5000 sets of <span class="math inline">(\phi_1, \phi_2, \nu)</span> from their marginal posterior distributions and plot them. For prior hyperparameters, we take <span class="math inline">m_0=(0,0)^\top</span>, <span class="math inline">C_0=I_2</span>, <span class="math inline">n_0=2</span>, and <span class="math inline">d_0=2</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,p),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>C0<span class="ot">=</span><span class="fu">diag</span>(p)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>n0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>d0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span>Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>Q<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">+</span><span class="fu">diag</span>(n)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>Q.inv<span class="ot">=</span><span class="fu">chol2inv</span>(<span class="fu">chol</span>(Q))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>A<span class="ot">=</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">%*%</span>Q.inv</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span>m0<span class="sc">+</span>A<span class="sc">%*%</span>e</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span>C0<span class="sc">-</span>A<span class="sc">%*%</span>Q<span class="sc">%*%</span><span class="fu">t</span>(A)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>n.star<span class="ot">=</span>n<span class="sc">+</span>n0</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>d.star<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">%*%</span>Q.inv<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">+</span>d0</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>n.sample<span class="ot">=</span><span class="dv">5000</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>nu.sample<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,n.sample)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>phi.sample<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span>n.sample,<span class="at">ncol=</span>p)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sample) {</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(i)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  nu.new<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>n.star<span class="sc">/</span><span class="dv">2</span>,<span class="at">rate=</span>d.star<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  nu.sample[i]<span class="ot">=</span>nu.new</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  phi.new<span class="ot">=</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>,<span class="at">mean=</span>m,<span class="at">sigma=</span>nu.new<span class="sc">*</span>C)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  phi.sample[i,]<span class="ot">=</span>phi.new</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(phi.sample[,<span class="dv">1</span>],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">main=</span><span class="st">""</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">6.4</span>))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(phi.sample[,<span class="dv">1</span>]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(phi.sample[,<span class="dv">2</span>],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]),<span class="at">main=</span><span class="st">""</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">6.4</span>))</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(phi.sample[,<span class="dv">2</span>]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(nu.sample,<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(nu),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(nu.sample),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-capstone-posterior-sampling" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-capstone-posterior-sampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C5-L01_files/figure-html/fig-capstone-posterior-sampling-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;103.5: Posterior sampling of AR coefficients and variance"><img src="C5-L01_files/figure-html/fig-capstone-posterior-sampling-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-capstone-posterior-sampling-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;103.5: Posterior sampling of AR coefficients and variance
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-checking-by-in-sample-point-and-interval-estimation" class="level3" data-number="103.7.2">
<h3 data-number="103.7.2" class="anchored" data-anchor-id="model-checking-by-in-sample-point-and-interval-estimation"><span class="header-section-number">103.7.2</span> Model Checking by In-sample Point and Interval Estimation</h3>
<p>To check whether the model fits well, we plot the posterior point and interval estimate for each point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## get in sample prediction</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>post.pred.y<span class="ot">=</span><span class="cf">function</span>(s){</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  beta.cur<span class="ot">=</span><span class="fu">matrix</span>(phi.sample[s,],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  nu.cur<span class="ot">=</span>nu.sample[s]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  mu.y<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>beta.cur</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mu.y), <span class="cf">function</span>(k){<span class="fu">rnorm</span>(<span class="dv">1</span>,mu.y[k],<span class="fu">sqrt</span>(nu.cur))})</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>y.post.pred.sample<span class="ot">=</span><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>, post.pred.y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## show the result</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>summary.vec95<span class="ot">=</span><span class="cf">function</span>(vec){</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.025</span>)),<span class="fu">mean</span>(vec),<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.975</span>)))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>summary.y<span class="ot">=</span><span class="fu">apply</span>(y.post.pred.sample,<span class="at">MARGIN=</span><span class="dv">1</span>,summary.vec95)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Y,<span class="at">type=</span><span class="st">'b'</span>,<span class="at">xlab=</span><span class="st">'Time'</span>,<span class="at">ylab=</span><span class="st">''</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>),<span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(summary.y[<span class="dv">2</span>,],<span class="at">type=</span><span class="st">'b'</span>,<span class="at">col=</span><span class="st">'grey'</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">pch=</span><span class="dv">4</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(summary.y[<span class="dv">1</span>,],<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'purple'</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(summary.y[<span class="dv">3</span>,],<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'purple'</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">'Truth'</span>,<span class="st">'Mean'</span>,<span class="st">'95% C.I.'</span>),<span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">'black'</span>,<span class="st">'grey'</span>,<span class="st">'purple'</span>),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">horiz =</span> T,<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">4</span>,<span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-capstone-result" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-capstone-result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C5-L01_files/figure-html/fig-capstone-result-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;103.6: TS with prediction and credible interval"><img src="C5-L01_files/figure-html/fig-capstone-result-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-capstone-result-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;103.6: TS with prediction and credible interval
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-capstone-prediction" class="level2 page-columns page-full" data-number="103.8">
<h2 data-number="103.8" class="anchored" data-anchor-id="sec-capstone-prediction"><span class="header-section-number">103.8</span> Prediction for AR Models 🎥</h2>
<div class="page-columns page-full"><p> <span class="math inline">AR(p)</span> Model:</p><div class="no-row-height column-margin column-container"><img src="images/C5-L01-sl05.png" id="fig-capstone-prediction" class="img-fluid" style="width:53mm" data-group="slides" alt="prediction"></div></div>
<p><span class="math display">
y_t = \phi_1 y_{t-1} + \phi_2 y_{t-2} + \cdots + \phi_p y_{t-p} + \varepsilon_t, \qquad \varepsilon_t\sim \mathcal{N}(0,\nu)
</span></p>
<p>where (<span class="math inline">\varepsilon_t</span>) follows a normal distribution with mean zero and variance (<span class="math inline">\nu</span>).</p>
<ul>
<li><p>First Step Ahead Prediction, <span class="math inline">t&gt;T</span> : <span class="math display">
y_{T+1} \sim \mathcal{N}(\phi_1 y_T + \ldots + \phi_p y_{T+1-p}, \nu)
</span></p></li>
<li><p>General H-Step Ahead Prediction:</p></li>
</ul>
<p><span class="math display">
y_{T+S}^s \sim \mathcal{N}\left(\sum_{j=1}^{p} \phi_j^s y_{T+s-j}^s, \nu^{(s)}\right)
</span></p>
<p>where (<span class="math inline">\phi_j^s</span>) and (<span class="math inline">\nu^{(s)}</span>) are the posterior samples of the parameters.</p>
</section>
<section id="sec-capstone-ar-prediction-example" class="level2" data-number="103.9">
<h2 data-number="103.9" class="anchored" data-anchor-id="sec-capstone-ar-prediction-example"><span class="header-section-number">103.9</span> AR model prediction example 📖 ℛ</h2>
<p>We now give an example for coding the prediction algorithm in R. Consider the simulated data in the previous class, an <em>AR(2)</em> model with 200 observations obtained from <span class="math inline">y_t=0.5y_{t−1}+0.4y_{t−2}+\varepsilon_t,\varepsilon_t\sim \mathcal{N}(0,1)</span>.</p>
<p>Before doing the prediction, we have to obtain posterior samples of model parameters <span class="math inline">\phi</span> and <span class="math inline">\nu</span>, which has been taught in the previous class. Here we just copy the code from previous to obtain 5000 posterior samples of <span class="math inline">\phi</span> and <span class="math inline">\nu</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate data</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>phi1<span class="ot">&lt;-</span><span class="fl">0.5</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>phi2<span class="ot">&lt;-</span><span class="fl">0.4</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>v<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>y.sample<span class="ot">=</span><span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">200</span>,<span class="at">model=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">ar=</span><span class="fu">c</span>(phi1,phi2),<span class="at">sd=</span><span class="fu">sqrt</span>(v)))</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="do">## set up</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>N<span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="dv">2</span> <span class="co"># order of AR process</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>n.all<span class="ot">=</span><span class="fu">length</span>(y.sample) <span class="do">## T, total number of data</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span><span class="fu">matrix</span>(y.sample[<span class="dv">3</span><span class="sc">:</span>n.all],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>Fmtx<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(y.sample[<span class="dv">2</span><span class="sc">:</span>(n.all<span class="dv">-1</span>)],y.sample[<span class="dv">1</span><span class="sc">:</span>(n.all<span class="dv">-2</span>)]),<span class="at">nrow=</span>p,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">length</span>(Y)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior inference</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="do">## set the prior</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,p),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>C0<span class="ot">=</span><span class="fu">diag</span>(p)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>n0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>d0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate parameters that will be reused in the loop</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span>Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>Q<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">+</span><span class="fu">diag</span>(n)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>Q.inv<span class="ot">=</span><span class="fu">chol2inv</span>(<span class="fu">chol</span>(Q))</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>A<span class="ot">=</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">%*%</span>Q.inv</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span>m0<span class="sc">+</span>A<span class="sc">%*%</span>e</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span>C0<span class="sc">-</span>A<span class="sc">%*%</span>Q<span class="sc">%*%</span><span class="fu">t</span>(A)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>n.star<span class="ot">=</span>n<span class="sc">+</span>n0</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>d.star<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">%*%</span>Q.inv<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">+</span>d0</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>n.sample<span class="ot">=</span><span class="dv">5000</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="do">## store posterior samples</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>nu.sample<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,n.sample)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>phi.sample<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span>n.sample,<span class="at">ncol=</span>p)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sample){</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(i)</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  nu.new<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>n.star<span class="sc">/</span><span class="dv">2</span>,<span class="at">rate=</span>d.star<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>  nu.sample[i]<span class="ot">=</span>nu.new</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>  phi.new<span class="ot">=</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>,<span class="at">mean=</span>m,<span class="at">sigma=</span>nu.new<span class="sc">*</span>C)</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>  phi.sample[i,]<span class="ot">=</span>phi.new</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running the code, 5000 posterior samples of <span class="math inline">\phi</span> and <span class="math inline">\nu</span> are stored in <code>phi.sample</code> and <code>nu.sample</code>.</p>
<p>The h-step ahead prediction can be obtained by the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## the prediction function</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>y_pred_h_step<span class="ot">=</span><span class="cf">function</span>(h.step,s){</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a> phi.cur<span class="ot">=</span><span class="fu">matrix</span>(phi.sample[s,],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a> nu.cur<span class="ot">=</span>nu.sample[s]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a> y.cur<span class="ot">=</span><span class="fu">c</span>(y.sample[<span class="dv">200</span>],y.sample[<span class="dv">199</span>])</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a> y.pred<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,h.step)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>h.step) {</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  mu.y<span class="ot">=</span><span class="fu">sum</span>(y.cur<span class="sc">*</span>phi.cur)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  y.new<span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">1</span>,mu.y,<span class="fu">sqrt</span>(nu.cur))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  y.pred[i]<span class="ot">=</span>y.new</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  y.cur<span class="ot">=</span><span class="fu">c</span>(y.new,y.cur)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  y.cur<span class="ot">=</span>y.cur[<span class="sc">-</span><span class="fu">length</span>(y.cur)]</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(y.pred)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For illustration purposes, we obtain 3-step ahead predictions. The posterior distribution of <span class="math inline">Y_{201}, Y_{202}, Y_{203}</span>, denoted as <span class="math inline">Y_{201}, Y_{202}, Y_{203}</span>, is given by:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y.post.pred.ahead<span class="ot">=</span><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>, <span class="cf">function</span>(s){<span class="fu">y_pred_h_step</span>(<span class="at">h.step=</span><span class="dv">3</span>,<span class="at">s=</span>s)})</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y.post.pred.ahead[<span class="dv">1</span>,],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(y[<span class="dv">201</span>]),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y.post.pred.ahead[<span class="dv">1</span>,]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y.post.pred.ahead[<span class="dv">2</span>,],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(y[<span class="dv">202</span>]),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y.post.pred.ahead[<span class="dv">2</span>,]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y.post.pred.ahead[<span class="dv">3</span>,],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(y[<span class="dv">203</span>]),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y.post.pred.ahead[<span class="dv">3</span>,]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C5-L01_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="C5-L01_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>summary.vec95<span class="ot">=</span><span class="cf">function</span>(vec){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">c</span>(<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.025</span>)),<span class="fu">mean</span>(vec),<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.975</span>)))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(y.post.pred.ahead,<span class="at">MARGIN=</span><span class="dv">1</span>,summary.vec95)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]        [,2]        [,3]
[1,] -1.88717944 -2.12253036 -2.52266829
[2,]  0.06139962  0.04574706  0.03225995
[3,]  2.00420428  2.14813228  2.61098539</code></pre>
</div>
</div>
<p>Posterior mean and 95% confidence interval for <span class="math inline">\phi_1</span> and <span class="math inline">\phi_2</span> can be obtained by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>summary.vec95<span class="ot">=</span><span class="cf">function</span>(vec){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">c</span>(<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.025</span>)),<span class="fu">mean</span>(vec),<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.975</span>)))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(y.post.pred.ahead,<span class="at">MARGIN=</span><span class="dv">1</span>,summary.vec95)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]        [,2]        [,3]
[1,] -1.88717944 -2.12253036 -2.52266829
[2,]  0.06139962  0.04574706  0.03225995
[3,]  2.00420428  2.14813228  2.61098539</code></pre>
</div>
</div>
</section>
<section id="sec-capstone-extended-ar-model" class="level2 page-columns page-full" data-number="103.10">
<h2 data-number="103.10" class="anchored" data-anchor-id="sec-capstone-extended-ar-model"><span class="header-section-number">103.10</span> Extended AR model 📖</h2>
<p>This is a five page <a href="handouts/c5-Honor-Extend-AR-model.pdf">Arima handout</a></p>
<p>I have however added some callouts with question and counterexamples to assist my understanding of this and earlier material.</p>
<section id="extending-ar-models-for-complex-time-series-data" class="level3" data-number="103.10.1">
<h3 data-number="103.10.1" class="anchored" data-anchor-id="extending-ar-models-for-complex-time-series-data"><span class="header-section-number">103.10.1</span> Extending AR Models for Complex Time Series Data</h3>
<p>After we finished learning the materials from this module, you may wonder why we started with AR models. As we mentioned at the beginning, <mark>AR models are central to stationary time series data analysis and, as components of larger models or in suitably modified and generalized forms, underlie nonstationary time-varying models.</mark> This reading material will give examples about extending AR models for complex time series data. Hopefully these notes will help you build up confidence to this relatively simple model.</p>
</section>
<section id="autoregressive-moving-average-models-arma" class="level3 page-columns page-full" data-number="103.10.2">
<h3 data-number="103.10.2" class="anchored" data-anchor-id="autoregressive-moving-average-models-arma"><span class="header-section-number">103.10.2</span> Autoregressive Moving Average Models (ARMA)</h3>
<section id="characteristic-polynomial-of-ar-processes" class="level4 page-columns page-full" data-number="103.10.2.1">
<h4 data-number="103.10.2.1" class="anchored" data-anchor-id="characteristic-polynomial-of-ar-processes"><span class="header-section-number">103.10.2.1</span> Characteristic polynomial of AR processes</h4>
<div class="page-columns page-full"><p>  An <em>AR(p)</em> process <span class="math inline">y_t</span> is said to be <em>causal</em> if it can be written as a one-sided linear process dependent on the past</p><div class="no-row-height column-margin column-container"><span class="">causal Ar(p)</span></div></div>
<p><span id="eq-capstone-arp-linear-parm"><span class="math display">
y_t= \Phi(\operatorname{B})\varepsilon_t= \sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j}
\tag{103.14}</span></span></p>
<p> Where <span class="math inline">\operatorname{B}</span> is the backshift operator, with <span class="math inline">\operatorname{B}\varepsilon_{t} = \varepsilon_{t−1}</span>, <span class="math inline">\psi_0 = 1</span> and <span class="math inline">\sum_{j=0}^{\infty} |\psi_j | &lt; \infty</span>.</p>
<p><span class="math inline">y_t</span> is causal only when <strong>the autoregressive characteristic polynomial</strong>, defined as <span id="eq-capstone-arp-characteristic-polynomial"><span class="math display">
\Phi(u) = 1 - \sum_{j=1}^{p} \phi_j u^j
\tag{103.15}</span></span></p>
<div class="page-columns page-full"><p>  Has roots with moduli greater than unity. That is, <span class="math inline">y_t</span> is causal if <span class="math inline">\Phi(u) = 0</span> only when <span class="math inline">|u| &gt; 1</span>. <mark>This <em>causality</em> condition implies <em>stationarity</em>, and so it is often referred as the stationary condition in the time series literature.</mark>  The autoregressive characteristic polynomial can also be written as <span class="math inline">\Phi(u) = \prod_{j=1}^{p}(1 - \alpha_j u)</span>, so that its roots are the reciprocals of the <span class="math inline">\alpha_j</span>’s. The <span class="math inline">\alpha_j</span>’s may be real-valued or may appear as pairs of complex conjugates. <mark>Either way, if <span class="math inline">|\alpha_j| &lt; 1</span> for all <span class="math inline">j</span>, the process is stationary.</mark></p><div class="no-row-height column-margin column-container"><span class="">causality <span class="math inline">\implies</span> stationarity</span><span class="">stationary condition</span></div></div>
</section>
</section>
<section id="structure-of-arma-models" class="level3 page-columns page-full" data-number="103.10.3">
<h3 data-number="103.10.3" class="anchored" data-anchor-id="structure-of-arma-models"><span class="header-section-number">103.10.3</span> Structure of ARMA models</h3>
<p>Consider a time series <span class="math inline">y_t</span>, for <span class="math inline">t = 1, 2, \cdots</span>, arising from the model</p>
<p><span id="eq-capstone-ARMA-definition"><span class="math display">
y_t= \sum_{i=1}^{p} \phi_i y_{t-i} + \sum_{j=1}^{q} \theta_j \varepsilon_{t-j} + \varepsilon_t
\tag{103.16}</span></span></p>
<div class="page-columns page-full"><p> With <span class="math inline">\varepsilon_t \sim \mathcal{N}(0, \nu)</span>. Then, <span class="math inline">\{y_t\}</span> follows an autoregressive moving average model, or <em>ARMA(p, q)</em>, where <span class="math inline">p</span> and <span class="math inline">q</span> are the orders of the autoregressive and moving average parts, respectively.  <mark>When <span class="math inline">p = 0</span>, <span class="math inline">\{y_t\}</span> is said to be a <em>moving average process</em> of order <span class="math inline">q</span> or <em>MA(q)</em>.</mark> Similarly, <mark>when <span class="math inline">q = 0</span>, <span class="math inline">\{y_t\}</span> is an <em>autoregressive process</em> of order <span class="math inline">p</span> or <em>AR(p)</em>.</mark></p><div class="no-row-height column-margin column-container"><span class="">ARMA(p,q)</span></div></div>
<div id="exm-capstone-ma-process" class="theorem example page-columns page-full">
<p><span class="theorem-title"><strong>Example 103.1 (MA(1) process)</strong></span> If <span class="math inline">\{y_t\}</span> follows a MA(1) process, <span class="math inline">y_t = \theta y_{t-1} + \varepsilon_t</span>, the process is stationary for all the values of <span class="math inline">\theta</span>. In addition, it is easy to see that the autocorrelation function has the following form:</p>
<p><span id="eq-capstone-ma-1-autocorrelation"><span class="math display">
\rho(h) =
\begin{cases}
1 &amp; h = 0 \\
\frac{\theta}{1 + \theta^2} &amp; h = 1 \\
0 &amp; \text{o.w.}
\end{cases}
\tag{103.17}</span></span></p>
<div class="page-columns page-full"><p>Now, if we consider a <em>MA(1)</em> process with coefficient 1 instead of <span class="math inline">\theta</span>, we would obtain the same correlation function, and so it would be impossible to determine which of the two processes generated the data. Therefore, it is necessary to impose identifiability conditions on <span class="math inline">\theta</span>. In particular, <span class="math inline">\frac{1}{\theta} &gt; 1</span> is the identifiability condition for a <em>MA(1)</em>, which is also known as the invertibility condition, given that it implies that the MA process can be “inverted” into an infinite order <span class="math inline">AR</span> process. </p><div class="no-row-height column-margin column-container"><span class="">invertibility condition</span></div></div>
</div>
<p><mark>In general, a <em>MA(q)</em> process is identifiable or invertible only when the roots of the MA characteristic polynomial <span class="math inline">\Theta(u) = 1 + \theta_1 u + \ldots + \theta_q u^q</span> lie outside the unit circle.</mark> In this case it is possible to write the MA process as an infinite order AR process.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Order <span class="math inline">\neq</span> Memory of MA(p) or AR(q) processes
</div>
</div>
<div class="callout-body-container callout-body">
<p>Throughout this unit and also before we are told about a finite order <span class="math inline">AR(p) \eq MA(\infty)</span> and <span class="math inline">MA(q)=AR(\infty)</span>. If like me you think this is a strange claim then perhaps you don’t understand the AR(1) and the MA(1) processes as well as you think.</p>
<p>The main issue here is understanding the relation of the parameters AR(p) and MA(q) and the memory of the process. If at some point you equate p or q in these processes to their memory you are due to a rude awakening. P and Q are just the number of parameters in the AR or MA process, they are the dimensions of matrices that represent the process.</p>
<p>However, the actual memory of the process is determined by the behavior of the coefficients as the time goes to infinity. We can show how AR(1) and MA(1) can easily remember infinite number of past values.</p>
<p>When we wish to represent such an AR(1) or MA(1) using their opposite we will quickly find counterexamples that require infinite number of parameters to represent the same process. In fact I would venture to say that only trivial or specially constructed AR and MA processes (e.g., white noise) are mutual finite-order representations. Most are infinite in one form or the other.</p>
</div>
</div>
<div id="exm-capstone-ma1-process" class="theorem example">
<p><span class="theorem-title"><strong>Example 103.2 (🔴 AR(1) That Can’t Be Represented as Finite MA(q))</strong></span> Consider the stationary AR(1) process:</p>
<p><span class="math display">
Y_t = \phi Y_{t-1} + \varepsilon_t, \quad |\phi| &lt; 1
</span></p>
<p>The infinite MA(∞) representation is:</p>
<p><span class="math display">
Y_t = \sum_{j=0}^{\infty} \phi^j \varepsilon_{t-j}
</span></p>
<p>Suppose we ask: can we find any finite <span class="math inline">q</span> such that:</p>
<p><span class="math display">
Y_t = \varepsilon_t + \theta_1 \varepsilon_{t-1} + \dots + \theta_q \varepsilon_{t-q}
</span></p>
<p>Then we would need:</p>
<p><span class="math display">
\phi^j = 0 \quad \text{for some finite } j &gt; q
</span></p>
<p>But this is impossible unless <span class="math inline">\phi = 0</span>, which trivializes the AR(1) to white noise.</p>
<p>👉 <strong>Therefore</strong>: A stationary AR(1) process (with <span class="math inline">\phi \neq 0</span>) has <strong>infinite memory</strong>, and cannot be exactly represented as a <strong>finite MA(q)</strong>.</p>
</div>
<p>Now here’s a simple <strong>counterexample</strong> that shows a <strong>finite AR(p)</strong> can’t always be expressed exactly as a <strong>finite MA(q)</strong>.</p>
<div id="exm-capstone-ar1-process" class="theorem example">
<p><span class="theorem-title"><strong>Example 103.3 (🔴 MA(1) That Can’t Be Represented as Finite AR(p))</strong></span> Now consider an MA(1):</p>
<p><span class="math display">
Y_t = \varepsilon_t + \theta \varepsilon_{t-1}, \quad \theta \neq 0
</span></p>
<p>To write it as a finite AR(p), we would need:</p>
<p><span class="math display">
Y_t = \phi_1 Y_{t-1} + \phi_2 Y_{t-2} + \dots + \varepsilon_t
</span></p>
<p>But again, this fails except in special cases. For invertible <span class="math inline">\theta</span>, we can write an <strong>AR(∞)</strong>:</p>
<p><span class="math display">
Y_t = \sum_{j=1}^\infty \phi_j Y_{t-j} + \varepsilon_t
</span></p>
<p>But truncating at any finite p yields approximation, not exact identity.</p>
</div>
<p>For an <em>ARMA(p, q)</em> process, the stationary condition is given in terms of the AR coefficients, i.e., the process is causal only when the roots of the AR characteristic polynomial <span class="math inline">\Phi(u) = 1 − \phi_1 u − \ldots − \phi_p u^p</span> lie outside the unit circle. The <em>ARMA</em> process is invertible only when the roots of the MA characteristic polynomial lie outside the unit circle.</p>
<p><mark>So, if the <em>ARMA</em> process is <em>causal</em> and <em>invertible</em>, it can be written either as a purely <em>AR</em> process of infinite order, or as a purely <em>MA</em> process of infinite order.</mark></p>
<p>If <span class="math inline">\{y_t\}</span> follows an <em>ARMA(p,q)</em> we can write <span class="math inline">\Phi(B)y_t = \Theta(B)\varepsilon_t</span>, with</p>
<p><span id="eq-capstone-characteristic-polynomials"><span class="math display">
\begin{aligned}
\Phi(B) &amp;= 1 − \phi_1\operatorname{B} − \ldots  − \phi_p\operatorname{B}^p \\
\Theta(B) &amp;= 1 + \theta_1\operatorname{B} + \ldots + \theta_q\operatorname{B}^q
\end{aligned}
\tag{103.18}</span></span></p>
<ul>
<li>where:
<ul>
<li><span class="math inline">\operatorname{B}</span> is the backshift operator.</li>
<li><span class="math inline">\Phi(\operatorname{B})</span> is the autoregressive characteristic polynomial of the ARMA model, with roots <span class="math inline">\alpha_i</span> and</li>
<li><span class="math inline">\Theta(\operatorname{B})</span> is the moving average characteristic polynomial of the ARMA model, with roots <span class="math inline">\beta_j</span>.</li>
</ul></li>
</ul>
<p>If the process is causal then we can write it as a purely MA process of infinite order</p>
<p><span id="eq-capstone-polynomial-inversion"><span class="math display">
y_t = \Phi(\operatorname{B})^{-1}\Theta(\operatorname{B})\varepsilon_t = \Psi(\operatorname{B})\varepsilon_t = \sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j}
\tag{103.19}</span></span></p>
<p>with <span class="math inline">\Psi(\operatorname{B})</span> such that <span class="math inline">\Phi(\operatorname{B})\Psi(\operatorname{B}) = \Theta(\operatorname{B})</span>. The <span class="math inline">\psi_j</span> values can be found by solving the homogeneous difference equations given by: <span id="eq-capstone-inverted-parameters"><span class="math display">
\psi_j − \sum_{h=1}^{p} \phi_h\psi_{j−h} = \theta_j, \qquad j \ge \max (p, q + 1)
\tag{103.20}</span></span></p>
<p>where <span class="math inline">\phi_h</span> are the AR coefficients and <span class="math inline">\psi_j</span> are the MA coefficients. with initial conditions:</p>
<p><span id="eq-capstone-ARMA-coefficients-initial"><span class="math display">
\psi_j − \sum_{h=1}^{j} \phi_h\psi_{j−h} = \theta_j , \qquad 0 ≤ j &lt; \max(p, q + 1)
\tag{103.21}</span></span></p>
<p>and <span class="math inline">θ_0</span>. The general solution to the Equations <a href="#eq-capstone-polynomial-inversion" class="quarto-xref">Equation&nbsp;<span>103.19</span></a> and <a href="#eq-capstone-inverted-parameters" class="quarto-xref">Equation&nbsp;<span>103.20</span></a> is given by</p>
<p><span id="eq-capstone-ARMA-inversion-general-solution"><span class="math display">
\psi_j = \alpha_1^j p_1(j) + \ldots + \alpha_r^j p_r(j)
\tag{103.22}</span></span></p>
<p>where <span class="math inline">\alpha_1, \ldots, \alpha_r</span> are the reciprocal roots of the characteristic polynomial <span class="math inline">\Phi(u) = 0</span>, with multiplicities <span class="math inline">m_1, \ldots, m_r</span>, respectively, and each <span class="math inline">p_i(j)</span> is a polynomial of degree <span class="math inline">m_i - 1</span>.</p>
<p>So the infinite decomposition yield a finite outcome!</p>
<!-- TODO: find the precise references in the book -->
<section id="inversion-of-ar-components" class="level4 page-columns page-full" data-number="103.10.3.1">
<h4 data-number="103.10.3.1" class="anchored" data-anchor-id="inversion-of-ar-components"><span class="header-section-number">103.10.3.1</span> Inversion of AR components</h4>
<p>In contexts where the time series has a reasonable length <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, we can fit long order AR models rather than ARMA or other, more complex forms. <mark>One key reason is that the statistical analysis, at least the conditional analysis based on fixed initial values, is much easier.</mark></p>
<div class="page-columns page-full"><p>If this view is adopted in a given problem, it may be informative to use the results of an AR analysis to explore possible <em>MA</em> component structure using the device of <strong>inversion</strong>, or <strong>partial inversion</strong>, of the AR model.  Assume that <span class="math inline">\{y_t\}</span> follows an <em>AR(p)</em> model with parameter vector <span class="math inline">\phi = (\phi_1, \ldots, \phi_p)^\top</span>, so we can write</p><div class="no-row-height column-margin column-container"><span class="">inversion</span></div></div>
<p><span id="eq-capstone-ARMA-definition-AR"><span class="math display">
\Phi(\operatorname{B})y_t= \prod_{i=1}^{p}(1 - \alpha_iB)y_t = \varepsilon_t
\tag{103.23}</span></span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\varepsilon_t \sim \mathcal{N}(0, \nu)</span> is a white noise process, and</li>
<li><span class="math inline">\Phi(\operatorname{B})</span> is the autoregressive characteristic polynomial of the AR model, with roots <span class="math inline">\alpha_i</span> and</li>
<li><span class="math inline">\alpha_i</span> are the autoregressive characteristic reciprocal roots.</li>
</ul>
<p>For some positive integer <span class="math inline">r &lt; p</span>, suppose that the final <span class="math inline">p − r</span> reciprocal roots are identified as having moduli less than unity; some or all of the first <span class="math inline">r</span> roots may also represent stationary components, though that is not necessary for the following development. Then, we can rewrite the model as</p>
<p><span id="eq-capstone-ARMA-inversion"><span class="math display">
\prod_{i=1}^{r}(1 - \alpha_iB) y_t = \prod_{i=r+1}^{p}(1 - \alpha_iB)^{-1} \varepsilon_t = \Psi^*(B) \varepsilon_t
\tag{103.24}</span></span></p>
<p>Where the implicitly infinite order MA component has the coefficients of the infinite order polynomial.</p>
<p><span id="eq-capstone-ARMA-inversion"><span class="math display">
\Psi^*(B) = \prod_{i=1}^{r}(1 - \alpha_iB)^{-1} \prod_{i=r+1}^{p}(1 - \alpha_iB)^{-1}
\tag{103.25}</span></span></p>
<p>So we have the representation</p>
<p><span id="eq-capstone-ARMA-inversion"><span class="math display">
y_t = \sum \phi^*_j y_{t−j} + \varepsilon_t + \sum_{j=1}^{\infty} ψ^*_j \varepsilon_{t−j}
\tag{103.26}</span></span></p>
<p>where <span class="math inline">\phi^*_j</span> are the new AR coefficients and <span class="math inline">\psi^*_j</span> are the new MA coefficients.</p>
<p>where the r new AR coefifients φ∗ j , for j = 1, · · · , r, are defined by the characteristic equation Φ∗(u) = (1 − αiu) = 0. The MA terms ψ∗ j can be easily calculated recursively, up to some appropriate upper bound on their number, say q.</p>
<p>Explicitly, they are recursively computed as follows. 1. Initialize the algorithm by setting <span class="math inline">\psi^*_i = 0 \quad \forall i \in \{1:q\}</span>. 2. For <span class="math inline">i = (r + 1) : p</span>, update <span class="math inline">\psi^*_1 = \psi^*_1 + \alpha_i</span>, and then - for <span class="math inline">j = 2 : q</span>, update <span class="math inline">\psi^*_j = \psi^*_j + \alpha_i\psi^*_j−1</span>.</p>
<p>Suppose <span class="math inline">\phi</span> is set at some estimate, such as a posterior mean, in the AR(p) model analysis. The above calculations can be performed for any specified value of <span class="math inline">r</span> to compute the corresponding MA coefficients in an inversion to the approximating ARMA(r, q) model. If the posterior for <span class="math inline">\phi</span> is sampled in the AR analysis, the above computations can be performed repeated for all sampled <span class="math inline">\phi</span> vectors, so producing corresponding samples of the ARMA parameters <span class="math inline">\phi^*</span> and <span class="math inline">\psi^*</span>. Thus, inference in various relevant ARMA models can be directly, and quite easily, deduced by inversion of longer order AR models.</p>
<p>Typically, various values of <span class="math inline">r</span> will be explored. Guidance is derived from the estimated amplitudes and, in the case of complex roots, periods of the roots of the AR model. Analyses in which some components are persistent suggest that these components should be retained in the AR description. The remaining roots, typically corresponding to high frequency characteristics in the data with lower moduli, are then the candidates for inversion to what will often be a relatively low order MA component. The calculations can be repeated, sequentially increasing <span class="math inline">q</span> and exploring inferences about the MA parameters, to assess a relevant approximating order.</p>
</section>
</section>
<section id="smoothing-and-differencing" class="level3" data-number="103.10.4">
<h3 data-number="103.10.4" class="anchored" data-anchor-id="smoothing-and-differencing"><span class="header-section-number">103.10.4</span> Smoothing and Differencing</h3>
<p>Many time series models are built under the stationary assumption. However, in many practical scenarios the data are realizations from one or several nonstationary processes. In this case, methods that aim to eliminate the nonstationary components are often used. The idea is to separate the nonstationary components, such as trends or seasonality, from the stationary ones so that the latter can be carefully studied via traditional time series models such as the aforementioned ARMA models. We briefly discuss two methods that are commonly used in practice for detrending and smoothing.</p>
<section id="differencing" class="level4" data-number="103.10.4.1">
<h4 data-number="103.10.4.1" class="anchored" data-anchor-id="differencing"><span class="header-section-number">103.10.4.1</span> Differencing</h4>
<p>Differencing is used to remove trends in time series data. The first difference of a time series is defined in terms of the difference operator that we denoted as D, that produces the transformation Dyt = yt − yt−1. Higher order differences are obtained by successively applying the operator D.</p>
<p>For example</p>
<p><span id="eq-capstone-differencing"><span class="math display">
D^2y_t = D(Dy_t) = D(y_t − y_{t−1}) = y_t − 2y_{t−1} + y_{t−2}
\tag{103.27}</span></span></p>
<p>Differencing can also be written in terms of the so called backshift operator B, with Byt = yt−1 so that <span class="math inline">Dy_t = (1 − B)y_t \text{ and } D^dy_t = (1 − B)^dy_t</span>.</p>
</section>
<section id="moving-averages" class="level4" data-number="103.10.4.2">
<h4 data-number="103.10.4.2" class="anchored" data-anchor-id="moving-averages"><span class="header-section-number">103.10.4.2</span> Moving Averages</h4>
<p>Moving averages is a method commonly used to ‘smooth’ a time series by removing certain features (e.g., seasonality) to highlight other features (e.g., trends). A moving average is a weighted average of the time series around a particular time t. In general, if we have data <span class="math inline">y_{1:T}</span> , we could obtain a new time series such that</p>
<p><span id="eq-capstone-moving-average"><span class="math display">
z_t = \sum_{j=−q}^p a_j y_{t+j}
\tag{103.28}</span></span></p>
<p>where <span class="math inline">a_j</span> are the weights, which can be chosen to be symmetric or asymmetric, and <span class="math inline">q</span> and <span class="math inline">p</span> are the number of past and future observations used in the average.</p>
<p>for <span class="math inline">t = (q + 1) : (T − p)</span>, with <span class="math inline">a_j \ge 0</span> and <span class="math inline">\sum_{j=−q}^p a_j = 1</span>. Usually <span class="math inline">p = q</span> and <span class="math inline">a_j = a_{−j}</span>. For example, to remove seasonality in monthly data, one can use a moving average with <span class="math inline">p = 6</span>, <span class="math inline">a_6 = a_{−6} = 1/24</span>, and <span class="math inline">a_j = a_{−j} = 1/12</span> for <span class="math inline">k = 0, \ldots , 5</span>, resulting in:</p>
<p><span id="eq-capstone-moving-average-example"><span class="math display">
z_t = \frac{1}{24} y_{t−6} + \frac{1}{12} y_{t−5} + \ldots + \frac{1}{12} y_{t+5} + \frac{1}{24} y_{t+6}
\tag{103.29}</span></span></p>
</section>
</section>
<section id="epilogue" class="level3" data-number="103.10.5">
<h3 data-number="103.10.5" class="anchored" data-anchor-id="epilogue"><span class="header-section-number">103.10.5</span> Epilogue</h3>
<p>With the methodology we have discussed in this lesson, you should now be confident that the <em>AR</em> models can deal with a large class of time series data. In practice, one can first check the stationarity of the time series. If it contains nonstationary features, try using some detrending, deseasonalizing and smoothing method. Then for the resulting stationary series, using <em>ARMA</em> models and perform the inference by fitting a longer order <em>AR</em> model and inverting <em>AR</em> components.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Quasi-periodic data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Great that might help if the data is periodic or has a trend. But what if the data is quasi-periodic so that the model cannot be made stationary by differencing or smoothing?</p>
<p>In such a case a state-space methods should be used.</p>
</div>
</div>


<!-- -->

</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>what is reasonable length? interpolation theorem lets us overfit to any length n with n+1 parameters<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./C4-L11.html" class="pagination-link" aria-label="Week 0: Feynman Notebook on Bayesian Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">102</span>&nbsp; <span class="chapter-title">Week 0: Feynman Notebook on Bayesian Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./C5-L01-Ex1.html" class="pagination-link" aria-label="Homework - Practice Quiz for Week 1 -- M1L1">
        <span class="nav-page-text"><span class="chapter-number">104</span>&nbsp; <span class="chapter-title">Homework - Practice Quiz for Week 1 – M1L1</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-07-02</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bayesian Conjugate Analysis for Autogressive Time Series Models - M1L1"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Bayesian Statistics - Capstone Project"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Capstone Project: Bayesian Conjugate Analysis for Autogressive Time Series Models"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - Bayesian Statistics</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Capstone Project</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - Time Series</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Explain the procedure for sampling from the posterior distribution, and code in R to achieve it.</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Calculate the posterior distributions of model parameters.</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> Describe the AR models under Bayesian conjugate setting. Specify the likelihood function and prior distribution.</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction 🎥 {#sec-capstone-introduction} </span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>This is a capstone project for the Bayesian Statistics course. </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>The instructor is a doctoral student Chi Joe Kao. I should point out that while he doesn't have the pedigree of the other instructors, he was on one of the best explainers of the complex material.  One downside is that is english is a little broken but I've had much worse. However you can see from the first slide that it covers the key concepts in a clear and concise manner leaving out very little.</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>Also it seems to me that Chi Joe Kao still remembers how hard this material is at first glance which is a great asset for teaching it effectively. You may notice that we revisit some old material this is because this course makes a great effort to be self contained. </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>Many parts of this course are steps towards completing the capstone project.</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>And perhaps just as exciting we will also cover a new type of model - a mixture version of the autoregressive model from the previous course.</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>We will cover the Bayesian conjugate analysis for autoregressive time series models.</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>This sounds a bit bombastic, all it means is that we will be using a likelihood and a prior that leads to a conjugate posterior, keeping everything within one distributional family!</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisite skill checklist 📖</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>:::: {.callout-note collapse="true"}</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisite skill checklist</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Statistics</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Interpret and specify the components of Bayesian statistical models: likelihood, prior, posterior.</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Explain the basics of sampling algorithms, including sampling from</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>standard distributions and using MCMC to sample from non-standard</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>posterior distributions.</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Assess the performance of a statistical model and compare competing</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>models using posterior samples.</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Coding in R to achieve the above tasks.</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mixture Models</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Define mixture model.</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Explain the likelihood function associated with a random sample</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>from a mixture distribution.</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Derive Markov chain Monte Carlo algorithms for fitting mixture models.</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Coding in R to achieve the above tasks.</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Series Analysis</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Define time series and stochastic processes (univariate, discrete-time, equally-spaced)</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Define strong and weak stationarity</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Define the auto-covariance function, the auto-correlation function</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>(ACF), and the partial autocorrelation function (PACF)</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="va">[x]</span> Definition of the general class of autoregressive processes of order p.</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Read Data 📖 ℛ</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a><span class="fu">### Earth Quake Data ℛ</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-capstone-earthquake-data</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="do">## read data, you need to make sure the data file is in your current working directory&nbsp;</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>earthquakes.dat <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"data/earthquakes.txt"</span>)</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>earthquakes.dat<span class="sc">$</span>Quakes<span class="ot">=</span><span class="fu">as.numeric</span>(earthquakes.dat<span class="sc">$</span>Quakes)</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>y.dat<span class="ot">=</span>earthquakes.dat<span class="sc">$</span>Quakes[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="do">## this is the training data</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>y.new<span class="ot">=</span>earthquakes.dat<span class="sc">$</span>Quakes[<span class="dv">101</span><span class="sc">:</span><span class="dv">103</span>] <span class="do">## this is the test data</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a><span class="fu">### Google Search Index Data ℛ</span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-capstone-google-search-index-covid</span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a><span class="do">## read data, you need to make sure the data file is in your current working directory&nbsp;</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>covid.dat <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"data/GoogleSearchIndex.txt"</span>)</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>covid.dat<span class="sc">$</span>Week<span class="ot">=</span><span class="fu">as.Date</span>(<span class="fu">as.character</span>(covid.dat<span class="sc">$</span>Week),<span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>y.dat<span class="ot">=</span>covid.dat<span class="sc">$</span>covid[<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>] <span class="do">## this is the training data</span></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>y.new<span class="ot">=</span>covid.dat<span class="sc">$</span>covid[<span class="dv">58</span><span class="sc">:</span><span class="dv">60</span>] <span class="do">## this is the test data</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Formulation 🎥</span></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a><span class="al">![AR(p) Model Formulation 1](images/C5-L01-sl01.png)</span>{#fig-capstone-model-formulation1 .column-margin group="slides" width="53mm"}</span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a><span class="al">![Multiple Regression Formulation](images/C5-L01-sl02.png)</span>{#fig-capstone-model-formulation2 .column-margin group="slides" width="53mm"}</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a><span class="fu">### AR(p) model formulation</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>y_t \quad t\in {1,2,\ldots,T} \qquad \begin{cases}  T&gt;p <span class="sc">\\</span> T=n+p <span class="sc">\\</span> n&gt;1 \end{cases}</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>*AR(p)*</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>y_t = \sum_{j=1}^p \phi_j y_{t-j} + \underbrace {\varepsilon_t}_{\text{innovations}}</span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>\qquad</span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>\varepsilon_t \perp y_\tau\ &amp; \forall \tau<span class="dt">&lt;</span><span class="kw">t</span><span class="ot"> </span><span class="er">\\</span></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">varepsilon_t </span><span class="er">\</span><span class="ot">stackrel</span><span class="er">{</span><span class="ot">iid</span><span class="er">}{\</span><span class="ot">sim</span><span class="er">}</span><span class="ot"> </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(0</span><span class="er">,\</span><span class="ot">nu) </span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">end</span><span class="er">{</span><span class="ot">cases</span><span class="er">}</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">end</span><span class="er">{</span><span class="ot">aligned</span><span class="er">}</span></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span><span class="ot">  </span><span class="er">{</span><span class="ot">#eq-capstone-ar-model</span><span class="er">}</span></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">begin</span><span class="er">{</span><span class="ot">aligned</span><span class="er">}</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a><span class="ot">y_t </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\sum_{j</span><span class="er">=</span><span class="st">1}^p</span><span class="ot"> </span><span class="er">\</span><span class="ot">phi_j y_</span><span class="er">{</span><span class="ot">t-j</span><span class="er">}</span><span class="ot"> </span><span class="er">+</span><span class="ot">  </span><span class="er">{\</span><span class="ot">varepsilon_t</span><span class="er">}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> (</span><span class="er">\</span><span class="ot">text</span><span class="er">{</span><span class="ot"> normality of innovation</span><span class="er">})\\</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\sum_{j</span><span class="er">=</span><span class="st">1}^p</span><span class="ot"> </span><span class="er">\</span><span class="ot">phi_j y_</span><span class="er">{</span><span class="ot">t-j</span><span class="er">}</span><span class="ot"> </span><span class="er">+</span><span class="ot">  </span><span class="er">\</span><span class="ot">mathcal N(0</span><span class="er">,\</span><span class="ot">nu) </span><span class="er">&amp;</span><span class="ot"> (</span><span class="er">\</span><span class="ot">text</span><span class="er">{</span><span class="ot">linearity</span><span class="er">})</span><span class="ot"> </span><span class="er">\\</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\mathcal{N}(\sum_{j</span><span class="er">=</span><span class="st">1}^p</span><span class="ot"> </span><span class="er">\</span><span class="ot">phi_j y_</span><span class="er">{</span><span class="ot">t-j</span><span class="er">},\</span><span class="ot">nu) </span><span class="er">&amp;</span><span class="ot"> (</span><span class="er">\</span><span class="ot">text</span><span class="er">{</span><span class="ot">rewrite using design matrix</span><span class="er">})\\</span></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a><span class="ot">    </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\mathcal{N}(f_t</span><span class="ot"> </span><span class="er">\</span><span class="ot">boldsymbol </span><span class="er">\</span><span class="ot">phi</span><span class="er">,\</span><span class="ot">nu) </span><span class="er">\\</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">end</span><span class="er">{</span><span class="ot">aligned</span><span class="er">}</span></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">begin</span><span class="er">{</span><span class="ot">aligned</span><span class="er">}</span></span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">P</span><span class="er">}</span><span class="ot">r(y_</span><span class="er">{1</span><span class="ot">:T</span><span class="er">}\</span><span class="ot">mid </span><span class="er">\</span><span class="ot">phi_1</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">ldots</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">phi_p</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">nu </span><span class="er">)</span><span class="ot"> </span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="ot"> </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\mathbb{P}r(y_{p+1:T})\prod_{t</span><span class="er">=</span><span class="st">p+1}^T</span><span class="ot"> </span><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">P</span><span class="er">}</span><span class="ot">r(y_t </span><span class="er">\</span><span class="ot">mid y_</span><span class="er">{</span><span class="ot">t-1</span><span class="er">},\</span><span class="ot">ldots</span><span class="er">,</span><span class="ot">y_</span><span class="er">{</span><span class="ot">t-p</span><span class="er">},\</span><span class="ot">phi_1</span><span class="er">,\</span><span class="ot">ldots</span><span class="er">,\</span><span class="ot">phi_p</span><span class="er">,\</span><span class="ot">nu) </span><span class="er">\\</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a><span class="ot"> </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\prod_{t</span><span class="er">=</span><span class="st">p+1}^T</span><span class="ot"> </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(f_t</span><span class="er">\</span><span class="ot">phi</span><span class="er">,\</span><span class="ot">nu) </span><span class="er">\\</span></span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a><span class="ot"> </span><span class="er">&amp;</span><span class="op">=</span> <span class="st">\mathcal{N}(F^\top</span><span class="ot"> </span><span class="er">\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">},\</span><span class="ot">nu</span><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">I</span><span class="er">}</span><span class="ot">_n) </span><span class="er">\\</span></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">end</span><span class="er">{</span><span class="ot">aligned</span><span class="er">}</span></span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span><span class="ot"> </span><span class="er">{</span><span class="ot">#eq-capstone-ar-likelihood</span><span class="er">}</span></span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> where </span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a><span class="ot">  </span><span class="er">-</span><span class="ot"> </span><span class="er">$\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">}</span><span class="op">=</span><span class="st">(\phi_1,\ldots,\phi_p)^\top$</span><span class="ot"> is the vector of parameters</span><span class="er">,</span><span class="ot"> and</span></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a><span class="ot">  </span><span class="er">-</span><span class="ot"> </span><span class="er">$\</span><span class="ot">nu</span><span class="er">$</span><span class="ot"> is the scale parameter. and </span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a><span class="ot">  </span><span class="er">-</span><span class="ot"> </span><span class="er">$</span><span class="ot">F</span><span class="er">$</span><span class="ot"> is the design matrix </span></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a><span class="ot">F</span><span class="op">=</span> <span class="st">\begin{pmatrix}</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a><span class="ot">y_</span><span class="er">{</span><span class="ot">p</span><span class="er">}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> y_</span><span class="er">{</span><span class="ot">p</span><span class="er">+1}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">cdots </span><span class="er">&amp;</span><span class="ot"> y_</span><span class="er">{</span><span class="ot">T-1</span><span class="er">}</span><span class="ot"> </span><span class="er">\\</span></span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a><span class="ot">y_</span><span class="er">{</span><span class="ot">p-1</span><span class="er">}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> y_</span><span class="er">{</span><span class="ot">p</span><span class="er">}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">cdots </span><span class="er">&amp;</span><span class="ot"> y_</span><span class="er">{</span><span class="ot">T-2</span><span class="er">}</span><span class="ot"> </span><span class="er">\\</span></span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">vdots </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">vdots </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">vdots </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">ddots </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">vdots </span><span class="er">\\</span></span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a><span class="ot">y_</span><span class="er">{1}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> y_</span><span class="er">{2}</span><span class="ot"> </span><span class="er">&amp;</span><span class="ot"> </span><span class="er">\</span><span class="ot">cdots </span><span class="er">&amp;</span><span class="ot"> y_</span><span class="er">{</span><span class="ot">T-p</span><span class="er">}</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">end</span><span class="er">{</span><span class="ot">pmatrix</span><span class="er">}</span></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span><span class="ot"> </span><span class="er">{</span><span class="ot">#eq-capstone-design-matrix</span><span class="er">}</span></span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a><span class="er">---</span></span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a><span class="ot">### Multiple Linear regression model formulation</span></span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a><span class="ot">y</span><span class="op">=</span><span class="st">(y_{p+1},\ldots,y_T)</span><span class="ot"> </span><span class="er">\</span><span class="ot">in </span><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">R</span><span class="er">}^</span><span class="ot">n</span></span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a><span class="ot">y </span><span class="op">=</span> <span class="st">F^\top</span><span class="ot"> </span><span class="er">\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">}</span><span class="ot"> </span><span class="er">+</span><span class="ot"> </span><span class="er">\</span><span class="ot">varepsilon </span><span class="er">\</span><span class="ot">qquad </span><span class="er">\</span><span class="ot">varepsilon </span><span class="er">\</span><span class="ot">sim </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(0</span><span class="er">,\</span><span class="ot">nu</span><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">I</span><span class="er">}</span><span class="ot">_n)</span></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">P</span><span class="er">}</span><span class="ot">r(y </span><span class="er">\</span><span class="ot">mid </span><span class="er">\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">},\</span><span class="ot">nu) </span><span class="op">=</span> <span class="st">\mathcal{N}(F^\top</span><span class="ot"> </span><span class="er">\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">},\</span><span class="ot">nu</span><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">I</span><span class="er">}</span><span class="ot">_n)</span></span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">y</span><span class="er">}\</span><span class="ot">sim </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">F</span><span class="er">}^\</span><span class="ot">top </span><span class="er">\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">},\</span><span class="ot">nu</span><span class="er">\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">I</span><span class="er">}</span><span class="ot">_n)</span><span class="er">,\</span><span class="ot">quad </span><span class="er">\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">phi</span><span class="er">}\</span><span class="ot">sim </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">m</span><span class="er">}</span><span class="ot">_0</span><span class="er">,\</span><span class="ot">nu</span><span class="er">\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">C</span><span class="er">}</span><span class="ot">_0)</span><span class="er">,\</span><span class="ot">quad </span><span class="er">\</span><span class="ot">nu</span><span class="er">\</span><span class="ot">sim IG(</span><span class="er">\</span><span class="ot">frac</span><span class="er">{</span><span class="ot">n_0</span><span class="er">}{2},\</span><span class="ot">frac</span><span class="er">{</span><span class="ot">d_0</span><span class="er">}{2})</span><span class="ot"> </span></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span><span class="ot"> </span><span class="er">{</span><span class="ot">#eq-capstone-model-specification</span><span class="er">}</span></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a><span class="ot">where:  </span></span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a><span class="ot">::: </span><span class="er">{.</span><span class="ot">callout-note collapse</span><span class="op">=</span><span class="st">"true"</span><span class="er">}</span></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="ot">## Question </span><span class="er">{.</span><span class="ot">unnumbered</span><span class="er">}</span></span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a><span class="ot">Suppose we have a multiple linear regression model </span><span class="er">$</span><span class="ot">y</span><span class="op">=</span><span class="st">\mathbf{X}\beta+\varepsilon$</span><span class="ot">  where </span><span class="er">$\</span><span class="ot">varepsilon </span><span class="er">\</span><span class="ot">sim</span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(0</span><span class="er">,\</span><span class="ot">sigma</span><span class="er">^2I)$</span><span class="ot">  what is the proper conditional conjugate prior for parameters </span><span class="er">$\</span><span class="ot">beta</span><span class="er">$</span><span class="ot"> and </span><span class="er">$\</span><span class="ot">sigma</span><span class="er">^2$?</span></span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a><span class="ot">Solution</span></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> [ </span><span class="er">]</span><span class="ot"> </span><span class="er">$\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">p</span><span class="er">}</span><span class="ot">r(</span><span class="er">\</span><span class="ot">beta</span><span class="er">,\</span><span class="ot">sigma</span><span class="er">^2)</span><span class="ot"> </span><span class="er">\</span><span class="ot">quad </span><span class="er">\</span><span class="ot">propto </span><span class="er">\</span><span class="ot">frac</span><span class="er">{1}{σ^2}$</span></span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> [ </span><span class="er">]</span><span class="ot"> </span><span class="er">$\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">p</span><span class="er">}</span><span class="ot">r(</span><span class="er">\</span><span class="ot">beta</span><span class="er">,\</span><span class="ot">sigma</span><span class="er">^2)</span><span class="ot"> </span><span class="er">\</span><span class="ot">quad </span><span class="er">\</span><span class="ot">propto  </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">beta </span><span class="er">\</span><span class="ot">mid </span><span class="er">\</span><span class="ot">mu</span><span class="er">,\</span><span class="ot">Sigma)</span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">IG</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">sigma</span><span class="er">^2\</span><span class="ot">mid a</span><span class="er">,</span><span class="ot">b)</span><span class="er">$</span></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> [ </span><span class="er">]</span><span class="ot"> </span><span class="er">$\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">p</span><span class="er">}</span><span class="ot">r(</span><span class="er">\</span><span class="ot">beta</span><span class="er">,\</span><span class="ot">sigma</span><span class="er">^2)</span><span class="ot"> </span><span class="er">\</span><span class="ot">quad </span><span class="er">\</span><span class="ot">propto  </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">beta </span><span class="er">\</span><span class="ot">mid </span><span class="er">\</span><span class="ot">mu</span><span class="er">,\</span><span class="ot">sigma</span><span class="er">^2\</span><span class="ot">Sigma)</span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">IG</span><span class="er">}</span><span class="ot">(σ</span><span class="er">^2\</span><span class="ot">mid a</span><span class="er">,</span><span class="ot">b)</span><span class="er">$</span></span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> [ </span><span class="er">]</span><span class="ot"> </span><span class="er">$\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">p</span><span class="er">}</span><span class="ot">r(</span><span class="er">\</span><span class="ot">beta</span><span class="er">,\</span><span class="ot">sigma</span><span class="er">^2)</span><span class="ot"> </span><span class="er">\</span><span class="ot">quad </span><span class="er">\</span><span class="ot">propto  </span><span class="er">1$</span></span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a><span class="ot">:::</span></span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a><span class="ot">I got this right the first time  by eyeballing it. </span></span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a><span class="ot">So I</span><span class="er">'</span><span class="ot">m not sure why it is right other than the the others are missing something.</span></span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a><span class="ot">## Review: Useful Distributions </span><span class="er">📖</span><span class="ot"> </span><span class="er">ℛ</span></span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a><span class="ot">This is material a review of three distributions we have seen frequently in relation to modeling with Normal distribution </span><span class="er">-</span><span class="ot"> our default model in many cases.</span></span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> The multivariate normal distribution is used to model multiple correlated variables</span></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> The inverse-gamma distribution is used as a prior for the variance for Normally distributed data when the mean is known and the variance is unknown.</span></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a><span class="er">-</span><span class="ot"> The multivariate Student-t distribution is a robust alternative to the multivariate normal distribution when the data has outliers or is not normally distributed.</span></span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a><span class="ot">### The multivariate normal distribution</span></span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a><span class="ot">A </span><span class="er">$</span><span class="ot">k</span><span class="er">$-</span><span class="ot">dimensional random vector </span><span class="er">$</span><span class="ot">x</span><span class="op">=</span><span class="st">(x_1,</span><span class="ot"> </span><span class="er">\</span><span class="ot">cdots</span><span class="er">,</span><span class="ot"> x_k)</span><span class="er">^</span><span class="ot">T</span><span class="er">$</span><span class="ot"> that follows a multivariate normal distribution with mean </span><span class="er">$\</span><span class="ot">mu</span><span class="er">$</span><span class="ot"> and variance-covariance matrix </span><span class="er">$\</span><span class="ot">Sigma</span><span class="er">$</span><span class="ot"> is denoted as </span><span class="er">$</span><span class="ot">x </span><span class="er">\</span><span class="ot">sim </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">N</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">mu</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">Sigma)</span><span class="er">$</span><span class="ot"> or </span><span class="er">$</span><span class="ot">p(x) </span><span class="op">=</span> <span class="st">\mathcal{N}(x</span><span class="ot"> </span><span class="er">\</span><span class="ot">mid </span><span class="er">\</span><span class="ot">mu</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">Sigma)</span><span class="er">$</span><span class="ot"> has a density function given by:</span></span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a><span class="ot">p(</span><span class="er">\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">x</span><span class="er">})</span><span class="op">=</span><span class="st">(2\pi)^{-k/2}|\boldsymbol{\Sigma}|^{-1/2}\exp[-\frac{1}{2}(\mathbf{x}-\boldsymbol{\mu})^T\boldsymbol{\Sigma}^{-1}(\mathbf{x}-\boldsymbol{\mu})]</span></span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span><span class="ot"> </span><span class="er">{</span><span class="ot">#eq-multivariate-normal-pdf</span><span class="er">}</span></span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a><span class="ot">where </span><span class="er">$\</span><span class="ot">mathbf</span><span class="er">{</span><span class="ot">x</span><span class="er">}$</span><span class="ot"> is a </span><span class="er">$</span><span class="ot">k</span><span class="er">$-</span><span class="ot">dimensional vector</span><span class="er">,</span><span class="ot"> </span><span class="er">$|\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">Sigma</span><span class="er">}|$</span><span class="ot"> is the determinant of the covariance matrix</span><span class="er">,</span><span class="ot"> and </span><span class="er">$\</span><span class="ot">boldsymbol</span><span class="er">{\</span><span class="ot">Sigma</span><span class="er">}^{-1}$</span><span class="ot"> is the inverse of the covariance matrix.</span></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a><span class="ot">### The gamma and inverse-gamma distribution</span></span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a><span class="ot">A random variable </span><span class="er">$</span><span class="ot">x</span><span class="er">$</span><span class="ot"> that follows a gamma distribution with shape parameter </span><span class="er">$\</span><span class="ot">alpha</span><span class="er">$</span><span class="ot"> and inverse scale parameter </span><span class="er">$\</span><span class="ot">beta</span><span class="er">$</span><span class="ot"> </span><span class="er">,</span><span class="ot"> denoted as </span><span class="er">$</span><span class="ot">x </span><span class="er">\</span><span class="ot">sim </span><span class="er">\</span><span class="ot">mathcal</span><span class="er">{</span><span class="ot">G</span><span class="er">}</span><span class="ot">(</span><span class="er">\</span><span class="ot">alpha</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">beta)</span><span class="er">$,</span><span class="ot"> or </span><span class="er">$\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">P</span><span class="er">}</span><span class="ot">r(x) </span><span class="op">=</span> <span class="st">\mathcal{G}(x</span><span class="ot"> </span><span class="er">\</span><span class="ot">mid </span><span class="er">\</span><span class="ot">alpha</span><span class="er">,</span><span class="ot"> </span><span class="er">\</span><span class="ot">beta)</span><span class="er">$,</span><span class="ot"> has a density of the form</span></span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a><span class="er">\</span><span class="ot">mathbb</span><span class="er">{</span><span class="ot">P</span><span class="er">}</span><span class="ot">r(x)</span><span class="op">=</span><span class="st">\frac{\beta^{\alpha}}{\Gamma(\alpha)}x^{\alpha-1}e^{-\beta</span><span class="ot"> x</span><span class="er">},\</span><span class="ot">quad x</span><span class="dt">&gt;</span>0</span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>$$ {#eq-gamma-pdf}</span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a>where $\alpha$ is the shape parameter, $\beta$ is the rate parameter, and $\Gamma(\alpha)$ is the gamma function evaluated at $\alpha$. </span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>In addition, </span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">x</span><span class="co">]</span>=\frac{\alpha}{\beta}  \qquad \mathbb{V}ar<span class="co">[</span><span class="ot">x</span><span class="co">]</span>=\frac{\alpha}{\beta^2}</span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>If $1/x \sim G(\alpha, \beta)$, then $x$ follows an inverse-gamma distribution $X\sim \mathcal{IG}(\alpha, \beta)$.</span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a> or $p(x) = \mathcal{IG}(X\mid \alpha, \beta)$. with</span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a>\mathbb{P}r(x)=\frac{\beta^{\alpha}}{\Gamma(\alpha)}x^{-(\alpha+1)}e^{-\beta/x},\quad x&gt;0</span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a>$$ {#eq-inverse-gamma-pdf}</span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a>where $\alpha$ is the shape parameter, $\beta$ is the scale parameter, and $\Gamma(\alpha)$ is the gamma function evaluated at $\alpha$.    </span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a>in this case </span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">x</span><span class="co">]</span>=\frac{\beta}{\alpha-1} \quad \text{for } \alpha &gt; 1 \qquad</span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a>\mathbb{V}ar<span class="co">[</span><span class="ot">x</span><span class="co">]</span>=\frac{\beta^2}{(\alpha-1)^2(\alpha-2)} \quad \text{for } \alpha &gt; 2</span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a>$$ {#eq-inverse-gamma-moments}</span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### The multivariate Student-t distribution</span></span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a>A random vector $x$ of dimension $k$ follows a multivariate Student-t distribution with $\nu$ degrees of freedom, location $\boldsymbol{\mu}$, and scale matrix $\boldsymbol{\Sigma}$, denoted as $x \sim T_\nu(\boldsymbol{\mu}, \boldsymbol{\Sigma})$, if its density is given by:</span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a>\mathbb{P}r(\mathbf{x})=\frac{\Gamma(\frac{\nu+k}{2})}{\Gamma(\frac{\nu}{2})(\nu\pi)^{k/2}}|\boldsymbol{\Sigma}|^{-1/2}<span class="co">[</span><span class="ot">1+\frac{1}{\nu}(\mathbf{x}-\boldsymbol{\mu})^T\boldsymbol{\Sigma}^{-1}(\mathbf{x}-\boldsymbol{\mu})</span><span class="co">]</span>^{-(\nu+k)/2}</span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">x</span><span class="co">]</span>=\mu \text{ for } \nu&gt;1  \qquad \mathbb{V}ar<span class="co">[</span><span class="ot">x</span><span class="co">]</span>=\frac{\nu\Sigma}{\nu−2} \quad \text{for } \nu&gt;2</span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a><span class="fu">## Posterior Distribution Derivation 📖 {#sec-capstone-posterior}</span></span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a>In this lesson, I present the derivation of the posterior distributions for $\boldsymbol{\phi}$ and $\nu$ for the following model:</span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a>\mathbf{y}\sim \mathcal{N}(\mathbf{F}^\top \boldsymbol{\phi},\nu\mathbf{I}_n),\quad \boldsymbol{\phi}\sim \mathcal{N}(\mathbf{m}_0,\nu\mathbf{C}_0),\quad \nu\sim IG(\frac{n_0}{2},\frac{d_0}{2}) </span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a>$$ {#eq-model-specification}</span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a>where :</span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{y}$ is the observed data,</span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{F}$ is the design matrix,</span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\boldsymbol{\phi}$ is the vector of parameters,</span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\nu$ is the scale parameter,</span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{m}_0$ is the prior mean of $\boldsymbol{\phi}$,</span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mathbf{C}_0$ is the prior covariance matrix of $\boldsymbol{\phi}$,</span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$n_0$ and $d_0$ are the shape and scale parameters of the inverse-gamma prior for $\nu$.</span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a>i.e. we start with a Normal likelihood with a Normal prior for $\boldsymbol{\phi}$ and an inverse-gamma prior for $\nu$. Since we call the parameters $\phi$ and not $\theta$ it suggests that this isn't a typical linear regression but rather an AR(p) model with </span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a>I recall that we already did this derivation in the first course by Herbert Lee.</span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a><span class="co"> &lt;!-- </span><span class="al">TODO</span><span class="co">: link the relevant section in the first course as it is unclear what this particular normal model means w.r.t. our knowledge of the mean and variance --&gt;</span></span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a>Using Bayes theorem, we have :</span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a>\begin{aligned} </span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a>\mathbb{p}r(\boldsymbol{\phi},\nu\mid\mathbf{y}) &amp; \propto \mathbb{p}r(\mathbf{y} \mid \boldsymbol{\phi},\nu)\mathbb{p}r(\boldsymbol{\phi}\mid\nu)\mathbb{p}r(\nu)<span class="sc">\\</span> </span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a>&amp;\propto \nu^{-n/2}\exp \left(-\frac{(\mathbf{y}-\mathbf{F}^T\boldsymbol{\phi})^T(\mathbf{y}-\mathbf{F}^T\boldsymbol{\phi})}{2\nu}\right)<span class="sc">\\</span> </span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a>&amp;\quad \times \nu^{-p/2}\exp\left(-\frac{(\boldsymbol{\phi}-\mathbf{m}_0)^T\mathbf{C}_0^{-1}(\boldsymbol{\phi}-\mathbf{m}_0)}{2\nu}\right)<span class="sc">\\</span> </span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>&amp;\quad \times \nu^{-(\frac{n_0}{2}+1)}\exp\left(-\frac{d_0}{2\nu}\right)<span class="sc">\\</span> </span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a>&amp;\propto \nu^{-(\frac{n^*}{2}+1)}\exp\left(-\frac{d^*}{2\nu}\right)<span class="sc">\\</span> </span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a>&amp;\quad \times \nu^{-p/2}\exp\left(-\frac{(\boldsymbol{\phi}-\mathbf{m})^T\mathbf{C}^{-1}(\boldsymbol{\phi}-\mathbf{m})}{2\nu}\right)<span class="sc">\\</span> </span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a>&amp;\propto \mathbb{p}r(\nu\mid\mathbf{y})\mathbb{p}r(\boldsymbol{\phi}\mid\nu,\mathbf{y}) </span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a>$$ {#eq-posterior-derivation-1}</span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a>where </span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>\begin{aligned} </span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>\mathbf{e}&amp;=\mathbf{y}-\mathbf{F}^T\mathbf{m}_0, </span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>&amp;\mathbf{Q}&amp;=\mathbf{F}^T\mathbf{C}_0\mathbf{F}+\mathbf{I}_n,\quad </span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a>\mathbf{A}=\mathbf{C}_0\mathbf{F}\mathbf{Q}^{-1}<span class="sc">\\</span></span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a>\mathbf{m}&amp;=\mathbf{m}_0+\mathbf{A}\mathbf{e},\quad </span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a>&amp;\mathbf{C}&amp;=\mathbf{C}_0-\mathbf{A}\mathbf{Q}\mathbf{A}^{T}<span class="sc">\\</span> </span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a> n^* &amp;=n+n_0,\quad </span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a> &amp;d^*&amp;=(y-\mathbf{F}^T\mathbf{m}_0)^T\mathbf{Q}^{-1}(y-\mathbf{F}^T\mathbf{m}_0)+d_0</span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a>\end{aligned} </span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a>$$ {#eq-posterior-derivation}</span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a>Therefore, we have the posterior distribution of $\boldsymbol{\phi}$ and $\nu$ as:</span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>\begin{aligned} </span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a>\mathbb{P}r(\boldsymbol{\phi},\nu \mid \mathbf{y}) &amp;=\mathbb{P}r(\boldsymbol{\phi} \mid \nu,\mathbf{y})\mathbb{P}r(\nu\mid \mathbf{y}) <span class="sc">\\</span></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a>&amp;=\mathcal{N}(\boldsymbol{\phi}\mid \mathbf{m},\nu\mathbf{C})\ \mathcal{IG}(\nu\mid \frac{n^*}{2},\frac{d^*}{2}) \end{aligned}</span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a>$$ {#eq-posterior-distribution}</span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a>To get the $s$^th^ sample of $(\boldsymbol{\phi}^{(s)},\nu^{(s)})$ from the joint posterior distribution of $\boldsymbol{\phi}$ and $\nu$, we first sample $\nu^{(s)}$ from $\mathcal{IG}(\frac{n^*}{2},\frac{d^*}{2})$, then sample $\boldsymbol{\phi}^{(s)}$ from $\mathcal{N}(\boldsymbol{m},\nu^{(s)}\boldsymbol{C})$.</span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a>**One can also obtain posterior samples** of $\boldsymbol{\phi}$ by directly sampling from its **marginal posterior distribution.** </span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a>Integrate out $\nu$ from the joint posterior distribution, we have $\mathbb{P}r(\boldsymbol{\phi} \mid \mathbf{y})=T_{n^*}(\boldsymbol{m},\frac{d^*}{n^*}\boldsymbol{C})$.</span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a>Denote the $s$^th^ posterior sample of $\boldsymbol{\phi}$ and $\nu$ as $\boldsymbol{\phi}^{(s)}$ and $\nu^{(s)}$, we can obtain the corresponding $i$^th^ posterior sample of $\mathbf{y}^{(s)}$ by sampling from $\mathcal{N}(\mathbf{F}^\top \boldsymbol{\phi}^{(s)},\nu^{(s)})$. </span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a>Therefore, we can obtain the posterior point and interval estimates for the time series.</span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a><span class="fu">## AR model fitting example {#sec-capstone-ar-fitting}</span></span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bayesian Conjugate Analysis of AR Model</span></span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Simulate Data</span></span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a>We give an example about fitting an $AR(2)$ model using simulated data. We simulate 200 observations from the following model:</span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a>y_t=0.5y_{t-1}+0.4y_{t-2}+\varepsilon_t,\quad \varepsilon_t\sim N(0,1) </span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a>$$ {#eq-ar2-model}</span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-capstone-simulate-data</span></span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Simulated AR(2) data"</span></span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate data</span></span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>phi1<span class="ot">=</span><span class="fl">0.5</span></span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>phi2<span class="ot">=</span><span class="fl">0.4</span></span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a>v<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a>y.sample<span class="ot">=</span><span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">200</span>,<span class="at">model=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">ar=</span><span class="fu">c</span>(phi1,phi2),<span class="at">sd=</span><span class="fu">sqrt</span>(v)))</span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(y.sample,<span class="at">ylab=</span><span class="fu">expression</span>(<span class="fu">italic</span>(y)[<span class="fu">italic</span>(t)]),<span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">italic</span>(t)),</span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">''</span>)</span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a>Now, we perform a prior sensitivity analysis for the choice of hyperparameters in prior distribution. We choose three sets of prior hyperparameters and plot the posterior distribution for $\mathbb{P}r(\phi_1, \phi_2 \mid y_{1:n})$ below. The three sets of prior hyperparameters are :</span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a>\begin{aligned} </span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a>&amp; (1) \quad \mathbf{m}_0=(0,0)^T,\mathbf{C}_0=I_2,n_0=2,d_0=2<span class="sc">\\</span> </span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a>&amp; (2) \quad \mathbf{m}_0=(0,0)^T,\mathbf{C}_0=I_2,n_0=6,d_0=1<span class="sc">\\</span> </span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a>&amp; (3) \quad \mathbf{m}_0=(-0.5,-0.5)^T,\mathbf{C}_0=I_2,n_0=6,d_0=1 </span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a>\end{aligned} </span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a>In the plot, the left, middle and right panel correspond to the first, second and last sets of hyperparameters, respectively.</span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-capstone-prior-sensitivity</span></span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Prior sensitivity analysis of AR coefficients"</span></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a><span class="do">## prior sensitivity analysis</span></span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a><span class="do">## plot posterior distribution of phi_1 and phi_2 on a grid </span></span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fields)</span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a><span class="do">## generate grid</span></span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a>coordinates_1<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a>coordinates_2<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a>coordinates<span class="ot">=</span><span class="fu">expand.grid</span>(coordinates_1,coordinates_2)</span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a>coordinates<span class="ot">=</span><span class="fu">as.matrix</span>(coordinates)</span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a><span class="do">## set up</span></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="dv">100</span></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="dv">2</span>  <span class="do">## order of AR process</span></span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a>n.all<span class="ot">=</span><span class="fu">length</span>(y.sample) <span class="do">## T, total number of data</span></span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span><span class="fu">matrix</span>(y.sample[<span class="dv">3</span><span class="sc">:</span>n.all],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a>Fmtx<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(y.sample[<span class="dv">2</span><span class="sc">:</span>(n.all<span class="dv">-1</span>)],y.sample[<span class="dv">1</span><span class="sc">:</span>(n.all<span class="dv">-2</span>)]),<span class="at">nrow=</span>p,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">length</span>(Y)</span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a><span class="do">## function to compute parameters for the posterior distribution of phi_1 and phi_2</span></span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a><span class="do">## the posterior distribution of phi_1 and phi_2 is a multivariate t distribution</span></span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a>cal_parameters<span class="ot">=</span><span class="cf">function</span>(<span class="at">m0=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">nrow=</span><span class="dv">2</span>),<span class="at">C0=</span><span class="fu">diag</span>(<span class="dv">2</span>),n0,d0){</span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a>  e<span class="ot">=</span>Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0</span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a>  Q<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">+</span><span class="fu">diag</span>(n)</span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a>  Q.inv<span class="ot">=</span><span class="fu">chol2inv</span>(<span class="fu">chol</span>(Q))  <span class="do">## similar as solve, but more robust</span></span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a>  A<span class="ot">=</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">%*%</span>Q.inv</span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a>  m<span class="ot">=</span>m0<span class="sc">+</span>A<span class="sc">%*%</span>e</span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a>  C<span class="ot">=</span>C0<span class="sc">-</span>A<span class="sc">%*%</span>Q<span class="sc">%*%</span><span class="fu">t</span>(A)</span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a>  n.star<span class="ot">=</span>n<span class="sc">+</span>n0</span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a>  d.star<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">%*%</span>Q.inv<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">+</span>d0</span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a>  params<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">1</span>]]<span class="ot">=</span>n.star</span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">2</span>]]<span class="ot">=</span>d.star</span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">3</span>]]<span class="ot">=</span>m</span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a>  params[[<span class="dv">4</span>]]<span class="ot">=</span>C</span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(params)</span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a><span class="do">## evaluate density at the grid points</span></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a>get_density<span class="ot">=</span><span class="cf">function</span>(param){</span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>  location<span class="ot">=</span>param[[<span class="dv">3</span>]]</span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a>  scale<span class="ot">=</span><span class="fu">as.numeric</span>(param[[<span class="dv">2</span>]]<span class="sc">/</span>param[[<span class="dv">1</span>]])<span class="sc">*</span>param[[<span class="dv">4</span>]]</span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a>  density<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,N<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N<span class="sc">^</span><span class="dv">2</span>) {</span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a>    xi<span class="ot">=</span>coordinates[i,]</span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>    density[i]<span class="ot">=</span><span class="fu">dmvt</span>(xi,<span class="at">delta=</span>location,<span class="at">sigma=</span>scale,<span class="at">df=</span>param[[<span class="dv">1</span>]])</span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a>  density_expand<span class="ot">=</span><span class="fu">matrix</span>(density,<span class="at">nrow=</span>N)</span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(density_expand)</span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate density for three sets of hyperparameters</span></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a>params1<span class="ot">=</span><span class="fu">cal_parameters</span>(<span class="at">n0=</span><span class="dv">2</span>,<span class="at">d0=</span><span class="dv">2</span>)</span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>params2<span class="ot">=</span><span class="fu">cal_parameters</span>(<span class="at">n0=</span><span class="dv">6</span>,<span class="at">d0=</span><span class="dv">1</span>)</span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a>params3<span class="ot">=</span><span class="fu">cal_parameters</span>(<span class="at">m0=</span><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="sc">-</span><span class="fl">0.5</span>),<span class="at">nrow=</span><span class="dv">2</span>),<span class="at">n0=</span><span class="dv">6</span>,<span class="at">d0=</span><span class="dv">1</span>)</span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a>col.list<span class="ot">=</span><span class="fu">matlab.like2</span>(N)</span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a>Z<span class="ot">=</span><span class="fu">list</span>(<span class="fu">get_density</span>(params1),<span class="fu">get_density</span>(params2),<span class="fu">get_density</span>(params3))</span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a>          <span class="at">oma =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.1</span>,</span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a>          <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.2</span>)</span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(coordinates_1,coordinates_2,Z[[<span class="dv">1</span>]],<span class="at">col=</span>col.list,</span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim=</span><span class="fu">range</span>(<span class="fu">unlist</span>(Z)),<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]))</span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(coordinates_1,coordinates_2,Z[[<span class="dv">2</span>]],<span class="at">col=</span>col.list,</span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim=</span><span class="fu">range</span>(<span class="fu">unlist</span>(Z)),<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]))</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(coordinates_1,coordinates_2,Z[[<span class="dv">3</span>]],<span class="at">col=</span>col.list,</span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a>      <span class="at">zlim=</span><span class="fu">range</span>(<span class="fu">unlist</span>(Z)),<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">ylab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]))</span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a>Since we change the value of hyperparameters but the posterior is almost the same, we can conclude that the posterior distribution of both AR coefficients and variance are robust w.r.t. the choice of hyperparameters.</span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a>Posterior Inference</span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a>We now sample 5000 sets of $(\phi_1, \phi_2, \nu)$  from their marginal posterior distributions and plot them. For prior hyperparameters, we take $m_0=(0,0)^\top$, $C_0=I_2$, $n_0=2$, and $d_0=2$.</span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-capstone-posterior-sampling</span></span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Posterior sampling of AR coefficients and variance"</span></span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,p),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a>C0<span class="ot">=</span><span class="fu">diag</span>(p)</span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a>n0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a>d0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span>Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0</span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a>Q<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">+</span><span class="fu">diag</span>(n)</span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a>Q.inv<span class="ot">=</span><span class="fu">chol2inv</span>(<span class="fu">chol</span>(Q))</span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a>A<span class="ot">=</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">%*%</span>Q.inv</span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span>m0<span class="sc">+</span>A<span class="sc">%*%</span>e</span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span>C0<span class="sc">-</span>A<span class="sc">%*%</span>Q<span class="sc">%*%</span><span class="fu">t</span>(A)</span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>n.star<span class="ot">=</span>n<span class="sc">+</span>n0</span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a>d.star<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">%*%</span>Q.inv<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">+</span>d0</span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a>n.sample<span class="ot">=</span><span class="dv">5000</span></span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a>nu.sample<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,n.sample)</span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a>phi.sample<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span>n.sample,<span class="at">ncol=</span>p)</span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sample) {</span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(i)</span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a>  nu.new<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>n.star<span class="sc">/</span><span class="dv">2</span>,<span class="at">rate=</span>d.star<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a>  nu.sample[i]<span class="ot">=</span>nu.new</span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a>  phi.new<span class="ot">=</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>,<span class="at">mean=</span>m,<span class="at">sigma=</span>nu.new<span class="sc">*</span>C)</span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a>  phi.sample[i,]<span class="ot">=</span>phi.new</span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(phi.sample[,<span class="dv">1</span>],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">1</span>]),<span class="at">main=</span><span class="st">""</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">6.4</span>))</span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(phi.sample[,<span class="dv">1</span>]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(phi.sample[,<span class="dv">2</span>],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(phi[<span class="dv">2</span>]),<span class="at">main=</span><span class="st">""</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">6.4</span>))</span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(phi.sample[,<span class="dv">2</span>]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(nu.sample,<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(nu),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(nu.sample),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Checking by In-sample Point and Interval Estimation</span></span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a>To check whether the model fits well, we plot the posterior point and interval estimate for each point.</span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-capstone-in-sample-predictions</span></span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a><span class="do">## get in sample prediction</span></span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a>post.pred.y<span class="ot">=</span><span class="cf">function</span>(s){</span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a>  beta.cur<span class="ot">=</span><span class="fu">matrix</span>(phi.sample[s,],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a>  nu.cur<span class="ot">=</span>nu.sample[s]</span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a>  mu.y<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>beta.cur</span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mu.y), <span class="cf">function</span>(k){<span class="fu">rnorm</span>(<span class="dv">1</span>,mu.y[k],<span class="fu">sqrt</span>(nu.cur))})</span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a>y.post.pred.sample<span class="ot">=</span><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>, post.pred.y)</span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-capstone-result</span></span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "TS with prediction and credible interval"</span></span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a><span class="do">## show the result</span></span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a>summary.vec95<span class="ot">=</span><span class="cf">function</span>(vec){</span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.025</span>)),<span class="fu">mean</span>(vec),<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.975</span>)))</span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a>summary.y<span class="ot">=</span><span class="fu">apply</span>(y.post.pred.sample,<span class="at">MARGIN=</span><span class="dv">1</span>,summary.vec95)</span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Y,<span class="at">type=</span><span class="st">'b'</span>,<span class="at">xlab=</span><span class="st">'Time'</span>,<span class="at">ylab=</span><span class="st">''</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">7</span>),<span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(summary.y[<span class="dv">2</span>,],<span class="at">type=</span><span class="st">'b'</span>,<span class="at">col=</span><span class="st">'grey'</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">pch=</span><span class="dv">4</span>)</span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(summary.y[<span class="dv">1</span>,],<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'purple'</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(summary.y[<span class="dv">3</span>,],<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'purple'</span>,<span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">'Truth'</span>,<span class="st">'Mean'</span>,<span class="st">'95% C.I.'</span>),<span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">'black'</span>,<span class="st">'grey'</span>,<span class="st">'purple'</span>),</span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a>       <span class="at">horiz =</span> T,<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">4</span>,<span class="cn">NA</span>))</span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prediction for AR Models 🎥 {#sec-capstone-prediction}</span></span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a><span class="al">![prediction](images/C5-L01-sl05.png)</span>{#fig-capstone-prediction .column-margin  group="slides" width="53mm"}</span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a>$AR(p)$ Model:</span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a>y_t = \phi_1 y_{t-1} + \phi_2 y_{t-2} + \cdots + \phi_p y_{t-p} + \varepsilon_t, \qquad \varepsilon_t\sim \mathcal{N}(0,\nu)</span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a>where ($\varepsilon_t$) follows a normal distribution with mean zero and variance ($\nu$).</span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>First Step Ahead Prediction, $t&gt;T$ :</span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a>y_{T+1} \sim \mathcal{N}(\phi_1 y_T + \ldots + \phi_p y_{T+1-p}, \nu)</span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>General H-Step Ahead Prediction: </span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a>y_{T+S}^s \sim \mathcal{N}\left(\sum_{j=1}^{p} \phi_j^s y_{T+s-j}^s, \nu^{(s)}\right)</span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a>where ($\phi_j^s$) and ($\nu^{(s)}$) are the posterior samples of the parameters.</span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## AR model prediction example 📖 ℛ {#sec-capstone-ar-prediction-example}</span></span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a>We now give an example for coding the prediction algorithm in R. Consider the simulated data in the previous class, an *AR(2)* model with 200 observations obtained from $y_t=0.5y_{t−1}+0.4y_{t−2}+\varepsilon_t,\varepsilon_t\sim \mathcal{N}(0,1)$. </span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a>Before doing the prediction, we have to obtain posterior samples of model parameters </span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a>$\phi$ and $\nu$, which has been taught in the previous class. Here we just copy the code from previous to obtain 5000 posterior samples of $\phi$ and $\nu$</span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-capstone-ar-prediction-example</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate data</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a>phi1<span class="ot">&lt;-</span><span class="fl">0.5</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a>phi2<span class="ot">&lt;-</span><span class="fl">0.4</span></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a>v<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a>y.sample<span class="ot">=</span><span class="fu">arima.sim</span>(<span class="at">n=</span><span class="dv">200</span>,<span class="at">model=</span><span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">ar=</span><span class="fu">c</span>(phi1,phi2),<span class="at">sd=</span><span class="fu">sqrt</span>(v)))</span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a><span class="do">## set up</span></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a>N<span class="ot">&lt;-</span><span class="dv">100</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="dv">2</span> <span class="co"># order of AR process</span></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a>n.all<span class="ot">=</span><span class="fu">length</span>(y.sample) <span class="do">## T, total number of data</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span><span class="fu">matrix</span>(y.sample[<span class="dv">3</span><span class="sc">:</span>n.all],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>Fmtx<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">c</span>(y.sample[<span class="dv">2</span><span class="sc">:</span>(n.all<span class="dv">-1</span>)],y.sample[<span class="dv">1</span><span class="sc">:</span>(n.all<span class="dv">-2</span>)]),<span class="at">nrow=</span>p,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">length</span>(Y)</span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a><span class="do">## posterior inference</span></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a><span class="do">## set the prior</span></span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">=</span><span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>,p),<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a>C0<span class="ot">=</span><span class="fu">diag</span>(p)</span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a>n0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a>d0<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate parameters that will be reused in the loop</span></span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a>e<span class="ot">=</span>Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0</span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a>Q<span class="ot">=</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">+</span><span class="fu">diag</span>(n)</span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a>Q.inv<span class="ot">=</span><span class="fu">chol2inv</span>(<span class="fu">chol</span>(Q))</span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>A<span class="ot">=</span>C0<span class="sc">%*%</span>Fmtx<span class="sc">%*%</span>Q.inv</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a>m<span class="ot">=</span>m0<span class="sc">+</span>A<span class="sc">%*%</span>e</span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a>C<span class="ot">=</span>C0<span class="sc">-</span>A<span class="sc">%*%</span>Q<span class="sc">%*%</span><span class="fu">t</span>(A)</span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a>n.star<span class="ot">=</span>n<span class="sc">+</span>n0</span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a>d.star<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">%*%</span>Q.inv<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">t</span>(Fmtx)<span class="sc">%*%</span>m0)<span class="sc">+</span>d0</span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a>n.sample<span class="ot">=</span><span class="dv">5000</span></span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a><span class="do">## store posterior samples</span></span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a>nu.sample<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,n.sample)</span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>phi.sample<span class="ot">=</span><span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span>n.sample,<span class="at">ncol=</span>p)</span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sample){</span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(i)</span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a>  nu.new<span class="ot">=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="at">shape=</span>n.star<span class="sc">/</span><span class="dv">2</span>,<span class="at">rate=</span>d.star<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a>  nu.sample[i]<span class="ot">=</span>nu.new</span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a>  phi.new<span class="ot">=</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>,<span class="at">mean=</span>m,<span class="at">sigma=</span>nu.new<span class="sc">*</span>C)</span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a>  phi.sample[i,]<span class="ot">=</span>phi.new</span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a>After running the code, 5000 posterior samples of $\phi$ and $\nu$ are stored in <span class="in">`phi.sample`</span> and <span class="in">`nu.sample`</span>.</span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a>The h-step ahead prediction can be obtained by the following code:</span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a><span class="do">## the prediction function</span></span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a>y_pred_h_step<span class="ot">=</span><span class="cf">function</span>(h.step,s){</span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a> phi.cur<span class="ot">=</span><span class="fu">matrix</span>(phi.sample[s,],<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a> nu.cur<span class="ot">=</span>nu.sample[s]</span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a> y.cur<span class="ot">=</span><span class="fu">c</span>(y.sample[<span class="dv">200</span>],y.sample[<span class="dv">199</span>])</span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a> y.pred<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,h.step)</span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>h.step) {</span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a>  mu.y<span class="ot">=</span><span class="fu">sum</span>(y.cur<span class="sc">*</span>phi.cur)</span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a>  y.new<span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">1</span>,mu.y,<span class="fu">sqrt</span>(nu.cur))</span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a>  y.pred[i]<span class="ot">=</span>y.new</span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a>  y.cur<span class="ot">=</span><span class="fu">c</span>(y.new,y.cur)</span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a>  y.cur<span class="ot">=</span>y.cur[<span class="sc">-</span><span class="fu">length</span>(y.cur)]</span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(y.pred)</span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a>For illustration purposes, we obtain 3-step ahead predictions. The posterior distribution of $Y_{201}, Y_{202}, Y_{203}$, denoted as $Y_{201}, Y_{202}, Y_{203}$, is </span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a>given by:</span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a>y.post.pred.ahead<span class="ot">=</span><span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>, <span class="cf">function</span>(s){<span class="fu">y_pred_h_step</span>(<span class="at">h.step=</span><span class="dv">3</span>,<span class="at">s=</span>s)})</span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y.post.pred.ahead[<span class="dv">1</span>,],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(y[<span class="dv">201</span>]),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y.post.pred.ahead[<span class="dv">1</span>,]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y.post.pred.ahead[<span class="dv">2</span>,],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(y[<span class="dv">202</span>]),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y.post.pred.ahead[<span class="dv">2</span>,]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(y.post.pred.ahead[<span class="dv">3</span>,],<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="fu">expression</span>(y[<span class="dv">203</span>]),<span class="at">main=</span><span class="st">""</span>)</span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(y.post.pred.ahead[<span class="dv">3</span>,]),<span class="at">type=</span><span class="st">'l'</span>,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a>summary.vec95<span class="ot">=</span><span class="cf">function</span>(vec){</span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a> <span class="fu">c</span>(<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.025</span>)),<span class="fu">mean</span>(vec),<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.975</span>)))</span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(y.post.pred.ahead,<span class="at">MARGIN=</span><span class="dv">1</span>,summary.vec95)</span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a>Posterior mean and 95% confidence interval for $\phi_1$ and $\phi_2$ can be obtained by</span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lst-capstone-ar-prediction-example-2</span></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a>summary.vec95<span class="ot">=</span><span class="cf">function</span>(vec){</span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a> <span class="fu">c</span>(<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.025</span>)),<span class="fu">mean</span>(vec),<span class="fu">unname</span>(<span class="fu">quantile</span>(vec,<span class="fl">0.975</span>)))</span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(y.post.pred.ahead,<span class="at">MARGIN=</span><span class="dv">1</span>,summary.vec95)</span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extended AR model 📖 {#sec-capstone-extended-ar-model}</span></span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a>This is a five page <span class="co">[</span><span class="ot">Arima handout</span><span class="co">](handouts/c5-Honor-Extend-AR-model.pdf)</span></span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a>I have however added some callouts with question and counterexamples to assist my understanding of this and earlier material.</span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extending AR Models for Complex Time Series Data</span></span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a>After we finished learning the materials from this module, you may wonder why we started with AR models. </span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a>As we mentioned at the beginning, <span class="co">[</span><span class="ot">AR models are central to stationary time series data analysis and, as components of larger models or in suitably modified and generalized forms, underlie nonstationary time-varying models.</span><span class="co">]</span>{.mark} </span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a>This reading material will give examples about extending AR models for complex time series data. </span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a>Hopefully these notes will help you build up confidence to this relatively simple model.</span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a><span class="fu">### Autoregressive Moving Average Models (ARMA)</span></span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Characteristic polynomial of AR processes</span></span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a>\index{AR(p)!causal} \index{AR(p)!{causality condition}}</span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">causal Ar(p)</span><span class="co">]</span>{.column-margin} An *AR(p)* process $y_t$ is said to be *causal* if it can be written as a one-sided linear process dependent on the past</span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a>y_t= \Phi(\operatorname{B})\varepsilon_t= \sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j}</span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-arp-linear-parm}</span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a>\index{AR(p)!characteristic polynomial} \index{AR(P)!{backshift operator}}</span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a>Where $\operatorname{B}$ is the backshift operator, with $\operatorname{B}\varepsilon_{t} = \varepsilon_{t−1}$, $\psi_0 = 1$ and $\sum_{j=0}^{\infty} |\psi_j | &lt; \infty$.</span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a>$y_t$ is causal only when **the autoregressive characteristic polynomial**, defined as</span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a>\Phi(u) = 1 - \sum_{j=1}^{p} \phi_j u^j</span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-arp-characteristic-polynomial}</span>
<span id="cb27-746"><a href="#cb27-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-747"><a href="#cb27-747" aria-hidden="true" tabindex="-1"></a>\index{AR(p)!stationarity} \index{AR(p)!{stationarity condition}}</span>
<span id="cb27-748"><a href="#cb27-748" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">causality $\implies$ stationarity</span><span class="co">]</span>{.column-margin} Has roots with moduli greater than unity. That is, $y_t$ is causal if $\Phi(u) = 0$ only when $|u| &gt; 1$. </span>
<span id="cb27-749"><a href="#cb27-749" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">This *causality* condition implies *stationarity*, and so it is often referred as the stationary condition in the time series literature.</span><span class="co">]</span>{.mark}</span>
<span id="cb27-750"><a href="#cb27-750" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">stationary condition</span><span class="co">]</span>{.column-margin} The autoregressive characteristic polynomial can also be written as $\Phi(u) = \prod_{j=1}^{p}(1 - \alpha_j u)$, so that its roots are the reciprocals of the $\alpha_j$'s. </span>
<span id="cb27-751"><a href="#cb27-751" aria-hidden="true" tabindex="-1"></a>The $\alpha_j$'s may be real-valued or may appear as pairs of complex conjugates.</span>
<span id="cb27-752"><a href="#cb27-752" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Either way, if $|\alpha_j| &lt; 1$ for all $j$, the process is stationary.</span><span class="co">]</span>{.mark}</span>
<span id="cb27-753"><a href="#cb27-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-754"><a href="#cb27-754" aria-hidden="true" tabindex="-1"></a><span class="fu">### Structure of ARMA models</span></span>
<span id="cb27-755"><a href="#cb27-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-756"><a href="#cb27-756" aria-hidden="true" tabindex="-1"></a>Consider a time series $y_t$, for $t = 1, 2, \cdots$, arising from the model</span>
<span id="cb27-757"><a href="#cb27-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-758"><a href="#cb27-758" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-759"><a href="#cb27-759" aria-hidden="true" tabindex="-1"></a>y_t= \sum_{i=1}^{p} \phi_i y_{t-i} + \sum_{j=1}^{q} \theta_j \varepsilon_{t-j} + \varepsilon_t</span>
<span id="cb27-760"><a href="#cb27-760" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-definition}</span>
<span id="cb27-761"><a href="#cb27-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-762"><a href="#cb27-762" aria-hidden="true" tabindex="-1"></a>\index{ARMA(p,q)} </span>
<span id="cb27-763"><a href="#cb27-763" aria-hidden="true" tabindex="-1"></a>With $\varepsilon_t \sim \mathcal{N}(0, \nu)$. </span>
<span id="cb27-764"><a href="#cb27-764" aria-hidden="true" tabindex="-1"></a>Then, $<span class="sc">\{</span>y_t<span class="sc">\}</span>$ follows an autoregressive moving average model, or *ARMA(p, q)*, where $p$ and $q$ are the orders of the autoregressive and moving average parts, respectively. <span class="co">[</span><span class="ot">ARMA(p,q)</span><span class="co">]</span>{.column-margin}</span>
<span id="cb27-765"><a href="#cb27-765" aria-hidden="true" tabindex="-1"></a>\index{MA(q)}</span>
<span id="cb27-766"><a href="#cb27-766" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">When $p = 0$, $\{y_t\}$ is said to be a *moving average process* of order $q$ or *MA(q)*.</span><span class="co">]</span>{.mark} </span>
<span id="cb27-767"><a href="#cb27-767" aria-hidden="true" tabindex="-1"></a>Similarly, <span class="co">[</span><span class="ot">when $q = 0$, $\{y_t\}$ is an *autoregressive process* of order $p$ or *AR(p)*.</span><span class="co">]</span>{.mark}</span>
<span id="cb27-768"><a href="#cb27-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-769"><a href="#cb27-769" aria-hidden="true" tabindex="-1"></a>::: {#exm-capstone-ma-process}</span>
<span id="cb27-770"><a href="#cb27-770" aria-hidden="true" tabindex="-1"></a><span class="fu">## MA(1) process</span></span>
<span id="cb27-771"><a href="#cb27-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-772"><a href="#cb27-772" aria-hidden="true" tabindex="-1"></a>If $<span class="sc">\{</span>y_t<span class="sc">\}</span>$ follows a MA(1) process, $y_t = \theta y_{t-1} + \varepsilon_t$, the process is stationary for all the values of $\theta$. </span>
<span id="cb27-773"><a href="#cb27-773" aria-hidden="true" tabindex="-1"></a>In addition, it is easy to see that the autocorrelation function has the following form:</span>
<span id="cb27-774"><a href="#cb27-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-775"><a href="#cb27-775" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-776"><a href="#cb27-776" aria-hidden="true" tabindex="-1"></a>\rho(h) =</span>
<span id="cb27-777"><a href="#cb27-777" aria-hidden="true" tabindex="-1"></a>\begin{cases}</span>
<span id="cb27-778"><a href="#cb27-778" aria-hidden="true" tabindex="-1"></a>1 &amp; h = 0 <span class="sc">\\</span></span>
<span id="cb27-779"><a href="#cb27-779" aria-hidden="true" tabindex="-1"></a>\frac{\theta}{1 + \theta^2} &amp; h = 1 <span class="sc">\\</span></span>
<span id="cb27-780"><a href="#cb27-780" aria-hidden="true" tabindex="-1"></a>0 &amp; \text{o.w.}</span>
<span id="cb27-781"><a href="#cb27-781" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb27-782"><a href="#cb27-782" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ma-1-autocorrelation}</span>
<span id="cb27-783"><a href="#cb27-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-784"><a href="#cb27-784" aria-hidden="true" tabindex="-1"></a>Now, if we consider a *MA(1)* process with coefficient 1 instead of $\theta$, we would obtain the same correlation function, and so it would be impossible to determine which of the two processes generated the data. </span>
<span id="cb27-785"><a href="#cb27-785" aria-hidden="true" tabindex="-1"></a>\index{MA(1)!identifiability condition}</span>
<span id="cb27-786"><a href="#cb27-786" aria-hidden="true" tabindex="-1"></a>Therefore, it is necessary to impose identifiability conditions on $\theta$. </span>
<span id="cb27-787"><a href="#cb27-787" aria-hidden="true" tabindex="-1"></a>In particular, $\frac{1}{\theta} &gt; 1$ is the identifiability condition for a *MA(1)*, which is also known as the invertibility condition, given that it implies that the MA process can be "inverted" into an infinite order $AR$ process. <span class="co">[</span><span class="ot">invertibility condition</span><span class="co">]</span>{.column-margin}</span>
<span id="cb27-788"><a href="#cb27-788" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-789"><a href="#cb27-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-790"><a href="#cb27-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-791"><a href="#cb27-791" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">In general, a *MA(q)* process is identifiable or invertible only when the roots of the MA characteristic polynomial $\Theta(u) = 1 + \theta_1 u + \ldots + \theta_q u^q$ lie outside the unit circle.</span><span class="co">]</span>{.mark} In this case it is possible to write the MA process as an infinite order AR process.</span>
<span id="cb27-792"><a href="#cb27-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-793"><a href="#cb27-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-794"><a href="#cb27-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-795"><a href="#cb27-795" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb27-796"><a href="#cb27-796" aria-hidden="true" tabindex="-1"></a><span class="fu">## Order $\neq$ Memory of MA(p) or AR(q) processes</span></span>
<span id="cb27-797"><a href="#cb27-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-798"><a href="#cb27-798" aria-hidden="true" tabindex="-1"></a>Throughout this unit and also before we are told about a finite order $AR(p) \eq MA(\infty)$  and $MA(q)=AR(\infty)$. If like me you think this is a strange claim then perhaps you don't understand the AR(1) and the MA(1) processes as well as you think.</span>
<span id="cb27-799"><a href="#cb27-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-800"><a href="#cb27-800" aria-hidden="true" tabindex="-1"></a>The main issue here is understanding the relation of the parameters AR(p) and MA(q) and the memory of the process. If at some point you equate p or q in these processes to their memory you are due to a rude awakening. P and Q are just the number of parameters in the AR or MA process, they are the dimensions of matrices that represent the process.</span>
<span id="cb27-801"><a href="#cb27-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-802"><a href="#cb27-802" aria-hidden="true" tabindex="-1"></a>However, the actual memory of the process is determined by the behavior of the coefficients as the time goes to infinity. We can show how AR(1) and MA(1) can easily remember infinite number of past values. </span>
<span id="cb27-803"><a href="#cb27-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-804"><a href="#cb27-804" aria-hidden="true" tabindex="-1"></a>When we wish to represent such an AR(1) or MA(1) using their opposite we will quickly find counterexamples that require infinite number of parameters to represent the same process. In fact I would venture to say that only trivial or specially constructed AR and MA processes (e.g., white noise) are mutual finite-order representations. Most are infinite in one form or the other.</span>
<span id="cb27-805"><a href="#cb27-805" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-806"><a href="#cb27-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-807"><a href="#cb27-807" aria-hidden="true" tabindex="-1"></a>::: {#exm-capstone-ma1-process}</span>
<span id="cb27-808"><a href="#cb27-808" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔴 AR(1) That Can't Be Represented as Finite MA(q)</span></span>
<span id="cb27-809"><a href="#cb27-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-810"><a href="#cb27-810" aria-hidden="true" tabindex="-1"></a>Consider the stationary AR(1) process:</span>
<span id="cb27-811"><a href="#cb27-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-812"><a href="#cb27-812" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-813"><a href="#cb27-813" aria-hidden="true" tabindex="-1"></a>Y_t = \phi Y_{t-1} + \varepsilon_t, \quad |\phi| &lt; 1</span>
<span id="cb27-814"><a href="#cb27-814" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-815"><a href="#cb27-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-816"><a href="#cb27-816" aria-hidden="true" tabindex="-1"></a>The infinite MA(∞) representation is:</span>
<span id="cb27-817"><a href="#cb27-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-818"><a href="#cb27-818" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-819"><a href="#cb27-819" aria-hidden="true" tabindex="-1"></a>Y_t = \sum_{j=0}^{\infty} \phi^j \varepsilon_{t-j}</span>
<span id="cb27-820"><a href="#cb27-820" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-821"><a href="#cb27-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-822"><a href="#cb27-822" aria-hidden="true" tabindex="-1"></a>Suppose we ask: can we find any finite $q$ such that:</span>
<span id="cb27-823"><a href="#cb27-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-824"><a href="#cb27-824" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-825"><a href="#cb27-825" aria-hidden="true" tabindex="-1"></a>Y_t = \varepsilon_t + \theta_1 \varepsilon_{t-1} + \dots + \theta_q \varepsilon_{t-q}</span>
<span id="cb27-826"><a href="#cb27-826" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-827"><a href="#cb27-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-828"><a href="#cb27-828" aria-hidden="true" tabindex="-1"></a>Then we would need:</span>
<span id="cb27-829"><a href="#cb27-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-830"><a href="#cb27-830" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-831"><a href="#cb27-831" aria-hidden="true" tabindex="-1"></a>\phi^j = 0 \quad \text{for some finite } j &gt; q</span>
<span id="cb27-832"><a href="#cb27-832" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-833"><a href="#cb27-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-834"><a href="#cb27-834" aria-hidden="true" tabindex="-1"></a>But this is impossible unless $\phi = 0$, which trivializes the AR(1) to white noise.</span>
<span id="cb27-835"><a href="#cb27-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-836"><a href="#cb27-836" aria-hidden="true" tabindex="-1"></a>👉 **Therefore**: A stationary AR(1) process (with $\phi \neq 0$) has **infinite memory**, and cannot be exactly represented as a **finite MA(q)**.</span>
<span id="cb27-837"><a href="#cb27-837" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-838"><a href="#cb27-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-839"><a href="#cb27-839" aria-hidden="true" tabindex="-1"></a>Now here's a simple **counterexample** that shows a **finite AR(p)** can't always be expressed exactly as a **finite MA(q)**.</span>
<span id="cb27-840"><a href="#cb27-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-841"><a href="#cb27-841" aria-hidden="true" tabindex="-1"></a>::: {#exm-capstone-ar1-process}</span>
<span id="cb27-842"><a href="#cb27-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-843"><a href="#cb27-843" aria-hidden="true" tabindex="-1"></a><span class="fu">### 🔴 MA(1) That Can't Be Represented as Finite AR(p)</span></span>
<span id="cb27-844"><a href="#cb27-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-845"><a href="#cb27-845" aria-hidden="true" tabindex="-1"></a>Now consider an MA(1):</span>
<span id="cb27-846"><a href="#cb27-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-847"><a href="#cb27-847" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-848"><a href="#cb27-848" aria-hidden="true" tabindex="-1"></a>Y_t = \varepsilon_t + \theta \varepsilon_{t-1}, \quad \theta \neq 0</span>
<span id="cb27-849"><a href="#cb27-849" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-850"><a href="#cb27-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-851"><a href="#cb27-851" aria-hidden="true" tabindex="-1"></a>To write it as a finite AR(p), we would need:</span>
<span id="cb27-852"><a href="#cb27-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-853"><a href="#cb27-853" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-854"><a href="#cb27-854" aria-hidden="true" tabindex="-1"></a>Y_t = \phi_1 Y_{t-1} + \phi_2 Y_{t-2} + \dots + \varepsilon_t</span>
<span id="cb27-855"><a href="#cb27-855" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-856"><a href="#cb27-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-857"><a href="#cb27-857" aria-hidden="true" tabindex="-1"></a>But again, this fails except in special cases. For invertible $\theta$, we can write an **AR(∞)**:</span>
<span id="cb27-858"><a href="#cb27-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-859"><a href="#cb27-859" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-860"><a href="#cb27-860" aria-hidden="true" tabindex="-1"></a>Y_t = \sum_{j=1}^\infty \phi_j Y_{t-j} + \varepsilon_t</span>
<span id="cb27-861"><a href="#cb27-861" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-862"><a href="#cb27-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-863"><a href="#cb27-863" aria-hidden="true" tabindex="-1"></a>But truncating at any finite p yields approximation, not exact identity.</span>
<span id="cb27-864"><a href="#cb27-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-865"><a href="#cb27-865" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-866"><a href="#cb27-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-867"><a href="#cb27-867" aria-hidden="true" tabindex="-1"></a>For an *ARMA(p, q)* process, the stationary condition is given in terms of the AR coefficients, i.e., the process is causal only when the roots of the AR characteristic polynomial $\Phi(u) = 1 − \phi_1 u − \ldots − \phi_p u^p$ lie outside the unit circle.</span>
<span id="cb27-868"><a href="#cb27-868" aria-hidden="true" tabindex="-1"></a>The *ARMA* process is invertible only when the roots of the MA characteristic polynomial lie outside the unit circle.</span>
<span id="cb27-869"><a href="#cb27-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-870"><a href="#cb27-870" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">So, if the *ARMA* process is *causal* and *invertible*, it can be written either as a purely *AR* process of infinite order, or as a purely *MA* process of infinite order.</span><span class="co">]</span>{.mark}</span>
<span id="cb27-871"><a href="#cb27-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-872"><a href="#cb27-872" aria-hidden="true" tabindex="-1"></a>If $<span class="sc">\{</span>y_t<span class="sc">\}</span>$ follows an *ARMA(p,q)* we can write $\Phi(B)y_t = \Theta(B)\varepsilon_t$, with</span>
<span id="cb27-873"><a href="#cb27-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-874"><a href="#cb27-874" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-875"><a href="#cb27-875" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb27-876"><a href="#cb27-876" aria-hidden="true" tabindex="-1"></a>\Phi(B) &amp;= 1 − \phi_1\operatorname{B} − \ldots  − \phi_p\operatorname{B}^p <span class="sc">\\</span></span>
<span id="cb27-877"><a href="#cb27-877" aria-hidden="true" tabindex="-1"></a>\Theta(B) &amp;= 1 + \theta_1\operatorname{B} + \ldots + \theta_q\operatorname{B}^q</span>
<span id="cb27-878"><a href="#cb27-878" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb27-879"><a href="#cb27-879" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-characteristic-polynomials}</span>
<span id="cb27-880"><a href="#cb27-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-881"><a href="#cb27-881" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>where:</span>
<span id="cb27-882"><a href="#cb27-882" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>$\operatorname{B}$ is the backshift operator.</span>
<span id="cb27-883"><a href="#cb27-883" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>$\Phi(\operatorname{B})$ is the autoregressive characteristic polynomial of the ARMA model, with roots $\alpha_i$ and</span>
<span id="cb27-884"><a href="#cb27-884" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>$\Theta(\operatorname{B})$ is the moving average characteristic polynomial of the ARMA model, with roots $\beta_j$.</span>
<span id="cb27-885"><a href="#cb27-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-886"><a href="#cb27-886" aria-hidden="true" tabindex="-1"></a>If the process is causal then we can write it as a purely MA process of infinite order</span>
<span id="cb27-887"><a href="#cb27-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-888"><a href="#cb27-888" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-889"><a href="#cb27-889" aria-hidden="true" tabindex="-1"></a>y_t = \Phi(\operatorname{B})^{-1}\Theta(\operatorname{B})\varepsilon_t = \Psi(\operatorname{B})\varepsilon_t = \sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j}</span>
<span id="cb27-890"><a href="#cb27-890" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-polynomial-inversion}</span>
<span id="cb27-891"><a href="#cb27-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-892"><a href="#cb27-892" aria-hidden="true" tabindex="-1"></a>with $\Psi(\operatorname{B})$ such that $\Phi(\operatorname{B})\Psi(\operatorname{B}) = \Theta(\operatorname{B})$. The $\psi_j$ values can be found by solving the homogeneous difference equations given by:</span>
<span id="cb27-893"><a href="#cb27-893" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-894"><a href="#cb27-894" aria-hidden="true" tabindex="-1"></a>\psi_j − \sum_{h=1}^{p} \phi_h\psi_{j−h} = \theta_j, \qquad j \ge \max (p, q + 1)</span>
<span id="cb27-895"><a href="#cb27-895" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-inverted-parameters}</span>
<span id="cb27-896"><a href="#cb27-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-897"><a href="#cb27-897" aria-hidden="true" tabindex="-1"></a>where $\phi_h$ are the AR coefficients and $\psi_j$ are the MA coefficients.</span>
<span id="cb27-898"><a href="#cb27-898" aria-hidden="true" tabindex="-1"></a>with initial conditions:</span>
<span id="cb27-899"><a href="#cb27-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-900"><a href="#cb27-900" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-901"><a href="#cb27-901" aria-hidden="true" tabindex="-1"></a>\psi_j − \sum_{h=1}^{j} \phi_h\psi_{j−h} = \theta_j , \qquad 0 ≤ j &lt; \max(p, q + 1) </span>
<span id="cb27-902"><a href="#cb27-902" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-coefficients-initial}</span>
<span id="cb27-903"><a href="#cb27-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-904"><a href="#cb27-904" aria-hidden="true" tabindex="-1"></a>and $θ_0$. </span>
<span id="cb27-905"><a href="#cb27-905" aria-hidden="true" tabindex="-1"></a>The general solution to the Equations @eq-capstone-polynomial-inversion and @eq-capstone-inverted-parameters is given by</span>
<span id="cb27-906"><a href="#cb27-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-907"><a href="#cb27-907" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-908"><a href="#cb27-908" aria-hidden="true" tabindex="-1"></a>\psi_j = \alpha_1^j p_1(j) + \ldots + \alpha_r^j p_r(j)</span>
<span id="cb27-909"><a href="#cb27-909" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-inversion-general-solution}</span>
<span id="cb27-910"><a href="#cb27-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-911"><a href="#cb27-911" aria-hidden="true" tabindex="-1"></a>where $\alpha_1, \ldots, \alpha_r$ are the reciprocal roots of the characteristic polynomial $\Phi(u) = 0$, with multiplicities $m_1, \ldots, m_r$, respectively, and each $p_i(j)$ is a polynomial of degree $m_i - 1$.</span>
<span id="cb27-912"><a href="#cb27-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-913"><a href="#cb27-913" aria-hidden="true" tabindex="-1"></a>So the infinite decomposition yield a finite outcome!</span>
<span id="cb27-914"><a href="#cb27-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-915"><a href="#cb27-915" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">TODO</span><span class="co">: find the precise references in the book --&gt;</span></span>
<span id="cb27-916"><a href="#cb27-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-917"><a href="#cb27-917" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Inversion of AR components</span></span>
<span id="cb27-918"><a href="#cb27-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-919"><a href="#cb27-919" aria-hidden="true" tabindex="-1"></a>In contexts where the time series has a reasonable length ^<span class="co">[</span><span class="ot">what is reasonable length? interpolation theorem lets us overfit to any length n with n+1 parameters</span><span class="co">]</span>, we can fit long order AR models rather than ARMA or other, more complex forms. <span class="co">[</span><span class="ot">One key reason is that the statistical analysis, at least the conditional analysis based on fixed initial values, is much easier.</span><span class="co">]</span>{.mark}</span>
<span id="cb27-920"><a href="#cb27-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-921"><a href="#cb27-921" aria-hidden="true" tabindex="-1"></a>If this view is adopted in a given problem, it may be informative to use the results of an AR analysis to explore possible *MA* component structure using the device of **inversion**, or **partial inversion**, of the AR model. <span class="co">[</span><span class="ot">inversion</span><span class="co">]</span>{.column-margin}</span>
<span id="cb27-922"><a href="#cb27-922" aria-hidden="true" tabindex="-1"></a>Assume that $<span class="sc">\{</span>y_t<span class="sc">\}</span>$ follows an *AR(p)* model with parameter vector $\phi = (\phi_1, \ldots, \phi_p)^\top$,</span>
<span id="cb27-923"><a href="#cb27-923" aria-hidden="true" tabindex="-1"></a>so we can write</span>
<span id="cb27-924"><a href="#cb27-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-925"><a href="#cb27-925" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-926"><a href="#cb27-926" aria-hidden="true" tabindex="-1"></a>\Phi(\operatorname{B})y_t= \prod_{i=1}^{p}(1 - \alpha_iB)y_t = \varepsilon_t </span>
<span id="cb27-927"><a href="#cb27-927" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-definition-AR}</span>
<span id="cb27-928"><a href="#cb27-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-929"><a href="#cb27-929" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb27-930"><a href="#cb27-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-931"><a href="#cb27-931" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\varepsilon_t \sim \mathcal{N}(0, \nu)$ is a white noise process, and </span>
<span id="cb27-932"><a href="#cb27-932" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\Phi(\operatorname{B})$ is the autoregressive characteristic polynomial of the AR model, with roots $\alpha_i$ and</span>
<span id="cb27-933"><a href="#cb27-933" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha_i$ are the autoregressive characteristic reciprocal roots.</span>
<span id="cb27-934"><a href="#cb27-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-935"><a href="#cb27-935" aria-hidden="true" tabindex="-1"></a>For some positive integer $r &lt; p$, suppose that the final $p − r$ reciprocal roots are identified as having moduli less than unity; some or all of the first $r$ roots may also represent stationary components, though that is not necessary for the following development. Then, we can rewrite the model as</span>
<span id="cb27-936"><a href="#cb27-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-937"><a href="#cb27-937" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-938"><a href="#cb27-938" aria-hidden="true" tabindex="-1"></a>\prod_{i=1}^{r}(1 - \alpha_iB) y_t = \prod_{i=r+1}^{p}(1 - \alpha_iB)^{-1} \varepsilon_t = \Psi^*(B) \varepsilon_t</span>
<span id="cb27-939"><a href="#cb27-939" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-inversion}</span>
<span id="cb27-940"><a href="#cb27-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-941"><a href="#cb27-941" aria-hidden="true" tabindex="-1"></a>Where the implicitly infinite order MA component has the coefficients of the infinite order polynomial. </span>
<span id="cb27-942"><a href="#cb27-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-943"><a href="#cb27-943" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-944"><a href="#cb27-944" aria-hidden="true" tabindex="-1"></a>\Psi^*(B) = \prod_{i=1}^{r}(1 - \alpha_iB)^{-1} \prod_{i=r+1}^{p}(1 - \alpha_iB)^{-1}</span>
<span id="cb27-945"><a href="#cb27-945" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-inversion}</span>
<span id="cb27-946"><a href="#cb27-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-947"><a href="#cb27-947" aria-hidden="true" tabindex="-1"></a>So we have the representation</span>
<span id="cb27-948"><a href="#cb27-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-949"><a href="#cb27-949" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-950"><a href="#cb27-950" aria-hidden="true" tabindex="-1"></a>y_t = \sum \phi^*_j y_{t−j} + \varepsilon_t + \sum_{j=1}^{\infty} ψ^*_j \varepsilon_{t−j}</span>
<span id="cb27-951"><a href="#cb27-951" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-ARMA-inversion}</span>
<span id="cb27-952"><a href="#cb27-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-953"><a href="#cb27-953" aria-hidden="true" tabindex="-1"></a>where $\phi^*_j$ are the new AR coefficients and $\psi^*_j$ are the new MA coefficients.</span>
<span id="cb27-954"><a href="#cb27-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-955"><a href="#cb27-955" aria-hidden="true" tabindex="-1"></a>where the r new AR coefifients φ∗</span>
<span id="cb27-956"><a href="#cb27-956" aria-hidden="true" tabindex="-1"></a>j , for j = 1, · · · , r, are defined by the characteristic equation</span>
<span id="cb27-957"><a href="#cb27-957" aria-hidden="true" tabindex="-1"></a>Φ∗(u) = (1 − αiu) = 0. The MA terms ψ∗</span>
<span id="cb27-958"><a href="#cb27-958" aria-hidden="true" tabindex="-1"></a>j can be easily calculated recursively, up to some</span>
<span id="cb27-959"><a href="#cb27-959" aria-hidden="true" tabindex="-1"></a>appropriate upper bound on their number, say q. </span>
<span id="cb27-960"><a href="#cb27-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-961"><a href="#cb27-961" aria-hidden="true" tabindex="-1"></a>Explicitly, they are recursively computed as follows.</span>
<span id="cb27-962"><a href="#cb27-962" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Initialize the algorithm by setting $\psi^*_i = 0 \quad \forall i \in <span class="sc">\{</span>1:q<span class="sc">\}</span>$.</span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>For $i = (r + 1) : p$, update $\psi^*_1 = \psi^*_1 + \alpha_i$, and then</span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>for $j = 2 : q$, update $\psi^*_j = \psi^*_j + \alpha_i\psi^*_j−1$.</span>
<span id="cb27-965"><a href="#cb27-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-966"><a href="#cb27-966" aria-hidden="true" tabindex="-1"></a>Suppose $\phi$ is set at some estimate, such as a posterior mean, in the AR(p) model analysis.</span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a>The above calculations can be performed for any specified value of $r$ to compute the corresponding MA coefficients in an inversion to the approximating ARMA(r, q) model. If the posterior for $\phi$ is sampled in the AR analysis, the above computations can be performed repeated for all sampled $\phi$ vectors, so producing corresponding samples of the ARMA parameters $\phi^*$ and $\psi^*$. </span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a>Thus, inference in various relevant ARMA models can be directly, and quite easily, deduced by inversion of longer order AR models.</span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a>Typically, various values of $r$ will be explored.</span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a>Guidance is derived from the estimated amplitudes and, in the case of complex roots, periods of the roots of the AR model.</span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a>Analyses in which some components are persistent suggest that these components should be retained in the AR description.</span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a>The remaining roots, typically corresponding to high frequency characteristics in the data with lower moduli, are then the candidates for inversion to what will often be a relatively low order MA component. </span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a>The calculations can be repeated, sequentially increasing $q$ and exploring inferences</span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a>about the MA parameters, to assess a relevant approximating order.</span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a><span class="fu">###  Smoothing and Differencing</span></span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a>Many time series models are built under the stationary assumption. </span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a>However, in many practical scenarios the data are realizations from one or several nonstationary processes. </span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a>In this case, methods that aim to eliminate the nonstationary components are often used. The idea is to separate the nonstationary components, such as trends or seasonality, from the stationary ones so that the latter can be carefully studied via traditional time series models such as the aforementioned ARMA models. </span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a>We briefly discuss two methods that are commonly used in practice for detrending and smoothing.</span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Differencing</span></span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a>Differencing is used to remove trends in time series data. The first difference of a time series is</span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a>defined in terms of the difference operator that we denoted as D, that produces the transformation</span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a>Dyt = yt − yt−1. Higher order differences are obtained by successively applying the operator D.</span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a>For example</span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a>D^2y_t = D(Dy_t) = D(y_t − y_{t−1}) = y_t − 2y_{t−1} + y_{t−2}</span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-differencing}</span>
<span id="cb27-996"><a href="#cb27-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-997"><a href="#cb27-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a>Differencing can also be written in terms of the so called backshift operator B, with Byt = yt−1 so that $Dy_t = (1 − B)y_t \text{ and } D^dy_t = (1 − B)^dy_t$.</span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Moving Averages</span></span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a>Moving averages is a method commonly used to 'smooth' a time series by removing certain features (e.g., seasonality) to highlight other features (e.g., trends). </span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a>A moving average is a weighted average of the time series around a particular time t. </span>
<span id="cb27-1005"><a href="#cb27-1005" aria-hidden="true" tabindex="-1"></a>In general, if we have data $y_{1:T}$ , we could obtain a new time series such that</span>
<span id="cb27-1006"><a href="#cb27-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a>z_t = \sum_{j=−q}^p a_j y_{t+j}</span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-moving-average}</span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a>where $a_j$ are the weights, which can be chosen to be symmetric or asymmetric, and $q$ and $p$ are the number of past and future observations used in the average.</span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a>for $t = (q + 1) : (T − p)$, with $a_j \ge 0$ and $\sum_{j=−q}^p a_j = 1$. Usually $p = q$ and $a_j = a_{−j}$. For example,</span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a>to remove seasonality in monthly data, one can use a moving average with $p = 6$, $a_6 = a_{−6} = 1/24$,</span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a>and $a_j = a_{−j} = 1/12$ for $k = 0, \ldots , 5$, resulting in:</span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a>z_t = \frac{1}{24} y_{t−6} + \frac{1}{12} y_{t−5} + \ldots + \frac{1}{12} y_{t+5} + \frac{1}{24} y_{t+6}</span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a>$$ {#eq-capstone-moving-average-example}</span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">### Epilogue</span></span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a>With the methodology we have discussed in this lesson, you should now be confident that the *AR* models can deal with a large class of time series data. </span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a>In practice, one can first check the stationarity of the time series. </span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a>If it contains nonstationary features, try using some detrending, deseasonalizing and smoothing method. </span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a>Then for the resulting stationary series, using *ARMA* models and perform the inference by fitting a longer order *AR* model and inverting *AR* components.</span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quasi-periodic data</span></span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a>Great that might help if the data is periodic or has a trend. But what if the data is quasi-periodic so that the model cannot be made stationary by differencing or smoothing?</span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a>In such a case a state-space methods should be used.</span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Oren Bochman</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":true,"openEffect":"fade","selector":".lightbox","skin":"my-css-class"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>