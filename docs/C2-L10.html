<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.11">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oren Bochman">
<meta name="keywords" content="Poisson regression, Bayesian statistics, R programming, statistical modeling, count data, Poisson distribution, over dispersion, zero-inflated models">
<meta name="description" content="An overview of Poisson regression in the context of Bayesian statistics.">

<title>Poisson regression – Bayesian Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-923206e44a13b4518db4dede9f4ebdc9.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-279bd408c6dfe7bd56e8b154fe269440.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-37379e3bbb48fc9e4c504b22bdb22879.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-e12ace95bce8268b44b48d9ebb190a16.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-37379e3bbb48fc9e4c504b22bdb22879.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C2-L01.html">2. Techniques and Models</a></li><li class="breadcrumb-item"><a href="./C2-L10.html">Poisson regression</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bayesian Statistics</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Intro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Bayesian Statistics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">1. From Concept to Data Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L01-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on paradigms of probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes’ Theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability and Bayes’ Law</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditional Probability and Bayes’ Law</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Random Variables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frequentist Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework - Frequentist MLE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Likelihoods and MLEs</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Bayesian Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Posterior Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Binomial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Poisson Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Poisson Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Honors Quiz - Beta Bernoulli</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exponential Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework exponential data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normally distributed Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Normal data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-Informative Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Alternative Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Brief Review of Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">—</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C1-L12-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Honnors Homework On Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">2. Techniques and Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Modeling and Monte Carlo estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monte Carlo estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metropolis-Hastings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on the Metropolis-Hastings algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gibbs sampling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW - Gibbs-Sampling algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assessing Convergence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on the Gibbs-Sampling algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L06-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Honnors Homework on M-H algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes - Linear regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW on Linear Regression Model Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L07-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW - Deviance information criterion (DIC)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW on ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L08-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HW+ - Multiple Factor ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistic regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L09-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Poisson regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L10-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Poisson regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hierarchical modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Hierarchical Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L11-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Non-Normal Hierarchical Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Capstone Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C2-L12-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework on Predictive distributions and mixture models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">3. Mixture Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex1-Basic-Definitions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex2-Gaussian-mixtures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixtures of Gaussians</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex3-Zero-Inflated-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Definition of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex4-Def-mixture-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zero inflated distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L01-Ex6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Concepts of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The EM algorithm for zero-inflated mixtures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The EM algorithm for Zero-Inflated Mixtures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L02-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The EM algorithm for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MCMC for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The MCMC algorithm for Zero-Inflated Mixtures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L03-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markov chain Monte Carlo algorithms for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Applications of Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Old Faithful eruptions density estimation with the EM algorithm</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Old Faithful eruptions density estimation with the MCMC algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L04-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Mixture Models for Classification of Banknotes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Practical Considerations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computational considerations for Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Information Criteria (BIC)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Estimating the number of components in Bayesian settings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Estimating the partition structure in Bayesian models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C3-L05-Ex5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The MCMC algorithm for Zero-Inflated Mixtures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">4. Time series Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L00.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 0: Introductions to time series analysis and the AR(1) process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductions to Time Series analysis &amp; the AR(1) process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The AR(p) process</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normal Dynamic Linear Models, Part 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normal Dynamic Linear Models, Part 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./C4-L06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 0: Feyman Notebook on Bayesian Time Series Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">5. Capstone Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">C5-L01.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">6. Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Notation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Discrete Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Continuous Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Exponents &amp; Logarithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: The Law of Large Numbers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: The Central Limit Theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Conjugate Priors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Link Function</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayes by backprop</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./A12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Books in R &amp; Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-introduction-to-poisson-regression" id="toc-sec-introduction-to-poisson-regression" class="nav-link active" data-scroll-target="#sec-introduction-to-poisson-regression"><span class="header-section-number">1</span> Introduction to Poisson regression</a></li>
  <li><a href="#poisson-regression---jags-model" id="toc-poisson-regression---jags-model" class="nav-link" data-scroll-target="#poisson-regression---jags-model"><span class="header-section-number">2</span> Poisson regression - JAGS model</a>
  <ul class="collapse">
  <li><a href="#doctor-visits-model" id="toc-doctor-visits-model" class="nav-link" data-scroll-target="#doctor-visits-model"><span class="header-section-number">2.1</span> Doctor Visits Model</a></li>
  <li><a href="#model-checking---residuals" id="toc-model-checking---residuals" class="nav-link" data-scroll-target="#model-checking---residuals"><span class="header-section-number">2.2</span> Model checking - Residuals</a></li>
  </ul></li>
  <li><a href="#sec-predictive-distributions" id="toc-sec-predictive-distributions" class="nav-link" data-scroll-target="#sec-predictive-distributions"><span class="header-section-number">3</span> Predictive distributions</a>
  <ul class="collapse">
  <li><a href="#predictive-distributions" id="toc-predictive-distributions" class="nav-link" data-scroll-target="#predictive-distributions"><span class="header-section-number">3.1</span> Predictive distributions</a></li>
  </ul></li>
  <li><a href="#sec-prior-sensitivity-analysis" id="toc-sec-prior-sensitivity-analysis" class="nav-link" data-scroll-target="#sec-prior-sensitivity-analysis"><span class="header-section-number">4</span> Prior sensitivity analysis</a>
  <ul class="collapse">
  <li><a href="#poisson-regression-example" id="toc-poisson-regression-example" class="nav-link" data-scroll-target="#poisson-regression-example"><span class="header-section-number">4.1</span> Poisson regression example</a></li>
  </ul></li>
  <li><a href="#overdispersed-model" id="toc-overdispersed-model" class="nav-link" data-scroll-target="#overdispersed-model"><span class="header-section-number">5</span> Overdispersed model</a>
  <ul class="collapse">
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations"><span class="header-section-number">5.1</span> Transformations:</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./C2-L01.html">2. Techniques and Models</a></li><li class="breadcrumb-item"><a href="./C2-L10.html">Poisson regression</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Poisson regression</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Bayesian Statistics: Techniques and Models</p>
  <div class="quarto-categories">
    <div class="quarto-category">Monte Carlo Estimation</div>
  </div>
  </div>

<div>
  <div class="description">
    An overview of Poisson regression in the context of Bayesian statistics.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Oren Bochman </p>
          </div>
  </div>
    
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Poisson regression, Bayesian statistics, R programming, statistical modeling, count data, Poisson distribution, over dispersion, zero-inflated models</p>
  </div>
</div>

</header>


<p>Poisson regression is the preferred method to handle count data where the response is positive values but includes zeroes. The gist of this method is that We use a log transform link function on the regressors but not on the response which allows the response to be zero valued which correspond to zero counts. One limit of this approach mentioned below is that the Poisson takes one parameter <span class="math inline">\lambda</span> for both its expected value and its variance. We look give a deeper solution to this problem in the next course on mixture models, however in this course we will consider more restricted cases where we extend the Poisson regression with the <strong>Negative Binomial Distribution</strong> which allows us to model over-dispersed data.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Overdispersion
</div>
</div>
<div class="callout-body-container callout-body">
<p> In cases where the variance needs to be a separate feature of the model we can use an alternative model with additional free parameters may provide a better fit. In this case of count data, a Poisson mixture model like the Negative Binomial Distribution can be posited instead, in which the mean of the Poisson distribution can itself be thought of as a random variable drawn – from the Gamma distribution thereby introducing an additional free parameter</p>
<p>We don’t see the case of over-dispersion in this course but the next course is on mixture models.</p>
</div>
</div>
<section id="sec-introduction-to-poisson-regression" class="level2 page-columns page-full" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-introduction-to-poisson-regression"><span class="header-section-number">1</span> Introduction to Poisson regression</h2>

<div class="no-row-height column-margin column-container"><div id="fig-intro-poisson-regression" class="quarto-float quarto-figure quarto-figure-center anchored" data-group="slides">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intro-poisson-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="images/c2l10-ss-01-Poisson-Regression.png" class="lightbox" data-gallery="slides" title="Figure&nbsp;1: Introduction to Poisson regression"><img src="images/c2l10-ss-01-Poisson-Regression.png" class="img-fluid figure-img" width="200"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intro-poisson-regression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Introduction to Poisson regression
</figcaption>
</figure>
</div></div><p>We now have experience fitting regression models when the response is continuous, and when it is binary. What about when we have count data? We could fit a linear normal regression, but here we have a couple of drawbacks. First of all, counts usually aren’t negative. And the variances might not be constant. The Poisson distribution provides a natural likelihood for count data.</p>
<p><span class="math display">
y_i\mid \lambda+i \stackrel {iid} \sim \mathrm{Pois}(\lambda_i) \qquad i=1, \ldots, n
</span></p>
<p>Here, <span class="math inline">\lambda</span> conveniently represents the expected value of y <span class="math inline">\mathbb{E}[y].</span> It turns out that <span class="math inline">\lambda</span> is also the variance of y <span class="math inline">\mathbb{V}ar[y].</span> So if we expect a count to be higher, we also expect the variability in counts to go up.</p>
<p>We saw this earlier with the <em>warp breaks</em> data.</p>
<p>If we model the mean directly, like we did with linear regression. That is, we had the expected value yi was directly modeled with this linear form.</p>
<p><span class="math display">
\mathbb{E}[y]=\beta_0 + \beta_1x_i \qquad \text{(linear regression)}
</span></p>
<p>We would run into the same problem we did with logistic regression. The expected value has to be greater than zero in the Poisson distribution. To naturally deal with that restriction, we’re going to use the logarithmic link function.</p>
<p>So, the log link. That is, that the log of <span class="math inline">\lambda_i</span> is equal to this linear piece.</p>
<p>log link:</p>
<p><span id="eq-pr-log-link"><span class="math display">
log(\lambda_i) = \beta_0+\beta_1x_i \qquad \text{(log link)}
\tag{1}</span></span></p>
<p><span class="math display">
\mathbb{E}[y]=\beta_0+\beta_1x_i \qquad \text{(linear regression)}
</span></p>
<p>From this, we can easily recover the expression for the mean itself. That is, we can invert this link function to get the expected value of <span class="math inline">y_i,</span></p>
<p><span id="eq-poisson-regression-link"><span class="math display">
\implies \mathbb{E}[y] = \lambda_i = e^{\left(\beta_0+\beta_1x_i \right)}
\tag{2}</span></span></p>
<p>It might seem like this model is equivalent to fitting a normal linear regression to the log of <span class="math inline">y</span>. But there are a few key differences. <mark>In the normal regression, we’re modeling the mean of the response directly. So we would be fitting a model to the <span class="math inline">\log(y)</span>. Where we’re modeling the expected value of the <span class="math inline">\log(y)</span>. This is different from what we’re modeling here, here we’re doing the log of the expected value of <span class="math inline">y</span>.</mark></p>
<p><span class="math display">
\mathbb{E}[log(y)]\ne log(\mathbb{E}[y])
</span></p>
<p><mark>These are not equal, they’re usually similar, but they’re not the same. Another difference is that we have a separate independent parameter for the variants in a normal regression. In Poisson regression, the variance is automatically the same as <span class="math inline">\lambda</span>,</mark><span class="mark-red">which may not always be appropriate</span>, as we’ll see in an upcoming example.</p>
<p>As usual, we can add more explanatory x variables to the Poisson regression framework. They can be continuous, categorical, or they could be counts themselves.</p>
<p>If we have three predictor variables <span class="math inline">x_i = ( x_{1,i}, x_{2,i}, x_{3,i} ),</span> what would the likelihood part of the hierarchical representation of a Poisson regression with logarithmic link look like?</p>
<ul class="task-list">
<li><label><input type="checkbox"><span class="math inline">y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left( e^{-(\beta_0+\beta_1 x_{1,i}+\beta_2 x_{2,i}+\beta_3 x_{3,i})}\right)</span></label></li>
<li><label><input type="checkbox"><span class="math inline">y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left(\beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \beta_3 x_{3,i} \right)</span></label></li>
<li><label><input type="checkbox" checked=""><span class="math inline">y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left(e^{\beta_0 + \beta_1 x_{1,i}+\beta_2 x_{2,i}+\beta_3 x_{3,i}}\right)</span></label></li>
<li><label><input type="checkbox"><span class="math inline">y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left( \log[ \beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \beta_3 x_{3,i} ] \right)</span></label></li>
</ul>
<p>Here we incorporated the (inverse) link function directly into the likelihood rather than writing it with two lines.</p>
</section>
<section id="poisson-regression---jags-model" class="level2 page-columns page-full" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="poisson-regression---jags-model"><span class="header-section-number">2</span> Poisson regression - JAGS model</h2>
<div class="page-columns page-full"><p> For an example of Poisson regression, we’ll use the <code>badhealth</code> data set from the <code>COUNT</code> package in <code>R</code>.</p><div class="no-row-height column-margin column-container"><span class=""><strong>doctor visits</strong></span></div></div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"COUNT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: msme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sandwich</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"badhealth"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#?badhealth</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(badhealth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  numvisit badh age
1       30    0  58
2       20    0  54
3       16    0  44
4       20    0  57
5       15    0  33
6       15    0  28</code></pre>
</div>
</div>
<p>according to the description:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Data Card for <code>badhealth</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>1,127 observations from a 1998 German survey with 3 variables:</p>
<ol type="1">
<li><code>numvisit</code> - number of visits to the doctor in 1998 (<strong>response</strong>)</li>
<li><code>badh</code> - <span class="math inline">\begin{cases} 1 \qquad \text{ patient claims to be in bad health} \\ 0 \qquad \text{ patient does not claim to be in bad health} \end{cases}</span></li>
<li><code>age</code> - age of patient</li>
</ol>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(badhealth))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<ol type="1">
<li>remove na</li>
</ol>
<p>As usual, let’s visualize these data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(badhealth<span class="sc">$</span>numvisit, <span class="at">breaks=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-numvisits-histogram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-numvisits-histogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-numvisits-histogram-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Histogram of number of doctor visits"><img src="C2-L10_files/figure-html/fig-numvisits-histogram-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-numvisits-histogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Histogram of number of doctor visits
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">jitter</span>(<span class="fu">log</span>(numvisit)) <span class="sc">~</span> <span class="fu">jitter</span>(age), <span class="at">data=</span>badhealth, <span class="at">subset=</span>badh<span class="sc">==</span><span class="dv">0</span>, <span class="at">xlab=</span><span class="st">"age"</span>, <span class="at">ylab=</span><span class="st">"log(visits)"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(<span class="fu">log</span>(numvisit)) <span class="sc">~</span> <span class="fu">jitter</span>(age), <span class="at">data=</span>badhealth, <span class="at">subset=</span>badh<span class="sc">==</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-visits-by-age-health" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-visits-by-age-health-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-visits-by-age-health-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: "><img src="C2-L10_files/figure-html/fig-visits-by-age-health-1.png" id="fig-visits-by-age-health" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-visits-by-age-health-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
</div>
</div>
<section id="doctor-visits-model" class="level3 page-columns page-full" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="doctor-visits-model"><span class="header-section-number">2.1</span> Doctor Visits Model</h3>
<div class="page-columns page-full"><p> It appears that both age and bad health are related to the number of doctor visits. We should include model terms for both variables. <mark>If we believe the age/visits relationship is different between healthy and non-healthy populations, we should also include an interaction term</mark>. We will fit the full model here and leave it to you to compare it with the simpler additive model.</p><div class="no-row-height column-margin column-container"><span class=""><strong>doctor visits</strong></span></div></div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: coda</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linked to JAGS 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded modules: basemod,bugs</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) {</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dpois(lam[i])</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="st">        log(lam[i]) = int + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="st">    int ~ dnorm(0.0, 1.0/1e6)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>data_jags <span class="ot">=</span> <span class="fu">as.list</span>(badhealth)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"int"</span>, <span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod_string), <span class="at">data=</span>data_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1127
   Unobserved stochastic nodes: 4
   Total graph size: 3665

Initializing model</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod, <span class="fl">1e3</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>mod_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod,  <span class="at">variable.names=</span>params, <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>mod_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod_sim))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="do">## convergence diagnostics</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/define-poisson-jags-model-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="C2-L10_files/figure-html/define-poisson-jags-model-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

       Point est. Upper C.I.
b_age        1.01       1.03
b_badh       1.01       1.05
b_intx       1.01       1.05
int          1.01       1.03

Multivariate psrf

1.01</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           b_age    b_badh    b_intx       int
Lag 0  1.0000000 1.0000000 1.0000000 1.0000000
Lag 1  0.9592776 0.9680917 0.9705949 0.9567349
Lag 5  0.8422200 0.8795245 0.8862814 0.8418455
Lag 10 0.7210438 0.7853174 0.7963564 0.7205695
Lag 50 0.2620261 0.3147533 0.3268107 0.2579339</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod_csim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/define-poisson-jags-model-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="C2-L10_files/figure-html/define-poisson-jags-model-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   b_age   b_badh   b_intx      int 
251.1574 181.3245 163.0702 243.1021 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## compute DIC</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dic <span class="ot">=</span> <span class="fu">dic.samples</span>(mod, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-checking---residuals" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="model-checking---residuals"><span class="header-section-number">2.2</span> Model checking - Residuals</h3>
<blockquote class="blockquote">
<p>“While inexact models may mislead, attempting to allow for every contingency a priori is impractical. Thus models must be built by an iterative feedback process in which an initial parsimonious model may be modified when diagnostic checks applied to residuals indicate the need.” —G. E. P. Box</p>
</blockquote>
<p>To get a general idea of the model’s performance, we can look at predicted values and residuals as usual. Don’t forget that we must apply the inverse of the link function to get predictions for <span class="math inline">\lambda</span> .</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-14"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-14-1" class="code-annotation-target"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(badhealth[,<span class="sc">-</span><span class="dv">1</span>])</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-14-2" class="code-annotation-target"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(X, <span class="fu">with</span>(badhealth, badh<span class="sc">*</span>age))</span>
<span id="annotated-cell-14-3"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="1" data-code-annotation="1">we drop the first column since it is the column for our <code>y</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="2" data-code-annotation="2">we add a third column with <span class="math inline">\mathbb{I}_{badh}\times age</span></span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     badh age  
[1,]    0  58 0
[2,]    0  54 0
[3,]    0  44 0
[4,]    0  57 0
[5,]    0  33 0
[6,]    0  28 0</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-15"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-15-1" class="code-annotation-target"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">pmed_coef =</span> <span class="fu">apply</span>(mod_csim, <span class="dv">2</span>, median))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="1" data-code-annotation="1">this are the column medians of the coefficients.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       b_age       b_badh       b_intx          int 
 0.008520553  1.572654849 -0.010997422  0.346261276 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-16-1" class="code-annotation-target"><a href="#annotated-cell-16-1" aria-hidden="true" tabindex="-1"></a>llam_hat <span class="ot">=</span> pmed_coef[<span class="st">"int"</span>] <span class="sc">+</span> X <span class="sc">%*%</span> pmed_coef[<span class="fu">c</span>(<span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)]</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-16-2" class="code-annotation-target"><a href="#annotated-cell-16-2" aria-hidden="true" tabindex="-1"></a>lam_hat <span class="ot">=</span> <span class="fu">exp</span>(llam_hat)</span>
<span id="annotated-cell-16-3"><a href="#annotated-cell-16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-16-4"><a href="#annotated-cell-16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lam_hat)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="1" data-code-annotation="1"><span class="math inline">X \cdot \vec b_i</span> gives the linear part.</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="2" data-code-annotation="2"><span class="math inline">\hat\lambda_i=e^{X \cdot \vec b_i}</span> we need to apply the inverse link function</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/compute-llam-hat-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="C2-L10_files/figure-html/compute-llam-hat-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> badhealth<span class="sc">$</span>numvisit <span class="sc">-</span> lam_hat</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid) <span class="co"># the data were ordered</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/compute-residuals-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="C2-L10_files/figure-html/compute-residuals-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>this plot looks bad, it might not be iid but we can ignore the issue since the data is presorted/</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lam_hat, badhealth<span class="sc">$</span>numvisit)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lamhat-vs-numvisit" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lamhat-vs-numvisit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-lamhat-vs-numvisit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure&nbsp;4: "><img src="C2-L10_files/figure-html/fig-lamhat-vs-numvisit-1.png" id="fig-lamhat-vs-numvisit" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-lamhat-vs-numvisit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lam_hat[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)], resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)], <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>), <span class="at">ylab=</span><span class="st">"residuals"</span>, <span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(lambda)), <span class="at">ylim=</span><span class="fu">range</span>(resid))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(lam_hat[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)], resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)], <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-residuals-by-health" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuals-by-health-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-residuals-by-health-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;5: "><img src="C2-L10_files/figure-html/fig-residuals-by-health-1.png" id="fig-residuals-by-health" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-residuals-by-health-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</div>
</div>
<p>It is not surprising that the variability increases for values predicted at higher values since the mean is also the variance in the Poisson distribution. <mark>However, observations predicted to have about two visits should have variance about two, and observations predicted to have about six visits should have variance about six.</mark></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.022518</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 41.1961</code></pre>
</div>
</div>
<p>For this data the variance is much bigger this is not the case with these data. This indicates that <mark id="sp-overdispersed">either the model fits poorly (meaning the covariates don’t explain enough of the variability in the data), or the data are “<strong>overdispersed</strong>” for the Poisson likelihood we have chosen. This is a common issue with count data. If the data are more variable than the Poisson likelihood would suggest, a good alternative is the negative binomial distribution</mark>, which we will not pursue here.</p>
</section>
</section>
<section id="sec-predictive-distributions" class="level2 page-columns page-full" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="sec-predictive-distributions"><span class="header-section-number">3</span> Predictive distributions</h2>
<p>Assuming the model fit is adequate, we can interpret the results.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 2001:7000
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 5000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

           Mean       SD  Naive SE Time-series SE
b_age   0.00851 0.002124 1.735e-05      0.0001339
b_badh  1.57667 0.191172 1.561e-03      0.0143081
b_intx -0.01111 0.004426 3.613e-05      0.0003485
int     0.34585 0.082801 6.761e-04      0.0052871

2. Quantiles for each variable:

            2.5%       25%       50%       75%     97.5%
b_age   0.004404  0.007039  0.008521  0.009950  0.012776
b_badh  1.205415  1.448986  1.572655  1.700515  1.958368
b_intx -0.019954 -0.013983 -0.010997 -0.008115 -0.002525
int     0.178969  0.290351  0.346261  0.403344  0.503312</code></pre>
</div>
</div>
<p><mark>The <strong><em>intercept</em></strong> is not necessarily <em>interpretable</em> here because it corresponds to the number of doctor visits for a healthy 0-year-old. While the number of visits for a newborn baby sounds like interesting information, the youngest person in the data set is 20 years old.</mark> In such cases we should avoid making such projections and say that the intercept is an artifact of the model.</p>
<ul>
<li><p>For healthy individuals, it appears that <strong>age</strong> is associated with an <em>increase</em> in the Expected <em>number of doctor visits</em>.</p></li>
<li><p><strong>Bad health</strong> is associated with an <em>increase in expected number of visits</em>.</p></li>
<li><p>The interaction coefficient is interpreted as an adjustment to the age coefficient for people in bad health. Hence, for people with bad health, age is essentially unassociated with number of visits.</p></li>
</ul>
<section id="predictive-distributions" class="level3 page-columns page-full" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="predictive-distributions"><span class="header-section-number">3.1</span> Predictive distributions</h3>
<div class="page-columns page-full"><p>Let’s say we have two people aged 35, one in good health and the other in poor health. </p><div class="no-row-height column-margin column-container"><span class=""><strong>Q. What is the posterior probability that the individual with poor health will have more doctor visits?</strong></span></div></div>
<p><mark>This goes beyond the posterior probabilities we have calculated comparing expected responses in previous lessons. Here we will create Monte Carlo samples for the <strong>responses themselves</strong>. This is done by taking the Monte Carlo samples of the model parameters, and for each of those, drawing a sample from the likelihood</mark>.</p>
<p>Let’s walk through this.</p>
<p>First, we need the <span class="math inline">x</span> values for each individual. We’ll say the healthy one is Person 1 and the unhealthy one is Person 2. Their <span class="math inline">x</span> values are:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-23-1" class="code-annotation-target"><a href="#annotated-cell-23-1" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">0</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-23-2" class="code-annotation-target"><a href="#annotated-cell-23-2" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">35</span>, <span class="dv">35</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="1" data-code-annotation="1">good health person’s data (bad_health_indicator=0,age=35,age*indicator=0)</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="2" data-code-annotation="2">bad health person’s (bad_health_indicator=1,age=35,age*indicator=35)</span>
</dd>
</dl>
</div>
</div>
<p>The posterior samples of the model parameters are stored in <code>mod_csim</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mod_csim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Markov Chain Monte Carlo (MCMC) output:
Start = 1 
End = 7 
Thinning interval = 1 
           b_age   b_badh       b_intx       int
[1,] 0.005290453 1.529232 -0.009187788 0.4786304
[2,] 0.005052663 1.606766 -0.011027587 0.4227358
[3,] 0.005580439 1.596672 -0.010291266 0.4389609
[4,] 0.005597212 1.581482 -0.011181978 0.4460846
[5,] 0.006224239 1.564051 -0.011856860 0.4564888
[6,] 0.006001431 1.644581 -0.013174529 0.4539493
[7,] 0.006372604 1.696334 -0.014579037 0.4606763</code></pre>
</div>
</div>
<p>First, we’ll compute the linear part of the predictor:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>loglam1 <span class="ot">=</span> mod_csim[,<span class="st">"int"</span>] <span class="sc">+</span> mod_csim[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)] <span class="sc">%*%</span> x1</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>loglam2 <span class="ot">=</span> mod_csim[,<span class="st">"int"</span>] <span class="sc">+</span> mod_csim[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)] <span class="sc">%*%</span> x2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next we’ll apply the inverse link:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>lam1 <span class="ot">=</span> <span class="fu">exp</span>(loglam1)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lam2 <span class="ot">=</span> <span class="fu">exp</span>(loglam2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The final step is to use these samples for the <span class="math inline">\lambda</span> parameter for each individual and simulate actual number of doctor visits using the likelihood:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">n_sim =</span> <span class="fu">length</span>(lam1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15000</code></pre>
</div>
</div>
<p>we have distribution of 15000 samples of <span class="math inline">\lambda</span> for each person.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">table</span>(<span class="fu">factor</span>(y1, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">18</span>))<span class="sc">/</span>n_sim, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"posterior prob."</span>, <span class="at">xlab=</span><span class="st">"visits"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">table</span>(y2<span class="fl">+0.1</span>)<span class="sc">/</span>n_sim, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-posterior-predictive" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-posterior-predictive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-posterior-predictive-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;6: "><img src="C2-L10_files/figure-html/fig-posterior-predictive-1.png" id="fig-posterior-predictive" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-posterior-predictive-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode r code-annotation-code code-with-copy"><code class="sourceCode r"><span id="annotated-cell-28-1"><a href="#annotated-cell-28-1" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">=</span> <span class="fu">rpois</span>(<span class="at">n=</span>n_sim, <span class="at">lambda=</span>lam1)</span>
<span id="annotated-cell-28-2"><a href="#annotated-cell-28-2" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">=</span> <span class="fu">rpois</span>(<span class="at">n=</span>n_sim, <span class="at">lambda=</span>lam2)</span>
<span id="annotated-cell-28-3"><a href="#annotated-cell-28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-28-4"><a href="#annotated-cell-28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">table</span>(<span class="fu">factor</span>(y1, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">18</span>))<span class="sc">/</span>n_sim, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"posterior prob."</span>, <span class="at">xlab=</span><span class="st">"visits"</span>)</span>
<span id="annotated-cell-28-5"><a href="#annotated-cell-28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">table</span>(y2<span class="fl">+0.1</span>)<span class="sc">/</span>n_sim, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/compute-y1-y2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="C2-L10_files/figure-html/compute-y1-y2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can answer the original question: What is the probability that the person with poor health will have more doctor visits than the person with good health?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y2 <span class="sc">&gt;</span> y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.921</code></pre>
</div>
</div>
<p>Because we used our posterior samples for the model parameters in our simulation (the <code>loglam1</code> and <code>loglam2</code> step above), this posterior predictive distribution on the number of visits for these two new individuals naturally account for our uncertainty in the model estimates. This is a more honest/realistic distribution than we would get if we had fixed the model parameters at their MLE or posterior means and simulated data for the new individuals.</p>
</section>
</section>
<section id="sec-prior-sensitivity-analysis" class="level2 page-columns page-full" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="sec-prior-sensitivity-analysis"><span class="header-section-number">4</span> Prior sensitivity analysis</h2>
<div class="page-columns page-full"><p>  When communicating results from any analysis, a responsible statistician will report and justify <em>modeling decisions</em>, especially assumptions. In a Bayesian analysis, there is an additional assumption that is open to scrutiny: the <em>choices of prior distributions</em>. In the models considered so far in this course, there are an infinite number of prior distributions we could have chosen from. When communicating results from any analysis, a responsible statistician will report and justify <em>modeling decisions</em>, especially assumptions. In a Bayesian analysis, there is another assumption that is open to scrutiny: the <em>choices of prior distributions</em>. In the models considered so far in this course, there are an infinite number of prior distributions we could have chosen from.</p><div class="no-row-height column-margin column-container"><span class=""><strong>Q. How do you justify the model you choose?</strong></span></div></div>
<div class="page-columns page-full"><p> If they truly represent your beliefs about the parameters before analysis and the model is appropriate, then the posterior distribution truly represents your updated beliefs. If you don’t have any strong beliefs beforehand, there are often default, reference, or non-informative prior options, and you will have to select one. However, a collaborator or a boss (indeed, somebody somewhere) may not agree with your choice of prior. <mark>One way to increase the credibility of your results is to repeat the analysis under a variety of priors, and report how the results differ as a result.</mark> This process is called <em>prior sensitivity analysis</em>. </p><div class="no-row-height column-margin column-container"><span class=""><strong>Q. How do you justify the priors you choose?</strong></span></div></div>
<p><mark>At a minimum you should always report your choice of model and prior</mark>. If you include a sensitivity analysis, select one or more alternative priors and describe how the results of the analysis change. If they are sensitive to the choice of prior, you will likely have to explain both sets of results, or at least explain why you favor one prior over another. <mark>If the results are not sensitive to the choice of prior, this is evidence that the data are strongly driving the results. It suggests that different investigators coming from different backgrounds should come to the same conclusions.</mark></p>
<p><mark>If the purpose of your analysis is to establish a hypothesis, it is often prudent to include a “skeptical” prior which does not favor the hypothesis.</mark> Then, if the posterior distribution still favors the hypothesis despite the unfavorable prior, you will be able to say that the data substantially favor the hypothesis. This is the approach we will take in the following example, continued from the previous lesson.</p>
<section id="poisson-regression-example" class="level3 page-columns page-full" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="poisson-regression-example"><span class="header-section-number">4.1</span> Poisson regression example</h3>
<div class="page-columns page-full"><p> Let’s return to the example of number of doctor visits. We concluded from our previous analysis of these data that both bad health and increased age are associated with more visits. Suppose the burden of proof that bad health is actually associated with more visits rests with us, and we need to convince a skeptic.</p><div class="no-row-height column-margin column-container"><span class=""><strong>doctor visits</strong></span></div></div>
<p>First, let’s re-run the original analysis and remind ourselves of the posterior distribution for the <code>badh</code> (bad health) indicator.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"COUNT"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"badhealth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mod_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) {</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dpois(lam[i])</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="st">        log(lam[i]) = int + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="st">    int ~ dnorm(0.0, 1.0/1e6)</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>data_jags <span class="ot">=</span> <span class="fu">as.list</span>(badhealth)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"int"</span>, <span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod_string), <span class="at">data=</span>data_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1127
   Unobserved stochastic nodes: 4
   Total graph size: 3665

Initializing model</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod, <span class="fl">1e3</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>mod_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>mod_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod_sim))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(mod_csim[,<span class="st">"b_badh"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-density-bbadh" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-density-bbadh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-density-bbadh-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Figure&nbsp;7: "><img src="C2-L10_files/figure-html/fig-density-bbadh-1.png" id="fig-density-bbadh" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-density-bbadh-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
</div>
</div>
<p>Essentially all of the posterior probability mass is above 0, suggesting that this coefficient is positive (and consequently that bad health is associated with more visits). We obtained this result using a relatively noninformative prior. What if we use a prior that strongly favors values near 0? Let’s repeat the analysis with a normal prior on the <code>badh</code> coefficient that has mean 0 and standard deviation 0.2, so that the prior probability that the coefficient is less than 0.6 is <span class="math inline">&gt;0.998</span> . We’ll also use a small variance on the prior for the interaction term involving <code>badh</code> (standard deviation 0.01 because this coefficient is on a much smaller scale).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mod2_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) {</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dpois(lam[i])</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="st">        log(lam[i]) = int + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="st">    int ~ dnorm(0.0, 1.0/1e6)</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh ~ dnorm(0.0, 1.0/0.2^2)</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx ~ dnorm(0.0, 1.0/0.01^2)</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod2_string), <span class="at">data=</span>data_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1127
   Unobserved stochastic nodes: 4
   Total graph size: 3672

Initializing model</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod2, <span class="fl">1e3</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>mod2_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod2,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>mod2_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod2_sim))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How did the posterior distribution for the coefficient of <code>badh</code> change?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">1e4</span>)), <span class="at">from=</span><span class="sc">-</span><span class="fl">3.0</span>, <span class="at">to=</span><span class="fl">3.0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">0.0</span>, <span class="fl">3.0</span>), <span class="at">lty=</span><span class="dv">2</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">main=</span><span class="st">"b_badh"</span>, <span class="at">ylab=</span><span class="st">"density"</span>, <span class="at">xlab=</span><span class="st">"b_badh"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fl">0.2</span>), <span class="at">from=</span><span class="sc">-</span><span class="fl">3.0</span>, <span class="at">to=</span><span class="fl">3.0</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod_csim[,<span class="st">"b_badh"</span>]))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod2_csim[,<span class="st">"b_badh"</span>]), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"noninformative prior"</span>, <span class="st">"posterior"</span>, <span class="st">"skeptical prior"</span>, <span class="st">"posterior"</span>),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">each=</span><span class="dv">2</span>), <span class="at">bty=</span><span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-prior-and-posterior-comparison" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prior-and-posterior-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-prior-and-posterior-comparison-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;8: "><img src="C2-L10_files/figure-html/fig-prior-and-posterior-comparison-1.png" id="fig-prior-and-posterior-comparison" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-prior-and-posterior-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div>
</div>
</div>
<p>Under the skeptical prior, our posterior distribution for <code>b_badh</code> has significantly dropped to between about 0.6 and 1.1. Although the strong prior influenced our inference on the magnitude of the bad health effect on visits, it did not change the fact that the coefficient is significantly above 0. In other words: even under the skeptical prior, bad health is associated with more visits, with posterior probability near 1.</p>
<p>We should also check the effect of our skeptical prior on the interaction term involving both age and health.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">1e4</span>)), <span class="at">from=</span><span class="sc">-</span><span class="fl">0.05</span>, <span class="at">to=</span><span class="fl">0.05</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">0.0</span>, <span class="fl">140.0</span>), <span class="at">lty=</span><span class="dv">2</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">main=</span><span class="st">"b_intx"</span>, <span class="at">ylab=</span><span class="st">"density"</span>, <span class="at">xlab=</span><span class="st">"b_intx"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fl">0.01</span>), <span class="at">from=</span><span class="sc">-</span><span class="fl">0.05</span>, <span class="at">to=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod_csim[,<span class="st">"b_intx"</span>]))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod2_csim[,<span class="st">"b_intx"</span>]), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"noninformative prior"</span>, <span class="st">"posterior"</span>, <span class="st">"skeptical prior"</span>, <span class="st">"posterior"</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">each=</span><span class="dv">2</span>), <span class="at">bty=</span><span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-prior-and-posterior-comparison-intx" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prior-and-posterior-comparison-intx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-prior-and-posterior-comparison-intx-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;9: "><img src="C2-L10_files/figure-html/fig-prior-and-posterior-comparison-intx-1.png" id="fig-prior-and-posterior-comparison-intx" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-prior-and-posterior-comparison-intx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mod2_csim[,<span class="st">"b_intx"</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="co"># posterior probability that b_intx is positive</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9251333</code></pre>
</div>
</div>
<p>The result here is interesting. Our estimate for the interaction coefficient has gone from negative under the non-informative prior to positive under the skeptical prior, so the result is sensitive. In this case, because the skeptical prior shrinks away much of the bad health main effect, it is likely that this interaction effect attempts to restore some of the positive effect of bad health on visits. Thus, despite some observed prior sensitivity, our conclusion that bad health positively associates with more visits remains unchanged.</p>
</section>
</section>
<section id="overdispersed-model" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="overdispersed-model"><span class="header-section-number">5</span> Overdispersed model</h2>
<p>Recall that the <strong>Negative Binomial</strong> can be used to model overdispersed count data.</p>
<p><code>stan</code> has three parameterizations for the <strong>Negative Binomial</strong>.</p>
<p>The first looks like similar to a binomial parameterization:</p>
<p><span class="math display">
\text{NegBinomial}(y~|~\alpha,\beta)  = \binom{y +
\alpha - 1}{\alpha - 1} \, \left( \frac{\beta}{\beta+1}
\right)^{\!\alpha} \, \left( \frac{1}{\beta + 1} \right)^{\!y} \!.
</span></p>
<p><span class="math display">
\mathbb{E}[y] = \frac{\alpha}{\beta} \ \ \text{ and } \ \ \text{Var}[Y] = \frac{\alpha}{\beta^2} (\beta + 1).
</span></p>
<p>we can sample from this using the following statement</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>n <span class="sc">~</span> <span class="fu">neg_binomial</span>(alpha, beta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But this parameterization if not a match to the Poisson model, so we move on</p>
<p>The second parametrization <span class="math inline">\mu \in \mathbb{R}^+</span> and <span class="math inline">\phi \in \mathbb{R}^+</span>:</p>
<p><span class="math display">
\text{NegBinomial2}(n \, | \, \mu, \phi)  = \binom{n + \phi - 1}{n} \,
\left( \frac{\mu}{\mu+\phi} \right)^{\!n} \, \left(
\frac{\phi}{\mu+\phi} \right)^{\!\phi}
</span></p>
<p><span class="math display">
\mathbb{E}[n] = \mu \ \ \text{ and } \ \ \ \mathbb{V}\text{ar}[n] = \mu + \frac{\mu^2}{\phi}
</span></p>
<p>we can sample from this using the following statement</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>n <span class="sc">~</span> <span class="fu">neg_binomial_2</span>(mu, phi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And there is a third parametrization</p>
<p><span class="math display">
NegBinomial2Log(y\mid\mu,\phi) = NegBinomial2(y\mid exp(\eta),\phi).
</span></p>
<p>we can sample from this using the following statement:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>y \<span class="sc">~</span> <span class="er">**</span>neg_binomial_2\_log<span class="sc">**</span>(y\<span class="sc">|</span>mu, phi)<span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>jags</code> has just one parameterization:</p>
<p><span class="math display">
f(y \mid r, p) = \frac{\Gamma(y+r)}{\Gamma(r)\Gamma(y+1)}p^r(1-p)^y
</span></p>
<p>We think of the Negative Binomial Distribution as the probability of completing <span class="math inline">y</span> successful trials allowing for <span class="math inline">r</span> failures in a sequence of <span class="math inline">(y+r)</span> Bernoulli trials where success is defined as drawing (with replacement) a white ball from an urn of white and black balls with a probability <code>p</code> of success.</p>
<p><span class="math display">
\mathbb{E}[Y] = \mu = { r(1-p) \over p }\ \ \text{ and } \ \ \ \mathbb{V}\text{ar}[Y] = \mu + \frac{\mu^2}{r}
</span></p>
<section id="transformations" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="transformations"><span class="header-section-number">5.1</span> Transformations:</h3>
<p>Since we want to have a model corresponding to a poisson regression we will transform the model as follows:</p>
<p>If we set <span class="math inline">p = {\text{r} \over {r} + \lambda }</span> then the mean becomes : <span class="math inline">\lambda</span></p>
<p>and if we also set <span class="math inline">r= {\lambda^2 \over \omega}</span> then the variance becomes a sum of <span class="math inline">\lambda + \omega</span> where <span class="math inline">\omega</span> is our <strong>over dispersion</strong> term.</p>
<p><span class="math display">
\omega = \lambda^2 / r
</span></p>
<p><span class="math display">
\begin{aligned}
\mathbb{E}[Y] &amp;= { r(1-p) \over p }
\\ &amp;= rp^{-1} -r
\\ &amp; \stackrel {sub\ p} =  {\cancel{r}(\bcancel{r}+\lambda) \over \cancel{r}} - \bcancel{r}
\\ &amp;= \lambda \mathbb{V}\text{ar}[Y]
\\ &amp;= { (1-p) r \over p^2 }
\\ &amp; \stackrel {sub \ \lambda } = {1 \over p} \lambda
\\ &amp; \stackrel {sub p} = \lambda { (r+ \lambda) \over r}
\\ &amp;=  {\lambda r +  \lambda^2 \over r }
\\ &amp;= 1 \lambda + {\lambda^2 \over r}
\\ &amp;\stackrel { sub \ \omega}= \lambda + \omega
\end{aligned}
</span></p>
<p>Where we interpret <span class="math inline">\lambda</span> as the mean and <span class="math inline">\omega</span> as the overdispersion </p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"COUNT"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"badhealth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-44"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-44-1"><a href="#annotated-cell-44-1" aria-hidden="true" tabindex="-1"></a>mod3_string <span class="ot">=</span> <span class="st">"</span></span>
<span id="annotated-cell-44-2"><a href="#annotated-cell-44-2" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="annotated-cell-44-3"><a href="#annotated-cell-44-3" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) { </span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-44-4" class="code-annotation-target"><a href="#annotated-cell-44-4" aria-hidden="true" tabindex="-1"></a><span class="st">        mu[i]       = b0 + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-44-5" class="code-annotation-target"><a href="#annotated-cell-44-5" aria-hidden="true" tabindex="-1"></a><span class="st">        lambda[i]   = exp(mu[i])</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-44-6" class="code-annotation-target"><a href="#annotated-cell-44-6" aria-hidden="true" tabindex="-1"></a><span class="st">        p[i]        = r / (r + lambda[i])</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-44-7" class="code-annotation-target"><a href="#annotated-cell-44-7" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dnegbin(p[i], r)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-44-8" class="code-annotation-target"><a href="#annotated-cell-44-8" aria-hidden="true" tabindex="-1"></a><span class="st">        resid[i]       = numvisit[i] - p[i]</span></span>
<span id="annotated-cell-44-9"><a href="#annotated-cell-44-9" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="annotated-cell-44-10"><a href="#annotated-cell-44-10" aria-hidden="true" tabindex="-1"></a><span class="st">    ## Priors</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-44-11" class="code-annotation-target"><a href="#annotated-cell-44-11" aria-hidden="true" tabindex="-1"></a><span class="st">    b0        ~ dnorm(0.0, 1.0/1e6)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-44-12" class="code-annotation-target"><a href="#annotated-cell-44-12" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh    ~ dnorm(0.0, 1.0/0.2^2)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-44-13" class="code-annotation-target"><a href="#annotated-cell-44-13" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age     ~ dnorm(0.0, 1.0/1e4)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="9" onclick="event.preventDefault();">9</a><span id="annotated-cell-44-14" class="code-annotation-target"><a href="#annotated-cell-44-14" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx    ~ dnorm(0.0, 1.0/0.01^2)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="10" onclick="event.preventDefault();">10</a><span id="annotated-cell-44-15" class="code-annotation-target"><a href="#annotated-cell-44-15" aria-hidden="true" tabindex="-1"></a><span class="st">    r ~ dunif(0,50)</span></span>
<span id="annotated-cell-44-16"><a href="#annotated-cell-44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-17"><a href="#annotated-cell-44-17" aria-hidden="true" tabindex="-1"></a><span class="st">    ## extra deterministic parameters</span></span>
<span id="annotated-cell-44-18"><a href="#annotated-cell-44-18" aria-hidden="true" tabindex="-1"></a><span class="st">    omega      &lt;-  pow(mean(lambda),2)/2</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="11" onclick="event.preventDefault();">11</a><span id="annotated-cell-44-19" class="code-annotation-target"><a href="#annotated-cell-44-19" aria-hidden="true" tabindex="-1"></a><span class="st">    #theta      &lt;- pow(1/mean(p),2)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="12" onclick="event.preventDefault();">12</a><span id="annotated-cell-44-20" class="code-annotation-target"><a href="#annotated-cell-44-20" aria-hidden="true" tabindex="-1"></a><span class="st">    #scale      &lt;- mean((1-p)/p)</span></span>
<span id="annotated-cell-44-21"><a href="#annotated-cell-44-21" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span></span>
<span id="annotated-cell-44-22"><a href="#annotated-cell-44-22" aria-hidden="true" tabindex="-1"></a>data3_jags <span class="ot">=</span> <span class="fu">as.list</span>(badhealth)</span>
<span id="annotated-cell-44-23"><a href="#annotated-cell-44-23" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod3_string), <span class="at">data=</span>data3_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="13" onclick="event.preventDefault();">13</a><span id="annotated-cell-44-24" class="code-annotation-target"><a href="#annotated-cell-44-24" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod3, <span class="fl">1e3</span>)</span>
<span id="annotated-cell-44-25"><a href="#annotated-cell-44-25" aria-hidden="true" tabindex="-1"></a>params3 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"b_intx"</span>, <span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">'over_disp'</span>, <span class="st">'b0'</span>,<span class="st">'omega'</span>,<span class="st">'r'</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="14" onclick="event.preventDefault();">14</a><span id="annotated-cell-44-26" class="code-annotation-target"><a href="#annotated-cell-44-26" aria-hidden="true" tabindex="-1"></a>mod3_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod3,  <span class="at">variable.names=</span>params3, <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="15" onclick="event.preventDefault();">15</a><span id="annotated-cell-44-27" class="code-annotation-target"><a href="#annotated-cell-44-27" aria-hidden="true" tabindex="-1"></a>mod3_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod3_sim))</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-44" data-target-annotation="16" onclick="event.preventDefault();">16</a><span id="annotated-cell-44-28" class="code-annotation-target"><a href="#annotated-cell-44-28" aria-hidden="true" tabindex="-1"></a>(<span class="at">dic3 =</span> <span class="fu">dic.samples</span>(mod3, <span class="at">n.iter=</span><span class="fl">1e3</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-44" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="4" data-code-annotation="1">the linear part</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="5" data-code-annotation="2">lambda corresponds to the parameter used in the Poisson regression</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="6" data-code-annotation="3">p is the success parameter</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="7" data-code-annotation="4">we draw from the negative binomial distribution</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="8" data-code-annotation="5">sampling using the parametrization of the Negative Binomial distribution.</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="11" data-code-annotation="6">normal prior for intercept <code>b0</code></span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="12" data-code-annotation="7">normal prior for <code>b_badh</code></span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="13" data-code-annotation="8">normal prior for <code>b_age</code></span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="14" data-code-annotation="9">normal prior for <code>b_intx</code></span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="15" data-code-annotation="10">uniform prior for <code>over_disp</code> - at the upper limit of 50 <strong>NegBin</strong> converges to <strong>Poisson</strong> see <span class="citation" data-cites="jackman2009">(<a href="#ref-jackman2009" role="doc-biblioref">Jackman 2009, 280</a>)</span></span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="19" data-code-annotation="11">theta param</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="12">12</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="20" data-code-annotation="12">scale param</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="13">13</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="24" data-code-annotation="13">burn in</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="14">14</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="26" data-code-annotation="14">sample</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="15">15</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="27" data-code-annotation="15">stack samples from the chains</span>
</dd>
<dt data-target-cell="annotated-cell-44" data-target-annotation="16">16</dt>
<dd>
<span data-code-cell="annotated-cell-44" data-code-lines="28" data-code-annotation="16">estimate the DIC</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1127
   Unobserved stochastic nodes: 5
   Total graph size: 4204

Initializing model

Mean deviance:  4477 
penalty 4.055 
Penalized deviance: 4481 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod3_sim )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Potential scale reduction factors:

       Point est. Upper C.I.
b0           1.01       1.01
b_age        1.01       1.01
b_badh       1.00       1.00
b_intx       1.00       1.01
omega        1.00       1.00
r            1.00       1.00

Multivariate psrf

1</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">raftery.diag</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 
                                              
        Burn-in  Total Lower bound  Dependence
        (M)      (N)   (Nmin)       factor (I)
 b0     27       29388 3746         7.85      
 b_age  28       29498 3746         7.87      
 b_badh 12       12572 3746         3.36      
 b_intx 18       21819 3746         5.82      
 omega  3        4062  3746         1.08      
 r      5        5871  3746         1.57      


[[2]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 
                                              
        Burn-in  Total Lower bound  Dependence
        (M)      (N)   (Nmin)       factor (I)
 b0     18       19100 3746         5.10      
 b_age  24       24334 3746         6.50      
 b_badh 12       13268 3746         3.54      
 b_intx 12       12678 3746         3.38      
 omega  2        3803  3746         1.02      
 r      5        5673  3746         1.51      


[[3]]

Quantile (q) = 0.025
Accuracy (r) = +/- 0.005
Probability (s) = 0.95 
                                              
        Burn-in  Total Lower bound  Dependence
        (M)      (N)   (Nmin)       factor (I)
 b0     42       50334 3746         13.400    
 b_age  26       28752 3746          7.680    
 b_badh 14       13732 3746          3.670    
 b_intx 12       12728 3746          3.400    
 omega  2        3680  3746          0.982    
 r      5        5673  3746          1.510    </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               b0     b_age      b_badh      b_intx       omega            r
Lag 0  1.00000000 1.0000000 1.000000000 1.000000000  1.00000000  1.000000000
Lag 1  0.93370705 0.9346078 0.784735253 0.795801833  0.01908193  0.238782320
Lag 5  0.74672691 0.7508936 0.374285108 0.383383936 -0.01326354 -0.010792019
Lag 10 0.56978037 0.5677051 0.156078365 0.168269346 -0.01851913  0.014250700
Lag 50 0.01816689 0.0171772 0.001551632 0.002502067  0.01531242 -0.001484443</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        b0      b_age     b_badh     b_intx      omega          r 
  411.1193   421.8928  1475.6070  1426.9707 14958.5971  9222.8008 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3_sim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 2001:7000
Thinning interval = 1 
Number of chains = 3 
Sample size per chain = 5000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

           Mean       SD  Naive SE Time-series SE
b0     0.465107 0.125807 1.027e-03      0.0062846
b_age  0.005694 0.003268 2.669e-05      0.0001631
b_badh 0.378740 0.168177 1.373e-03      0.0043766
b_intx 0.014878 0.004311 3.520e-05      0.0001141
omega  2.775407 0.216049 1.764e-03      0.0017664
r      0.988001 0.068882 5.624e-04      0.0007187

2. Quantiles for each variable:

             2.5%      25%      50%      75%   97.5%
b0      0.2121766 0.383124 0.463586 0.548234 0.71291
b_age  -0.0007964 0.003535 0.005727 0.007812 0.01222
b_badh  0.0522866 0.264232 0.376815 0.493034 0.70985
b_intx  0.0064113 0.011972 0.014918 0.017783 0.02327
omega   2.3798276 2.624586 2.767403 2.916428 3.22150
r       0.8602568 0.940839 0.984807 1.032203 1.13181</code></pre>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod3_sim, <span class="at">auto.layout =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Figure&nbsp;10: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-1.png" id="fig-overdisperesed-convergence-1" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Figure&nbsp;11: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-2.png" id="fig-overdisperesed-convergence-2" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-3" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;12: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-3.png" id="fig-overdisperesed-convergence-3" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-4" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Figure&nbsp;13: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-4.png" id="fig-overdisperesed-convergence-4" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-5" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;14: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-5.png" id="fig-overdisperesed-convergence-5" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-6" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;15: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-6.png" id="fig-overdisperesed-convergence-6" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-7" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21" title="Figure&nbsp;16: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-7.png" id="fig-overdisperesed-convergence-7" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-8" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22" title="Figure&nbsp;17: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-8.png" id="fig-overdisperesed-convergence-8" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-9" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23" title="Figure&nbsp;18: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-9.png" id="fig-overdisperesed-convergence-9" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-10" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24" title="Figure&nbsp;19: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-10.png" id="fig-overdisperesed-convergence-10" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-11" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-11.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25" title="Figure&nbsp;20: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-11.png" id="fig-overdisperesed-convergence-11" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-overdisperesed-convergence-12" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-overdisperesed-convergence-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-overdisperesed-convergence-12.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26" title="Figure&nbsp;21: "><img src="C2-L10_files/figure-html/fig-overdisperesed-convergence-12.png" id="fig-overdisperesed-convergence-12" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-overdisperesed-convergence-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod3_csim,<span class="at">auto.layout =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-autocorr-plot-mod3-csim-1" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod3-csim-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="Figure&nbsp;22: "><img src="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-1.png" id="fig-autocorr-plot-mod3-csim-1" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-autocorr-plot-mod3-csim-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-autocorr-plot-mod3-csim-2" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod3-csim-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28" title="Figure&nbsp;23: "><img src="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-2.png" id="fig-autocorr-plot-mod3-csim-2" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-autocorr-plot-mod3-csim-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-autocorr-plot-mod3-csim-3" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod3-csim-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29" title="Figure&nbsp;24: "><img src="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-3.png" id="fig-autocorr-plot-mod3-csim-3" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-autocorr-plot-mod3-csim-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;24
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-autocorr-plot-mod3-csim-4" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod3-csim-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30" title="Figure&nbsp;25: "><img src="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-4.png" id="fig-autocorr-plot-mod3-csim-4" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-autocorr-plot-mod3-csim-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;25
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-autocorr-plot-mod3-csim-5" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod3-csim-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31" title="Figure&nbsp;26: "><img src="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-5.png" id="fig-autocorr-plot-mod3-csim-5" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-autocorr-plot-mod3-csim-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-autocorr-plot-mod3-csim-6" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-autocorr-plot-mod3-csim-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32" title="Figure&nbsp;27: "><img src="C2-L10_files/figure-html/fig-autocorr-plot-mod3-csim-6.png" id="fig-autocorr-plot-mod3-csim-6" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-autocorr-plot-mod3-csim-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(badhealth[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(X, <span class="fu">with</span>(badhealth, badh<span class="sc">*</span>age))</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">pmed_coef =</span> <span class="fu">apply</span>(mod3_csim, <span class="dv">2</span>, median))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         b0       b_age      b_badh      b_intx       omega           r 
0.463585543 0.005726857 0.376815015 0.014917844 2.767403254 0.984806654 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">r =</span> pmed_coef[<span class="st">"r"</span>] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        r 
0.9848067 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>mu_hat <span class="ot">=</span> pmed_coef[<span class="st">"b0"</span>] <span class="sc">+</span> X <span class="sc">%*%</span> pmed_coef[<span class="fu">c</span>(<span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">=</span> <span class="fu">exp</span>(mu_hat)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>p_hat <span class="ot">=</span> r <span class="sc">/</span> (r <span class="sc">+</span> lambda_hat)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lambda_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/compute-X-pmed-r-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="C2-L10_files/figure-html/compute-X-pmed-r-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(p_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="C2-L10_files/figure-html/compute-X-pmed-r-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="C2-L10_files/figure-html/compute-X-pmed-r-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>residuals</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> badhealth<span class="sc">$</span>numvisit <span class="sc">-</span> p_hat</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]
[1,] 29.69233
[2,] 19.68743
[3,] 15.67500
[4,] 19.69111
[5,] 14.66103
[6,] 14.65458</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid) <span class="co"># the data were ordered</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-residuals-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuals-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-residuals-plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35" title="Figure&nbsp;28: Plot of residuals"><img src="C2-L10_files/figure-html/fig-residuals-plot-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuals-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28: Plot of residuals
</figcaption>
</figure>
</div>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mod3_csim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-head-mod3_csim" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-head-mod3_csim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: First few rows of mod3_csim
</figcaption>
<div aria-describedby="tbl-head-mod3_csim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>Markov Chain Monte Carlo (MCMC) output:
Start = 1 
End = 7 
Thinning interval = 1 
            b0       b_age    b_badh     b_intx    omega         r
[1,] 0.4585149 0.004660465 0.5236388 0.01131598 2.488047 1.0334043
[2,] 0.5131659 0.004195786 0.4538343 0.01262845 2.663287 0.9278381
[3,] 0.5062904 0.004209453 0.5352869 0.01171546 2.681452 0.9522651
[4,] 0.5396153 0.005596650 0.3210580 0.01399573 3.030899 1.0261184
[5,] 0.4559783 0.005517106 0.3364373 0.01749889 2.777185 0.9943383
[6,] 0.4279814 0.005486275 0.3872663 0.01983019 2.859494 0.9943618
[7,] 0.4876701 0.003198972 0.3430875 0.01520471 2.348750 0.9742482</code></pre>
</div>
</div>
</figure>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p_hat, badhealth<span class="sc">$</span>numvisit)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-p_hat-vs-numvisit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p_hat-vs-numvisit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-p_hat-vs-numvisit-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36" title="Figure&nbsp;29: Plot of p_hat vs numvisit"><img src="C2-L10_files/figure-html/fig-p_hat-vs-numvisit-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-p_hat-vs-numvisit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;29: Plot of p_hat vs numvisit
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p_hat[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)], resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)], <span class="at">xlim=</span><span class="fu">range</span>(p_hat), <span class="at">ylab=</span><span class="st">"residuals"</span>, <span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(p)), <span class="at">ylim=</span><span class="fu">range</span>(resid))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(p_hat[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)], resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)], <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-p_hat-vs-resid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-p_hat-vs-resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="C2-L10_files/figure-html/fig-p_hat-vs-resid-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37" title="Figure&nbsp;30: Plot of p_hat vs residuals, colored by health status"><img src="C2-L10_files/figure-html/fig-p_hat-vs-resid-1.png" class="img-fluid figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-p_hat-vs-resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;30: Plot of p_hat vs residuals, colored by health status
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.061266</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 41.2124</code></pre>
</div>
</div>


<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-jackman2009" class="csl-entry" role="listitem">
Jackman, Simon. 2009. <span>“Bayesian Analysis for the Social Sciences.”</span> <em>Wiley Series in Probability and Statistics</em>, October. <a href="https://doi.org/10.1002/9780470686621">https://doi.org/10.1002/9780470686621</a>.
</div>
</div></section></div></main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb93" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Poisson regression"</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Bayesian Statistics: Techniques and Models"</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "An overview of Poisson regression in the context of Bayesian statistics."</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - Monte Carlo Estimation</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - Poisson regression</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - Bayesian statistics</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - R programming</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - statistical modeling</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - count data</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - Poisson distribution</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - over dispersion</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - zero-inflated models</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>Poisson regression \index{Poisson regression} is the preferred method to handle count data where the response is positive values but includes zeroes. </span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>The gist of this method is that We use a log transform link function on the regressors but not on the response which allows the response to be zero valued which correspond to zero counts. </span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>One limit of this approach mentioned below is that the Poisson \index{Poisson Distribution} takes one parameter $\lambda$ for both its expected value and its variance.</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>We look give a deeper solution to this problem in the next course on mixture models, however in this course we will consider more restricted cases where we </span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>extend the Poisson regression with the **Negative Binomial Distribution** \index{Negative Binomial Distribution} which allows us to model over-dispersed data.</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Overdispersion {#sec-overdispersion}</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>\index{overdispersion} \index{Poisson regression!overdispersion}</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>In cases where the variance needs to be a separate feature of the model we can use an alternative model with additional free parameters may provide a better fit. In this case of count data, a Poisson mixture model like the Negative Binomial Distribution can be posited instead, in which the mean of the Poisson distribution can itself be thought of as a random variable drawn -- from the Gamma distribution thereby introducing an additional free parameter</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>We don't see the case of over-dispersion  in this course but the next course is on mixture models.</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to Poisson regression {#sec-introduction-to-poisson-regression}</span></span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a><span class="al">![Introduction to Poisson regression](images/c2l10-ss-01-Poisson-Regression.png)</span>{#fig-intro-poisson-regression .column-margin width="200px" group="slides"}</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>We now have experience fitting regression models when the response is continuous, and when it is binary. </span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>What about when we have count data?</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>We could fit a linear normal regression, but here we have a couple of drawbacks. </span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>First of all, counts usually aren't negative. </span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>And the variances might not be constant.</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>The Poisson distribution provides a natural likelihood for count data.</span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>y_i\mid \lambda+i \stackrel {iid} \sim \mathrm{Pois}(\lambda_i) \qquad i=1, \ldots, n </span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>Here, $\lambda$ conveniently represents the expected value of y $\mathbb{E}<span class="co">[</span><span class="ot">y</span><span class="co">]</span>.$ It turns out that $\lambda$ is also the variance of y $\mathbb{V}ar<span class="co">[</span><span class="ot">y</span><span class="co">]</span>.$ So if we expect a count to be higher, we also expect the variability in counts to go up.</span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>We saw this earlier with the *warp breaks* data.</span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>If we model the mean directly, like we did with linear regression. That is, we had the expected value yi was directly modeled with this linear form.</span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">y</span><span class="co">]</span>=\beta_0 + \beta_1x_i \qquad \text{(linear regression)}</span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a>We would run into the same problem we did with logistic regression. The expected value has to be greater than zero in the Poisson distribution. To naturally deal with that restriction, we're going to use the logarithmic link function.</span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a>So, the log link. That is, that the log of $\lambda_i$ is equal to this linear piece.</span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a>log link:</span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>log(\lambda_i) = \beta_0+\beta_1x_i \qquad \text{(log link)}</span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a>$$ {#eq-pr-log-link}</span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">y</span><span class="co">]</span>=\beta_0+\beta_1x_i \qquad \text{(linear regression)}</span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a>From this, we can easily recover the expression for the mean itself. That is, we can invert this link function to get the expected value of $y_i,$</span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>\implies \mathbb{E}<span class="co">[</span><span class="ot">y</span><span class="co">]</span> = \lambda_i = e^{\left(\beta_0+\beta_1x_i \right)}</span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a>$$ {#eq-poisson-regression-link}</span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a>It might seem like this model is equivalent to fitting a normal linear regression to the log of $y$. </span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a>But there are a few key differences. </span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a>[In the normal regression, we're modeling the mean of the response directly. </span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a>So we would be fitting a model to the $\log(y)$.</span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a>Where we're modeling the expected value of the $\log(y)$.</span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a>This is different from what we're modeling here, here we're doing the log of the expected value of $y$.]{.mark}</span>
<span id="cb93-84"><a href="#cb93-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-85"><a href="#cb93-85" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-86"><a href="#cb93-86" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">log(y)</span><span class="co">]</span>\ne log(\mathbb{E}<span class="co">[</span><span class="ot">y</span><span class="co">]</span>)</span>
<span id="cb93-87"><a href="#cb93-87" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-88"><a href="#cb93-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-89"><a href="#cb93-89" aria-hidden="true" tabindex="-1"></a>[These are not equal, they're usually similar, but they're not the same. </span>
<span id="cb93-90"><a href="#cb93-90" aria-hidden="true" tabindex="-1"></a>Another difference is that we have a separate independent parameter for the variants in a normal regression. </span>
<span id="cb93-91"><a href="#cb93-91" aria-hidden="true" tabindex="-1"></a>In Poisson regression, the variance is automatically the same as $\lambda$,]{.mark}<span class="co">[</span><span class="ot">which may not always be appropriate</span><span class="co">]</span>{.mark-red}, as we'll see in an upcoming example.</span>
<span id="cb93-92"><a href="#cb93-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-93"><a href="#cb93-93" aria-hidden="true" tabindex="-1"></a>As usual, we can add more explanatory x variables to the Poisson regression framework. </span>
<span id="cb93-94"><a href="#cb93-94" aria-hidden="true" tabindex="-1"></a>They can be continuous, categorical, or they could be counts themselves.</span>
<span id="cb93-95"><a href="#cb93-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-96"><a href="#cb93-96" aria-hidden="true" tabindex="-1"></a>If we have three predictor variables $x_i = ( x_{1,i}, x_{2,i}, x_{3,i} ),$ what would the likelihood part of the hierarchical representation of a Poisson regression with logarithmic link look like?</span>
<span id="cb93-97"><a href="#cb93-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-98"><a href="#cb93-98" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[ ]</span> $y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left( e^{-(\beta_0+\beta_1 x_{1,i}+\beta_2 x_{2,i}+\beta_3 x_{3,i})}\right)$</span>
<span id="cb93-99"><a href="#cb93-99" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[ ]</span> $y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left(\beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \beta_3 x_{3,i} \right)$</span>
<span id="cb93-100"><a href="#cb93-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[x]</span> $y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left(e^{\beta_0 + \beta_1 x_{1,i}+\beta_2 x_{2,i}+\beta_3 x_{3,i}}\right)$</span>
<span id="cb93-101"><a href="#cb93-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[ ]</span> $y_i \mid x_i, \beta \overset{\text{ind}}{\sim} \mathrm{Pois} \left( \log[ \beta_0 + \beta_1 x_{1,i} + \beta_2 x_{2,i} + \beta_3 x_{3,i} ] \right)$</span>
<span id="cb93-102"><a href="#cb93-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-103"><a href="#cb93-103" aria-hidden="true" tabindex="-1"></a>Here we incorporated the (inverse) link function directly into the likelihood rather than writing it with two lines.</span>
<span id="cb93-104"><a href="#cb93-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-105"><a href="#cb93-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Poisson regression - JAGS model</span></span>
<span id="cb93-106"><a href="#cb93-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-107"><a href="#cb93-107" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**doctor visits**</span><span class="co">]</span>{.column-margin} For an example of Poisson regression, we'll use the <span class="in">`badhealth`</span> data set from the <span class="in">`COUNT`</span> package in <span class="in">`R`</span>.</span>
<span id="cb93-108"><a href="#cb93-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-111"><a href="#cb93-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-112"><a href="#cb93-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-badhealth-data</span></span>
<span id="cb93-113"><a href="#cb93-113" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"COUNT"</span>)</span>
<span id="cb93-114"><a href="#cb93-114" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"badhealth"</span>)</span>
<span id="cb93-115"><a href="#cb93-115" aria-hidden="true" tabindex="-1"></a><span class="co">#?badhealth</span></span>
<span id="cb93-116"><a href="#cb93-116" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(badhealth)</span>
<span id="cb93-117"><a href="#cb93-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-118"><a href="#cb93-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-119"><a href="#cb93-119" aria-hidden="true" tabindex="-1"></a>according to the description:</span>
<span id="cb93-120"><a href="#cb93-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-121"><a href="#cb93-121" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb93-122"><a href="#cb93-122" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Card for `badhealth`</span></span>
<span id="cb93-123"><a href="#cb93-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-124"><a href="#cb93-124" aria-hidden="true" tabindex="-1"></a>1,127 observations from a 1998 German survey with 3 variables:</span>
<span id="cb93-125"><a href="#cb93-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-126"><a href="#cb93-126" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`numvisit`</span> - number of visits to the doctor in 1998 (**response**)</span>
<span id="cb93-127"><a href="#cb93-127" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="in">`badh`</span> - $\begin{cases} 1 \qquad \text{ patient claims to be in bad health} <span class="sc">\\</span> 0 \qquad \text{ patient does not claim to be in bad health} \end{cases}$</span>
<span id="cb93-128"><a href="#cb93-128" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span><span class="in">`age`</span> - age of patient</span>
<span id="cb93-129"><a href="#cb93-129" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb93-130"><a href="#cb93-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-133"><a href="#cb93-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-134"><a href="#cb93-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check-missing-data</span></span>
<span id="cb93-135"><a href="#cb93-135" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(badhealth))</span>
<span id="cb93-136"><a href="#cb93-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-137"><a href="#cb93-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-138"><a href="#cb93-138" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>remove na</span>
<span id="cb93-139"><a href="#cb93-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-140"><a href="#cb93-140" aria-hidden="true" tabindex="-1"></a>As usual, let's visualize these data.</span>
<span id="cb93-141"><a href="#cb93-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-144"><a href="#cb93-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-145"><a href="#cb93-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-numvisits-histogram</span></span>
<span id="cb93-146"><a href="#cb93-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Histogram of number of doctor visits"</span></span>
<span id="cb93-147"><a href="#cb93-147" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(badhealth<span class="sc">$</span>numvisit, <span class="at">breaks=</span><span class="dv">20</span>)</span>
<span id="cb93-148"><a href="#cb93-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-149"><a href="#cb93-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-152"><a href="#cb93-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-153"><a href="#cb93-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-visits-by-age-health</span></span>
<span id="cb93-154"><a href="#cb93-154" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">jitter</span>(<span class="fu">log</span>(numvisit)) <span class="sc">~</span> <span class="fu">jitter</span>(age), <span class="at">data=</span>badhealth, <span class="at">subset=</span>badh<span class="sc">==</span><span class="dv">0</span>, <span class="at">xlab=</span><span class="st">"age"</span>, <span class="at">ylab=</span><span class="st">"log(visits)"</span>)</span>
<span id="cb93-155"><a href="#cb93-155" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(<span class="fu">log</span>(numvisit)) <span class="sc">~</span> <span class="fu">jitter</span>(age), <span class="at">data=</span>badhealth, <span class="at">subset=</span>badh<span class="sc">==</span><span class="dv">1</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb93-156"><a href="#cb93-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-157"><a href="#cb93-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-158"><a href="#cb93-158" aria-hidden="true" tabindex="-1"></a><span class="fu">### Doctor Visits Model</span></span>
<span id="cb93-159"><a href="#cb93-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-160"><a href="#cb93-160" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**doctor visits**</span><span class="co">]</span>{.column-margin} It appears that both age and bad health are related to the number of doctor visits. We should include model terms for both variables. <span class="co">[</span><span class="ot">If we believe the age/visits relationship is different between healthy and non-healthy populations, we should also include an interaction term</span><span class="co">]</span>{.mark}. We will fit the full model here and leave it to you to compare it with the simpler additive model.</span>
<span id="cb93-161"><a href="#cb93-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-164"><a href="#cb93-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-165"><a href="#cb93-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-rjags</span></span>
<span id="cb93-166"><a href="#cb93-166" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="cb93-167"><a href="#cb93-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-168"><a href="#cb93-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-171"><a href="#cb93-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-172"><a href="#cb93-172" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-poisson-jags-model</span></span>
<span id="cb93-173"><a href="#cb93-173" aria-hidden="true" tabindex="-1"></a>mod_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb93-174"><a href="#cb93-174" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) {</span></span>
<span id="cb93-175"><a href="#cb93-175" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dpois(lam[i])</span></span>
<span id="cb93-176"><a href="#cb93-176" aria-hidden="true" tabindex="-1"></a><span class="st">        log(lam[i]) = int + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<span id="cb93-177"><a href="#cb93-177" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb93-178"><a href="#cb93-178" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb93-179"><a href="#cb93-179" aria-hidden="true" tabindex="-1"></a><span class="st">    int ~ dnorm(0.0, 1.0/1e6)</span></span>
<span id="cb93-180"><a href="#cb93-180" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-181"><a href="#cb93-181" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-182"><a href="#cb93-182" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-183"><a href="#cb93-183" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb93-184"><a href="#cb93-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-185"><a href="#cb93-185" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb93-186"><a href="#cb93-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-187"><a href="#cb93-187" aria-hidden="true" tabindex="-1"></a>data_jags <span class="ot">=</span> <span class="fu">as.list</span>(badhealth)</span>
<span id="cb93-188"><a href="#cb93-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-189"><a href="#cb93-189" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"int"</span>, <span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)</span>
<span id="cb93-190"><a href="#cb93-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-191"><a href="#cb93-191" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod_string), <span class="at">data=</span>data_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="cb93-192"><a href="#cb93-192" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod, <span class="fl">1e3</span>)</span>
<span id="cb93-193"><a href="#cb93-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-194"><a href="#cb93-194" aria-hidden="true" tabindex="-1"></a>mod_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod,  <span class="at">variable.names=</span>params, <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb93-195"><a href="#cb93-195" aria-hidden="true" tabindex="-1"></a>mod_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod_sim))</span>
<span id="cb93-196"><a href="#cb93-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-197"><a href="#cb93-197" aria-hidden="true" tabindex="-1"></a><span class="do">## convergence diagnostics</span></span>
<span id="cb93-198"><a href="#cb93-198" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">1</span>, <span class="fl">2.5</span>, <span class="dv">1</span>))</span>
<span id="cb93-199"><a href="#cb93-199" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_sim)</span>
<span id="cb93-200"><a href="#cb93-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-201"><a href="#cb93-201" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(mod_sim)</span>
<span id="cb93-202"><a href="#cb93-202" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.diag</span>(mod_sim)</span>
<span id="cb93-203"><a href="#cb93-203" aria-hidden="true" tabindex="-1"></a><span class="fu">autocorr.plot</span>(mod_csim)</span>
<span id="cb93-204"><a href="#cb93-204" aria-hidden="true" tabindex="-1"></a><span class="fu">effectiveSize</span>(mod_sim)</span>
<span id="cb93-205"><a href="#cb93-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-206"><a href="#cb93-206" aria-hidden="true" tabindex="-1"></a><span class="do">## compute DIC</span></span>
<span id="cb93-207"><a href="#cb93-207" aria-hidden="true" tabindex="-1"></a>dic <span class="ot">=</span> <span class="fu">dic.samples</span>(mod, <span class="at">n.iter=</span><span class="fl">1e3</span>)</span>
<span id="cb93-208"><a href="#cb93-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-209"><a href="#cb93-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-210"><a href="#cb93-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model checking - Residuals</span></span>
<span id="cb93-211"><a href="#cb93-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-212"><a href="#cb93-212" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; "While inexact models may mislead, attempting to allow for every contingency a priori is impractical. Thus models must be built by an iterative feedback process in which an initial parsimonious model may be modified when diagnostic checks applied to residuals indicate the need." ---G. E. P. Box</span></span>
<span id="cb93-213"><a href="#cb93-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-214"><a href="#cb93-214" aria-hidden="true" tabindex="-1"></a>To get a general idea of the model's performance, we can look at predicted values and \index{residual analysis} residuals as usual. Don't forget that we must apply the inverse of the link function to get predictions for $\lambda$ .</span>
<span id="cb93-215"><a href="#cb93-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-218"><a href="#cb93-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-219"><a href="#cb93-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create-matrix-X</span></span>
<span id="cb93-220"><a href="#cb93-220" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(badhealth[,<span class="sc">-</span><span class="dv">1</span>]) <span class="co">#&lt;1&gt;</span></span>
<span id="cb93-221"><a href="#cb93-221" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">cbind</span>(X, <span class="fu">with</span>(badhealth, badh<span class="sc">*</span>age)) <span class="co">#&lt;2&gt;</span></span>
<span id="cb93-222"><a href="#cb93-222" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(X)</span>
<span id="cb93-223"><a href="#cb93-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-224"><a href="#cb93-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-225"><a href="#cb93-225" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>we drop the first column since it is the column for our <span class="in">`y`</span>.</span>
<span id="cb93-226"><a href="#cb93-226" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>we add a third column with $\mathbb{I}_{badh}\times age$</span>
<span id="cb93-227"><a href="#cb93-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-230"><a href="#cb93-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-231"><a href="#cb93-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-pmed-coef</span></span>
<span id="cb93-232"><a href="#cb93-232" aria-hidden="true" tabindex="-1"></a>(<span class="at">pmed_coef =</span> <span class="fu">apply</span>(mod_csim, <span class="dv">2</span>, median)) <span class="co"># &lt;1&gt;</span></span>
<span id="cb93-233"><a href="#cb93-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-234"><a href="#cb93-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-235"><a href="#cb93-235" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>this are the column medians of the coefficients.</span>
<span id="cb93-236"><a href="#cb93-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-239"><a href="#cb93-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-240"><a href="#cb93-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-llam-hat</span></span>
<span id="cb93-241"><a href="#cb93-241" aria-hidden="true" tabindex="-1"></a>llam_hat <span class="ot">=</span> pmed_coef[<span class="st">"int"</span>] <span class="sc">+</span> X <span class="sc">%*%</span> pmed_coef[<span class="fu">c</span>(<span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)] <span class="co"># &lt;1&gt;</span></span>
<span id="cb93-242"><a href="#cb93-242" aria-hidden="true" tabindex="-1"></a>lam_hat <span class="ot">=</span> <span class="fu">exp</span>(llam_hat) <span class="co">#&lt;2&gt;</span></span>
<span id="cb93-243"><a href="#cb93-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-244"><a href="#cb93-244" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(lam_hat)</span>
<span id="cb93-245"><a href="#cb93-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-246"><a href="#cb93-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-247"><a href="#cb93-247" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>$X \cdot \vec b_i$ gives the linear part.</span>
<span id="cb93-248"><a href="#cb93-248" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>$\hat\lambda_i=e^{X \cdot \vec b_i}$ we need to apply the inverse link function</span>
<span id="cb93-249"><a href="#cb93-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-252"><a href="#cb93-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-253"><a href="#cb93-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-residuals</span></span>
<span id="cb93-254"><a href="#cb93-254" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">=</span> badhealth<span class="sc">$</span>numvisit <span class="sc">-</span> lam_hat</span>
<span id="cb93-255"><a href="#cb93-255" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(resid) <span class="co"># the data were ordered</span></span>
<span id="cb93-256"><a href="#cb93-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-257"><a href="#cb93-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-258"><a href="#cb93-258" aria-hidden="true" tabindex="-1"></a>this plot looks bad, it might not be iid but we can ignore the issue since the data is presorted/</span>
<span id="cb93-259"><a href="#cb93-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-262"><a href="#cb93-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-263"><a href="#cb93-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lamhat-vs-numvisit</span></span>
<span id="cb93-264"><a href="#cb93-264" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lam_hat, badhealth<span class="sc">$</span>numvisit)</span>
<span id="cb93-265"><a href="#cb93-265" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb93-266"><a href="#cb93-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-267"><a href="#cb93-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-270"><a href="#cb93-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-271"><a href="#cb93-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-residuals-by-health</span></span>
<span id="cb93-272"><a href="#cb93-272" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lam_hat[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)], resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)], <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>), <span class="at">ylab=</span><span class="st">"residuals"</span>, <span class="at">xlab=</span><span class="fu">expression</span>(<span class="fu">hat</span>(lambda)), <span class="at">ylim=</span><span class="fu">range</span>(resid))</span>
<span id="cb93-273"><a href="#cb93-273" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(lam_hat[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)], resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)], <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb93-274"><a href="#cb93-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-275"><a href="#cb93-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-276"><a href="#cb93-276" aria-hidden="true" tabindex="-1"></a>It is not surprising that the variability increases for values predicted at higher values since the mean is also the variance in the Poisson distribution. <span class="co">[</span><span class="ot">However, observations predicted to have about two visits should have variance about two, and observations predicted to have about six visits should have variance about six.</span><span class="co">]</span>{.mark}</span>
<span id="cb93-277"><a href="#cb93-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-280"><a href="#cb93-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-281"><a href="#cb93-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-variance-resid-healthy</span></span>
<span id="cb93-282"><a href="#cb93-282" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">0</span>)])</span>
<span id="cb93-283"><a href="#cb93-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-284"><a href="#cb93-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-287"><a href="#cb93-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-288"><a href="#cb93-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-variance-resid-unhealthy</span></span>
<span id="cb93-289"><a href="#cb93-289" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid[<span class="fu">which</span>(badhealth<span class="sc">$</span>badh<span class="sc">==</span><span class="dv">1</span>)])</span>
<span id="cb93-290"><a href="#cb93-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-291"><a href="#cb93-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-292"><a href="#cb93-292" aria-hidden="true" tabindex="-1"></a>For this data the variance is much bigger this is not the case with these data. This indicates that <span class="co">[</span><span class="ot">either the model fits poorly (meaning the covariates don't explain enough of the variability in the data), or the data are "**overdispersed**" \index{overdispersed} for the Poisson likelihood we have chosen. This is a common issue with count data. If the data are more variable than the Poisson likelihood would suggest, a good alternative is the negative binomial distribution</span><span class="co">]</span>{#sp-overdispersed .mark}, which we will not pursue here.</span>
<span id="cb93-293"><a href="#cb93-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-294"><a href="#cb93-294" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictive distributions {#sec-predictive-distributions}</span></span>
<span id="cb93-295"><a href="#cb93-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-296"><a href="#cb93-296" aria-hidden="true" tabindex="-1"></a>Assuming the model fit is adequate, we can interpret the results.</span>
<span id="cb93-297"><a href="#cb93-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-300"><a href="#cb93-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-301"><a href="#cb93-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summarize-mod-sim</span></span>
<span id="cb93-302"><a href="#cb93-302" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_sim)</span>
<span id="cb93-303"><a href="#cb93-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-304"><a href="#cb93-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-305"><a href="#cb93-305" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">The ***intercept*** is not necessarily *interpretable* here because it corresponds to the number of doctor visits for a healthy 0-year-old. While the number of visits for a newborn baby sounds like interesting information, the youngest person in the data set is 20 years old.</span><span class="co">]</span>{.mark} In such cases we should avoid making such projections and say that the intercept is an artifact of the model.</span>
<span id="cb93-306"><a href="#cb93-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-307"><a href="#cb93-307" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For healthy individuals, it appears that **age** is associated with an *increase* in the Expected *number of doctor visits*.</span>
<span id="cb93-308"><a href="#cb93-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-309"><a href="#cb93-309" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Bad health** is associated with an *increase in expected number of visits*.</span>
<span id="cb93-310"><a href="#cb93-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-311"><a href="#cb93-311" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The interaction coefficient is interpreted as an adjustment to the age coefficient for people in bad health. Hence, for people with bad health, age is essentially unassociated with number of visits.</span>
<span id="cb93-312"><a href="#cb93-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-313"><a href="#cb93-313" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predictive distributions</span></span>
<span id="cb93-314"><a href="#cb93-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-315"><a href="#cb93-315" aria-hidden="true" tabindex="-1"></a>Let's say we have two people aged 35, one in good health and the other in poor health. <span class="co">[</span><span class="ot">**Q. What is the posterior probability that the individual with poor health will have more doctor visits?**</span><span class="co">]</span>{.column-margin}</span>
<span id="cb93-316"><a href="#cb93-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-317"><a href="#cb93-317" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">This goes beyond the posterior probabilities we have calculated comparing expected responses in previous lessons. Here we will create Monte Carlo samples for the **responses themselves**. This is done by taking the Monte Carlo samples of the model parameters, and for each of those, drawing a sample from the likelihood</span><span class="co">]</span>{.mark}.</span>
<span id="cb93-318"><a href="#cb93-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-319"><a href="#cb93-319" aria-hidden="true" tabindex="-1"></a>Let's walk through this.</span>
<span id="cb93-320"><a href="#cb93-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-321"><a href="#cb93-321" aria-hidden="true" tabindex="-1"></a>First, we need the $x$ values for each individual. We'll say the healthy one is Person 1 and the unhealthy one is Person 2. Their $x$ values are:</span>
<span id="cb93-322"><a href="#cb93-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-325"><a href="#cb93-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-326"><a href="#cb93-326" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-x-values</span></span>
<span id="cb93-327"><a href="#cb93-327" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">0</span>)  <span class="co"># &lt;1&gt;</span></span>
<span id="cb93-328"><a href="#cb93-328" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">35</span>, <span class="dv">35</span>) <span class="co"># &lt;2&gt;</span></span>
<span id="cb93-329"><a href="#cb93-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-330"><a href="#cb93-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-331"><a href="#cb93-331" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>good health person's data (bad_health_indicator=0,age=35,age<span class="sc">\*</span>indicator=0)</span>
<span id="cb93-332"><a href="#cb93-332" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>bad health person's (bad_health_indicator=1,age=35,age<span class="sc">\*</span>indicator=35)</span>
<span id="cb93-333"><a href="#cb93-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-334"><a href="#cb93-334" aria-hidden="true" tabindex="-1"></a>The posterior samples of the model parameters are stored in <span class="in">`mod_csim`</span>:</span>
<span id="cb93-335"><a href="#cb93-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-338"><a href="#cb93-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-339"><a href="#cb93-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: show-mod-csim-head</span></span>
<span id="cb93-340"><a href="#cb93-340" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mod_csim)</span>
<span id="cb93-341"><a href="#cb93-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-342"><a href="#cb93-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-343"><a href="#cb93-343" aria-hidden="true" tabindex="-1"></a>First, we'll compute the linear part of the predictor:</span>
<span id="cb93-344"><a href="#cb93-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-347"><a href="#cb93-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-348"><a href="#cb93-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-log-lambda</span></span>
<span id="cb93-349"><a href="#cb93-349" aria-hidden="true" tabindex="-1"></a>loglam1 <span class="ot">=</span> mod_csim[,<span class="st">"int"</span>] <span class="sc">+</span> mod_csim[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)] <span class="sc">%*%</span> x1</span>
<span id="cb93-350"><a href="#cb93-350" aria-hidden="true" tabindex="-1"></a>loglam2 <span class="ot">=</span> mod_csim[,<span class="st">"int"</span>] <span class="sc">+</span> mod_csim[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>)] <span class="sc">%*%</span> x2</span>
<span id="cb93-351"><a href="#cb93-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-352"><a href="#cb93-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-353"><a href="#cb93-353" aria-hidden="true" tabindex="-1"></a>Next we'll apply the inverse link:</span>
<span id="cb93-354"><a href="#cb93-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-357"><a href="#cb93-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-358"><a href="#cb93-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-lambda</span></span>
<span id="cb93-359"><a href="#cb93-359" aria-hidden="true" tabindex="-1"></a>lam1 <span class="ot">=</span> <span class="fu">exp</span>(loglam1)</span>
<span id="cb93-360"><a href="#cb93-360" aria-hidden="true" tabindex="-1"></a>lam2 <span class="ot">=</span> <span class="fu">exp</span>(loglam2)</span>
<span id="cb93-361"><a href="#cb93-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-362"><a href="#cb93-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-363"><a href="#cb93-363" aria-hidden="true" tabindex="-1"></a>The final step is to use these samples for the $\lambda$ parameter for each individual and simulate actual number of doctor visits using the likelihood:</span>
<span id="cb93-364"><a href="#cb93-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-367"><a href="#cb93-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-368"><a href="#cb93-368" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-nsim</span></span>
<span id="cb93-369"><a href="#cb93-369" aria-hidden="true" tabindex="-1"></a>(<span class="at">n_sim =</span> <span class="fu">length</span>(lam1))</span>
<span id="cb93-370"><a href="#cb93-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-371"><a href="#cb93-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-372"><a href="#cb93-372" aria-hidden="true" tabindex="-1"></a>we have distribution of 15000 samples of $\lambda$ for each person.</span>
<span id="cb93-373"><a href="#cb93-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-376"><a href="#cb93-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-377"><a href="#cb93-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-y1-y2</span></span>
<span id="cb93-378"><a href="#cb93-378" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">=</span> <span class="fu">rpois</span>(<span class="at">n=</span>n_sim, <span class="at">lambda=</span>lam1) <span class="co">#&lt;1&gt;</span></span>
<span id="cb93-379"><a href="#cb93-379" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">=</span> <span class="fu">rpois</span>(<span class="at">n=</span>n_sim, <span class="at">lambda=</span>lam2) <span class="co">#&lt;1&gt;</span></span>
<span id="cb93-380"><a href="#cb93-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-381"><a href="#cb93-381" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">table</span>(<span class="fu">factor</span>(y1, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">18</span>))<span class="sc">/</span>n_sim, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"posterior prob."</span>, <span class="at">xlab=</span><span class="st">"visits"</span>)</span>
<span id="cb93-382"><a href="#cb93-382" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">table</span>(y2<span class="fl">+0.1</span>)<span class="sc">/</span>n_sim, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb93-383"><a href="#cb93-383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-384"><a href="#cb93-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-387"><a href="#cb93-387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-388"><a href="#cb93-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-posterior-predictive</span></span>
<span id="cb93-389"><a href="#cb93-389" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">table</span>(<span class="fu">factor</span>(y1, <span class="at">levels=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">18</span>))<span class="sc">/</span>n_sim, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">ylab=</span><span class="st">"posterior prob."</span>, <span class="at">xlab=</span><span class="st">"visits"</span>)</span>
<span id="cb93-390"><a href="#cb93-390" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">table</span>(y2<span class="fl">+0.1</span>)<span class="sc">/</span>n_sim, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb93-391"><a href="#cb93-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-392"><a href="#cb93-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-393"><a href="#cb93-393" aria-hidden="true" tabindex="-1"></a>Finally, we can answer the original question: What is the probability that the person with poor health will have more doctor visits than the person with good health?</span>
<span id="cb93-394"><a href="#cb93-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-397"><a href="#cb93-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-398"><a href="#cb93-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-prob-y2-greater-y1</span></span>
<span id="cb93-399"><a href="#cb93-399" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y2 <span class="sc">&gt;</span> y1)</span>
<span id="cb93-400"><a href="#cb93-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-401"><a href="#cb93-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-402"><a href="#cb93-402" aria-hidden="true" tabindex="-1"></a>Because we used our posterior samples for the model parameters in our simulation (the <span class="in">`loglam1`</span> and <span class="in">`loglam2`</span> step above), this posterior predictive distribution on the number of visits for these two new individuals naturally account for our uncertainty in the model estimates. This is a more honest/realistic distribution than we would get if we had fixed the model parameters at their MLE or posterior means and simulated data for the new individuals.</span>
<span id="cb93-403"><a href="#cb93-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-404"><a href="#cb93-404" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prior sensitivity analysis {#sec-prior-sensitivity-analysis}</span></span>
<span id="cb93-405"><a href="#cb93-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-406"><a href="#cb93-406" aria-hidden="true" tabindex="-1"></a>\index{prior sensitivity analysis} \index{modeling decisions} \index{sensitivity analysis}</span>
<span id="cb93-407"><a href="#cb93-407" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Q. How do you justify the model you choose?**</span><span class="co">]</span>{.column-margin} When communicating results from any analysis, a responsible statistician will report and justify *modeling decisions*, especially assumptions. In a Bayesian analysis, there is an additional assumption that is open to scrutiny: the *choices of prior distributions*. In the models considered so far in this course, there are an infinite number of prior distributions we could have chosen from.</span>
<span id="cb93-408"><a href="#cb93-408" aria-hidden="true" tabindex="-1"></a>When communicating results from any analysis, a responsible statistician will report and justify *modeling decisions*, especially assumptions. In a Bayesian analysis, there is another assumption that is open to scrutiny: the *choices of prior distributions*. In the models considered so far in this course, there are an infinite number of prior distributions we could have chosen from.</span>
<span id="cb93-409"><a href="#cb93-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-410"><a href="#cb93-410" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**Q. How do you justify the priors you choose?**</span><span class="co">]</span>{.column-margin} If they truly represent your beliefs about the parameters before analysis and the model is appropriate, then the posterior distribution truly represents your updated beliefs. If you don't have any strong beliefs beforehand, there are often default, reference, or non-informative prior options, and you will have to select one. However, a collaborator or a boss (indeed, somebody somewhere) may not agree with your choice of prior. <span class="co">[</span><span class="ot">One way to increase the credibility of your results is to repeat the analysis under a variety of priors, and report how the results differ as a result.</span><span class="co">]</span>{.mark} This process is called *prior sensitivity analysis*. \index{prior sensitivity analysis}</span>
<span id="cb93-411"><a href="#cb93-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-412"><a href="#cb93-412" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">At a minimum you should always report your choice of model and prior</span><span class="co">]</span>{.mark}. If you include a sensitivity analysis, select one or more alternative priors and describe how the results of the analysis change. If they are sensitive to the choice of prior, you will likely have to explain both sets of results, or at least explain why you favor one prior over another. <span class="co">[</span><span class="ot">If the results are not sensitive to the choice of prior, this is evidence that the data are strongly driving the results. It suggests that different investigators coming from different backgrounds should come to the same conclusions.</span><span class="co">]</span>{.mark}</span>
<span id="cb93-413"><a href="#cb93-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-414"><a href="#cb93-414" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">If the purpose of your analysis is to establish a hypothesis, it is often prudent to include a "skeptical" prior which does not favor the hypothesis.</span><span class="co">]</span>{.mark} Then, if the posterior distribution still favors the hypothesis despite the unfavorable prior, you will be able to say that the data substantially favor the hypothesis. This is the approach we will take in the following example, continued from the previous lesson.</span>
<span id="cb93-415"><a href="#cb93-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-416"><a href="#cb93-416" aria-hidden="true" tabindex="-1"></a><span class="fu">### Poisson regression example</span></span>
<span id="cb93-417"><a href="#cb93-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-418"><a href="#cb93-418" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**doctor visits**</span><span class="co">]</span>{.column-margin} Let's return to the example of number of doctor visits. We concluded from our previous analysis of these data that both bad health and increased age are associated with more visits. Suppose the burden of proof that bad health is actually associated with more visits rests with us, and we need to convince a skeptic.</span>
<span id="cb93-419"><a href="#cb93-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-420"><a href="#cb93-420" aria-hidden="true" tabindex="-1"></a>First, let's re-run the original analysis and remind ourselves of the posterior distribution for the <span class="in">`badh`</span> (bad health) indicator.</span>
<span id="cb93-421"><a href="#cb93-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-424"><a href="#cb93-424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-425"><a href="#cb93-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-libraries-sensitivity</span></span>
<span id="cb93-426"><a href="#cb93-426" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"COUNT"</span>)</span>
<span id="cb93-427"><a href="#cb93-427" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rjags"</span>)</span>
<span id="cb93-428"><a href="#cb93-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-429"><a href="#cb93-429" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"badhealth"</span>)</span>
<span id="cb93-430"><a href="#cb93-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-431"><a href="#cb93-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-434"><a href="#cb93-434" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-435"><a href="#cb93-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-model-string</span></span>
<span id="cb93-436"><a href="#cb93-436" aria-hidden="true" tabindex="-1"></a>mod_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb93-437"><a href="#cb93-437" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) {</span></span>
<span id="cb93-438"><a href="#cb93-438" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dpois(lam[i])</span></span>
<span id="cb93-439"><a href="#cb93-439" aria-hidden="true" tabindex="-1"></a><span class="st">        log(lam[i]) = int + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<span id="cb93-440"><a href="#cb93-440" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb93-441"><a href="#cb93-441" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb93-442"><a href="#cb93-442" aria-hidden="true" tabindex="-1"></a><span class="st">    int ~ dnorm(0.0, 1.0/1e6)</span></span>
<span id="cb93-443"><a href="#cb93-443" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-444"><a href="#cb93-444" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-445"><a href="#cb93-445" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-446"><a href="#cb93-446" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb93-447"><a href="#cb93-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-448"><a href="#cb93-448" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb93-449"><a href="#cb93-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-450"><a href="#cb93-450" aria-hidden="true" tabindex="-1"></a>data_jags <span class="ot">=</span> <span class="fu">as.list</span>(badhealth)</span>
<span id="cb93-451"><a href="#cb93-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-452"><a href="#cb93-452" aria-hidden="true" tabindex="-1"></a>params <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"int"</span>, <span class="st">"b_badh"</span>, <span class="st">"b_age"</span>, <span class="st">"b_intx"</span>)</span>
<span id="cb93-453"><a href="#cb93-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-454"><a href="#cb93-454" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod_string), <span class="at">data=</span>data_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="cb93-455"><a href="#cb93-455" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod, <span class="fl">1e3</span>)</span>
<span id="cb93-456"><a href="#cb93-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-457"><a href="#cb93-457" aria-hidden="true" tabindex="-1"></a>mod_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod,</span>
<span id="cb93-458"><a href="#cb93-458" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params,</span>
<span id="cb93-459"><a href="#cb93-459" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb93-460"><a href="#cb93-460" aria-hidden="true" tabindex="-1"></a>mod_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod_sim))</span>
<span id="cb93-461"><a href="#cb93-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-462"><a href="#cb93-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-465"><a href="#cb93-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-466"><a href="#cb93-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-density-bbadh</span></span>
<span id="cb93-467"><a href="#cb93-467" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(mod_csim[,<span class="st">"b_badh"</span>]))</span>
<span id="cb93-468"><a href="#cb93-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-469"><a href="#cb93-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-470"><a href="#cb93-470" aria-hidden="true" tabindex="-1"></a>Essentially all of the posterior probability mass is above 0, suggesting that this coefficient is positive (and consequently that bad health is associated with more visits). We obtained this result using a relatively noninformative prior. What if we use a prior that strongly favors values near 0? Let's repeat the analysis with a normal prior on the <span class="in">`badh`</span> coefficient that has mean 0 and standard deviation 0.2, so that the prior probability that the coefficient is less than 0.6 is $&gt;0.998$ . We'll also use a small variance on the prior for the interaction term involving <span class="in">`badh`</span> (standard deviation 0.01 because this coefficient is on a much smaller scale).</span>
<span id="cb93-471"><a href="#cb93-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-474"><a href="#cb93-474" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-475"><a href="#cb93-475" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-model2-string</span></span>
<span id="cb93-476"><a href="#cb93-476" aria-hidden="true" tabindex="-1"></a>mod2_string <span class="ot">=</span> <span class="st">" model {</span></span>
<span id="cb93-477"><a href="#cb93-477" aria-hidden="true" tabindex="-1"></a><span class="st">    for (i in 1:length(numvisit)) {</span></span>
<span id="cb93-478"><a href="#cb93-478" aria-hidden="true" tabindex="-1"></a><span class="st">        numvisit[i] ~ dpois(lam[i])</span></span>
<span id="cb93-479"><a href="#cb93-479" aria-hidden="true" tabindex="-1"></a><span class="st">        log(lam[i]) = int + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i]</span></span>
<span id="cb93-480"><a href="#cb93-480" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb93-481"><a href="#cb93-481" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb93-482"><a href="#cb93-482" aria-hidden="true" tabindex="-1"></a><span class="st">    int ~ dnorm(0.0, 1.0/1e6)</span></span>
<span id="cb93-483"><a href="#cb93-483" aria-hidden="true" tabindex="-1"></a><span class="st">    b_badh ~ dnorm(0.0, 1.0/0.2^2)</span></span>
<span id="cb93-484"><a href="#cb93-484" aria-hidden="true" tabindex="-1"></a><span class="st">    b_age ~ dnorm(0.0, 1.0/1e4)</span></span>
<span id="cb93-485"><a href="#cb93-485" aria-hidden="true" tabindex="-1"></a><span class="st">    b_intx ~ dnorm(0.0, 1.0/0.01^2)</span></span>
<span id="cb93-486"><a href="#cb93-486" aria-hidden="true" tabindex="-1"></a><span class="st">} "</span></span>
<span id="cb93-487"><a href="#cb93-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-488"><a href="#cb93-488" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">=</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(mod2_string), <span class="at">data=</span>data_jags, <span class="at">n.chains=</span><span class="dv">3</span>)</span>
<span id="cb93-489"><a href="#cb93-489" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod2, <span class="fl">1e3</span>)</span>
<span id="cb93-490"><a href="#cb93-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-491"><a href="#cb93-491" aria-hidden="true" tabindex="-1"></a>mod2_sim <span class="ot">=</span> <span class="fu">coda.samples</span>(<span class="at">model=</span>mod2,</span>
<span id="cb93-492"><a href="#cb93-492" aria-hidden="true" tabindex="-1"></a>                        <span class="at">variable.names=</span>params,</span>
<span id="cb93-493"><a href="#cb93-493" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n.iter=</span><span class="fl">5e3</span>)</span>
<span id="cb93-494"><a href="#cb93-494" aria-hidden="true" tabindex="-1"></a>mod2_csim <span class="ot">=</span> <span class="fu">as.mcmc</span>(<span class="fu">do.call</span>(rbind, mod2_sim))</span>
<span id="cb93-495"><a href="#cb93-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-496"><a href="#cb93-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-497"><a href="#cb93-497" aria-hidden="true" tabindex="-1"></a>How did the posterior distribution for the coefficient of <span class="in">`badh`</span> change?</span>
<span id="cb93-498"><a href="#cb93-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-501"><a href="#cb93-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-502"><a href="#cb93-502" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prior-and-posterior-comparison</span></span>
<span id="cb93-503"><a href="#cb93-503" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">1e4</span>)), <span class="at">from=</span><span class="sc">-</span><span class="fl">3.0</span>, <span class="at">to=</span><span class="fl">3.0</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">0.0</span>, <span class="fl">3.0</span>), <span class="at">lty=</span><span class="dv">2</span>,</span>
<span id="cb93-504"><a href="#cb93-504" aria-hidden="true" tabindex="-1"></a>      <span class="at">main=</span><span class="st">"b_badh"</span>, <span class="at">ylab=</span><span class="st">"density"</span>, <span class="at">xlab=</span><span class="st">"b_badh"</span>)</span>
<span id="cb93-505"><a href="#cb93-505" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fl">0.2</span>), <span class="at">from=</span><span class="sc">-</span><span class="fl">3.0</span>, <span class="at">to=</span><span class="fl">3.0</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb93-506"><a href="#cb93-506" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod_csim[,<span class="st">"b_badh"</span>]))</span>
<span id="cb93-507"><a href="#cb93-507" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod2_csim[,<span class="st">"b_badh"</span>]), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb93-508"><a href="#cb93-508" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"noninformative prior"</span>, <span class="st">"posterior"</span>, <span class="st">"skeptical prior"</span>, <span class="st">"posterior"</span>),</span>
<span id="cb93-509"><a href="#cb93-509" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">each=</span><span class="dv">2</span>), <span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb93-510"><a href="#cb93-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-511"><a href="#cb93-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-512"><a href="#cb93-512" aria-hidden="true" tabindex="-1"></a>Under the skeptical prior, our posterior distribution for <span class="in">`b_badh`</span> has significantly dropped to between about 0.6 and 1.1. Although the strong prior influenced our inference on the magnitude of the bad health effect on visits, it did not change the fact that the coefficient is significantly above 0. In other words: even under the skeptical prior, bad health is associated with more visits, with posterior probability near 1.</span>
<span id="cb93-513"><a href="#cb93-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-514"><a href="#cb93-514" aria-hidden="true" tabindex="-1"></a>We should also check the effect of our skeptical prior on the interaction term involving both age and health.</span>
<span id="cb93-515"><a href="#cb93-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-518"><a href="#cb93-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-519"><a href="#cb93-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-prior-and-posterior-comparison-intx</span></span>
<span id="cb93-520"><a href="#cb93-520" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fl">1e4</span>)), <span class="at">from=</span><span class="sc">-</span><span class="fl">0.05</span>, <span class="at">to=</span><span class="fl">0.05</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">0.0</span>, <span class="fl">140.0</span>), <span class="at">lty=</span><span class="dv">2</span>,</span>
<span id="cb93-521"><a href="#cb93-521" aria-hidden="true" tabindex="-1"></a>      <span class="at">main=</span><span class="st">"b_intx"</span>, <span class="at">ylab=</span><span class="st">"density"</span>, <span class="at">xlab=</span><span class="st">"b_intx"</span>)</span>
<span id="cb93-522"><a href="#cb93-522" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean=</span><span class="fl">0.0</span>, <span class="at">sd=</span><span class="fl">0.01</span>), <span class="at">from=</span><span class="sc">-</span><span class="fl">0.05</span>, <span class="at">to=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb93-523"><a href="#cb93-523" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod_csim[,<span class="st">"b_intx"</span>]))</span>
<span id="cb93-524"><a href="#cb93-524" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(mod2_csim[,<span class="st">"b_intx"</span>]), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb93-525"><a href="#cb93-525" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"noninformative prior"</span>, <span class="st">"posterior"</span>, <span class="st">"skeptical prior"</span>, <span class="st">"posterior"</span>),</span>
<span id="cb93-526"><a href="#cb93-526" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="at">col=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">each=</span><span class="dv">2</span>), <span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb93-527"><a href="#cb93-527" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-528"><a href="#cb93-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-531"><a href="#cb93-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-532"><a href="#cb93-532" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-mean-bintx-positive</span></span>
<span id="cb93-533"><a href="#cb93-533" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mod2_csim[,<span class="st">"b_intx"</span>] <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="co"># posterior probability that b_intx is positive</span></span>
<span id="cb93-534"><a href="#cb93-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-535"><a href="#cb93-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-536"><a href="#cb93-536" aria-hidden="true" tabindex="-1"></a>The result here is interesting. Our estimate for the interaction coefficient has gone from negative under the non-informative prior to positive under the skeptical prior, so the result is sensitive. In this case, because the skeptical prior shrinks away much of the bad health main effect, it is likely that this interaction effect attempts to restore some of the positive effect of bad health on visits. Thus, despite some observed prior sensitivity, our conclusion that bad health positively associates with more visits remains unchanged.</span>
<span id="cb93-537"><a href="#cb93-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-538"><a href="#cb93-538" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overdispersed model</span></span>
<span id="cb93-539"><a href="#cb93-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-540"><a href="#cb93-540" aria-hidden="true" tabindex="-1"></a>Recall that the **Negative Binomial** can be used to model overdispersed count data.</span>
<span id="cb93-541"><a href="#cb93-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-542"><a href="#cb93-542" aria-hidden="true" tabindex="-1"></a><span class="in">`stan`</span> has three parameterizations for the **Negative Binomial**.</span>
<span id="cb93-543"><a href="#cb93-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-544"><a href="#cb93-544" aria-hidden="true" tabindex="-1"></a>The first looks like similar to a binomial parameterization:</span>
<span id="cb93-545"><a href="#cb93-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-546"><a href="#cb93-546" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-547"><a href="#cb93-547" aria-hidden="true" tabindex="-1"></a>\text{NegBinomial}(y~|~\alpha,\beta)  = \binom{y +</span>
<span id="cb93-548"><a href="#cb93-548" aria-hidden="true" tabindex="-1"></a>\alpha - 1}{\alpha - 1} \, \left( \frac{\beta}{\beta+1}</span>
<span id="cb93-549"><a href="#cb93-549" aria-hidden="true" tabindex="-1"></a>\right)^{<span class="sc">\!</span>\alpha} \, \left( \frac{1}{\beta + 1} \right)^{<span class="sc">\!</span>y} <span class="sc">\!</span>.</span>
<span id="cb93-550"><a href="#cb93-550" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-551"><a href="#cb93-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-552"><a href="#cb93-552" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-553"><a href="#cb93-553" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">y</span><span class="co">]</span> = \frac{\alpha}{\beta} \ \ \text{ and } \ \ \text{Var}<span class="co">[</span><span class="ot">Y</span><span class="co">]</span> = \frac{\alpha}{\beta^2} (\beta + 1).</span>
<span id="cb93-554"><a href="#cb93-554" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-555"><a href="#cb93-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-556"><a href="#cb93-556" aria-hidden="true" tabindex="-1"></a>we can sample from this using the following statement</span>
<span id="cb93-557"><a href="#cb93-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-558"><a href="#cb93-558" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb93-559"><a href="#cb93-559" aria-hidden="true" tabindex="-1"></a>n <span class="sc">~</span> <span class="fu">neg_binomial</span>(alpha, beta)</span>
<span id="cb93-560"><a href="#cb93-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-561"><a href="#cb93-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-562"><a href="#cb93-562" aria-hidden="true" tabindex="-1"></a>But this parameterization if not a match to the Poisson model, so we move on</span>
<span id="cb93-563"><a href="#cb93-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-564"><a href="#cb93-564" aria-hidden="true" tabindex="-1"></a>The second parametrization $\mu \in \mathbb{R}^+$ and $\phi \in \mathbb{R}^+$:</span>
<span id="cb93-565"><a href="#cb93-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-566"><a href="#cb93-566" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-567"><a href="#cb93-567" aria-hidden="true" tabindex="-1"></a>\text{NegBinomial2}(n \, | \, \mu, \phi)  = \binom{n + \phi - 1}{n} \,</span>
<span id="cb93-568"><a href="#cb93-568" aria-hidden="true" tabindex="-1"></a>\left( \frac{\mu}{\mu+\phi} \right)^{<span class="sc">\!</span>n} \, \left(</span>
<span id="cb93-569"><a href="#cb93-569" aria-hidden="true" tabindex="-1"></a>\frac{\phi}{\mu+\phi} \right)^{<span class="sc">\!</span>\phi}</span>
<span id="cb93-570"><a href="#cb93-570" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-571"><a href="#cb93-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-572"><a href="#cb93-572" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-573"><a href="#cb93-573" aria-hidden="true" tabindex="-1"></a>\mathbb{E}<span class="co">[</span><span class="ot">n</span><span class="co">]</span> = \mu \ \ \text{ and } \ \ \ \mathbb{V}\text{ar}<span class="co">[</span><span class="ot">n</span><span class="co">]</span> = \mu + \frac{\mu^2}{\phi}</span>
<span id="cb93-574"><a href="#cb93-574" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-575"><a href="#cb93-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-576"><a href="#cb93-576" aria-hidden="true" tabindex="-1"></a>we can sample from this using the following statement</span>
<span id="cb93-577"><a href="#cb93-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-578"><a href="#cb93-578" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb93-579"><a href="#cb93-579" aria-hidden="true" tabindex="-1"></a>n <span class="sc">~</span> <span class="fu">neg_binomial_2</span>(mu, phi)</span>
<span id="cb93-580"><a href="#cb93-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb93-581"><a href="#cb93-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-582"><a href="#cb93-582" aria-hidden="true" tabindex="-1"></a>And there is a third parametrization</span>
<span id="cb93-583"><a href="#cb93-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-584"><a href="#cb93-584" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-585"><a href="#cb93-585" aria-hidden="true" tabindex="-1"></a>NegBinomial2Log(y\mid\mu,\phi) = NegBinomial2(y\mid exp(\eta),\phi).</span>
<span id="cb93-586"><a href="#cb93-586" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb93-587"><a href="#cb93-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-588"><a href="#cb93-588" aria-hidden="true" tabindex="-1"></a>we can sample from this using the following statement:</span>
<span id="cb93-589"><a href="#cb93-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-590"><a href="#cb93-590" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb93-591"><a href="#cb93-591" aria-hidden="true" tabindex="-1"></a>y \<span class="sc">~</span> <span class="er">**</span>neg_binomial_2\_log<span class="sc">**</span>(y\<span class="sc">|</span>mu, phi)<span class="st">`</span></span>
<span id="cb93-592"><a href="#cb93-592" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-593"><a href="#cb93-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-594"><a href="#cb93-594" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">jags</span><span class="st">`</span> has just one parameterization<span class="sc">:</span></span>
<span id="cb93-595"><a href="#cb93-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-596"><a href="#cb93-596" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb93-597"><a href="#cb93-597" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(y \mid r, p) <span class="ot">=</span> \frac{\<span class="fu">Gamma</span>(y<span class="sc">+</span>r)}{\<span class="fu">Gamma</span>(r)\<span class="fu">Gamma</span>(y<span class="sc">+</span><span class="dv">1</span>)}p<span class="sc">^</span><span class="fu">r</span>(<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">^</span>y</span>
<span id="cb93-598"><a href="#cb93-598" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span></span>
<span id="cb93-599"><a href="#cb93-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-600"><a href="#cb93-600" aria-hidden="true" tabindex="-1"></a>We think of the Negative Binomial Distribution as the probability of completing <span class="sc">$</span>y<span class="sc">$</span> successful trials allowing <span class="cf">for</span> <span class="sc">$</span>r<span class="sc">$</span> failures <span class="cf">in</span> a sequence of <span class="sc">$</span>(y<span class="sc">+</span>r)<span class="sc">$</span> Bernoulli trials where success is defined as <span class="fu">drawing</span> (with replacement) a white ball from an urn of white and black balls with a probability <span class="st">`</span><span class="at">p</span><span class="st">`</span> of success.</span>
<span id="cb93-601"><a href="#cb93-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-602"><a href="#cb93-602" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span></span>
<span id="cb93-603"><a href="#cb93-603" aria-hidden="true" tabindex="-1"></a>\mathbb{E}[Y] <span class="ot">=</span> \mu <span class="ot">=</span> { <span class="fu">r</span>(<span class="dv">1</span><span class="sc">-</span>p) \over p }\ \ \text{ and } \ \ \ \mathbb{V}\text{ar}[Y] <span class="ot">=</span> \mu <span class="sc">+</span> \frac{\mu<span class="sc">^</span><span class="dv">2</span>}{r}</span>
<span id="cb93-604"><a href="#cb93-604" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span></span>
<span id="cb93-605"><a href="#cb93-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-606"><a href="#cb93-606" aria-hidden="true" tabindex="-1"></a><span class="do">### Transformations:</span></span>
<span id="cb93-607"><a href="#cb93-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-608"><a href="#cb93-608" aria-hidden="true" tabindex="-1"></a>Since we want to have a model corresponding to a poisson regression we will transform the model as follows<span class="sc">:</span></span>
<span id="cb93-609"><a href="#cb93-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-610"><a href="#cb93-610" aria-hidden="true" tabindex="-1"></a>If we set <span class="sc">$</span>p <span class="ot">=</span> {\text{r} \over {r} <span class="sc">+</span> \lambda }<span class="sc">$</span> then the mean becomes <span class="sc">:</span> <span class="er">$</span>\lambda<span class="sc">$</span></span>
<span id="cb93-611"><a href="#cb93-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-612"><a href="#cb93-612" aria-hidden="true" tabindex="-1"></a>and <span class="cf">if</span> we also set <span class="sc">$</span>r<span class="ot">=</span> {\lambda<span class="sc">^</span><span class="dv">2</span> \over \omega}<span class="sc">$</span> then the variance becomes a sum of <span class="sc">$</span>\lambda <span class="sc">+</span> \omega<span class="sc">$</span> where <span class="sc">$</span>\omega<span class="sc">$</span> is our <span class="sc">**</span>over dispersion<span class="sc">**</span> term.</span>
<span id="cb93-613"><a href="#cb93-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-614"><a href="#cb93-614" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span></span>
<span id="cb93-615"><a href="#cb93-615" aria-hidden="true" tabindex="-1"></a>\omega <span class="ot">=</span> \lambda<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> r</span>
<span id="cb93-616"><a href="#cb93-616" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span></span>
<span id="cb93-617"><a href="#cb93-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-618"><a href="#cb93-618" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb93-619"><a href="#cb93-619" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb93-620"><a href="#cb93-620" aria-hidden="true" tabindex="-1"></a>\mathbb{E}[Y] <span class="sc">&amp;</span><span class="er">=</span> { <span class="fu">r</span>(<span class="dv">1</span><span class="sc">-</span>p) \over p } </span>
<span id="cb93-621"><a href="#cb93-621" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span><span class="er">=</span> rp<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>} <span class="sc">-</span>r </span>
<span id="cb93-622"><a href="#cb93-622" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span> \stackrel {sub\ p} <span class="ot">=</span>  {\cancel{r}(\bcancel{r}<span class="sc">+</span>\lambda) \over \cancel{r}} <span class="sc">-</span> \bcancel{r} </span>
<span id="cb93-623"><a href="#cb93-623" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span><span class="er">=</span> \lambda \mathbb{V}\text{ar}[Y] </span>
<span id="cb93-624"><a href="#cb93-624" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span><span class="er">=</span> { (<span class="dv">1</span><span class="sc">-</span>p) r \over p<span class="sc">^</span><span class="dv">2</span> }</span>
<span id="cb93-625"><a href="#cb93-625" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span> \stackrel {sub \ \lambda } <span class="ot">=</span> {<span class="dv">1</span> \over p} \lambda </span>
<span id="cb93-626"><a href="#cb93-626" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span> \stackrel {sub p} <span class="ot">=</span> \lambda { (r<span class="sc">+</span> \lambda) \over r} </span>
<span id="cb93-627"><a href="#cb93-627" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span><span class="er">=</span>  {\lambda r <span class="sc">+</span>  \lambda<span class="sc">^</span><span class="dv">2</span> \over r } </span>
<span id="cb93-628"><a href="#cb93-628" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span><span class="er">=</span> <span class="dv">1</span> \lambda <span class="sc">+</span> {\lambda<span class="sc">^</span><span class="dv">2</span> \over r} </span>
<span id="cb93-629"><a href="#cb93-629" aria-hidden="true" tabindex="-1"></a>\\ <span class="sc">&amp;</span>\stackrel { sub \ \omega}<span class="ot">=</span> \lambda <span class="sc">+</span> \omega</span>
<span id="cb93-630"><a href="#cb93-630" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb93-631"><a href="#cb93-631" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span></span>
<span id="cb93-632"><a href="#cb93-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-633"><a href="#cb93-633" aria-hidden="true" tabindex="-1"></a>Where we interpret <span class="sc">$</span>\lambda<span class="sc">$</span> as the mean and <span class="sc">$</span>\omega<span class="sc">$</span> as the overdispersion \index{overdispersion}</span>
<span id="cb93-634"><a href="#cb93-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-637"><a href="#cb93-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-638"><a href="#cb93-638" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: load-libraries-overdispersed</span></span>
<span id="cb93-639"><a href="#cb93-639" aria-hidden="true" tabindex="-1"></a><span class="at">library("rjags")</span></span>
<span id="cb93-640"><a href="#cb93-640" aria-hidden="true" tabindex="-1"></a><span class="at">library("COUNT")</span></span>
<span id="cb93-641"><a href="#cb93-641" aria-hidden="true" tabindex="-1"></a><span class="at">data("badhealth")</span></span>
<span id="cb93-642"><a href="#cb93-642" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-643"><a href="#cb93-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-646"><a href="#cb93-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-647"><a href="#cb93-647" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: define-overdispersed-model</span></span>
<span id="cb93-648"><a href="#cb93-648" aria-hidden="true" tabindex="-1"></a><span class="at">mod3_string = "</span></span>
<span id="cb93-649"><a href="#cb93-649" aria-hidden="true" tabindex="-1"></a><span class="at">model {</span></span>
<span id="cb93-650"><a href="#cb93-650" aria-hidden="true" tabindex="-1"></a><span class="at">    for (i in 1:length(numvisit)) { </span></span>
<span id="cb93-651"><a href="#cb93-651" aria-hidden="true" tabindex="-1"></a><span class="at">        mu[i]       = b0 + b_badh*badh[i] + b_age*age[i] + b_intx*age[i]*badh[i] # &lt;1&gt;</span></span>
<span id="cb93-652"><a href="#cb93-652" aria-hidden="true" tabindex="-1"></a><span class="at">        lambda[i]   = exp(mu[i])                                                 # &lt;2&gt; </span></span>
<span id="cb93-653"><a href="#cb93-653" aria-hidden="true" tabindex="-1"></a><span class="at">        p[i]        = r / (r + lambda[i])                                        # &lt;3&gt;</span></span>
<span id="cb93-654"><a href="#cb93-654" aria-hidden="true" tabindex="-1"></a><span class="at">        numvisit[i] ~ dnegbin(p[i], r)                                           # &lt;4&gt;</span></span>
<span id="cb93-655"><a href="#cb93-655" aria-hidden="true" tabindex="-1"></a><span class="at">        resid[i]       = numvisit[i] - p[i]                                      # &lt;5&gt;</span></span>
<span id="cb93-656"><a href="#cb93-656" aria-hidden="true" tabindex="-1"></a><span class="at">    }</span></span>
<span id="cb93-657"><a href="#cb93-657" aria-hidden="true" tabindex="-1"></a><span class="at">    ## Priors</span></span>
<span id="cb93-658"><a href="#cb93-658" aria-hidden="true" tabindex="-1"></a><span class="at">    b0        ~ dnorm(0.0, 1.0/1e6)    # &lt;6&gt;</span></span>
<span id="cb93-659"><a href="#cb93-659" aria-hidden="true" tabindex="-1"></a><span class="at">    b_badh    ~ dnorm(0.0, 1.0/0.2^2)  # &lt;7&gt;</span></span>
<span id="cb93-660"><a href="#cb93-660" aria-hidden="true" tabindex="-1"></a><span class="at">    b_age     ~ dnorm(0.0, 1.0/1e4)    # &lt;8&gt;</span></span>
<span id="cb93-661"><a href="#cb93-661" aria-hidden="true" tabindex="-1"></a><span class="at">    b_intx    ~ dnorm(0.0, 1.0/0.01^2) # &lt;9&gt;</span></span>
<span id="cb93-662"><a href="#cb93-662" aria-hidden="true" tabindex="-1"></a><span class="at">    r ~ dunif(0,50)            # &lt;10&gt;</span></span>
<span id="cb93-663"><a href="#cb93-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-664"><a href="#cb93-664" aria-hidden="true" tabindex="-1"></a><span class="at">    ## extra deterministic parameters</span></span>
<span id="cb93-665"><a href="#cb93-665" aria-hidden="true" tabindex="-1"></a><span class="at">    omega      &lt;-  pow(mean(lambda),2)/2</span></span>
<span id="cb93-666"><a href="#cb93-666" aria-hidden="true" tabindex="-1"></a><span class="at">    #theta      &lt;- pow(1/mean(p),2)     # &lt;11&gt;</span></span>
<span id="cb93-667"><a href="#cb93-667" aria-hidden="true" tabindex="-1"></a><span class="at">    #scale      &lt;- mean((1-p)/p)        # &lt;12&gt;</span></span>
<span id="cb93-668"><a href="#cb93-668" aria-hidden="true" tabindex="-1"></a><span class="at">}"</span></span>
<span id="cb93-669"><a href="#cb93-669" aria-hidden="true" tabindex="-1"></a><span class="at">data3_jags = as.list(badhealth)</span></span>
<span id="cb93-670"><a href="#cb93-670" aria-hidden="true" tabindex="-1"></a><span class="at">mod3 = jags.model(textConnection(mod3_string), data=data3_jags, n.chains=3)</span></span>
<span id="cb93-671"><a href="#cb93-671" aria-hidden="true" tabindex="-1"></a><span class="at">update(mod3, 1e3)                                                           # &lt;13&gt;</span></span>
<span id="cb93-672"><a href="#cb93-672" aria-hidden="true" tabindex="-1"></a><span class="at">params3 = c("b_intx", "b_badh", "b_age", 'over_disp', 'b0','omega','r')</span></span>
<span id="cb93-673"><a href="#cb93-673" aria-hidden="true" tabindex="-1"></a><span class="at">mod3_sim = coda.samples(model=mod3,  variable.names=params3, n.iter=5e3)    # &lt;14&gt;</span></span>
<span id="cb93-674"><a href="#cb93-674" aria-hidden="true" tabindex="-1"></a><span class="at">mod3_csim = as.mcmc(do.call(rbind, mod3_sim))                               # &lt;15&gt;</span></span>
<span id="cb93-675"><a href="#cb93-675" aria-hidden="true" tabindex="-1"></a><span class="at">(dic3 = dic.samples(mod3, n.iter=1e3))                                      # &lt;16&gt;</span></span>
<span id="cb93-676"><a href="#cb93-676" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-677"><a href="#cb93-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-678"><a href="#cb93-678" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span>  the linear part</span>
<span id="cb93-679"><a href="#cb93-679" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span>  lambda corresponds to the parameter used <span class="cf">in</span> the Poisson regression</span>
<span id="cb93-680"><a href="#cb93-680" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span>  p is the success parameter</span>
<span id="cb93-681"><a href="#cb93-681" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span>  we draw from the negative binomial distribution</span>
<span id="cb93-682"><a href="#cb93-682" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span>  sampling using the parametrization of the Negative Binomial distribution.</span>
<span id="cb93-683"><a href="#cb93-683" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span>  normal prior <span class="cf">for</span> intercept <span class="st">`</span><span class="at">b0</span><span class="st">`</span></span>
<span id="cb93-684"><a href="#cb93-684" aria-hidden="true" tabindex="-1"></a><span class="fl">7.</span>  normal prior <span class="cf">for</span> <span class="st">`</span><span class="at">b_badh</span><span class="st">`</span></span>
<span id="cb93-685"><a href="#cb93-685" aria-hidden="true" tabindex="-1"></a><span class="fl">8.</span>  normal prior <span class="cf">for</span> <span class="st">`</span><span class="at">b_age</span><span class="st">`</span></span>
<span id="cb93-686"><a href="#cb93-686" aria-hidden="true" tabindex="-1"></a><span class="fl">9.</span>  normal prior <span class="cf">for</span> <span class="st">`</span><span class="at">b_intx</span><span class="st">`</span></span>
<span id="cb93-687"><a href="#cb93-687" aria-hidden="true" tabindex="-1"></a><span class="fl">10.</span> uniform prior <span class="cf">for</span> <span class="st">`</span><span class="at">over_disp</span><span class="st">`</span> <span class="sc">-</span> at the upper limit of <span class="dv">50</span> <span class="sc">**</span>NegBin<span class="sc">**</span> converges to <span class="sc">**</span>Poisson<span class="sc">**</span> see [<span class="sc">@</span>jackman2009 p. <span class="dv">280</span>]</span>
<span id="cb93-688"><a href="#cb93-688" aria-hidden="true" tabindex="-1"></a><span class="fl">11.</span> theta param</span>
<span id="cb93-689"><a href="#cb93-689" aria-hidden="true" tabindex="-1"></a><span class="fl">12.</span> scale param</span>
<span id="cb93-690"><a href="#cb93-690" aria-hidden="true" tabindex="-1"></a><span class="fl">13.</span> burn <span class="cf">in</span></span>
<span id="cb93-691"><a href="#cb93-691" aria-hidden="true" tabindex="-1"></a><span class="fl">14.</span> sample</span>
<span id="cb93-692"><a href="#cb93-692" aria-hidden="true" tabindex="-1"></a><span class="fl">15.</span> stack samples from the chains</span>
<span id="cb93-693"><a href="#cb93-693" aria-hidden="true" tabindex="-1"></a><span class="fl">16.</span> estimate the DIC</span>
<span id="cb93-694"><a href="#cb93-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-697"><a href="#cb93-697" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-698"><a href="#cb93-698" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: gelman-diag-mod3-sim</span></span>
<span id="cb93-699"><a href="#cb93-699" aria-hidden="true" tabindex="-1"></a><span class="at">gelman.diag(mod3_sim )</span></span>
<span id="cb93-700"><a href="#cb93-700" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-701"><a href="#cb93-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-704"><a href="#cb93-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-705"><a href="#cb93-705" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: raftery-diag-mod3-sim</span></span>
<span id="cb93-706"><a href="#cb93-706" aria-hidden="true" tabindex="-1"></a><span class="at">raftery.diag(mod3_sim)</span></span>
<span id="cb93-707"><a href="#cb93-707" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-708"><a href="#cb93-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-711"><a href="#cb93-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-712"><a href="#cb93-712" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: autocorr-diag-mod3-sim</span></span>
<span id="cb93-713"><a href="#cb93-713" aria-hidden="true" tabindex="-1"></a><span class="at">autocorr.diag(mod3_sim)</span></span>
<span id="cb93-714"><a href="#cb93-714" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-715"><a href="#cb93-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-718"><a href="#cb93-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-719"><a href="#cb93-719" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: effectiveSize-mod3-sim</span></span>
<span id="cb93-720"><a href="#cb93-720" aria-hidden="true" tabindex="-1"></a><span class="at">effectiveSize(mod3_sim)</span></span>
<span id="cb93-721"><a href="#cb93-721" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-722"><a href="#cb93-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-725"><a href="#cb93-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-726"><a href="#cb93-726" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: summary-mod3-sim</span></span>
<span id="cb93-727"><a href="#cb93-727" aria-hidden="true" tabindex="-1"></a><span class="at">summary(mod3_sim)</span></span>
<span id="cb93-728"><a href="#cb93-728" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-729"><a href="#cb93-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-732"><a href="#cb93-732" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-733"><a href="#cb93-733" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: fig-overdisperesed-convergence</span></span>
<span id="cb93-734"><a href="#cb93-734" aria-hidden="true" tabindex="-1"></a><span class="at">#| layout-ncol: 2</span></span>
<span id="cb93-735"><a href="#cb93-735" aria-hidden="true" tabindex="-1"></a><span class="at">par(mar = c(2.5, 1, 2.5, 1))</span></span>
<span id="cb93-736"><a href="#cb93-736" aria-hidden="true" tabindex="-1"></a><span class="at">plot(mod3_sim, auto.layout = FALSE)</span></span>
<span id="cb93-737"><a href="#cb93-737" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-738"><a href="#cb93-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-741"><a href="#cb93-741" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-742"><a href="#cb93-742" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: fig-autocorr-plot-mod3-csim</span></span>
<span id="cb93-743"><a href="#cb93-743" aria-hidden="true" tabindex="-1"></a><span class="at">#| layout-ncol: 1</span></span>
<span id="cb93-744"><a href="#cb93-744" aria-hidden="true" tabindex="-1"></a><span class="at">autocorr.plot(mod3_csim,auto.layout = FALSE)</span></span>
<span id="cb93-745"><a href="#cb93-745" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-746"><a href="#cb93-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-747"><a href="#cb93-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-750"><a href="#cb93-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-751"><a href="#cb93-751" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: compute-X-pmed-r</span></span>
<span id="cb93-752"><a href="#cb93-752" aria-hidden="true" tabindex="-1"></a><span class="at">X = as.matrix(badhealth[,-1])</span></span>
<span id="cb93-753"><a href="#cb93-753" aria-hidden="true" tabindex="-1"></a><span class="at">X = cbind(X, with(badhealth, badh*age))</span></span>
<span id="cb93-754"><a href="#cb93-754" aria-hidden="true" tabindex="-1"></a><span class="at">(pmed_coef = apply(mod3_csim, 2, median))</span></span>
<span id="cb93-755"><a href="#cb93-755" aria-hidden="true" tabindex="-1"></a><span class="at">(r = pmed_coef["r"] )</span></span>
<span id="cb93-756"><a href="#cb93-756" aria-hidden="true" tabindex="-1"></a><span class="at">mu_hat = pmed_coef["b0"] + X %*% pmed_coef[c("b_badh", "b_age", "b_intx")]</span></span>
<span id="cb93-757"><a href="#cb93-757" aria-hidden="true" tabindex="-1"></a><span class="at">lambda_hat = exp(mu_hat)</span></span>
<span id="cb93-758"><a href="#cb93-758" aria-hidden="true" tabindex="-1"></a><span class="at">p_hat = r / (r + lambda_hat)</span></span>
<span id="cb93-759"><a href="#cb93-759" aria-hidden="true" tabindex="-1"></a><span class="at">hist(lambda_hat)</span></span>
<span id="cb93-760"><a href="#cb93-760" aria-hidden="true" tabindex="-1"></a><span class="at">hist(p_hat)</span></span>
<span id="cb93-761"><a href="#cb93-761" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-762"><a href="#cb93-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-763"><a href="#cb93-763" aria-hidden="true" tabindex="-1"></a>residuals</span>
<span id="cb93-764"><a href="#cb93-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-767"><a href="#cb93-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-768"><a href="#cb93-768" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: compute-resid-p_hat</span></span>
<span id="cb93-769"><a href="#cb93-769" aria-hidden="true" tabindex="-1"></a><span class="at">resid = badhealth$numvisit - p_hat</span></span>
<span id="cb93-770"><a href="#cb93-770" aria-hidden="true" tabindex="-1"></a><span class="at">head(resid)</span></span>
<span id="cb93-771"><a href="#cb93-771" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-772"><a href="#cb93-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-775"><a href="#cb93-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-776"><a href="#cb93-776" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: fig-residuals-plot</span></span>
<span id="cb93-777"><a href="#cb93-777" aria-hidden="true" tabindex="-1"></a><span class="at">#| fig-cap: "Plot of residuals"</span></span>
<span id="cb93-778"><a href="#cb93-778" aria-hidden="true" tabindex="-1"></a><span class="at">plot(resid) # the data were ordered</span></span>
<span id="cb93-779"><a href="#cb93-779" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-780"><a href="#cb93-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-783"><a href="#cb93-783" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-784"><a href="#cb93-784" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: tbl-head-mod3_csim</span></span>
<span id="cb93-785"><a href="#cb93-785" aria-hidden="true" tabindex="-1"></a><span class="at">#| tbl-cap: "First few rows of mod3_csim"</span></span>
<span id="cb93-786"><a href="#cb93-786" aria-hidden="true" tabindex="-1"></a><span class="at">head(mod3_csim)</span></span>
<span id="cb93-787"><a href="#cb93-787" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-788"><a href="#cb93-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-791"><a href="#cb93-791" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-792"><a href="#cb93-792" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: fig-p_hat-vs-numvisit</span></span>
<span id="cb93-793"><a href="#cb93-793" aria-hidden="true" tabindex="-1"></a><span class="at">#| fig-cap: "Plot of p_hat vs numvisit"</span></span>
<span id="cb93-794"><a href="#cb93-794" aria-hidden="true" tabindex="-1"></a><span class="at">plot(p_hat, badhealth$numvisit)</span></span>
<span id="cb93-795"><a href="#cb93-795" aria-hidden="true" tabindex="-1"></a><span class="at">abline(0.0, 1.0)</span></span>
<span id="cb93-796"><a href="#cb93-796" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-797"><a href="#cb93-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-800"><a href="#cb93-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-801"><a href="#cb93-801" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: fig-p_hat-vs-resid</span></span>
<span id="cb93-802"><a href="#cb93-802" aria-hidden="true" tabindex="-1"></a><span class="at">#| fig-cap: "Plot of p_hat vs residuals, colored by health status"</span></span>
<span id="cb93-803"><a href="#cb93-803" aria-hidden="true" tabindex="-1"></a><span class="at">plot(p_hat[which(badhealth$badh==0)], resid[which(badhealth$badh==0)], xlim=range(p_hat), ylab="residuals", xlab=expression(hat(p)), ylim=range(resid))</span></span>
<span id="cb93-804"><a href="#cb93-804" aria-hidden="true" tabindex="-1"></a><span class="at">points(p_hat[which(badhealth$badh==1)], resid[which(badhealth$badh==1)], col="red")</span></span>
<span id="cb93-805"><a href="#cb93-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-806"><a href="#cb93-806" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb93-807"><a href="#cb93-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-810"><a href="#cb93-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb93-811"><a href="#cb93-811" aria-hidden="true" tabindex="-1"></a><span class="at">#| label: compute-variance-resid-by-health</span></span>
<span id="cb93-812"><a href="#cb93-812" aria-hidden="true" tabindex="-1"></a><span class="at">var(resid[which(badhealth$badh==0)])</span></span>
<span id="cb93-813"><a href="#cb93-813" aria-hidden="true" tabindex="-1"></a><span class="at">var(resid[which(badhealth$badh==1)])</span></span>
<span id="cb93-814"><a href="#cb93-814" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"fade","descPosition":"bottom","loop":true,"openEffect":"fade","selector":".lightbox","skin":"my-css-class"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>